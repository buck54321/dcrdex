{"version":3,"file":"entry.js","mappings":"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","sources":["webpack://dexclient/./node_modules/@babel/runtime/helpers/regeneratorRuntime.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/typeof.js","webpack://dexclient/./node_modules/@babel/runtime/regenerator/index.js","webpack://dexclient/webpack/bootstrap","webpack://dexclient/webpack/runtime/compat get default export","webpack://dexclient/webpack/runtime/define property getters","webpack://dexclient/webpack/runtime/hasOwnProperty shorthand","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/slicedToArray.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/classCallCheck.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/toPrimitive.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/createClass.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack://dexclient/./src/js/locales.ts","webpack://dexclient/./src/js/doc.ts","webpack://dexclient/./src/js/state.ts","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/inherits.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","webpack://dexclient/./src/js/http.ts","webpack://dexclient/./src/js/registry.ts","webpack://dexclient/./src/js/opts.ts","webpack://dexclient/./src/js/basepage.ts","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/iterableToArray.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","webpack://dexclient/./src/js/orderutil.ts","webpack://dexclient/./src/js/charts.ts","webpack://dexclient/./src/js/forms.ts","webpack://dexclient/./src/js/register.ts","webpack://dexclient/./src/js/login.ts","webpack://dexclient/./src/js/wallets.ts","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js","webpack://dexclient/./node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js","webpack://dexclient/./src/js/settings.ts","webpack://dexclient/./src/js/orderbook.ts","webpack://dexclient/./src/js/ws.ts","webpack://dexclient/./src/js/markets.ts","webpack://dexclient/./src/js/orders.ts","webpack://dexclient/./src/js/order.ts","webpack://dexclient/./src/js/dexsettings.ts","webpack://dexclient/./src/js/mm.ts","webpack://dexclient/./src/js/app.ts","webpack://dexclient/./src/js/notifications.ts","webpack://dexclient/./src/index.ts"],"sourcesContent":["var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction _regeneratorRuntime() {\n  \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */\n  module.exports = _regeneratorRuntime = function _regeneratorRuntime() {\n    return exports;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;\n  var exports = {},\n    Op = Object.prototype,\n    hasOwn = Op.hasOwnProperty,\n    defineProperty = Object.defineProperty || function (obj, key, desc) {\n      obj[key] = desc.value;\n    },\n    $Symbol = \"function\" == typeof Symbol ? Symbol : {},\n    iteratorSymbol = $Symbol.iterator || \"@@iterator\",\n    asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\",\n    toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n  function define(obj, key, value) {\n    return Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: !0,\n      configurable: !0,\n      writable: !0\n    }), obj[key];\n  }\n  try {\n    define({}, \"\");\n  } catch (err) {\n    define = function define(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator,\n      generator = Object.create(protoGenerator.prototype),\n      context = new Context(tryLocsList || []);\n    return defineProperty(generator, \"_invoke\", {\n      value: makeInvokeMethod(innerFn, self, context)\n    }), generator;\n  }\n  function tryCatch(fn, obj, arg) {\n    try {\n      return {\n        type: \"normal\",\n        arg: fn.call(obj, arg)\n      };\n    } catch (err) {\n      return {\n        type: \"throw\",\n        arg: err\n      };\n    }\n  }\n  exports.wrap = wrap;\n  var ContinueSentinel = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  var IteratorPrototype = {};\n  define(IteratorPrototype, iteratorSymbol, function () {\n    return this;\n  });\n  var getProto = Object.getPrototypeOf,\n    NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype);\n  var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype);\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function (method) {\n      define(prototype, method, function (arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (\"throw\" !== record.type) {\n        var result = record.arg,\n          value = result.value;\n        return value && \"object\" == _typeof(value) && hasOwn.call(value, \"__await\") ? PromiseImpl.resolve(value.__await).then(function (value) {\n          invoke(\"next\", value, resolve, reject);\n        }, function (err) {\n          invoke(\"throw\", err, resolve, reject);\n        }) : PromiseImpl.resolve(value).then(function (unwrapped) {\n          result.value = unwrapped, resolve(result);\n        }, function (error) {\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n      reject(record.arg);\n    }\n    var previousPromise;\n    defineProperty(this, \"_invoke\", {\n      value: function value(method, arg) {\n        function callInvokeWithMethodAndArg() {\n          return new PromiseImpl(function (resolve, reject) {\n            invoke(method, arg, resolve, reject);\n          });\n        }\n        return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();\n      }\n    });\n  }\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = \"suspendedStart\";\n    return function (method, arg) {\n      if (\"executing\" === state) throw new Error(\"Generator is already running\");\n      if (\"completed\" === state) {\n        if (\"throw\" === method) throw arg;\n        return doneResult();\n      }\n      for (context.method = method, context.arg = arg;;) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n        if (\"next\" === context.method) context.sent = context._sent = context.arg;else if (\"throw\" === context.method) {\n          if (\"suspendedStart\" === state) throw state = \"completed\", context.arg;\n          context.dispatchException(context.arg);\n        } else \"return\" === context.method && context.abrupt(\"return\", context.arg);\n        state = \"executing\";\n        var record = tryCatch(innerFn, self, context);\n        if (\"normal\" === record.type) {\n          if (state = context.done ? \"completed\" : \"suspendedYield\", record.arg === ContinueSentinel) continue;\n          return {\n            value: record.arg,\n            done: context.done\n          };\n        }\n        \"throw\" === record.type && (state = \"completed\", context.method = \"throw\", context.arg = record.arg);\n      }\n    };\n  }\n  function maybeInvokeDelegate(delegate, context) {\n    var methodName = context.method,\n      method = delegate.iterator[methodName];\n    if (undefined === method) return context.delegate = null, \"throw\" === methodName && delegate.iterator[\"return\"] && (context.method = \"return\", context.arg = undefined, maybeInvokeDelegate(delegate, context), \"throw\" === context.method) || \"return\" !== methodName && (context.method = \"throw\", context.arg = new TypeError(\"The iterator does not provide a '\" + methodName + \"' method\")), ContinueSentinel;\n    var record = tryCatch(method, delegate.iterator, context.arg);\n    if (\"throw\" === record.type) return context.method = \"throw\", context.arg = record.arg, context.delegate = null, ContinueSentinel;\n    var info = record.arg;\n    return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, \"return\" !== context.method && (context.method = \"next\", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = \"throw\", context.arg = new TypeError(\"iterator result is not an object\"), context.delegate = null, ContinueSentinel);\n  }\n  function pushTryEntry(locs) {\n    var entry = {\n      tryLoc: locs[0]\n    };\n    1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry);\n  }\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\", delete record.arg, entry.completion = record;\n  }\n  function Context(tryLocsList) {\n    this.tryEntries = [{\n      tryLoc: \"root\"\n    }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0);\n  }\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) return iteratorMethod.call(iterable);\n      if (\"function\" == typeof iterable.next) return iterable;\n      if (!isNaN(iterable.length)) {\n        var i = -1,\n          next = function next() {\n            for (; ++i < iterable.length;) if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next;\n            return next.value = undefined, next.done = !0, next;\n          };\n        return next.next = next;\n      }\n    }\n    return {\n      next: doneResult\n    };\n  }\n  function doneResult() {\n    return {\n      value: undefined,\n      done: !0\n    };\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, defineProperty(Gp, \"constructor\", {\n    value: GeneratorFunctionPrototype,\n    configurable: !0\n  }), defineProperty(GeneratorFunctionPrototype, \"constructor\", {\n    value: GeneratorFunction,\n    configurable: !0\n  }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, \"GeneratorFunction\"), exports.isGeneratorFunction = function (genFun) {\n    var ctor = \"function\" == typeof genFun && genFun.constructor;\n    return !!ctor && (ctor === GeneratorFunction || \"GeneratorFunction\" === (ctor.displayName || ctor.name));\n  }, exports.mark = function (genFun) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, \"GeneratorFunction\")), genFun.prototype = Object.create(Gp), genFun;\n  }, exports.awrap = function (arg) {\n    return {\n      __await: arg\n    };\n  }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () {\n    return this;\n  }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    void 0 === PromiseImpl && (PromiseImpl = Promise);\n    var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl);\n    return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) {\n      return result.done ? result.value : iter.next();\n    });\n  }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, \"Generator\"), define(Gp, iteratorSymbol, function () {\n    return this;\n  }), define(Gp, \"toString\", function () {\n    return \"[object Generator]\";\n  }), exports.keys = function (val) {\n    var object = Object(val),\n      keys = [];\n    for (var key in object) keys.push(key);\n    return keys.reverse(), function next() {\n      for (; keys.length;) {\n        var key = keys.pop();\n        if (key in object) return next.value = key, next.done = !1, next;\n      }\n      return next.done = !0, next;\n    };\n  }, exports.values = values, Context.prototype = {\n    constructor: Context,\n    reset: function reset(skipTempReset) {\n      if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) \"t\" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined);\n    },\n    stop: function stop() {\n      this.done = !0;\n      var rootRecord = this.tryEntries[0].completion;\n      if (\"throw\" === rootRecord.type) throw rootRecord.arg;\n      return this.rval;\n    },\n    dispatchException: function dispatchException(exception) {\n      if (this.done) throw exception;\n      var context = this;\n      function handle(loc, caught) {\n        return record.type = \"throw\", record.arg = exception, context.next = loc, caught && (context.method = \"next\", context.arg = undefined), !!caught;\n      }\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i],\n          record = entry.completion;\n        if (\"root\" === entry.tryLoc) return handle(\"end\");\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\"),\n            hasFinally = hasOwn.call(entry, \"finallyLoc\");\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0);\n            if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc);\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0);\n          } else {\n            if (!hasFinally) throw new Error(\"try statement without catch or finally\");\n            if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc);\n          }\n        }\n      }\n    },\n    abrupt: function abrupt(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev && hasOwn.call(entry, \"finallyLoc\") && this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n      finallyEntry && (\"break\" === type || \"continue\" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null);\n      var record = finallyEntry ? finallyEntry.completion : {};\n      return record.type = type, record.arg = arg, finallyEntry ? (this.method = \"next\", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record);\n    },\n    complete: function complete(record, afterLoc) {\n      if (\"throw\" === record.type) throw record.arg;\n      return \"break\" === record.type || \"continue\" === record.type ? this.next = record.arg : \"return\" === record.type ? (this.rval = this.arg = record.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel;\n    },\n    finish: function finish(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel;\n      }\n    },\n    \"catch\": function _catch(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (\"throw\" === record.type) {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n      throw new Error(\"illegal catch attempt\");\n    },\n    delegateYield: function delegateYield(iterable, resultName, nextLoc) {\n      return this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      }, \"next\" === this.method && (this.arg = undefined), ContinueSentinel;\n    }\n  }, exports;\n}\nmodule.exports = _regeneratorRuntime, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return (module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports), _typeof(obj);\n}\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// TODO(Babel 8): Remove this file.\n\nvar runtime = require(\"../helpers/regeneratorRuntime\")();\nmodule.exports = runtime;\n\n// Copied from https://github.com/facebook/regenerator/blob/main/packages/runtime/runtime.js#L736=\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"];\n  if (null != _i) {\n    var _s,\n      _e,\n      _x,\n      _r,\n      _arr = [],\n      _n = !0,\n      _d = !1;\n    try {\n      if (_x = (_i = _i.call(arr)).next, 0 === i) {\n        if (Object(_i) !== _i) return;\n        _n = !1;\n      } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);\n    } catch (err) {\n      _d = !0, _e = err;\n    } finally {\n      try {\n        if (!_n && null != _i[\"return\"] && (_r = _i[\"return\"](), Object(_r) !== _r)) return;\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n      args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n      _next(undefined);\n    });\n  };\n}","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nexport default function _toPropertyKey(arg) {\n  var key = toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}","import _typeof from \"./typeof.js\";\nexport default function _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, toPropertyKey(descriptor.key), descriptor);\n  }\n}\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","import toPropertyKey from \"./toPropertyKey.js\";\nexport default function _defineProperty(obj, key, value) {\n  key = toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}","type Locale = Record<string, string>\n\nexport const ID_NO_PASS_ERROR_MSG = 'ID_NO_PASS_ERROR_MSG'\nexport const ID_NO_APP_PASS_ERROR_MSG = 'ID_NO_APP_PASS_ERROR_MSG'\nexport const ID_SET_BUTTON_BUY = 'ID_SET_BUTTON_BUY'\nexport const ID_SET_BUTTON_SELL = 'ID_SET_BUTTON_SELL'\nexport const ID_OFF = 'ID_OFF'\nexport const ID_READY = 'ID_READY'\nexport const ID_NO_WALLET = 'ID_NO_WALLET'\nexport const ID_DISABLED_MSG = 'ID_DISABLED_MSG'\nexport const ID_WALLET_SYNC_PROGRESS = 'ID_WALLET_SYNC_PROGRESS'\nexport const ID_HIDE_ADDITIONAL_SETTINGS = 'ID_HIDE_ADDITIONAL_SETTINGS'\nexport const ID_SHOW_ADDITIONAL_SETTINGS = 'ID_SHOW_ADDITIONAL_SETTINGS'\nexport const ID_BUY = 'ID_BUY'\nexport const ID_SELL = 'ID_SELL'\nexport const ID_NOT_SUPPORTED = 'ID_NOT_SUPPORTED'\nexport const ID_VERSION_NOT_SUPPORTED = 'ID_VERSION_NOT_SUPPORTED'\nexport const ID_CONNECTION_FAILED = 'ID_CONNECTION_FAILED'\nexport const ID_ORDER_PREVIEW = 'ID_ORDER_PREVIEW'\nexport const ID_CALCULATING = 'ID_CALCULATING'\nexport const ID_ESTIMATE_UNAVAILABLE = 'ID_ESTIMATE_UNAVAILABLE'\nexport const ID_NO_ZERO_RATE = 'ID_NO_ZERO_RATE'\nexport const ID_NO_ZERO_QUANTITY = 'ID_NO_ZERO_QUANTITY'\nexport const ID_TRADE = 'ID_TRADE'\nexport const ID_NO_ASSET_WALLET = 'ID_NO_ASSET_WALLET'\nexport const ID_EXECUTED = 'ID_EXECUTED'\nexport const ID_BOOKED = 'ID_BOOKED'\nexport const ID_CANCELING = 'ID_CANCELING'\nexport const ID_PASSWORD_NOT_MATCH = 'ID_PASSWORD_NOT_MATCH'\nexport const ID_ACCT_UNDEFINED = 'ID_ACCT_UNDEFINED'\nexport const ID_KEEP_WALLET_PASS = 'ID_KEEP_WALLET_PASS'\nexport const ID_NEW_WALLET_PASS = 'ID_NEW_WALLET_PASS'\nexport const ID_LOT = 'ID_LOT'\nexport const ID_LOTS = 'ID_LOTS'\nexport const ID_UNKNOWN = 'ID_UNKNOWN'\nexport const ID_EPOCH = 'ID_EPOCH'\nexport const ID_ORDER_SUBMITTING = 'ID_ORDER_SUBMITTING'\nexport const ID_SETTLING = 'ID_SETTLING'\nexport const ID_NO_MATCH = 'ID_NO_MATCH'\nexport const ID_CANCELED = 'ID_CANCELED'\nexport const ID_REVOKED = 'ID_REVOKED'\nexport const ID_WAITING_FOR_CONFS = 'ID_WAITING_FOR_CONFS'\nexport const ID_NONE_SELECTED = 'ID_NONE_SELECTED' // unused?\nexport const ID_REGISTRATION_FEE_SUCCESS = 'ID_REGISTRATION_FEE_SUCCESS'\nexport const ID_API_ERROR = 'ID_API_ERROR'\nexport const ID_ADD = 'ID_ADD'\nexport const ID_CREATE = 'ID_CREATE'\nexport const ID_SETUP_WALLET = 'ID_SETUP_WALLET'\nexport const ID_WALLET_READY = 'ID_WALLET_READY'\nexport const ID_CHANGE_WALLET_TYPE = 'ID_CHANGE_WALLET_TYPE'\nexport const ID_KEEP_WALLET_TYPE = 'ID_KEEP_WALLET_TYPE'\nexport const WALLET_READY = 'WALLET_READY'\nexport const WALLET_PENDING = 'WALLET_PENDING'\nexport const SETUP_NEEDED = 'SETUP_NEEDED'\nexport const ID_SEND_SUCCESS = 'SEND_SUCCESS'\nexport const ID_RECONFIG_SUCCESS = 'RECONFIG_SUCCESS'\nexport const ID_RESCAN_STARTED = 'RESCAN_STARTED'\nexport const ID_NEW_WALLET_SUCCESS = 'NEW_WALLET_SUCCESS'\nexport const ID_WALLET_UNLOCKED = 'WALLET_UNLOCKED'\nexport const ID_SELLING = 'ID_SELLING'\nexport const ID_BUYING = 'ID_BUYING'\nexport const ID_WALLET_DISABLED_MSG = 'WALLET_DISABLED'\nexport const ID_WALLET_ENABLED_MSG = 'WALLET_ENABLED'\nexport const ID_ACTIVE_ORDERS_ERR_MSG = 'ACTIVE_ORDERS_ERR_MSG'\nexport const ID_AVAILABLE = 'AVAILABLE'\nexport const ID_LOCKED = 'LOCKED'\nexport const ID_IMMATURE = 'IMMATURE'\nexport const ID_FEE_BALANCE = 'FEE_BALANCE'\nexport const ID_CANDLES_LOADING = 'CANDLES_LOADING'\nexport const ID_DEPTH_LOADING = 'DEPTH_LOADING'\nexport const ID_INVALID_ADDRESS_MSG = 'INVALID_ADDRESS_MSG'\nexport const ID_TXFEE_UNSUPPORTED = 'TXFEE_UNSUPPORTED'\nexport const ID_TXFEE_ERR_MSG = 'TXFEE_ERR_MSG'\nexport const ID_ACTIVE_ORDERS_LOGOUT_ERR_MSG = 'ACTIVE_ORDERS_LOGOUT_ERR_MSG'\nexport const ID_INVALID_DATE_ERR_MSG = 'INVALID_DATE_ERR_MSG'\nexport const ID_NO_ARCHIVED_RECORDS = 'NO_ARCHIVED_RECORDS'\nexport const ID_DELETE_ARCHIVED_RECORDS_RESULT = 'DELETE_ARCHIVED_RECORDS_RESULT'\nexport const ID_ARCHIVED_RECORDS_PATH = 'ARCHIVED_RECORDS_PATH'\nexport const ID_DEFAULT = 'DEFAULT'\nexport const ID_ADDED = 'USER_ADDED'\nexport const ID_DISCOVERED = 'DISCOVERED'\nexport const ID_UNSUPPORTED_ASSET_INFO_ERR_MSG = 'UNSUPPORTED_ASSET_INFO_ERR_MSG'\nexport const ID_LIMIT_ORDER = 'LIMIT_ORDER'\nexport const ID_LIMIT_ORDER_IMMEDIATE_TIF = 'LIMIT_ORDER_IMMEDIATE_TIF'\nexport const ID_MARKET_ORDER = 'MARKET_ORDER'\nexport const ID_MATCH_STATUS_NEWLY_MATCHED = 'MATCH_STATUS_NEWLY_MATCHED'\nexport const ID_MATCH_STATUS_MAKER_SWAP_CAST = 'MATCH_STATUS_MAKER_SWAP_CAST'\nexport const ID_MATCH_STATUS_TAKER_SWAP_CAST = 'MATCH_STATUS_TAKER_SWAP_CAST'\nexport const ID_MATCH_STATUS_MAKER_REDEEMED = 'MATCH_STATUS_MAKER_REDEEMED'\nexport const ID_MATCH_STATUS_REDEMPTION_SENT = 'MATCH_STATUS_REDEMPTION_SENT'\nexport const ID_MATCH_STATUS_REDEMPTION_CONFIRMED = 'MATCH_REDEMPTION_CONFIRMED'\nexport const ID_MATCH_STATUS_REVOKED = 'MATCH_STATUS_REVOKED'\nexport const ID_MATCH_STATUS_REFUNDED = 'MATCH_STATUS_REFUNDED'\nexport const ID_MATCH_STATUS_REFUND_PENDING = 'MATCH_STATUS_REFUND_PENDING'\nexport const ID_MATCH_STATUS_REDEEM_PENDING = 'MATCH_STATUS_REDEEM_PENDING'\nexport const ID_MATCH_STATUS_COMPLETE = 'MATCH_STATUS_COMPLETE'\nexport const ID_TAKER_FOUND_MAKER_REDEMPTION = 'TAKER_FOUND_MAKER_REDEMPTION'\nexport const ID_OPEN_WALLET_ERR_MSG = 'OPEN_WALLET_ERR_MSG'\nexport const ID_ORDER_ACCELERATION_FEE_ERR_MSG = 'ORDER_ACCELERATION_FEE_ERR_MSG'\nexport const ID_ORDER_ACCELERATION_ERR_MSG = 'ORDER_ACCELERATION_FEE_ERR_MSG'\nexport const ID_CONNECTED = 'CONNECTED'\nexport const ID_DISCONNECTED = 'DISCONNECTED'\nexport const ID_INVALID_CERTIFICATE = 'INVALID_CERTIFICATE'\nexport const ID_CONFIRMATIONS = 'ID_CONFIRMATIONS'\nexport const ID_TAKER = 'TAKER'\nexport const ID_MAKER = 'MAKER'\nexport const ID_EMPTY_DEX_ADDRESS_MSG = 'EMPTY_DEX_ADDRESS_MSG'\nexport const ID_SELECT_WALLET_FOR_FEE_PAYMENT = 'SELECT_WALLET_FOR_FEE_PAYMENT'\nexport const ID_UNAVAILABLE = 'UNAVAILABLE'\nexport const ID_WALLET_SYNC_FINISHING_UP = 'WALLET_SYNC_FINISHING_UP'\nexport const ID_CONNECT_WALLET_ERR_MSG = 'CONNECTING_WALLET_ERR_MSG'\n\nexport const enUS: Locale = {\n  [ID_NO_PASS_ERROR_MSG]: 'password cannot be empty',\n  [ID_NO_APP_PASS_ERROR_MSG]: 'app password cannot be empty',\n  [ID_PASSWORD_NOT_MATCH]: 'passwords do not match',\n  [ID_SET_BUTTON_BUY]: 'Place order to buy  {{ asset }}',\n  [ID_SET_BUTTON_SELL]: 'Place order to sell {{ asset }}',\n  [ID_OFF]: 'off',\n  [ID_READY]: 'ready',\n  [ID_LOCKED]: 'locked',\n  [ID_NO_WALLET]: 'no wallet',\n  [ID_WALLET_SYNC_PROGRESS]: 'wallet is {{ syncProgress }}% synced',\n  [ID_HIDE_ADDITIONAL_SETTINGS]: 'hide additional settings',\n  [ID_SHOW_ADDITIONAL_SETTINGS]: 'show additional settings',\n  [ID_BUY]: 'Buy',\n  [ID_SELL]: 'Sell',\n  [ID_NOT_SUPPORTED]: '{{ asset }} is not supported',\n  [ID_VERSION_NOT_SUPPORTED]: '{{ asset }} (v{{version}}) is not supported',\n  [ID_CONNECTION_FAILED]: 'Connection to dex server failed. You can close dexc and try again later or wait for it to reconnect.',\n  [ID_ORDER_PREVIEW]: 'Total: {{ total }} {{ asset }}',\n  [ID_CALCULATING]: 'calculating...',\n  [ID_ESTIMATE_UNAVAILABLE]: 'estimate unavailable',\n  [ID_NO_ZERO_RATE]: 'zero rate not allowed',\n  [ID_NO_ZERO_QUANTITY]: 'zero quantity not allowed',\n  [ID_TRADE]: 'trade',\n  [ID_NO_ASSET_WALLET]: 'No {{ asset }} wallet',\n  [ID_EXECUTED]: 'executed',\n  [ID_BOOKED]: 'booked',\n  [ID_CANCELING]: 'canceling',\n  [ID_ACCT_UNDEFINED]: 'Account undefined.',\n  [ID_KEEP_WALLET_PASS]: 'keep current wallet password',\n  [ID_NEW_WALLET_PASS]: 'set a new wallet password',\n  [ID_LOT]: 'lot',\n  [ID_LOTS]: 'lots',\n  [ID_UNKNOWN]: 'unknown',\n  [ID_EPOCH]: 'epoch',\n  [ID_SETTLING]: 'settling',\n  [ID_NO_MATCH]: 'no match',\n  [ID_CANCELED]: 'canceled',\n  [ID_REVOKED]: 'revoked',\n  [ID_WAITING_FOR_CONFS]: 'Waiting for confirmations...',\n  [ID_NONE_SELECTED]: 'none selected',\n  [ID_REGISTRATION_FEE_SUCCESS]: 'Fidelity bond accepted!',\n  [ID_API_ERROR]: 'API error',\n  [ID_ADD]: 'Add',\n  [ID_CREATE]: 'Create',\n  [ID_WALLET_READY]: 'Ready',\n  [ID_SETUP_WALLET]: 'Setup',\n  [ID_CHANGE_WALLET_TYPE]: 'change the wallet type',\n  [ID_KEEP_WALLET_TYPE]: 'don\\'t change the wallet type',\n  [WALLET_READY]: 'Wallet Ready',\n  [SETUP_NEEDED]: 'Setup Needed',\n  [WALLET_PENDING]: 'Creating Wallet',\n  [ID_SEND_SUCCESS]: '{{ assetName }} Sent!',\n  [ID_RECONFIG_SUCCESS]: 'Wallet Reconfigured!',\n  [ID_RESCAN_STARTED]: 'Wallet Rescan Running',\n  [ID_NEW_WALLET_SUCCESS]: '{{ assetName }} Wallet Created!',\n  [ID_WALLET_UNLOCKED]: 'Wallet Unlocked',\n  [ID_SELLING]: 'Selling',\n  [ID_BUYING]: 'Buying',\n  [ID_WALLET_ENABLED_MSG]: '{{ assetName }} Wallet Enabled',\n  [ID_WALLET_DISABLED_MSG]: '{{ assetName }} Wallet Disabled',\n  [ID_DISABLED_MSG]: 'wallet is disabled',\n  [ID_ACTIVE_ORDERS_ERR_MSG]: '{{ assetName }} wallet is actively managing orders',\n  [ID_AVAILABLE]: 'available',\n  [ID_IMMATURE]: 'immature',\n  [ID_FEE_BALANCE]: 'fee balance',\n  [ID_CANDLES_LOADING]: 'waiting for candlesticks',\n  [ID_DEPTH_LOADING]: 'retrieving depth data',\n  [ID_INVALID_ADDRESS_MSG]: 'invalid address: {{ address }}',\n  [ID_TXFEE_UNSUPPORTED]: 'fee estimation is not supported for this wallet type',\n  [ID_TXFEE_ERR_MSG]: 'fee estimation failed: {{ err }}',\n  [ID_ACTIVE_ORDERS_LOGOUT_ERR_MSG]: 'cannot logout with active orders',\n  [ID_INVALID_DATE_ERR_MSG]: 'error: invalid date or time',\n  [ID_NO_ARCHIVED_RECORDS]: 'No archived records found',\n  [ID_DELETE_ARCHIVED_RECORDS_RESULT]: 'Message: {{ nRecords }} archived records has been deleted',\n  [ID_ARCHIVED_RECORDS_PATH]: 'File Location: {{ path }}',\n  [ID_ORDER_SUBMITTING]: 'submitting',\n  [ID_DEFAULT]: 'Default',\n  [ID_ADDED]: 'Added',\n  [ID_DISCOVERED]: 'Discovered',\n  [ID_UNSUPPORTED_ASSET_INFO_ERR_MSG]: 'no supported asset info for id = {{ assetID }}, and no exchange info provided',\n  [ID_LIMIT_ORDER]: 'limit',\n  [ID_LIMIT_ORDER_IMMEDIATE_TIF]: 'limit (i)',\n  [ID_MARKET_ORDER]: 'market',\n  [ID_MATCH_STATUS_NEWLY_MATCHED]: 'Newly Matched',\n  [ID_MATCH_STATUS_MAKER_SWAP_CAST]: 'Maker Swap Sent',\n  [ID_MATCH_STATUS_TAKER_SWAP_CAST]: 'Taker Swap Sent',\n  [ID_MATCH_STATUS_MAKER_REDEEMED]: 'Maker Redeemed',\n  [ID_MATCH_STATUS_REDEMPTION_SENT]: 'Redemption Sent',\n  [ID_MATCH_STATUS_REVOKED]: 'Revoked - {{ status }}',\n  [ID_MATCH_STATUS_REFUND_PENDING]: 'Refund PENDING',\n  [ID_MATCH_STATUS_REFUNDED]: 'Refunded',\n  [ID_MATCH_STATUS_REDEEM_PENDING]: 'Redeem PENDING',\n  [ID_MATCH_STATUS_REDEMPTION_CONFIRMED]: 'Redemption Confirmed',\n  [ID_MATCH_STATUS_COMPLETE]: 'Complete',\n  [ID_TAKER_FOUND_MAKER_REDEMPTION]: 'redeemed by {{ makerAddr }}',\n  [ID_OPEN_WALLET_ERR_MSG]: 'Error opening wallet: {{ msg }}',\n  [ID_ORDER_ACCELERATION_FEE_ERR_MSG]: 'Error estimating acceleration fee: {{ msg }}',\n  [ID_ORDER_ACCELERATION_ERR_MSG]: 'Error accelerating order: {{ msg }}',\n  [ID_CONNECTED]: 'Connected',\n  [ID_DISCONNECTED]: 'Disconnected',\n  [ID_INVALID_CERTIFICATE]: 'Invalid Certificate',\n  [ID_CONFIRMATIONS]: 'confirmations',\n  [ID_TAKER]: 'Taker',\n  [ID_MAKER]: 'Maker',\n  [ID_UNAVAILABLE]: 'unavailable',\n  [ID_EMPTY_DEX_ADDRESS_MSG]: 'DEX address cannot be empty',\n  [ID_SELECT_WALLET_FOR_FEE_PAYMENT]: 'Select a valid wallet to post a bond',\n  [ID_WALLET_SYNC_FINISHING_UP]: 'finishing up',\n  [ID_CONNECT_WALLET_ERR_MSG]: 'Failed to connect {{ assetName }} wallet: {{ errMsg }}'\n}\n\nexport const ptBR: Locale = {\n  [ID_NO_PASS_ERROR_MSG]: 'senha não pode ser vazia',\n  [ID_NO_APP_PASS_ERROR_MSG]: 'senha do app não pode ser vazia',\n  [ID_PASSWORD_NOT_MATCH]: 'senhas diferentes',\n  [ID_SET_BUTTON_BUY]: 'Ordem de compra de {{ asset }}',\n  [ID_SET_BUTTON_SELL]: 'Ordem de venda de {{ asset }}',\n  [ID_OFF]: 'desligar',\n  [ID_READY]: 'pronto',\n  [ID_LOCKED]: 'trancado',\n  [ID_NO_WALLET]: 'sem carteira',\n  [ID_WALLET_SYNC_PROGRESS]: 'carteira está {{ syncProgress }}% sincronizada',\n  [ID_HIDE_ADDITIONAL_SETTINGS]: 'esconder configurações adicionais',\n  [ID_SHOW_ADDITIONAL_SETTINGS]: 'mostrar configurações adicionais',\n  [ID_BUY]: 'Comprar',\n  [ID_SELL]: 'Vender',\n  [ID_NOT_SUPPORTED]: '{{ asset }} não tem suporte',\n  [ID_CONNECTION_FAILED]: 'Conexão ao server dex falhou. Pode fechar dexc e tentar novamente depois ou esperar para tentar se reconectar.',\n  [ID_ORDER_PREVIEW]: 'Total: {{ total }} {{ asset }}',\n  [ID_CALCULATING]: 'calculando...',\n  [ID_ESTIMATE_UNAVAILABLE]: 'estimativa indisponível',\n  [ID_NO_ZERO_RATE]: 'taxa não pode ser zero',\n  [ID_NO_ZERO_QUANTITY]: 'quantidade não pode ser zero',\n  [ID_TRADE]: 'troca',\n  [ID_NO_ASSET_WALLET]: 'Sem carteira {{ asset }}',\n  [ID_EXECUTED]: 'executado',\n  [ID_BOOKED]: 'reservado',\n  [ID_CANCELING]: 'cancelando',\n  [ID_ACCT_UNDEFINED]: 'conta não definida.',\n  [ID_KEEP_WALLET_PASS]: 'manter senha da carteira',\n  [ID_NEW_WALLET_PASS]: 'definir nova senha para carteira',\n  [ID_LOT]: 'lote',\n  [ID_LOTS]: 'lotes',\n  [ID_UNKNOWN]: 'desconhecido',\n  [ID_EPOCH]: 'epoque',\n  [ID_SETTLING]: 'assentando',\n  [ID_NO_MATCH]: 'sem combinações',\n  [ID_CANCELED]: 'cancelado',\n  [ID_REVOKED]: 'revocado',\n  [ID_WAITING_FOR_CONFS]: 'Esperando confirmações...',\n  [ID_NONE_SELECTED]: 'nenhuma selecionado',\n  [ID_REGISTRATION_FEE_SUCCESS]: 'Sucesso no pagamento da taxa de registro!', // TODO: reword from fee => bond\n  [ID_API_ERROR]: 'Erro de API',\n  [ID_ADD]: 'Adicionar',\n  [ID_CREATE]: 'Criar',\n  [ID_WALLET_READY]: 'Escolher',\n  [ID_SETUP_WALLET]: 'Configurar',\n  [ID_CHANGE_WALLET_TYPE]: 'trocar o tipo de carteira',\n  [ID_KEEP_WALLET_TYPE]: 'Não trocara tipo de carteira',\n  [WALLET_READY]: 'Carteira Pronta',\n  [SETUP_NEEDED]: 'Configuração Necessária',\n  [ID_AVAILABLE]: 'disponível',\n  [ID_IMMATURE]: 'imaturo'\n}\n\nexport const zhCN: Locale = {\n  [ID_NO_PASS_ERROR_MSG]: '密码不能为空',\n  [ID_NO_APP_PASS_ERROR_MSG]: '应用密码不能为空',\n  [ID_PASSWORD_NOT_MATCH]: '密码不相同',\n  [ID_SET_BUTTON_BUY]: '来自{{ asset }}的买入订单',\n  [ID_SET_BUTTON_SELL]: '来自{{ asset }}的卖出订单',\n  [ID_OFF]: '关闭',\n  [ID_READY]: '准备就绪', //  alt. 准备好\n  [ID_LOCKED]: '锁',\n  [ID_NO_WALLET]: '未连接钱包', // alt. 没有钱包\n  [ID_WALLET_SYNC_PROGRESS]: '钱包同步进度{{ syncProgress }}%',\n  [ID_HIDE_ADDITIONAL_SETTINGS]: '隐藏其它设置',\n  [ID_SHOW_ADDITIONAL_SETTINGS]: '显示其它设置',\n  [ID_BUY]: '买入',\n  [ID_SELL]: '卖出',\n  [ID_NOT_SUPPORTED]: '{{ asset }}不受支持',\n  [ID_CONNECTION_FAILED]: '连接到服务器 dex 失败。您可以关闭 dexc 并稍后重试或等待尝试重新连接。',\n  [ID_ORDER_PREVIEW]: '总计： {{ total }} {{ asset }}',\n  [ID_CALCULATING]: '计算中...',\n  [ID_ESTIMATE_UNAVAILABLE]: '估计不可用',\n  [ID_NO_ZERO_RATE]: '汇率不能为零',\n  [ID_NO_ZERO_QUANTITY]: '数量不能为零',\n  [ID_TRADE]: '交易',\n  [ID_NO_ASSET_WALLET]: '没有钱包 {{ asset }}',\n  [ID_EXECUTED]: '执行',\n  [ID_BOOKED]: '保留',\n  [ID_CANCELING]: '取消',\n  [ID_ACCT_UNDEFINED]: '帐户未定义。',\n  [ID_KEEP_WALLET_PASS]: '保留钱包密码',\n  [ID_NEW_WALLET_PASS]: '设置新的钱包密码',\n  [ID_LOT]: '批处理',\n  [ID_LOTS]: '批', // alt. 很多\n  [ID_EPOCH]: '时间',\n  [ID_API_ERROR]: '接口错误',\n  [ID_ADD]: '添加',\n  [ID_CREATE]: '创建',\n  [ID_AVAILABLE]: '可用',\n  [ID_IMMATURE]: '不成熟'\n}\n\nexport const plPL: Locale = {\n  [ID_NO_PASS_ERROR_MSG]: 'hasło nie może być puste',\n  [ID_NO_APP_PASS_ERROR_MSG]: 'hasło aplikacji nie może być puste',\n  [ID_PASSWORD_NOT_MATCH]: 'hasła nie są jednakowe',\n  [ID_SET_BUTTON_BUY]: 'Złóż zlecenie, aby kupić  {{ asset }}',\n  [ID_SET_BUTTON_SELL]: 'Złóż zlecenie, aby sprzedać {{ asset }}',\n  [ID_OFF]: 'wyłączony',\n  [ID_READY]: 'gotowy',\n  [ID_LOCKED]: 'zablokowany',\n  [ID_NO_WALLET]: 'brak portfela',\n  [ID_WALLET_SYNC_PROGRESS]: 'portfel zsynchronizowany w {{ syncProgress }}%',\n  [ID_HIDE_ADDITIONAL_SETTINGS]: 'ukryj dodatkowe ustawienia',\n  [ID_SHOW_ADDITIONAL_SETTINGS]: 'pokaż dodatkowe ustawienia',\n  [ID_BUY]: 'Kup',\n  [ID_SELL]: 'Sprzedaj',\n  [ID_NOT_SUPPORTED]: '{{ asset }} nie jest wspierany',\n  [ID_CONNECTION_FAILED]: 'Połączenie z serwerem dex nie powiodło się. Możesz zamknąć dexc i spróbować ponownie później, lub poczekać na wznowienie połączenia.',\n  [ID_ORDER_PREVIEW]: 'W sumie: {{ total }} {{ asset }}',\n  [ID_CALCULATING]: 'obliczanie...',\n  [ID_ESTIMATE_UNAVAILABLE]: 'brak szacunkowego wyliczenia',\n  [ID_NO_ZERO_RATE]: 'zero nie może być ceną',\n  [ID_NO_ZERO_QUANTITY]: 'zero nie może być ilością',\n  [ID_TRADE]: 'handluj',\n  [ID_NO_ASSET_WALLET]: 'Brak portfela {{ asset }}',\n  [ID_EXECUTED]: 'wykonano',\n  [ID_BOOKED]: 'zapisano',\n  [ID_CANCELING]: 'anulowanie',\n  [ID_ACCT_UNDEFINED]: 'Niezdefiniowane konto.',\n  [ID_KEEP_WALLET_PASS]: 'zachowaj obecne hasło portfela',\n  [ID_NEW_WALLET_PASS]: 'ustaw nowe hasło portfela',\n  [ID_LOT]: 'lot',\n  [ID_LOTS]: 'loty(ów)',\n  [ID_UNKNOWN]: 'nieznane',\n  [ID_EPOCH]: 'epoka',\n  [ID_SETTLING]: 'rozliczanie',\n  [ID_NO_MATCH]: 'brak spasowania',\n  [ID_CANCELED]: 'anulowano',\n  [ID_REVOKED]: 'unieważniono',\n  [ID_WAITING_FOR_CONFS]: 'Oczekiwanie na potwierdzenia...',\n  [ID_NONE_SELECTED]: 'brak zaznaczenia',\n  [ID_REGISTRATION_FEE_SUCCESS]: 'Płatność rejestracyjna powiodła się!', // TODO: reword from fee => bond\n  [ID_API_ERROR]: 'błąd API',\n  [ID_ADD]: 'Dodaj',\n  [ID_CREATE]: 'Utwórz',\n  [ID_WALLET_READY]: 'Gotowy',\n  [ID_SETUP_WALLET]: 'Konfiguracja',\n  [ID_CHANGE_WALLET_TYPE]: 'zmień typ portfela',\n  [ID_KEEP_WALLET_TYPE]: 'nie zmieniaj typu portfela',\n  [WALLET_READY]: 'Portfel jest gotowy',\n  [SETUP_NEEDED]: 'Potrzebna konfiguracja',\n  [ID_AVAILABLE]: 'dostępne',\n  [ID_IMMATURE]: 'niedojrzałe'\n}\n\nexport const deDE: Locale = {\n  [ID_NO_PASS_ERROR_MSG]: 'Passwort darf nicht leer sein',\n  [ID_NO_APP_PASS_ERROR_MSG]: 'App-Passwort darf nicht leer sein',\n  [ID_PASSWORD_NOT_MATCH]: 'Passwörter stimmen nicht überein',\n  [ID_SET_BUTTON_BUY]: 'Platziere Auftrag zum Kauf von  {{ asset }}',\n  [ID_SET_BUTTON_SELL]: 'Platziere Auftrag zum Verkauf von {{ asset }}',\n  [ID_OFF]: 'aus',\n  [ID_READY]: 'bereit',\n  [ID_LOCKED]: 'gesperrt',\n  [ID_NO_WALLET]: 'kein Wallet',\n  [ID_WALLET_SYNC_PROGRESS]: 'Wallet ist zu {{ syncProgress }}% synchronisiert',\n  [ID_HIDE_ADDITIONAL_SETTINGS]: 'zusätzliche Einstellungen ausblenden',\n  [ID_SHOW_ADDITIONAL_SETTINGS]: 'zusätzliche Einstellungen anzeigen',\n  [ID_BUY]: 'Kaufen',\n  [ID_SELL]: 'Verkaufen',\n  [ID_NOT_SUPPORTED]: '{{ asset }} wird nicht unterstützt',\n  [ID_CONNECTION_FAILED]: 'Die Verbindung zum Dex-Server fehlgeschlagen. Du kannst dexc schließen und es später erneut versuchen oder warten bis die Verbindung wiederhergestellt ist.',\n  [ID_ORDER_PREVIEW]: 'Insgesamt: {{ total }} {{ asset }}',\n  [ID_CALCULATING]: 'kalkuliere...',\n  [ID_ESTIMATE_UNAVAILABLE]: 'Schätzung nicht verfügbar',\n  [ID_NO_ZERO_RATE]: 'Null-Satz nicht erlaubt',\n  [ID_NO_ZERO_QUANTITY]: 'Null-Menge nicht erlaubt',\n  [ID_TRADE]: 'Handel',\n  [ID_NO_ASSET_WALLET]: 'Kein {{ asset }} Wallet',\n  [ID_EXECUTED]: 'ausgeführt',\n  [ID_BOOKED]: 'gebucht',\n  [ID_CANCELING]: 'Abbruch',\n  [ID_ACCT_UNDEFINED]: 'Account undefiniert.',\n  [ID_KEEP_WALLET_PASS]: 'aktuelles Passwort für das Wallet behalten',\n  [ID_NEW_WALLET_PASS]: 'ein neues Passwort für das Wallet festlegen',\n  [ID_LOT]: 'Lot',\n  [ID_LOTS]: 'Lots',\n  [ID_UNKNOWN]: 'unbekannt',\n  [ID_EPOCH]: 'Epoche',\n  [ID_SETTLING]: 'Abwicklung',\n  [ID_NO_MATCH]: 'kein Match',\n  [ID_CANCELED]: 'abgebrochen',\n  [ID_REVOKED]: 'widerrufen',\n  [ID_WAITING_FOR_CONFS]: 'Warten auf Bestätigungen...',\n  [ID_NONE_SELECTED]: 'keine ausgewählt',\n  [ID_REGISTRATION_FEE_SUCCESS]: 'Zahlung der Registrierungsgebühr erfolgreich!', // TODO: reword from fee => bond\n  [ID_API_ERROR]: 'API Fehler',\n  [ID_ADD]: 'Hinzufügen',\n  [ID_CREATE]: 'Erstellen',\n  [ID_WALLET_READY]: 'Bereit',\n  [ID_SETUP_WALLET]: 'Einrichten',\n  [ID_CHANGE_WALLET_TYPE]: 'den Wallet-Typ ändern',\n  [ID_KEEP_WALLET_TYPE]: 'den Wallet-Typ nicht ändern',\n  [WALLET_READY]: 'Wallet bereit',\n  [SETUP_NEEDED]: 'Einrichtung erforderlich',\n  [WALLET_PENDING]: 'Erstelle Wallet',\n  [ID_SEND_SUCCESS]: '{{ assetName }} gesendet!',\n  [ID_RECONFIG_SUCCESS]: 'Wallet neu konfiguriert!',\n  [ID_RESCAN_STARTED]: 'Wallet Rescan läuft',\n  [ID_NEW_WALLET_SUCCESS]: '{{ assetName }} Wallet erstellt!',\n  [ID_WALLET_UNLOCKED]: 'Wallet entsperrt'\n}\n\nexport const ar: Locale = {\n  [ID_NO_PASS_ERROR_MSG]: 'لا يمكن أن تكون كلمة المرور فارغة',\n  [ID_NO_APP_PASS_ERROR_MSG]: 'لا يمكن أن تكون كلمة مرور التطبيق فارغة',\n  [ID_PASSWORD_NOT_MATCH]: 'كلمات المرور غير متطابقة',\n  [ID_SET_BUTTON_BUY]: 'ضع طلبًا للشراء  {{ asset }}',\n  [ID_SET_BUTTON_SELL]: 'ضع طلبًا للبيع {{ asset }}',\n  [ID_OFF]: 'إيقاف',\n  [ID_READY]: 'متوقف',\n  [ID_LOCKED]: 'مقفل',\n  [ID_NO_WALLET]: 'لا توجد أي محفظة',\n  [ID_WALLET_SYNC_PROGRESS]: 'تمت مزامنة {{ syncProgress }}% المحفظة',\n  [ID_HIDE_ADDITIONAL_SETTINGS]: 'إخفاء الإعدادات الإضافية',\n  [ID_SHOW_ADDITIONAL_SETTINGS]: 'عرض الإعدادات الإضافية',\n  [ID_BUY]: 'شراء',\n  [ID_SELL]: 'بيع',\n  [ID_NOT_SUPPORTED]: '{{ asset }} غير مدعوم',\n  [ID_CONNECTION_FAILED]: 'فشل الاتصال بخادم dex. يمكنك إغلاق dexc والمحاولة مرة أخرى لاحقًا أو انتظار إعادة الاتصال.',\n  [ID_ORDER_PREVIEW]: 'إجمالي: {{ total }} {{ asset }}',\n  [ID_CALCULATING]: 'جاري الحساب ...',\n  [ID_ESTIMATE_UNAVAILABLE]: 'التقديرات غير متاحة',\n  [ID_NO_ZERO_RATE]: 'معدل الصفر غير مسموح به',\n  [ID_NO_ZERO_QUANTITY]: 'غير مسموح بالكمية الصفرية',\n  [ID_TRADE]: 'التداول',\n  [ID_NO_ASSET_WALLET]: 'لا توجد {{ asset }} محفظة',\n  [ID_EXECUTED]: 'تم تنفيذها',\n  [ID_BOOKED]: 'تم الحجز',\n  [ID_CANCELING]: 'جارٍ الإلغاء',\n  [ID_ACCT_UNDEFINED]: 'حساب غير محدد.',\n  [ID_KEEP_WALLET_PASS]: 'احتفظ بكلمة مرور المحفظة الحالية',\n  [ID_NEW_WALLET_PASS]: 'قم بتعيين كلمة مرور جديدة للمحفظة',\n  [ID_LOT]: 'الحصة',\n  [ID_LOTS]: 'الحصص',\n  [ID_UNKNOWN]: 'غير معروف',\n  [ID_EPOCH]: 'الحقبة الزمنية',\n  [ID_SETTLING]: 'الإعدادات',\n  [ID_NO_MATCH]: 'غير متطابقة',\n  [ID_CANCELED]: 'ملغاة',\n  [ID_REVOKED]: 'مستعادة',\n  [ID_WAITING_FOR_CONFS]: 'في انتظار التأكيدات ...',\n  [ID_NONE_SELECTED]: 'لم يتم تحديد أي شيء',\n  [ID_REGISTRATION_FEE_SUCCESS]: 'تم دفع رسوم التسجيل بنجاح!', // TODO: reword from fee => bond\n  [ID_API_ERROR]: 'خطأ في واجهة برمجة التطبيقات',\n  [ID_ADD]: 'إضافة',\n  [ID_CREATE]: 'إنشاء',\n  [ID_WALLET_READY]: 'جاهزة',\n  [ID_SETUP_WALLET]: 'إعداد',\n  [ID_CHANGE_WALLET_TYPE]: 'تغيير نوع المحفظة',\n  [ID_KEEP_WALLET_TYPE]: 'لا تغير نوع المحفظة',\n  [WALLET_READY]: 'المحفظة جاهزة',\n  [SETUP_NEEDED]: 'الإعداد مطلوب',\n  [WALLET_PENDING]: 'إنشاء المحفظة',\n  [ID_SEND_SUCCESS]: '{{ assetName }} تم الإرسال!',\n  [ID_RECONFIG_SUCCESS]: 'تمت إعادة تهيئة المحفظة!!',\n  [ID_RESCAN_STARTED]: 'إعادة فحص المحفظة قيد التشغيل',\n  [ID_NEW_WALLET_SUCCESS]: '{{ assetName }} تم إنشاء المحفظة!',\n  [ID_WALLET_UNLOCKED]: 'المحفظة غير مقفلة',\n  [ID_SELLING]: 'البيع',\n  [ID_BUYING]: 'Bالشراء',\n  [ID_WALLET_ENABLED_MSG]: '{{ assetName }} المحفظة ممكنة',\n  [ID_WALLET_DISABLED_MSG]: '{{ assetName }} المحفظة معطلة',\n  [ID_DISABLED_MSG]: 'تم تعطيل المحفظة',\n  [ID_ACTIVE_ORDERS_ERR_MSG]: '{{ assetName }} تدير المحفظة  الطلبات بفعالية'\n}\n\nconst localesMap: Record<string, Locale> = {\n  'en-us': enUS,\n  'pt-br': ptBR,\n  'zh-cn': zhCN,\n  'pl-pl': plPL,\n  'de-de': deDE,\n  'ar': ar\n}\n\n/* locale will hold the locale loaded via setLocale. */\nlet locale: Locale\n\nconst defaultLocale = enUS\n\n/*\n * setLocale read the language tag from the current document's html element lang\n * attribute and sets the locale. setLocale should be called once by the\n * application before prep is used.\n*/\nexport function setLocale () { locale = localesMap[document.documentElement.lang.toLowerCase()] }\n\n/* prep will format the message to the current locale. */\nexport function prep (k: string, args?: Record<string, string>) {\n  return stringTemplateParser(locale[k] || defaultLocale[k], args || {})\n}\n\n/*\n * stringTemplateParser is a template string matcher, where expression is any\n * text. It switches what is inside double brackets (e.g. 'buy {{ asset }}')\n * for the value described into args. args is an object with keys\n * equal to the placeholder keys. (e.g. {\"asset\": \"dcr\"}).\n * So that will be switched for: 'asset dcr'.\n */\nfunction stringTemplateParser (expression: string, args: Record<string, string>) {\n  // templateMatcher matches any text which:\n  // is some {{ text }} between two brackets, and a space between them.\n  // It is global, therefore it will change all occurrences found.\n  // text can be anything, but brackets '{}' and space '\\s'\n  const templateMatcher = /{{\\s?([^{}\\s]*)\\s?}}/g\n  return expression.replace(templateMatcher, (_, value) => args[value])\n}\n\nwindow.localeDiscrepancies = () => {\n  const ref = enUS\n  for (const [lang, dict] of Object.entries(localesMap)) {\n    if (dict === ref) continue\n    for (const [k, s] of Object.entries(ref)) {\n      if (!dict[k]) console.log(`${lang} needs a tranlation for: ${s}`)\n    }\n  }\n}\n","import * as intl from './locales'\nimport {\n  UnitInfo,\n  LayoutMetrics,\n  WalletState,\n  PageElement\n} from './registry'\n\nconst parser = new window.DOMParser()\n\nconst FPS = 30\n\nconst BipIDs: Record<number, string> = {\n  0: 'btc',\n  42: 'dcr',\n  2: 'ltc',\n  20: 'dgb',\n  22: 'mona',\n  28: 'vtc',\n  3: 'doge',\n  145: 'bch',\n  60: 'eth',\n  133: 'zec',\n  60000: 'dextt.eth',\n  60001: 'usdc.eth'\n}\n\nconst BipSymbols = Object.values(BipIDs)\n\nconst intFormatter = new Intl.NumberFormat((navigator.languages as string[]))\n\nconst threeSigFigs = new Intl.NumberFormat((navigator.languages as string[]), {\n  minimumSignificantDigits: 3,\n  maximumSignificantDigits: 3\n})\n\nconst fiveSigFigs = new Intl.NumberFormat((navigator.languages as string[]), {\n  minimumSignificantDigits: 5,\n  maximumSignificantDigits: 5\n})\n\n/* A cache for formatters used for Doc.formatCoinValue. */\nconst decimalFormatters = {}\n\n/*\n * decimalFormatter gets the formatCoinValue formatter for the specified decimal\n * precision.\n */\nfunction decimalFormatter (prec: number) {\n  return formatter(decimalFormatters, 2, prec)\n}\n\n/* A cache for formatters used for Doc.formatFullPrecision. */\nconst fullPrecisionFormatters = {}\n\n/*\n * fullPrecisionFormatter gets the formatFullPrecision formatter for the\n * specified decimal precision.\n */\nfunction fullPrecisionFormatter (prec: number) {\n  return formatter(fullPrecisionFormatters, prec, prec)\n}\n\n/*\n * formatter gets the formatter from the supplied cache if it already exists,\n * else creates it.\n */\nfunction formatter (formatters: Record<string, Intl.NumberFormat>, min: number, max: number): Intl.NumberFormat {\n  const k = `${min}-${max}`\n  let fmt = formatters[k]\n  if (!fmt) {\n    fmt = new Intl.NumberFormat((navigator.languages as string[]), {\n      minimumFractionDigits: min,\n      maximumFractionDigits: max\n    })\n    formatters[k] = fmt\n  }\n  return fmt\n}\n\n/*\n * convertToConventional converts the value in atomic units to conventional\n * units.\n */\nfunction convertToConventional (v: number, unitInfo?: UnitInfo) {\n  let prec = 8\n  if (unitInfo) {\n    const f = unitInfo.conventional.conversionFactor\n    v /= f\n    prec = Math.round(Math.log10(f))\n  }\n  return [v, prec]\n}\n\n// Helpers for working with the DOM.\nexport default class Doc {\n  /*\n   * idel is the element with the specified id that is the descendent of the\n   * specified node.\n   */\n  static idel (el: Document | Element, id: string): HTMLElement {\n    return el.querySelector(`#${id}`) as HTMLElement\n  }\n\n  /* bind binds the function to the event for the element. */\n  static bind (el: EventTarget, ev: string, f: EventListenerOrEventListenerObject): void {\n    el.addEventListener(ev, f)\n  }\n\n  /* unbind removes the handler for the event from the element. */\n  static unbind (el: EventTarget, ev: string, f: (e: Event) => void): void {\n    el.removeEventListener(ev, f)\n  }\n\n  /* noderize creates a Document object from a string of HTML. */\n  static noderize (html: string): Document {\n    return parser.parseFromString(html, 'text/html')\n  }\n\n  /*\n   * mouseInElement returns true if the position of mouse event, e, is within\n   * the bounds of the specified element or any of its descendents.\n   */\n  static mouseInElement (e: MouseEvent, el: HTMLElement): boolean {\n    if (el.contains(e.target as Node)) return true\n    const rect = el.getBoundingClientRect()\n    return e.pageX >= rect.left && e.pageX <= rect.right &&\n      e.pageY >= rect.top && e.pageY <= rect.bottom\n  }\n\n  /*\n   * layoutMetrics gets information about the elements position on the page.\n   */\n  static layoutMetrics (el: HTMLElement): LayoutMetrics {\n    const box = el.getBoundingClientRect()\n    const docEl = document.documentElement\n    const top = box.top + docEl.scrollTop\n    const left = box.left + docEl.scrollLeft\n    const w = el.offsetWidth\n    const h = el.offsetHeight\n    return {\n      bodyTop: top,\n      bodyLeft: left,\n      width: w,\n      height: h,\n      centerX: left + w / 2,\n      centerY: top + h / 2\n    }\n  }\n\n  static descendentMetrics (parent: PageElement, kid: PageElement): LayoutMetrics {\n    const parentMetrics = Doc.layoutMetrics(parent)\n    const kidMetrics = Doc.layoutMetrics(kid)\n    return {\n      bodyTop: kidMetrics.bodyTop - parentMetrics.bodyTop,\n      bodyLeft: kidMetrics.bodyLeft - parentMetrics.bodyLeft,\n      width: kidMetrics.width,\n      height: kidMetrics.height,\n      centerX: kidMetrics.centerX - parentMetrics.bodyLeft,\n      centerY: kidMetrics.centerY - parentMetrics.bodyTop\n    }\n  }\n\n  /* empty removes all child nodes from the specified element. */\n  static empty (...els: Element[]) {\n    for (const el of els) while (el.firstChild) el.removeChild(el.firstChild)\n  }\n\n  /*\n   * setContent removes all child nodes from the specified element and appends\n   * passed elements.\n   */\n  static setContent (ancestor: PageElement, ...kids: PageElement[]) {\n    Doc.empty(ancestor)\n    for (const k of kids) ancestor.appendChild(k)\n  }\n\n  /*\n   * hide hides the specified elements. This is accomplished by adding the\n   * bootstrap d-hide class to the element. Use Doc.show to undo.\n   */\n  static hide (...els: Element[]) {\n    for (const el of els) el.classList.add('d-hide')\n  }\n\n  /*\n   * show shows the specified elements. This is accomplished by removing the\n   * bootstrap d-hide class as added with Doc.hide.\n   */\n  static show (...els: Element[]) {\n    for (const el of els) el.classList.remove('d-hide')\n  }\n\n  /*\n   * show or hide the specified elements, based on value of the truthiness of\n   * vis.\n   */\n  static setVis (vis: any, ...els: Element[]) {\n    if (vis) Doc.show(...els)\n    else Doc.hide(...els)\n  }\n\n  /* isHidden returns true if the specified element is hidden */\n  static isHidden (el: Element): boolean {\n    return el.classList.contains('d-hide')\n  }\n\n  /* isDisplayed returns true if the specified element is not hidden */\n  static isDisplayed (el: Element): boolean {\n    return !el.classList.contains('d-hide')\n  }\n\n  /*\n   * animate runs the supplied function, which should be a \"progress\" function\n   * accepting one argument. The progress function will be called repeatedly\n   * with the argument varying from 0.0 to 1.0. The exact path that animate\n   * takes from 0.0 to 1.0 will vary depending on the choice of easing\n   * algorithm. See the Easing object for the available easing algo choices. The\n   * default easing algorithm is linear.\n   */\n  static async animate (duration: number, f: (progress: number) => void, easingAlgo?: string) {\n    await new Animation(duration, f, easingAlgo).wait()\n  }\n\n  static applySelector (ancestor: HTMLElement, k: string): PageElement[] {\n    return Array.from(ancestor.querySelectorAll(k)) as PageElement[]\n  }\n\n  static kids (ancestor: HTMLElement): PageElement[] {\n    return Array.from(ancestor.children) as PageElement[]\n  }\n\n  static safeSelector (ancestor: HTMLElement, k: string): PageElement {\n    const el = ancestor.querySelector(k)\n    if (el) return el as PageElement\n    console.warn(`no element found for selector '${k}' on element ->`, ancestor)\n    return document.createElement('div')\n  }\n\n  /*\n   * idDescendants creates an object mapping to elements which are descendants\n   * of the ancestor and have id attributes. Elements are keyed by their id\n   * value.\n   */\n  static idDescendants (ancestor: HTMLElement): Record<string, PageElement> {\n    const d: Record<string, PageElement> = {}\n    for (const el of Doc.applySelector(ancestor, '[id]')) d[el.id] = el\n    return d\n  }\n\n  /*\n   * formatCoinValue formats the value in atomic units into a string\n   * representation in conventional units. If the value happens to be an\n   * integer, no decimals are displayed. Trailing zeros may be truncated.\n   */\n  static formatCoinValue (vAtomic: number, unitInfo?: UnitInfo): string {\n    const [v, prec] = convertToConventional(vAtomic, unitInfo)\n    if (Number.isInteger(v)) return intFormatter.format(v)\n    return decimalFormatter(prec).format(v)\n  }\n\n  static formatThreeSigFigs (v: number): string {\n    if (v >= 1000) return intFormatter.format(Math.round(v))\n    return threeSigFigs.format(v)\n  }\n\n  static formatFiveSigFigs (v: number, prec?: number): string {\n    if (v >= 10000) return intFormatter.format(Math.round(v))\n    else if (v < 1e5) return fullPrecisionFormatter(prec ?? 8 /* rate encoding factor */).format(v)\n    return fiveSigFigs.format(v)\n  }\n\n  /*\n   * formatFullPrecision formats the value in atomic units into a string\n   * representation in conventional units using the full decimal precision\n   * associated with the conventional unit's conversion factor.\n   */\n  static formatFullPrecision (vAtomic: number, unitInfo?: UnitInfo): string {\n    const [v, prec] = convertToConventional(vAtomic, unitInfo)\n    return fullPrecisionFormatter(prec).format(v)\n  }\n\n  /*\n   * formatFiatConversion formats the value in atomic units to its representation in\n   * conventional units and returns the fiat value as a string.\n   */\n  static formatFiatConversion (vAtomic: number, rate: number, unitInfo?: UnitInfo): string {\n    if (!rate || rate === 0) return intl.prep(intl.ID_UNAVAILABLE)\n    const prec = 2\n    const [v] = convertToConventional(vAtomic, unitInfo)\n    const value = v * rate\n    return fullPrecisionFormatter(prec).format(value)\n  }\n\n  /*\n   * logoPath creates a path to a png logo for the specified ticker symbol. If\n   * the symbol is not a supported asset, the generic letter logo will be\n   * requested instead.\n   */\n  static logoPath (symbol: string): string {\n    if (BipSymbols.indexOf(symbol) === -1) symbol = symbol.substring(0, 1)\n    return `/img/coins/${symbol}.png`\n  }\n\n  static bipSymbol (assetID: number): string {\n    return BipIDs[assetID]\n  }\n\n  static logoPathFromID (assetID: number): string {\n    return Doc.logoPath(BipIDs[assetID])\n  }\n\n  /*\n   * symbolize creates a token-aware symbol element for the asset's symbol. For\n   * non-token assets, this is simply a <span>SYMBOL</span>. For tokens, it'll\n   * be <span><span>SYMBOL</span><sup>PARENT</sup></span>.\n   */\n  static symbolize (symbol: string): PageElement {\n    const parts = symbol.split('.')\n    const assetSymbol = document.createElement('span')\n    assetSymbol.textContent = parts[0].toUpperCase()\n    if (parts.length === 1) return assetSymbol\n    const span = document.createElement('span')\n    span.classList.add('token-aware-symbol')\n    span.appendChild(assetSymbol)\n    const parent = document.createElement('sup')\n    parent.textContent = parts[1].toUpperCase()\n    span.appendChild(parent)\n    return span\n  }\n\n  /*\n   * shortSymbol removes the short format of a symbol, with any parent chain\n   * identifier removed\n   */\n  static shortSymbol (symbol: string): string {\n    return symbol.split('.')[0].toUpperCase()\n  }\n\n  /*\n  * cleanTemplates removes the elements from the DOM and deletes the id\n  * attribute.\n  */\n  static cleanTemplates (...tmpls: HTMLElement[]) {\n    tmpls.forEach(tmpl => {\n      tmpl.remove()\n      tmpl.removeAttribute('id')\n    })\n  }\n\n  /*\n  * tmplElement is a helper function for grabbing sub-elements of the market list\n  * template.\n  */\n  static tmplElement (ancestor: Document | HTMLElement, s: string): PageElement {\n    return ancestor.querySelector(`[data-tmpl=\"${s}\"]`) || document.createElement('div')\n  }\n\n  /*\n  * parseTemplate returns an object of data-tmpl elements, keyed by their\n  * data-tmpl values.\n  */\n  static parseTemplate (ancestor: HTMLElement): Record<string, PageElement> {\n    const d: Record<string, PageElement> = {}\n    for (const el of Doc.applySelector(ancestor, '[data-tmpl]')) d[el.dataset.tmpl || ''] = el\n    return d\n  }\n\n  /*\n   * timeSince returns a string representation of the duration since the\n   * specified unix timestamp.\n   */\n  static timeSince (t: number): string {\n    return Doc.formatDuration((new Date().getTime()) - t)\n  }\n\n  /* formatDuration returns a string representation of the duration */\n  static formatDuration (dur: number): string {\n    let seconds = Math.floor(dur)\n    let result = ''\n    let count = 0\n    const add = (n: number, s: string) => {\n      if (n > 0 || count > 0) count++\n      if (n > 0) result += `${n} ${s} `\n      return count >= 2\n    }\n    let y, mo, d, h, m, s\n    [y, seconds] = timeMod(seconds, aYear)\n    if (add(y, 'y')) { return result }\n    [mo, seconds] = timeMod(seconds, aMonth)\n    if (add(mo, 'mo')) { return result }\n    [d, seconds] = timeMod(seconds, aDay)\n    if (add(d, 'd')) { return result }\n    [h, seconds] = timeMod(seconds, anHour)\n    if (add(h, 'h')) { return result }\n    [m, seconds] = timeMod(seconds, aMinute)\n    if (add(m, 'm')) { return result }\n    [s, seconds] = timeMod(seconds, 1000)\n    add(s, 's')\n    return result || '0 s'\n  }\n\n  /*\n   * disableMouseWheel can be used to disable the mouse wheel for any\n   * input. It is very easy to unknowingly scroll up on a number input\n   * and then submit an unexpected value. This function prevents the\n   * scroll increment/decrement behavior for a wheel action on a\n   * number input.\n   */\n  static disableMouseWheel (...inputFields: Element[]) {\n    for (const inputField of inputFields) {\n      inputField.addEventListener('wheel', (ev) => {\n        ev.preventDefault()\n      })\n    }\n  }\n\n  // showFormError can be used to set and display error message on forms.\n  static showFormError (el: PageElement, msg: any) {\n    el.textContent = msg\n    Doc.show(el)\n  }\n}\n\n/*\n * Animation is a handler for starting and stopping animations.\n */\nexport class Animation {\n  done: (() => void) | undefined\n  endAnimation: boolean\n  thread: Promise<void>\n  static Forever: number\n\n  constructor (duration: number, f: (progress: number) => void, easingAlgo?: string, done?: () => void) {\n    this.done = done\n    this.thread = this.run(duration, f, easingAlgo)\n  }\n\n  /*\n   * run runs the animation function, increasing progress from 0 to 1 in a\n   * manner dictated by easingAlgo.\n   */\n  async run (duration: number, f: (progress: number) => void, easingAlgo?: string) {\n    duration = duration >= 0 ? duration : 1000 * 86400 * 365 * 10 // 10 years, in ms\n    const easer = easingAlgo ? Easing[easingAlgo] : Easing.linear\n    const start = new Date().getTime()\n    const end = (duration === Animation.Forever) ? Number.MAX_SAFE_INTEGER : start + duration\n    const range = end - start\n    const frameDuration = 1000 / FPS\n    let now = start\n    this.endAnimation = false\n    while (now < end) {\n      if (this.endAnimation) return this.runCompletionFunction()\n      f(easer((now - start) / range))\n      await sleep(frameDuration)\n      now = new Date().getTime()\n    }\n    f(1)\n    this.runCompletionFunction()\n  }\n\n  /* wait returns a promise that will resolve when the animation completes. */\n  async wait () {\n    await this.thread\n  }\n\n  /* stop schedules the animation to exit at its next frame. */\n  stop () {\n    this.endAnimation = true\n  }\n\n  /*\n   * stopAndWait stops the animations and returns a promise that will resolve\n   * when the animation exits.\n   */\n  async stopAndWait () {\n    this.stop()\n    await this.wait()\n  }\n\n  /* runCompletionFunction runs any registered callback function */\n  runCompletionFunction () {\n    if (this.done) this.done()\n  }\n}\nAnimation.Forever = -1\n\n/* Easing algorithms for animations. */\nexport const Easing: Record<string, (t: number) => number> = {\n  linear: t => t,\n  easeIn: t => t * t,\n  easeOut: t => t * (2 - t),\n  easeInHard: t => t * t * t,\n  easeOutHard: t => (--t) * t * t + 1,\n  easeOutElastic: t => {\n    const c4 = (2 * Math.PI) / 3\n    return t === 0\n      ? 0\n      : t === 1\n        ? 1\n        : Math.pow(2, -10 * t) * Math.sin((t * 10 - 0.75) * c4) + 1\n  }\n}\n\n/* WalletIcons are used for controlling wallets in various places. */\nexport class WalletIcons {\n  icons: Record<string, HTMLElement>\n  status: Element\n\n  constructor (box: HTMLElement) {\n    const stateElement = (name: string) => box.querySelector(`[data-state=${name}]`) as HTMLElement\n    this.icons = {}\n    this.icons.sleeping = stateElement('sleeping')\n    this.icons.locked = stateElement('locked')\n    this.icons.unlocked = stateElement('unlocked')\n    this.icons.nowallet = stateElement('nowallet')\n    this.icons.syncing = stateElement('syncing')\n    this.icons.nopeers = stateElement('nopeers')\n    this.icons.disabled = stateElement('disabled')\n    this.status = stateElement('status')\n  }\n\n  /* sleeping sets the icons to indicate that the wallet is not connected. */\n  sleeping () {\n    const i = this.icons\n    Doc.hide(i.locked, i.unlocked, i.nowallet, i.syncing, i.disabled)\n    Doc.show(i.sleeping)\n    if (this.status) this.status.textContent = intl.prep(intl.ID_OFF)\n  }\n\n  /*\n   * locked sets the icons to indicate that the wallet is connected, but locked.\n   */\n  locked () {\n    const i = this.icons\n    Doc.hide(i.unlocked, i.nowallet, i.sleeping, i.disabled)\n    Doc.show(i.locked)\n    if (this.status) this.status.textContent = intl.prep(intl.ID_LOCKED)\n  }\n\n  /*\n   * unlocked sets the icons to indicate that the wallet is connected and\n   * unlocked.\n   */\n  unlocked () {\n    const i = this.icons\n    Doc.hide(i.locked, i.nowallet, i.sleeping, i.disabled)\n    Doc.show(i.unlocked)\n    if (this.status) this.status.textContent = intl.prep(intl.ID_READY)\n  }\n\n  /* nowallet sets the icons to indicate that no wallet exists. */\n  nowallet () {\n    const i = this.icons\n    Doc.hide(i.locked, i.unlocked, i.sleeping, i.syncing, i.disabled)\n    Doc.show(i.nowallet)\n    if (this.status) this.status.textContent = intl.prep(intl.ID_NO_WALLET)\n  }\n\n  /* set the icons to indicate that the wallet is disabled */\n  disabled () {\n    const i = this.icons\n    Doc.hide(i.locked, i.unlocked, i.sleeping, i.syncing, i.nowallet, i.nopeers)\n    Doc.show(i.disabled)\n    i.disabled.dataset.tooltip = intl.prep(intl.ID_DISABLED_MSG)\n  }\n\n  setSyncing (wallet: WalletState | null) {\n    const syncIcon = this.icons.syncing\n    if (!wallet || !wallet.running || wallet.disabled) {\n      Doc.hide(syncIcon)\n      return\n    }\n\n    if (wallet.peerCount === 0) {\n      Doc.show(this.icons.nopeers)\n      Doc.hide(syncIcon) // potentially misleading with no peers\n      return\n    }\n    Doc.hide(this.icons.nopeers)\n\n    if (!wallet.synced) {\n      Doc.show(syncIcon)\n      syncIcon.dataset.tooltip = intl.prep(intl.ID_WALLET_SYNC_PROGRESS, { syncProgress: (wallet.syncProgress * 100).toFixed(1) })\n      return\n    }\n    Doc.hide(syncIcon)\n  }\n\n  /* reads the core.Wallet state and sets the icon visibility. */\n  readWallet (wallet: WalletState | null) {\n    this.setSyncing(wallet)\n    if (!wallet) return this.nowallet()\n    switch (true) {\n      case (wallet.disabled):\n        this.disabled()\n        break\n      case (!wallet.running):\n        this.sleeping()\n        break\n      case (!wallet.open):\n        this.locked()\n        break\n      case (wallet.open):\n        this.unlocked()\n        break\n      default:\n        console.error('wallet in unknown state', wallet)\n    }\n  }\n}\n\n/* sleep can be used by async functions to pause for a specified period. */\nfunction sleep (ms: number) {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n\nconst aYear = 31536000000\nconst aMonth = 2592000000\nconst aDay = 86400000\nconst anHour = 3600000\nconst aMinute = 60000\n\n/* timeMod returns the quotient and remainder of t / dur. */\nfunction timeMod (t: number, dur: number) {\n  const n = Math.floor(t / dur)\n  return [n, t - n * dur]\n}\n","// State is a set of static methods for working with the user state. It has\n// utilities for setting and retrieving cookies and storing user configuration\n// to localStorage.\nexport default class State {\n  // Cookie keys.\n  static darkModeCK = 'darkMode'\n  static authCK = 'dexauth'\n  static pwKeyCK = 'sessionkey'\n  // Local storage keys (for data that we don't need at the server).\n  static popupsLK = 'popups'\n  static loggersLK = 'loggers'\n  static recordersLK = 'recorders'\n  static lastMarketLK = 'selectedMarket'\n  static depthZoomLK = 'depthZoom'\n  static lastMMMarketLK = 'mmMarket'\n  static optionsExpansionLK = 'mmOptsExpand'\n  static leftMarketDockLK = 'leftmarketdock'\n  static selectedAssetLK = 'selectedasset'\n  static notificationsLK = 'notifications'\n  static orderDisclaimerAckedLK = 'ordAck'\n  static lastCandleDurationLK = 'lastCandleDuration'\n\n  static setCookie (cname: string, cvalue: string) {\n    const d = new Date()\n    // Set cookie to expire in ten years.\n    d.setTime(d.getTime() + (86400 * 365 * 10 * 1000))\n    const expires = 'expires=' + d.toUTCString()\n    document.cookie = cname + '=' + cvalue + ';' + expires + ';path=/'\n  }\n\n  /*\n   * getCookie returns the value at the specified cookie name, otherwise null.\n   */\n  static getCookie (cname: string) {\n    for (const cstr of document.cookie.split(';')) {\n      const [k, v] = cstr.split('=')\n      if (k.trim() === cname) return v\n    }\n    return null\n  }\n\n  /*\n   * removeCookie tells the browser to stop using cookie. It's not enough to simply\n   * erase cookie value because browser will still send it to the server (with empty\n   * value), and that's not what server expects.\n   */\n  static removeCookie (cKey: string) {\n    document.cookie = `${cKey}=;expires=Thu, 01 Jan 1970 00:00:01 GMT;`\n  }\n\n  /*\n   * isDark returns true if the dark-mode cookie is currently set to '1' = true.\n   */\n  static isDark () {\n    return document.cookie.split(';').filter((item) => item.includes(`${State.darkModeCK}=1`)).length\n  }\n\n  /* passwordIsCached returns whether or not there is a cached password in the cookies. */\n  static passwordIsCached () {\n    return !!this.getCookie(State.pwKeyCK)\n  }\n\n  /* storeLocal puts the key-value pair into Window.localStorage. */\n  static storeLocal (k: string, v: any) {\n    window.localStorage.setItem(k, JSON.stringify(v))\n  }\n\n  /*\n  * fetchLocal the value associated with the key in Window.localStorage, or\n  * null if the no value exists for the key.\n  */\n  static fetchLocal (k: string) {\n    const v = window.localStorage.getItem(k)\n    if (v !== null) {\n      return JSON.parse(v)\n    }\n    return null\n  }\n\n  /* removeLocal removes the key-value pair from Window.localStorage. */\n  static removeLocal (k: string) {\n    window.localStorage.removeItem(k)\n  }\n}\n\n// Setting defaults here, unless specific cookie (or local storage) value was already chosen by the user.\nif (State.getCookie(State.darkModeCK) === null) State.setCookie(State.darkModeCK, '1')\nif (State.fetchLocal(State.popupsLK) === null) State.storeLocal(State.popupsLK, '1')\nif (State.fetchLocal(State.leftMarketDockLK) === null) State.storeLocal(State.leftMarketDockLK, '1')\n","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return self;\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}","import _typeof from \"./typeof.js\";\nimport assertThisInitialized from \"./assertThisInitialized.js\";\nexport default function _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n  return assertThisInitialized(self);\n}","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","/*\n * requestJSON encodes the object and sends the JSON to the specified address.\n */\nexport async function requestJSON (method: string, addr: string, reqBody?: any): Promise<any> {\n  try {\n    const response = await window.fetch(addr, {\n      method: method,\n      headers: new window.Headers({ 'content-type': 'application/json' }),\n      // credentials: \"same-origin\",\n      body: reqBody\n    })\n    if (response.status !== 200) { throw response }\n    const obj = await response.json()\n    obj.requestSuccessful = true\n    return obj\n  } catch (response) {\n    response.requestSuccessful = false\n    response.msg = await response.text()\n    return response\n  }\n}\n\n/*\n * postJSON sends a POST request with JSON-formatted data and returns the\n * response.\n */\nexport async function postJSON (addr: string, data?: any) {\n  return requestJSON('POST', addr, JSON.stringify(data))\n}\n\n/*\n * getJSON sends a GET request and returns the response.\n */\nexport async function getJSON (addr: string): Promise<any> {\n  return requestJSON('GET', addr)\n}\n\nexport enum Errors {\n  walletErr,\n  walletAuthErr,\n  walletBalanceErr,\n  dupeDEXErr,\n  assetSupportErr,\n  registerErr,\n  signatureErr,\n  zeroFeeErr,\n  feeMismatchErr,\n  feeSendErr,\n  passwordErr,\n  emptyHostErr,\n  connectionErr,\n  acctKeyErr,\n  unknownOrderErr,\n  orderParamsErr,\n  dbErr,\n  authErr,\n  connectWalletErr,\n  missingWalletErr,\n  encryptionErr,\n  decodeErr,\n  accountVerificationErr,\n  accountProofErr,\n  parseKeyErr,\n  marketErr,\n  addressParseErr,\n  addrErr,\n  fileReadErr,\n  unknownDEXErr,\n  accountRetrieveErr,\n  accountDisableErr,\n  suspendedAcctErr,\n  existenceCheckErr,\n  createWalletErr,\n  activeOrdersErr,\n  newAddrErr,\n}\n","declare global {\n  interface Window {\n    log: (...args: any) => void\n    enableLogger: (loggerID: string, enable: boolean) => void\n    recordLogger: (loggerID: string, enable: boolean) => void\n    dumpLogger: (loggerID: string) => void\n    localeDiscrepancies: () => void\n  }\n}\n\nexport enum ConnectionStatus {\n  Disconnected = 0,\n  Connected = 1,\n  InvalidCert = 2,\n}\n\nexport interface BondOptions {\n  bondAsset: number\n  targetTier: number\n  maxBondedAmt: number\n}\n\nexport interface Exchange {\n  host: string\n  acctID: string\n  markets: Record<string, Market>\n  assets: Record<number, Asset>\n  connectionStatus: ConnectionStatus\n  viewOnly: boolean\n  bondAssets: Record<string, BondAsset>\n  tier: number\n  bondOptions: BondOptions\n  pendingBonds: Record<string, PendingBondState>\n  candleDurs: string[]\n}\n\nexport interface Candle {\n  startStamp: number\n  endStamp: number\n  matchVolume: number\n  quoteVolume: number\n  highRate: number\n  lowRate: number\n  startRate: number\n  endRate: number\n}\n\nexport interface CandlesPayload {\n  dur: string\n  ms: number\n  candles: Candle[]\n}\n\nexport interface Market {\n  name: string\n  baseid: number\n  basesymbol: string\n  quoteid: number\n  quotesymbol: string\n  lotsize: number\n  ratestep: number\n  epochlen: number\n  startepoch: number\n  buybuffer: number\n  orders: Order[]\n  spot: Spot | undefined\n  atomToConv: number\n  inflight: InFlightOrder[]\n}\n\nexport interface InFlightOrder extends Order {\n  tempID: number\n}\n\nexport interface Order {\n  host: string\n  baseID: number\n  baseSymbol: string\n  quoteID: number\n  quoteSymbol: string\n  market: string\n  type: number\n  id: string\n  stamp: number\n  submitTime: number\n  sig: string\n  status: number\n  epoch: number\n  qty: number\n  sell: boolean\n  filled: number\n  matches: Match[]\n  cancelling: boolean\n  canceled: boolean\n  feesPaid: FeeBreakdown\n  fundingCoins: Coin[]\n  accelerationCoins: Coin[]\n  lockedamt: number\n  rate: number // limit only\n  tif: number // limit only\n  targetOrderID: string // cancel only\n  readyToTick: boolean\n}\n\nexport interface Match {\n  matchID: string\n  status: number\n  active: boolean\n  revoked: boolean\n  rate: number\n  qty: number\n  side: number\n  feeRate: number\n  swap: Coin\n  counterSwap: Coin\n  redeem: Coin\n  counterRedeem: Coin\n  refund: Coin\n  stamp: number\n  isCancel: boolean\n}\n\nexport interface Spot {\n  stamp: number\n  baseID: number\n  quoteID: number\n  rate: number\n  bookVolume: number // Unused?\n  change24: number\n  vol24: number\n  low24: number\n  high24: number\n}\n\nexport interface Asset {\n  id: number\n  symbol: string\n  version: number\n  maxFeeRate: number\n  swapSize: number\n  swapSizeBase: number\n  redeemSize: number\n  swapConf: number\n  unitInfo: UnitInfo\n}\n\nexport interface BondAsset {\n  ver: number\n  id: number\n  confs: number\n  amount: number\n}\n\nexport interface PendingBondState {\n  symbol: string\n  assetID: number\n  confs: number\n}\n\nexport interface FeeBreakdown {\n  swap: number\n  redemption: number\n}\n\nexport interface SupportedAsset {\n  id: number\n  symbol: string\n  name: string\n  wallet: WalletState\n  info?: WalletInfo\n  token?: Token\n  unitInfo: UnitInfo\n  walletCreationPending: boolean\n}\n\nexport interface Token {\n  parentID: number\n  name: string\n  unitInfo: UnitInfo\n  definition: WalletDefinition\n}\n\nexport interface WalletState {\n  symbol: string\n  assetID: number\n  version: number\n  type: string\n  traits: number\n  open: boolean\n  running: boolean\n  disabled: boolean\n  balance: WalletBalance\n  address: string\n  units: string\n  encrypted: boolean\n  peerCount: number\n  synced: boolean\n  syncProgress: number\n}\n\nexport interface WalletInfo {\n  name: string\n  version: number\n  availablewallets: WalletDefinition[]\n  versions: number[]\n  emptyidx: number\n  unitinfo: UnitInfo\n}\n\nexport interface WalletBalance {\n  available: number\n  immature: number\n  locked: number\n  stamp: string // time.Time\n  orderlocked: number\n  contractlocked: number\n  bondlocked: number\n  other: Record<string, number>\n}\n\nexport interface WalletDefinition {\n  seeded: boolean\n  type: string\n  tab: string\n  description: string\n  configpath: string\n  configopts: ConfigOption[]\n  noauth: boolean\n  guidelink: string\n}\n\nexport interface ConfigOption {\n  key: string\n  displayname: string\n  description: string\n  default: any\n  max: any\n  min: any\n  noecho: boolean\n  isboolean: boolean\n  isdate: boolean\n  disablewhenactive: boolean\n  isBirthdayConfig: boolean\n  repeatable?: string\n  repeatN?: number\n  noauth: boolean\n  regAsset?: number\n  required?: boolean\n}\n\nexport interface Coin {\n  id: string\n  stringID: string\n  assetID: number\n  symbol: string\n  confs: Confirmations\n}\n\nexport interface Confirmations {\n  required: number\n  count: number\n}\n\nexport interface UnitInfo {\n  atomicUnit: string\n  conventional: Denomination\n  denominations: Denomination[]\n}\n\nexport interface Denomination {\n  unit: string\n  conversionFactor: number\n}\n\nexport interface ExtensionConfiguredWallet {\n  hiddenFields: string[]\n  disableWalletType: boolean\n  disablePassword: boolean\n}\n\nexport interface ExtensionModeConfig {\n  restrictedWallets: Record<string, ExtensionConfiguredWallet>\n}\n\nexport interface User {\n  exchanges: Record<string, Exchange>\n  inited: boolean\n  seedgentime: number\n  assets: Record<number, SupportedAsset>\n  fiatRates: Record<number, number>\n  authed: boolean // added by webserver\n  ok: boolean // added by webserver\n  bots: BotReport[]\n  extensionModeConfig: ExtensionModeConfig\n}\n\nexport interface CoreNote {\n  type: string\n  topic: string\n  subject: string\n  details: string\n  severity: number\n  stamp: number\n  acked: boolean\n  id: string\n}\n\nexport interface BondNote extends CoreNote {\n  asset: number\n  confirmations: number\n  dex: string\n  coinID: string | null\n  tier: number | null\n}\n\nexport interface BalanceNote extends CoreNote {\n  assetID: number\n  balance: WalletBalance\n}\n\nexport interface RateNote extends CoreNote {\n  fiatRates: Record<number, number>\n}\n\nexport interface WalletConfigNote extends CoreNote {\n  wallet: WalletState\n}\n\nexport type WalletStateNote = WalletConfigNote\n\nexport interface WalletCreationNote extends CoreNote {\n  assetID: number\n}\n\nexport interface SpotPriceNote extends CoreNote {\n  host: string\n  spots: Record<string, Spot>\n}\n\nexport interface BotNote extends CoreNote {\n  report: BotReport\n}\n\nexport interface MatchNote extends CoreNote {\n  orderID: string\n  match: Match\n  host: string\n  marketID: string\n}\n\nexport interface ConnEventNote extends CoreNote {\n  host: string\n  connectionStatus: ConnectionStatus\n}\n\nexport interface OrderNote extends CoreNote {\n  order: Order\n  tempID: number\n}\n\nexport interface RecentMatch {\n  rate: number\n  qty: number\n  stamp: number\n  sell: boolean\n}\n\nexport interface EpochNote extends CoreNote {\n  host: string\n  marketID: string\n  epoch: number\n}\n\nexport interface APIResponse {\n  requestSuccessful: boolean\n  ok: boolean\n  msg: string\n  err?: string\n}\n\nexport interface LogMessage {\n  time: string\n  msg: string\n}\n\nexport interface NoteElement extends HTMLElement {\n  note: CoreNote\n}\n\nexport interface BalanceResponse extends APIResponse {\n  balance: WalletBalance\n}\n\nexport interface LayoutMetrics {\n  bodyTop: number\n  bodyLeft: number\n  width: number\n  height: number\n  centerX: number\n  centerY: number\n}\n\nexport interface PasswordCache {\n  pw: string\n}\n\nexport interface PageElement extends HTMLElement {\n  value?: string\n  src?: string\n  files?: FileList\n  checked?: boolean\n  href?: string\n  htmlFor?: string\n}\n\nexport interface BooleanConfig {\n  reason: string\n}\n\nexport interface XYRangePoint {\n  label: string\n  x: number\n  y: number\n}\n\nexport interface XYRange {\n  start: XYRangePoint\n  end: XYRangePoint\n  xUnit: string\n  yUnit: string\n}\n\nexport interface OrderOption extends ConfigOption {\n  boolean?: BooleanConfig\n  xyRange?: XYRange\n  showByDefault?: boolean\n}\n\nexport interface SwapEstimate {\n  lots: number\n  value: number\n  maxFees: number\n  realisticWorstCase: number\n  realisticBestCase: number\n}\n\nexport interface RedeemEstimate {\n  realisticBestCase: number\n  realisticWorstCase: number\n}\n\nexport interface PreSwap {\n  estimate: SwapEstimate\n  options: OrderOption[]\n}\n\nexport interface PreRedeem {\n  estimate: RedeemEstimate\n  options: OrderOption[]\n}\n\nexport interface OrderEstimate {\n  swap: PreSwap\n  redeem: PreRedeem\n}\n\nexport interface MaxOrderEstimate {\n  swap: SwapEstimate\n  redeem: RedeemEstimate\n}\n\nexport interface MaxSell {\n  maxSell: MaxOrderEstimate\n}\n\nexport interface MaxBuy {\n  maxBuy: MaxOrderEstimate\n}\n\nexport interface TradeForm {\n  host: string\n  isLimit: boolean\n  sell: boolean\n  base: number\n  quote: number\n  qty: number\n  rate: number\n  tifnow: boolean\n  options: Record<string, any>\n}\n\nexport interface BookUpdate {\n  action: string\n  host: string\n  marketID: string\n  matchesSummary: RecentMatch[]\n  payload: any\n}\n\nexport interface MiniOrder {\n  qty: number\n  qtyAtomic: number\n  rate: number\n  msgRate: number\n  epoch: number\n  sell: boolean\n  token: string\n}\n\nexport interface CoreOrderBook {\n  sells: MiniOrder[]\n  buys: MiniOrder[]\n  epoch: MiniOrder[]\n  recentMatches: RecentMatch[]\n}\n\nexport interface MarketOrderBook {\n  base: number\n  quote: number\n  book: CoreOrderBook\n}\n\nexport interface RemainderUpdate {\n  token: string\n  qty: number\n  qtyAtomic: number\n}\n\nexport interface OrderFilter {\n  n?: number\n  offset?: string\n  hosts: string[]\n  assets: number[]\n  statuses: number[]\n}\n\nexport interface MakerProgram {\n  host: string\n  baseID: number\n  quoteID: number\n  lots: number\n  oracleWeighting: number\n  oracleBias: number\n  driftTolerance: number\n  gapFactor: number\n  gapStrategy: string\n}\n\nexport interface BotOrder {\n  host: string\n  marketID: string\n  orderID: string\n}\n\nexport interface BotReport {\n  programID: number\n  program: MakerProgram\n  running: boolean\n  orders: BotOrder\n}\n\nexport interface MarketReport {\n  basisPrice: number\n  price: number\n  oracles: OracleReport[]\n  breakEvenSpread: number\n}\n\nexport interface OracleReport {\n  host: string\n  usdVol: number\n  bestBuy: number\n  bestSell: number\n}\n\n// changing the order of the elements in this enum will affect\n// the sorting of the peers table in wallets.ts.\nexport enum PeerSource {\n  WalletDefault,\n  UserAdded,\n  Discovered,\n}\n\nexport interface WalletPeer {\n  addr: string\n  source: PeerSource\n  connected: boolean\n}\n\nexport interface Application {\n  assets: Record<number, SupportedAsset>\n  seedGenTime: number\n  user: User\n  header: HTMLElement\n  headerSpace: HTMLElement\n  walletMap: Record<number, WalletState>\n  exchanges: Record<string, Exchange>\n  fiatRatesMap: Record<number, number>\n  showPopups: boolean\n  commitHash: string\n  authed(): boolean\n  start (): Promise<void>\n  reconnected (): void\n  fetchUser (): Promise<User | void>\n  loadPage (page: string, data?: any, skipPush?: boolean): Promise<boolean>\n  attach (data: any): void\n  bindTooltips (ancestor: HTMLElement): void\n  attachHeader (): void\n  showDropdown (icon: HTMLElement, dialog: HTMLElement): void\n  ackNotes (): void\n  setNoteTimes (noteList: HTMLElement): void\n  bindInternalNavigation (ancestor: HTMLElement): void\n  storeNotes (): void\n  updateMenuItemsDisplay (): void\n  attachCommon (node: HTMLElement): void\n  updateBondConfs (dexAddr: string, coinID: string, confs: number, assetID: number): void\n  handleBondNote (note: BondNote): void\n  setNotes (notes: CoreNote[]): void\n  notify (note: CoreNote): void\n  log (loggerID: string, ...msg: any): void\n  prependPokeElement (note: CoreNote): void\n  prependNoteElement (note: CoreNote, skipSave?: boolean): void\n  prependListElement (noteList: HTMLElement, note: CoreNote, el: NoteElement): void\n  loading (el: HTMLElement): () => void\n  orders (host: string, mktID: string): Order[]\n  haveActiveOrders (assetID: number): boolean\n  order (oid: string): Order | null\n  canAccelerateOrder(order: Order): boolean\n  unitInfo (assetID: number, xc?: Exchange): UnitInfo\n  conventionalRate (baseID: number, quoteID: number, encRate: number, xc?: Exchange): number\n  walletDefinition (assetID: number, walletType: string): WalletDefinition\n  currentWalletDefinition (assetID: number): WalletDefinition\n  fetchBalance (assetID: number): Promise<WalletBalance>\n  checkResponse (resp: APIResponse): boolean\n  signOut (): Promise<void>\n  registerNoteFeeder (receivers: Record<string, (n: CoreNote) => void>): void\n}\n\n// TODO: Define an interface for Application?\nlet application: Application\n\nexport function registerApplication (a: Application) {\n  application = a\n}\n\nexport function app (): Application {\n  return application\n}\n","import Doc from './doc'\nimport {\n  PageElement,\n  XYRange,\n  OrderOption\n} from './registry'\n\ninterface OptionsReporters {\n  enable: () => void\n  disable: () => void\n}\n\n// Having the caller set these vars on load using an exported function makes\n// life easier.\nlet orderOptTmpl: HTMLElement, booleanOptTmpl: HTMLElement, rangeOptTmpl: HTMLElement\n\n// setOptionTemplates sets the package vars for the templates and application.\nexport function setOptionTemplates (page: Record<string, PageElement>): void {\n  [booleanOptTmpl, rangeOptTmpl, orderOptTmpl] = [page.booleanOptTmpl, page.rangeOptTmpl, page.orderOptTmpl]\n}\n\nconst threeSigFigs = new Intl.NumberFormat((navigator.languages as string[]), {\n  minimumSignificantDigits: 3,\n  maximumSignificantDigits: 3\n})\n\n/*\n * Option is a base class for option elements. Option stores some common\n * parameters and monitors the toggle switch, calling the child class's\n * enable/disable methods when the user manually turns the option on or off.\n */\nexport class Option {\n  opt: OrderOption\n  node: HTMLElement\n  tmpl: Record<string, PageElement>\n  on: boolean\n\n  constructor (opt: OrderOption, symbol: string, report: OptionsReporters) {\n    this.opt = opt\n    const node = this.node = orderOptTmpl.cloneNode(true) as HTMLElement\n    const tmpl = this.tmpl = Doc.parseTemplate(node)\n\n    tmpl.optName.textContent = opt.displayname\n    tmpl.tooltip.dataset.tooltip = opt.description\n\n    // const isBaseChain = (isSwapOption && order.sell) || (!isSwapOption && !order.sell)\n    // const symbol = isBaseChain ? this.baseSymbol() : this.quoteSymbol()\n    if (symbol) tmpl.chainIcon.src = Doc.logoPath(symbol)\n    else Doc.hide(tmpl.chainIcon)\n\n    this.on = false\n    Doc.bind(node, 'click', () => {\n      if (this.on) return\n      this.on = true\n      node.classList.add('selected')\n      report.enable()\n    })\n    Doc.bind(tmpl.toggle, 'click', e => {\n      if (!this.on) return\n      e.stopPropagation()\n      this.on = false\n      node.classList.remove('selected')\n      report.disable()\n    })\n  }\n}\n\n/*\n * BooleanOption is a simple on/off option with a short summary of it's effects.\n * BooleanOrderOption is the handler for a *BooleanConfig from client/asset.\n */\nexport class BooleanOption extends Option {\n  control: HTMLElement\n  changed: () => void\n  dict: Record<string, any>\n\n  constructor (opt: OrderOption, symbol: string, dict: Record<string, any>, changed: () => void) {\n    super(opt, symbol, {\n      enable: () => this.enable(),\n      disable: () => this.disable()\n    })\n    this.dict = dict\n    this.changed = () => changed()\n    if (opt.boolean === undefined) throw Error('not a boolean opt')\n    const cfg = opt.boolean\n    const control = this.control = booleanOptTmpl.cloneNode(true) as HTMLElement\n    // Append to parent's options div.\n    this.tmpl.controls.appendChild(control)\n    const tmpl = Doc.parseTemplate(control)\n    tmpl.reason.textContent = cfg.reason\n    this.on = typeof dict[opt.key] !== 'undefined' ? dict[opt.key] : opt.default\n    if (this.on) this.node.classList.add('selected')\n  }\n\n  store (): void {\n    if (this.on === this.opt.default) delete this.dict[this.opt.key]\n    else this.dict[this.opt.key] = this.on\n    this.changed()\n  }\n\n  enable (): void {\n    this.store()\n  }\n\n  disable (): void {\n    this.store()\n  }\n}\n\n/*\n * XYRangeOption is an order option that contains an XYRangeHandler. The logic\n * for handling the slider to is defined in XYRangeHandler so that the slider\n * can be used without being contained in an order option.\n */\nexport class XYRangeOption extends Option {\n  handler: XYRangeHandler\n  x: number\n  changed: () => void\n  dict: Record<string, any>\n\n  constructor (opt: OrderOption, symbol: string, dict: Record<string, any>, changed: () => void) {\n    super(opt, symbol, {\n      enable: () => this.enable(),\n      disable: () => this.disable()\n    })\n    this.dict = dict\n    this.changed = changed\n    if (opt.xyRange === undefined) throw Error('not an xy range opt')\n    const cfg = opt.xyRange\n    const setVal = dict[opt.key]\n    this.on = typeof setVal !== 'undefined'\n    if (this.on) {\n      this.node.classList.add('selected')\n      this.x = setVal\n    } else {\n      this.x = opt.default\n    }\n    const onUpdate = (x: number) => {\n      this.x = x\n      this.dict[this.opt.key] = x\n    }\n    const onChange = () => { this.changed() }\n    const selected = () => { this.node.classList.add('selected') }\n    this.handler = new XYRangeHandler(cfg, this.x, onUpdate, onChange, selected)\n    this.tmpl.controls.appendChild(this.handler.control)\n  }\n\n  enable (): void {\n    this.dict[this.opt.key] = this.x\n    this.changed()\n  }\n\n  disable (): void {\n    delete this.dict[this.opt.key]\n    this.changed()\n  }\n\n  setValue (x: number): void {\n    this.handler.setValue(x)\n    this.on = true\n    this.node.classList.add('selected')\n  }\n}\n\n/*\n * XYRangeHandler is the handler for an *XYRange from client/asset. XYRange\n * has a slider which allows adjusting the x and y, linearly between two limits.\n * The user can also manually enter values for x or y.\n */\nexport class XYRangeHandler {\n  control: HTMLElement\n  cfg: XYRange\n  tmpl: Record<string, PageElement>\n  x: number\n  scrollingX: number\n  y: number\n  r: number\n  roundY: boolean\n  updated: (x:number, y:number) => void\n  changed: () => void\n  selected: () => void\n  setConfig: (cfg: XYRange) => void\n\n  constructor (cfg: XYRange, initVal: number, updated: (x:number, y:number) => void, changed: () => void, selected: () => void, roundY?: boolean) {\n    const control = this.control = rangeOptTmpl.cloneNode(true) as HTMLElement\n    const tmpl = this.tmpl = Doc.parseTemplate(control)\n    this.roundY = Boolean(roundY)\n    this.cfg = cfg\n\n    this.changed = changed\n    this.selected = selected\n    this.updated = updated\n\n    const { slider, handle } = tmpl\n\n    let rangeX = cfg.end.x - cfg.start.x\n    let rangeY = cfg.end.y - cfg.start.y\n    const normalizeX = (x: number) => (x - cfg.start.x) / rangeX\n\n    const setConfig = (newCfg: XYRange) => {\n      rangeX = newCfg.end.x - newCfg.start.x\n      rangeY = newCfg.end.y - newCfg.start.y\n      cfg = this.cfg = newCfg\n      tmpl.rangeLblStart.textContent = cfg.start.label\n      tmpl.rangeLblEnd.textContent = cfg.end.label\n      tmpl.xUnit.textContent = cfg.xUnit\n      tmpl.yUnit.textContent = cfg.yUnit\n      this.y = this.r * rangeY + cfg.start.y\n      this.r = (this.y - cfg.start.y) / rangeY\n      this.scrollingX = this.r * rangeX + cfg.start.x\n    }\n    setConfig(cfg)\n\n    this.setConfig = (cfg: XYRange) => {\n      setConfig(cfg)\n      this.accept(this.scrollingX)\n    }\n\n    // r, x, and y will be updated by the various input event handlers. r is\n    // x (or y) normalized on its range, e.g. [x_min, x_max] -> [0, 1]\n    this.r = normalizeX(initVal)\n    this.scrollingX = this.x = initVal\n    this.y = this.r * rangeY + cfg.start.y\n\n    // Set up the handlers for the x and y text input fields.\n    const clickOutX = (e: MouseEvent) => {\n      if (e.type !== 'change' && e.target === tmpl.xInput) return\n      const s = tmpl.xInput.value\n      if (s) {\n        const xx = parseFloat(s)\n        if (!isNaN(xx)) {\n          this.scrollingX = clamp(xx, cfg.start.x, cfg.end.x)\n          this.r = normalizeX(this.scrollingX)\n          this.y = this.r * rangeY + cfg.start.y\n          this.accept(this.scrollingX)\n        }\n      }\n      Doc.hide(tmpl.xInput)\n      Doc.show(tmpl.x)\n      Doc.unbind(document, 'click', clickOutX)\n      this.changed()\n    }\n\n    Doc.bind(tmpl.x, 'click', e => {\n      Doc.hide(tmpl.x)\n      Doc.show(tmpl.xInput)\n      tmpl.xInput.focus()\n      tmpl.xInput.value = threeSigFigs.format(this.scrollingX)\n      Doc.bind(document, 'click', clickOutX)\n      e.stopPropagation()\n    })\n\n    Doc.bind(tmpl.xInput, 'change', clickOutX)\n\n    const clickOutY = (e: MouseEvent) => {\n      if (e.type !== 'change' && e.target === tmpl.yInput) return\n      const s = tmpl.yInput.value\n      if (s) {\n        const yy = parseFloat(s)\n        if (!isNaN(yy)) {\n          this.y = clamp(yy, cfg.start.y, cfg.end.y)\n          this.r = (this.y - cfg.start.y) / rangeY\n          this.scrollingX = cfg.start.x + this.r * rangeX\n          this.accept(this.scrollingX)\n        }\n      }\n      Doc.hide(tmpl.yInput)\n      Doc.show(tmpl.y)\n      Doc.unbind(document, 'click', clickOutY)\n      this.changed()\n    }\n\n    Doc.bind(tmpl.y, 'click', e => {\n      Doc.hide(tmpl.y)\n      Doc.show(tmpl.yInput)\n      tmpl.yInput.focus()\n      tmpl.yInput.value = threeSigFigs.format(this.y)\n      Doc.bind(document, 'click', clickOutY)\n      e.stopPropagation()\n    })\n\n    Doc.bind(tmpl.yInput, 'change', clickOutY)\n\n    // Read the slider.\n    Doc.bind(handle, 'mousedown', (e: MouseEvent) => {\n      if (e.button !== 0) return\n      e.preventDefault()\n      this.selected()\n      const startX = e.pageX\n      const w = slider.clientWidth - handle.offsetWidth\n      const startLeft = normalizeX(this.scrollingX) * w\n      const left = (ee: MouseEvent) => Math.max(Math.min(startLeft + (ee.pageX - startX), w), 0)\n      const trackMouse = (ee: MouseEvent) => {\n        ee.preventDefault()\n        this.r = left(ee) / w\n        this.scrollingX = this.r * rangeX + cfg.start.x\n        this.y = this.r * rangeY + cfg.start.y\n        this.accept(this.scrollingX)\n      }\n      const mouseUp = (ee: MouseEvent) => {\n        trackMouse(ee)\n        Doc.unbind(document, 'mousemove', trackMouse)\n        Doc.unbind(document, 'mouseup', mouseUp)\n        this.changed()\n      }\n      Doc.bind(document, 'mousemove', trackMouse)\n      Doc.bind(document, 'mouseup', mouseUp)\n    })\n\n    this.accept(this.scrollingX, true)\n  }\n\n  accept (x: number, skipUpdate?: boolean): void {\n    const tmpl = this.tmpl\n    if (this.roundY) this.y = Math.round(this.y)\n    tmpl.x.textContent = threeSigFigs.format(x)\n    tmpl.y.textContent = threeSigFigs.format(this.y)\n    if (this.roundY) tmpl.y.textContent = `${this.y}`\n    tmpl.handle.style.left = `calc(${this.r * 100}% - ${this.r * 14}px)`\n    this.x = x\n    this.scrollingX = x\n    if (!skipUpdate) this.updated(x, this.y)\n  }\n\n  setValue (x: number) {\n    const cfg = this.cfg\n    this.r = (x - cfg.start.x) / (cfg.end.x - cfg.start.x)\n    this.y = cfg.start.y + this.r * (cfg.end.y - cfg.start.y)\n    this.accept(x, true)\n  }\n}\n\nconst clamp = (v: number, min: number, max: number): number => v < min ? min : v > max ? max : v\n","export default class BasePage {\n  /* unload is called when the user navigates away from the page. */\n  unload () {\n    // should be implemented by inheriting class.\n  }\n}\n","import arrayWithoutHoles from \"./arrayWithoutHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableSpread from \"./nonIterableSpread.js\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import * as intl from './locales'\nimport {\n  app,\n  Order,\n  TradeForm,\n  OrderOption,\n  Match\n} from './registry'\nimport { BooleanOption, XYRangeOption } from './opts'\n\nexport const Limit = 1\nexport const Market = 2\nexport const Cancel = 3\n\n/* The time-in-force specifiers are a mirror of dex/order.TimeInForce. */\nexport const ImmediateTiF = 0\nexport const StandingTiF = 1\n\n/* The order statuses are a mirror of dex/order.OrderStatus. */\nexport const StatusUnknown = 0\nexport const StatusEpoch = 1\nexport const StatusBooked = 2\nexport const StatusExecuted = 3\nexport const StatusCanceled = 4\nexport const StatusRevoked = 5\n\n/* The match statuses are a mirror of dex/order.MatchStatus. */\nexport const NewlyMatched = 0\nexport const MakerSwapCast = 1\nexport const TakerSwapCast = 2\nexport const MakerRedeemed = 3\nexport const MatchComplete = 4\nexport const MatchConfirmed = 5\n\n/* The match sides are a mirror of dex/order.MatchSide. */\nexport const Maker = 0\nexport const Taker = 1\n\n/*\n * RateEncodingFactor is used when encoding an atomic exchange rate as an\n * integer. See docs on message-rate encoding @\n * https://github.com/decred/dcrdex/blob/master/spec/comm.mediawiki#Rate_Encoding\n */\nexport const RateEncodingFactor = 1e8\n\nexport function sellString (ord: Order) {\n  const key = ord.sell ? intl.ID_SELL : intl.ID_BUY\n  const lang = document.documentElement.lang.toLowerCase()\n  return intl.prep(key).toLocaleLowerCase(lang)\n}\n\nexport function typeString (ord: Order) {\n  return ord.type === Limit ? (ord.tif === ImmediateTiF ? intl.prep(intl.ID_LIMIT_ORDER_IMMEDIATE_TIF) : intl.prep(intl.ID_LIMIT_ORDER)) : intl.prep(intl.ID_MARKET_ORDER)\n}\n\n/* isMarketBuy will return true if the order is a market buy order. */\nexport function isMarketBuy (ord: Order) {\n  return ord.type === Market && !ord.sell\n}\n\n/*\n * hasActiveMatches returns true if the order has matches that have not completed\n * settlement yet.\n */\nexport function hasActiveMatches (order: Order) {\n  if (!order.matches) return false\n  for (const match of order.matches) {\n    if (match.active) return true\n  }\n  return false\n}\n\n/**\n * statusString converts the order status to a string.\n *\n * IMPORTANT: we have similar function in Golang, it must match this one exactly,\n * when updating make sure to update both!\n */\nexport function statusString (order: Order): string {\n  if (!order.id) return intl.prep(intl.ID_ORDER_SUBMITTING) // order ID is empty.\n  const isLive = hasActiveMatches(order)\n  switch (order.status) {\n    case StatusUnknown: return intl.prep(intl.ID_UNKNOWN)\n    case StatusEpoch: return intl.prep(intl.ID_EPOCH)\n    case StatusBooked:\n      if (order.cancelling) return intl.prep(intl.ID_CANCELING)\n      return isLive ? `${intl.prep(intl.ID_BOOKED)}/${intl.prep(intl.ID_SETTLING)}` : intl.prep(intl.ID_BOOKED)\n    case StatusExecuted:\n      if (isLive) return intl.prep(intl.ID_SETTLING)\n      if (order.filled === 0 && order.type !== Cancel) return intl.prep(intl.ID_NO_MATCH)\n      return intl.prep(intl.ID_EXECUTED)\n    case StatusCanceled:\n      return isLive ? `${intl.prep(intl.ID_CANCELED)}/${intl.prep(intl.ID_SETTLING)}` : intl.prep(intl.ID_CANCELED)\n    case StatusRevoked:\n      return isLive ? `${intl.prep(intl.ID_REVOKED)}/${intl.prep(intl.ID_SETTLING)}` : intl.prep(intl.ID_REVOKED)\n  }\n  return intl.prep(intl.ID_UNKNOWN)\n}\n\n/* filled sums the quantities of non-cancel matches available. */\nexport function filled (order: Order) {\n  if (!order.matches) return 0\n  const qty = isMarketBuy(order) ? (m: Match) => m.qty * m.rate / RateEncodingFactor : (m: Match) => m.qty\n  return order.matches.reduce((filled, match) => {\n    if (match.isCancel) return filled\n    return filled + qty(match)\n  }, 0)\n}\n\n/* settled sums the quantities of the matches that have completed. */\nexport function settled (order: Order) {\n  if (!order.matches) return 0\n  const qty = isMarketBuy(order) ? (m: Match) => m.qty * m.rate / RateEncodingFactor : (m: Match) => m.qty\n  return order.matches.reduce((settled, match) => {\n    if (match.isCancel) return settled\n    const redeemed = (match.side === Maker && match.status >= MakerRedeemed) ||\n      (match.side === Taker && match.status >= MatchComplete)\n    return redeemed ? settled + qty(match) : settled\n  }, 0)\n}\n\n/* baseToQuote returns the quantity of the quote asset. */\nexport function baseToQuote (rate: number, base: number) : number {\n  return rate * base / RateEncodingFactor\n}\n\n/* orderPortion returns a string stating the percentage of the order a match\n   makes up. */\nexport function orderPortion (order: Order, match: Match) : string {\n  let matchQty = match.qty\n  if (isMarketBuy(order)) {\n    matchQty = baseToQuote(match.rate, match.qty)\n  }\n  return ((matchQty / order.qty) * 100).toFixed(1) + ' %'\n}\n\n/*\n * matchStatusString is a string used to create a displayable string describing\n * describing the match status.\n */\nexport function matchStatusString (m: Match) {\n  if (m.revoked) {\n    // When revoked, match status is less important than pending action if still\n    // active, or the outcome if inactive.\n    if (m.active) {\n      if (m.redeem) return revokedMatchStatus(intl.ID_MATCH_STATUS_REDEMPTION_SENT) // must require confirmation if active\n      // If maker and we have not redeemed, waiting to refund, assuming it's not\n      // revoked while waiting for confs on an unspent/unexpired taker swap.\n      if (m.side === Maker) return revokedMatchStatus(intl.ID_MATCH_STATUS_REFUND_PENDING)\n      // As taker, resolution depends on maker's actions while waiting to refund.\n      if (m.counterRedeem) return revokedMatchStatus(intl.ID_MATCH_STATUS_REDEEM_PENDING) // this should be very brief if we see the maker's redeem\n      return revokedMatchStatus(intl.ID_MATCH_STATUS_REFUND_PENDING) // may switch to redeem if maker redeems on the sly\n    }\n    if (m.refund) {\n      return revokedMatchStatus(intl.ID_MATCH_STATUS_REFUNDED)\n    }\n    if (m.redeem) {\n      return revokedMatchStatus(intl.ID_MATCH_STATUS_REDEMPTION_CONFIRMED)\n    }\n    return revokedMatchStatus(intl.ID_MATCH_STATUS_COMPLETE) // i.e. we sent no swap\n  }\n\n  switch (m.status) {\n    case NewlyMatched:\n      return intl.prep(intl.ID_MATCH_STATUS_NEWLY_MATCHED)\n    case MakerSwapCast:\n      return intl.prep(intl.ID_MATCH_STATUS_MAKER_SWAP_CAST)\n    case TakerSwapCast:\n      return intl.prep(intl.ID_MATCH_STATUS_TAKER_SWAP_CAST)\n    case MakerRedeemed:\n      if (m.side === Maker) {\n        return intl.prep(intl.ID_MATCH_STATUS_REDEMPTION_SENT)\n      }\n      return intl.prep(intl.ID_MATCH_STATUS_MAKER_REDEEMED)\n    case MatchComplete:\n      return intl.prep(intl.ID_MATCH_STATUS_REDEMPTION_SENT)\n    case MatchConfirmed:\n      return intl.prep(intl.ID_MATCH_STATUS_REDEMPTION_CONFIRMED)\n  }\n  return intl.prep(intl.ID_UNKNOWN)\n}\n\n// revokedMatchStatus is a helper function that returns the revoked match status\n// string.\nfunction revokedMatchStatus (matchStatus: string): string {\n  return intl.prep(intl.ID_MATCH_STATUS_REVOKED, { status: intl.prep(matchStatus) })\n}\n\n/*\n * optionElement is a getter for an element matching the *OrderOption from\n * client/asset. change is a function with no arguments that is called when the\n * returned option's value has changed.\n */\nexport function optionElement (opt: OrderOption, order: TradeForm, change: () => void, isSwap: boolean): HTMLElement {\n  const isBaseChain = (isSwap && order.sell) || (!isSwap && !order.sell)\n  const symbol = isBaseChain ? dexAssetSymbol(order.host, order.base) : dexAssetSymbol(order.host, order.quote)\n\n  switch (true) {\n    case !!opt.boolean:\n      return new BooleanOption(opt, symbol, order.options, change).node\n    case !!opt.xyRange:\n      return new XYRangeOption(opt, symbol, order.options, change).node\n    default:\n      console.error('no option type specified', opt)\n  }\n  console.error('unknown option type', opt)\n  return document.createElement('div')\n}\n\nfunction dexAssetSymbol (host: string, assetID: number): string {\n  return app().exchanges[host].assets[assetID].symbol\n}\n","import Doc, { Animation } from './doc'\nimport { RateEncodingFactor } from './orderutil'\nimport OrderBook from './orderbook'\nimport State from './state'\nimport { UnitInfo, Market, Candle, CandlesPayload } from './registry'\n\nconst bind = Doc.bind\nconst PIPI = 2 * Math.PI\nconst plusChar = String.fromCharCode(59914)\nconst minusChar = String.fromCharCode(59915)\n\ninterface Point {\n  x: number\n  y: number\n}\n\ninterface MinMax {\n  min: number\n  max: number\n}\n\ninterface Label {\n  val: number\n  txt: string\n}\n\ninterface LabelSet {\n  widest?: number\n  lbls: Label[]\n}\n\ninterface Translator {\n    x: (x: number) => number\n    y: (y: number) => number\n    unx: (x: number) => number\n    uny: (y: number) => number\n    w: (w: number) => number\n    h: (h: number) => number\n    dataCoords: (f: () => void) => void\n}\n\nexport interface MouseReport {\n  rate: number\n  depth: number\n  dotColor: string\n  hoverMarkers: number[]\n}\n\nexport interface VolumeReport {\n  buyBase: number\n  buyQuote: number\n  sellBase: number\n  sellQuote: number\n}\n\nexport interface DepthReporters {\n  mouse: (r: MouseReport | null) => void\n  click: (x: number) => void\n  volume: (r: VolumeReport) => void\n  zoom: (z: number) => void\n}\n\nexport interface CandleReporters {\n  mouse: (r: Candle | null) => void\n}\n\nexport interface ChartReporters {\n  resize: () => void,\n  click: (e: MouseEvent) => void,\n  zoom: (bigger: boolean) => void\n}\n\nexport interface DepthLine {\n  rate: number\n  color: string\n}\n\nexport interface DepthMarker {\n  rate: number\n  active: boolean\n}\n\ninterface DepthMark extends DepthMarker {\n  qty: number\n  sell: boolean\n}\n\ninterface Theme {\n  axisLabel: string\n  gridBorder: string\n  gridLines: string\n  gapLine: string\n  value: string\n  zoom: string\n  zoomHover: string\n  sellLine: string\n  buyLine: string\n  sellFill: string\n  buyFill: string\n  crosshairs: string\n  legendFill: string\n  legendText: string\n}\n\nconst darkTheme: Theme = {\n  axisLabel: '#b1b1b1',\n  gridBorder: '#383f4b',\n  gridLines: '#383f4b',\n  gapLine: '#6b6b6b',\n  value: '#9a9a9a',\n  zoom: '#5b5b5b',\n  zoomHover: '#aaa',\n  sellLine: '#ae3333',\n  buyLine: '#05a35a',\n  sellFill: '#591a1a',\n  buyFill: '#02572f',\n  crosshairs: '#888',\n  legendFill: 'black',\n  legendText: '#d5d5d5'\n}\n\nconst lightTheme: Theme = {\n  axisLabel: '#1b1b1b',\n  gridBorder: '#ddd',\n  gridLines: '#ddd',\n  gapLine: '#595959',\n  value: '#4d4d4d',\n  zoom: '#777',\n  zoomHover: '#333',\n  sellLine: '#99302b',\n  buyLine: '#207a46',\n  sellFill: '#bd5959',\n  buyFill: '#4cad75',\n  crosshairs: '#595959',\n  legendFill: '#e6e6e6',\n  legendText: '#1b1b1b'\n}\n\n// Chart is the base class for charts.\nexport class Chart {\n  parent: HTMLElement\n  report: ChartReporters\n  theme: Theme\n  canvas: HTMLCanvasElement\n  visible: boolean\n  renderScheduled: boolean\n  ctx: CanvasRenderingContext2D\n  mousePos: Point | null\n  rect: DOMRect\n  wheelLimiter: number | null\n  boundResizer: () => void\n  plotRegion: Region\n  xRegion: Region\n  yRegion: Region\n  dataExtents: Extents\n  unattachers: (() => void)[]\n\n  constructor (parent: HTMLElement, reporters: ChartReporters) {\n    this.parent = parent\n    this.report = reporters\n    this.theme = State.isDark() ? darkTheme : lightTheme\n    this.canvas = document.createElement('canvas')\n    this.visible = true\n    parent.appendChild(this.canvas)\n    const ctx = this.canvas.getContext('2d')\n    if (!ctx) {\n      console.error('error getting canvas context')\n      return\n    }\n    this.ctx = ctx\n    this.ctx.textAlign = 'center'\n    this.ctx.textBaseline = 'middle'\n    // Mouse handling\n    this.mousePos = null\n    bind(this.canvas, 'mousemove', (e: MouseEvent) => {\n      // this.rect will be set in resize().\n      if (!this.rect) return\n      this.mousePos = {\n        x: e.clientX - this.rect.left,\n        y: e.clientY - this.rect.y\n      }\n      this.draw()\n    })\n    bind(this.canvas, 'mouseleave', () => {\n      this.mousePos = null\n      this.draw()\n    })\n\n    // Bind resize.\n    const resizeObserver = new ResizeObserver(() => this.resize())\n    resizeObserver.observe(this.parent)\n\n    // Scrolling by wheel is smoother when the rate is slightly limited.\n    this.wheelLimiter = null\n    bind(this.canvas, 'wheel', (e: WheelEvent) => { this.wheel(e) })\n    bind(this.canvas, 'click', (e: MouseEvent) => { this.click(e) })\n    const setVis = () => {\n      this.visible = document.visibilityState !== 'hidden'\n      if (this.visible && this.renderScheduled) {\n        this.renderScheduled = false\n        this.draw()\n      }\n    }\n    bind(document, 'visibilitychange', setVis)\n    this.unattachers = [() => { Doc.unbind(document, 'visibilitychange', setVis) }]\n  }\n\n  wheeled () {\n    this.wheelLimiter = window.setTimeout(() => { this.wheelLimiter = null }, 100)\n  }\n\n  /* clear the canvas. */\n  clear () {\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n  }\n\n  /* draw calls the child class's render method. */\n  draw () {\n    this.render()\n  }\n\n  /* click is the handler for a click event on the canvas. */\n  click (e: MouseEvent) {\n    this.report.click(e)\n  }\n\n  /* wheel is a mousewheel event handler. */\n  wheel (e: WheelEvent) {\n    this.zoom(e.deltaY < 0)\n    e.preventDefault()\n  }\n\n  /*\n   * resize updates the chart size. The parentHeight is an argument to support\n   * updating the height programmatically after the caller sets a style.height\n   * but before the clientHeight has been updated.\n   */\n  resize () {\n    this.canvas.width = this.parent.clientWidth\n    this.canvas.height = this.parent.clientHeight\n    const xLblHeight = 30\n    const yGuess = 40 // y label width guess. Will be adjusted when drawn.\n    const plotExtents = new Extents(yGuess, this.canvas.width, 10, this.canvas.height - xLblHeight)\n    const xLblExtents = new Extents(yGuess, this.canvas.width, this.canvas.height - xLblHeight, this.canvas.height)\n    const yLblExtents = new Extents(0, yGuess, 10, this.canvas.height - xLblHeight)\n    this.plotRegion = new Region(this.ctx, plotExtents)\n    this.xRegion = new Region(this.ctx, xLblExtents)\n    this.yRegion = new Region(this.ctx, yLblExtents)\n    // After changing the visibility, this.canvas.getBoundingClientRect will\n    // return nonsense until a render.\n    window.requestAnimationFrame(() => {\n      this.rect = this.canvas.getBoundingClientRect()\n      this.report.resize()\n    })\n  }\n\n  /* zoom is called when the user scrolls the mouse wheel on the canvas. */\n  zoom (bigger: boolean) {\n    if (this.wheelLimiter) return\n    this.report.zoom(bigger)\n  }\n\n  /* The market handler will call unattach when the markets page is unloaded. */\n  unattach () {\n    for (const u of this.unattachers) u()\n    this.unattachers = []\n  }\n\n  /* render must be implemented by the child class. */\n  render () {\n    console.error('child class must override render method')\n  }\n\n  /* applyLabelStyle applies the style used for axis tick labels. */\n  applyLabelStyle (fontSize?: number) {\n    this.ctx.textAlign = 'center'\n    this.ctx.textBaseline = 'middle'\n    this.ctx.font = `${fontSize ?? '14'}px 'sans', sans-serif`\n    this.ctx.fillStyle = this.theme.axisLabel\n  }\n\n  /* plotXLabels applies the provided labels to the x axis and draws the grid. */\n  plotXLabels (labels: LabelSet, minX: number, maxX: number, unitLines: string[]) {\n    const extents = new Extents(minX, maxX, 0, 1)\n    this.xRegion.plot(extents, (ctx: CanvasRenderingContext2D, tools: Translator) => {\n      this.applyLabelStyle()\n      const centerX = (maxX + minX) / 2\n      let lastX = minX\n      let unitCenter = centerX\n      labels.lbls.forEach(lbl => {\n        ctx.fillText(lbl.txt, tools.x(lbl.val), tools.y(0.5))\n        if (centerX >= lastX && centerX < lbl.val) {\n          unitCenter = (lastX + lbl.val) / 2\n        }\n        lastX = lbl.val\n      })\n      ctx.font = '11px \\'sans\\', sans-serif'\n      if (unitLines.length === 2) {\n        ctx.fillText(unitLines[0], tools.x(unitCenter), tools.y(0.63))\n        ctx.fillText(unitLines[1], tools.x(unitCenter), tools.y(0.23))\n      } else if (unitLines.length === 1) {\n        ctx.fillText(unitLines[0], tools.x(unitCenter), tools.y(0.5))\n      }\n    }, true)\n    this.plotRegion.plot(extents, (ctx: CanvasRenderingContext2D, tools: Translator) => {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = this.theme.gridLines\n      labels.lbls.forEach(lbl => {\n        line(ctx, tools.x(lbl.val), tools.y(0), tools.x(lbl.val), tools.y(1))\n      })\n    }, true)\n  }\n\n  /*\n   * plotYLabels applies the y labels based on the provided plot region, and\n   * draws the grid.\n   */\n  plotYLabels (region: Region, labels: LabelSet, minY: number, maxY: number, unit: string) {\n    const extents = new Extents(0, 1, minY, maxY)\n    this.yRegion.plot(extents, (ctx: CanvasRenderingContext2D, tools: Translator) => {\n      this.applyLabelStyle()\n      const centerY = maxY / 2\n      let lastY = 0\n      let unitCenter = centerY\n      labels.lbls.forEach(lbl => {\n        ctx.fillText(lbl.txt, tools.x(0.5), tools.y(lbl.val))\n        if (centerY >= lastY && centerY < lbl.val) {\n          unitCenter = (lastY + lbl.val) / 2\n        }\n        lastY = lbl.val\n      })\n      ctx.fillText(unit, tools.x(0.5), tools.y(unitCenter))\n    }, true)\n    region.plot(extents, (ctx: CanvasRenderingContext2D, tools: Translator) => {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = this.theme.gridLines\n      labels.lbls.forEach(lbl => {\n        line(ctx, tools.x(0), tools.y(lbl.val), tools.x(1), tools.y(lbl.val))\n      })\n    }, true)\n  }\n\n  /*\n   * doYLabels generates and applies the y-axis labels, based upon the\n   * provided plot region.\n   */\n  doYLabels (region: Region, step: number, unit: string, valFmt?: (v: number) => string) {\n    this.applyLabelStyle()\n    const yLabels = makeLabels(this.ctx, region.height(), this.dataExtents.y.min,\n      this.dataExtents.y.max, 50, step, unit, valFmt)\n\n    // Reassign the width of the y-label column to accommodate the widest text.\n    const yAxisWidth = (yLabels.widest || 0) + 20 /* x padding */\n    this.yRegion.extents.x.max = yAxisWidth\n    this.yRegion.extents.y.max = region.extents.y.max\n\n    this.plotRegion.extents.x.min = yAxisWidth\n    this.xRegion.extents.x.min = yAxisWidth\n    // Print the y labels.\n    this.plotYLabels(region, yLabels, this.dataExtents.y.min, this.dataExtents.y.max, unit)\n    return yLabels\n  }\n\n  // drawFrame draws an outline around the plotRegion.\n  drawFrame () {\n    this.plotRegion.plot(new Extents(0, 1, 0, 1), (ctx: CanvasRenderingContext2D, tools: Translator) => {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = this.theme.gridBorder\n      ctx.beginPath()\n      tools.dataCoords(() => {\n        ctx.moveTo(0, 0)\n        ctx.lineTo(0, 1)\n        ctx.lineTo(1, 1)\n        ctx.lineTo(1, 0)\n        ctx.lineTo(0, 0)\n      })\n      ctx.stroke()\n    })\n  }\n}\n\n/* DepthChart is a javascript Canvas-based depth chart renderer. */\nexport class DepthChart extends Chart {\n  reporters: DepthReporters\n  book: OrderBook\n  zoomLevel: number\n  lotSize: number\n  rateStep: number\n  lines: DepthLine[]\n  markers: Record<string, DepthMarker[]>\n  zoomInBttn: Region\n  zoomOutBttn: Region\n  baseUnit: string\n  quoteUnit: string\n\n  constructor (parent: HTMLElement, reporters: DepthReporters, zoom: number) {\n    super(parent, {\n      resize: () => this.resized(),\n      click: (e: MouseEvent) => this.clicked(e),\n      zoom: (bigger: boolean) => this.zoomed(bigger)\n    })\n    this.reporters = reporters\n    this.zoomLevel = zoom\n    this.lines = []\n    this.markers = {\n      buys: [],\n      sells: []\n    }\n    this.setZoomBttns() // can't wait for requestAnimationFrame -> resized\n    this.resize()\n  }\n\n  // setZoomBttns creates new regions for zoom in and zoom out buttons. It is\n  // used in initiation of the buttons and resizing.\n  setZoomBttns () {\n    this.zoomInBttn = new Region(this.ctx, new Extents(0, 0, 0, 0))\n    this.zoomOutBttn = new Region(this.ctx, new Extents(0, 0, 0, 0))\n  }\n\n  /* resized is called when the window or parent element are resized. */\n  resized () {\n    // The button region extents are set during drawing.\n    this.setZoomBttns()\n    if (this.book) this.draw()\n  }\n\n  /* zoomed zooms the current view in or out. bigger=true is zoom in. */\n  zoomed (bigger: boolean) {\n    if (!this.zoomLevel) return\n    if (!this.book.buys || !this.book.sells) return\n    this.wheeled()\n    // Zoom in to 66%, but out to 150% = 1 / (2/3) so that the same zoom levels\n    // are hit when reversing direction.\n    this.zoomLevel *= bigger ? 2 / 3 : 3 / 2\n    this.zoomLevel = clamp(this.zoomLevel, 0.005, 2)\n    this.draw()\n    this.reporters.zoom(this.zoomLevel)\n  }\n\n  /* clicked is the canvas 'click' event handler. */\n  clicked (e: MouseEvent) {\n    if (!this.dataExtents) return\n    const x = e.clientX - this.rect.left\n    const y = e.clientY - this.rect.y\n    if (this.zoomInBttn.contains(x, y)) { this.zoom(true); return }\n    if (this.zoomOutBttn.contains(x, y)) { this.zoom(false); return }\n    const translator = this.plotRegion.translator(this.dataExtents)\n    this.reporters.click(translator.unx(x))\n  }\n\n  // clear the canvas.\n  clear () {\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n  }\n\n  // set sets the current data set and draws.\n  set (book: OrderBook, lotSize: number, rateStep: number, baseUnitInfo: UnitInfo, quoteUnitInfo: UnitInfo) {\n    this.book = book\n    this.lotSize = lotSize / baseUnitInfo.conventional.conversionFactor\n    const [qFactor, bFactor] = [quoteUnitInfo.conventional.conversionFactor, baseUnitInfo.conventional.conversionFactor]\n    this.rateStep = rateStep / RateEncodingFactor * qFactor / bFactor\n    this.baseUnit = baseUnitInfo.conventional.unit\n    this.quoteUnit = quoteUnitInfo.conventional.unit\n    if (!this.zoomLevel) {\n      const [midGap, gapWidth] = this.gap()\n      // Default to 5% zoom, but with a minimum of 5 * midGap, but still observing\n      // the hard cap of 200%.\n      const minZoom = Math.max(gapWidth / midGap * 5, 0.05)\n      this.zoomLevel = Math.min(minZoom, 2)\n    }\n    this.draw()\n  }\n\n  /*\n   * render draws the chart.\n   * 1. Calculate the data extents and translate the order book data to a\n   *    cumulative form.\n   * 2. Draw axis ticks and grid, mid-gap line and value, zoom buttons, mouse\n   *    position indicator...\n   * 4. Tick labels.\n   * 5. Data.\n   * 6. Epoch line legend.\n   * 7. Hover legend.\n   */\n  render () {\n    // if connection fails it is not possible to get book.\n    if (!this.book || !this.visible || this.canvas.width === 0) {\n      this.renderScheduled = true\n      return\n    }\n\n    this.clear()\n    // if (!this.book || this.book.empty()) return\n    const ctx = this.ctx\n    const mousePos = this.mousePos\n    const buys = this.book.buys\n    const sells = this.book.sells\n    const [midGap, gapWidth] = this.gap()\n\n    const halfWindow = this.zoomLevel * midGap / 2\n    const high = midGap + halfWindow\n    const low = midGap - halfWindow\n\n    // Get a sorted copy of the markers list.\n    const buyMarkers = [...this.markers.buys]\n    const sellMarkers = [...this.markers.sells]\n    buyMarkers.sort((a, b) => b.rate - a.rate)\n    sellMarkers.sort((a, b) => a.rate - b.rate)\n    const markers: DepthMark[] = []\n\n    const buyDepth: [number, number][] = []\n    const buyEpoch: [number, number][] = []\n    const sellDepth: [number, number][] = []\n    const sellEpoch: [number, number][] = []\n    const volumeReport = {\n      buyBase: 0,\n      buyQuote: 0,\n      sellBase: 0,\n      sellQuote: 0\n    }\n    let sum = 0\n    // The epoch line is above the non-epoch region, so the epochSum y value\n    // must account for non-epoch orders too.\n    let epochSum = 0\n\n    for (let i = 0; i < buys.length; i++) {\n      const ord = buys[i]\n      epochSum += ord.qty\n      if (ord.rate >= low) buyEpoch.push([ord.rate, epochSum])\n      if (ord.epoch) continue\n      sum += ord.qty\n      buyDepth.push([ord.rate, sum])\n      volumeReport.buyBase += ord.qty\n      volumeReport.buyQuote += ord.qty * ord.rate\n      while (buyMarkers.length && floatCompare(buyMarkers[0].rate, ord.rate)) {\n        const mark = buyMarkers.shift()\n        if (!mark) continue\n        markers.push({\n          rate: mark.rate,\n          qty: ord.epoch ? epochSum : sum,\n          sell: ord.sell,\n          active: mark.active\n        })\n      }\n    }\n    const buySum = buyDepth.length ? last(buyDepth)[1] : 0\n    buyDepth.push([low, buySum])\n    const epochBuySum = buyEpoch.length ? last(buyEpoch)[1] : 0\n    buyEpoch.push([low, epochBuySum])\n\n    epochSum = sum = 0\n    for (let i = 0; i < sells.length; i++) {\n      const ord = sells[i]\n      epochSum += ord.qty\n      if (ord.rate <= high) sellEpoch.push([ord.rate, epochSum])\n      if (ord.epoch) continue\n      sum += ord.qty\n      sellDepth.push([ord.rate, sum])\n      volumeReport.sellBase += ord.qty\n      volumeReport.sellQuote += ord.qty * ord.rate\n      while (sellMarkers.length && floatCompare(sellMarkers[0].rate, ord.rate)) {\n        const mark = sellMarkers.shift()\n        if (!mark) continue\n        markers.push({\n          rate: mark.rate,\n          qty: ord.epoch ? epochSum : sum,\n          sell: ord.sell,\n          active: mark.active\n        })\n      }\n    }\n    // Add a data point going to the left so that the data doesn't end with a\n    // vertical line.\n    const sellSum = sellDepth.length ? last(sellDepth)[1] : 0\n    sellDepth.push([high, sellSum])\n    const epochSellSum = sellEpoch.length ? last(sellEpoch)[1] : 0\n    sellEpoch.push([high, epochSellSum])\n\n    // Add ~30px padding to the top of the chart.\n    const h = this.xRegion.extents.y.min\n    const growthFactor = (h + 30) / h\n    const maxY = (epochSellSum && epochBuySum ? Math.max(epochBuySum, epochSellSum) : epochSellSum || epochBuySum || 1) * growthFactor\n\n    const dataExtents = new Extents(low, high, 0, maxY)\n    this.dataExtents = dataExtents\n\n    this.doYLabels(this.plotRegion, this.lotSize, this.baseUnit)\n\n    // Print the x labels\n    const xLabels = makeLabels(ctx, this.plotRegion.width(), dataExtents.x.min,\n      dataExtents.x.max, 100, this.rateStep, '')\n\n    this.plotXLabels(xLabels, low, high, [`${this.quoteUnit}/`, this.baseUnit])\n\n    // A function to be run at the end if there is legend data to display.\n    let mouseData: MouseReport | null = null\n\n    // Draw the grid.\n    this.drawFrame()\n    this.plotRegion.plot(dataExtents, (ctx, tools) => {\n      ctx.lineWidth = 1\n      // first, a square around the plot area.\n      ctx.strokeStyle = this.theme.gridBorder\n      // draw a line to indicate mid-gap\n      ctx.lineWidth = 2.5\n      ctx.strokeStyle = this.theme.gapLine\n      line(ctx, tools.x(midGap), tools.y(0), tools.x(midGap), tools.y(0.3 * dataExtents.y.max))\n\n      ctx.font = '30px \\'demi-sans\\', sans-serif'\n      ctx.textAlign = 'center'\n      ctx.textBaseline = 'middle'\n      ctx.fillStyle = this.theme.value\n      const y = 0.5 * dataExtents.y.max\n      ctx.fillText(formatLabelValue(midGap), tools.x(midGap), tools.y(y))\n      ctx.font = '12px \\'sans\\', sans-serif'\n      // ctx.fillText('mid-market price', tools.x(midGap), tools.y(y) + 24)\n      ctx.fillText(`${(gapWidth / midGap * 100).toFixed(2)}% spread`,\n        tools.x(midGap), tools.y(y) + 24)\n\n      // Draw zoom buttons.\n      ctx.textAlign = 'center'\n      ctx.textBaseline = 'middle'\n      const topCenterX = this.plotRegion.extents.midX\n      const topCenterY = tools.y(maxY * 0.9)\n      const zoomPct = dataExtents.xRange / midGap * 100\n      const zoomText = `${zoomPct.toFixed(1)}%`\n      const w = ctx.measureText(zoomText).width\n      ctx.font = '13px \\'sans\\', sans-serif'\n      ctx.fillText(zoomText, topCenterX, topCenterY + 1)\n      // define the region for the zoom button\n      const bttnSize = 20\n      const xPad = 10\n      let bttnLeft = topCenterX - w / 2 - xPad - bttnSize\n      const bttnTop = topCenterY - bttnSize / 2\n      this.zoomOutBttn.setExtents(\n        bttnLeft,\n        bttnLeft + bttnSize,\n        bttnTop,\n        bttnTop + bttnSize\n      )\n      let hover = mousePos && this.zoomOutBttn.contains(mousePos.x, mousePos.y)\n      this.zoomOutBttn.plot(new Extents(0, 1, 0, 1), ctx => {\n        ctx.font = '12px \\'icomoon\\''\n        ctx.fillStyle = this.theme.zoom\n        if (hover) {\n          ctx.fillStyle = this.theme.zoomHover\n          ctx.font = '13px \\'icomoon\\''\n        }\n        ctx.fillText(minusChar, this.zoomOutBttn.extents.midX, this.zoomOutBttn.extents.midY)\n      })\n      bttnLeft = topCenterX + w / 2 + xPad\n      this.zoomInBttn.setExtents(\n        bttnLeft,\n        bttnLeft + bttnSize,\n        bttnTop,\n        bttnTop + bttnSize\n      )\n      hover = mousePos && this.zoomInBttn.contains(mousePos.x, mousePos.y)\n      this.zoomInBttn.plot(new Extents(0, 1, 0, 1), ctx => {\n        ctx.font = '12px \\'icomoon\\''\n        ctx.fillStyle = this.theme.zoom\n        if (hover) {\n          ctx.fillStyle = this.theme.zoomHover\n          ctx.font = '14px \\'icomoon\\''\n        }\n        ctx.fillText(plusChar, this.zoomInBttn.extents.midX, this.zoomInBttn.extents.midY)\n      })\n\n      // Draw a dotted vertical line where the mouse is, and a dot at the level\n      // of the depth line.\n      const drawLine = (x: number, color: string) => {\n        if (x > high || x < low) return\n        ctx.save()\n        ctx.setLineDash([3, 5])\n        ctx.lineWidth = 1.5\n        ctx.strokeStyle = color\n        line(ctx, tools.x(x), tools.y(0), tools.x(x), tools.y(maxY))\n        ctx.restore()\n      }\n\n      for (const line of this.lines || []) {\n        drawLine(line.rate, line.color)\n      }\n\n      const tolerance = (high - low) * 0.005\n      const hoverMarkers = []\n      for (const marker of markers || []) {\n        const hovered = (mousePos && withinTolerance(marker.rate, tools.unx(mousePos.x), tolerance))\n        if (hovered) hoverMarkers.push(marker.rate)\n        ctx.save()\n        ctx.lineWidth = (hovered || marker.active) ? 5 : 3\n        ctx.strokeStyle = marker.sell ? this.theme.sellLine : this.theme.buyLine\n        ctx.fillStyle = marker.sell ? this.theme.sellFill : this.theme.buyFill\n        const size = (hovered || marker.active) ? 10 : 8\n        ctx.beginPath()\n        const tip = {\n          x: tools.x(marker.rate),\n          y: tools.y(marker.qty) - 8\n        }\n        const top = tip.y - (Math.sqrt(3) * size / 2) // cos(30)\n        ctx.moveTo(tip.x, tip.y)\n        ctx.lineTo(tip.x - size / 2, top)\n        ctx.lineTo(tip.x + size / 2, top)\n        ctx.closePath()\n        ctx.stroke()\n        ctx.fill()\n        ctx.restore()\n      }\n\n      // If the mouse is in the chart area, draw the crosshairs.\n      if (!mousePos) return\n      if (!this.plotRegion.contains(mousePos.x, mousePos.y)) return\n      // The mouse is in the plot region. Get the data coordinates and find the\n      // side and depth for the x value.\n      const dataX = tools.unx(mousePos.x)\n      let evalSide = sellDepth\n      let trigger = (ptX: number) => ptX >= dataX\n      let dotColor = this.theme.sellLine\n      if (dataX < midGap) {\n        evalSide = buyDepth\n        trigger = (ptX) => ptX <= dataX\n        dotColor = this.theme.buyLine\n      }\n      let bestDepth = evalSide[0]\n      for (let i = 0; i < evalSide.length; i++) {\n        const pt = evalSide[i]\n        if (trigger(pt[0])) break\n        bestDepth = pt\n      }\n      drawLine(dataX, this.theme.crosshairs)\n      mouseData = {\n        rate: dataX,\n        depth: bestDepth[1],\n        dotColor: dotColor,\n        hoverMarkers: hoverMarkers\n      }\n    })\n\n    // Draw the epoch lines\n    ctx.lineWidth = 1.5\n    ctx.setLineDash([3, 3])\n    // epoch sells\n    ctx.fillStyle = this.theme.sellFill\n    ctx.strokeStyle = this.theme.sellLine\n    this.drawDepth(sellEpoch)\n    // epoch buys\n    ctx.fillStyle = this.theme.buyFill\n    ctx.strokeStyle = this.theme.buyLine\n    this.drawDepth(buyEpoch)\n\n    // Draw the book depth.\n    ctx.lineWidth = 2.5\n    ctx.setLineDash([])\n    // book sells\n    ctx.fillStyle = this.theme.sellFill\n    ctx.strokeStyle = this.theme.sellLine\n    this.drawDepth(sellDepth)\n    // book buys\n    ctx.fillStyle = this.theme.buyFill\n    ctx.strokeStyle = this.theme.buyLine\n    this.drawDepth(buyDepth)\n\n    // Display the dot at the intersection of the mouse hover line and the depth\n    // line. This should be drawn after the depths.\n    if (mouseData) {\n      this.plotRegion.plot(dataExtents, (ctx, tools) => {\n        if (!mouseData) return // For TypeScript. Duh.\n        dot(ctx, tools.x(mouseData.rate), tools.y(mouseData.depth), mouseData.dotColor, 5)\n      })\n    }\n\n    // Report the book volumes.\n    this.reporters.volume(volumeReport)\n    this.reporters.mouse(mouseData)\n  }\n\n  /* drawDepth draws a single side's depth chart data. */\n  drawDepth (depth: [number, number][]) {\n    const firstPt = depth[0]\n    let y = firstPt[1]\n    let x: number\n    this.plotRegion.plot(this.dataExtents, (ctx, tools) => {\n      tools.dataCoords(() => {\n        ctx.beginPath()\n        ctx.moveTo(firstPt[0], firstPt[1])\n        for (let i = 0; i < depth.length; i++) {\n          // Set x, but don't set y until we draw the horizontal line.\n          x = depth[i][0]\n          ctx.lineTo(x, y)\n          // If this is past the render edge, quit drawing.\n          y = depth[i][1]\n          ctx.lineTo(x, y)\n        }\n      })\n      ctx.stroke()\n      tools.dataCoords(() => {\n        ctx.lineTo(x, 0)\n        ctx.lineTo(firstPt[0], 0)\n      })\n      ctx.closePath()\n      ctx.globalAlpha = 0.25\n      ctx.fill()\n    })\n  }\n\n  /* returns the mid-gap rate and gap width as a tuple. */\n  gap () {\n    const [b, s] = [this.book.bestGapBuy(), this.book.bestGapSell()]\n    if (!b) {\n      if (!s) return [1, 0]\n      return [s.rate, 0]\n    } else if (!s) return [b.rate, 0]\n    return [(s.rate + b.rate) / 2, s.rate - b.rate]\n  }\n\n  /* setLines stores the indicator lines to draw. */\n  setLines (lines: DepthLine[]) {\n    this.lines = lines\n  }\n\n  /* setMarkers sets the indicator markers to draw. */\n  setMarkers (markers: Record<string, DepthMarker[]>) {\n    this.markers = markers\n  }\n}\n\n/* CandleChart is a candlestick data renderer. */\nexport class CandleChart extends Chart {\n  reporters: CandleReporters\n  data: CandlesPayload\n  zoomLevel: number\n  numToShow: number\n  candleRegion: Region\n  volumeRegion: Region\n  resizeTimer: number\n  zoomLevels: number[]\n  market: Market\n  rateConversionFactor: number\n\n  constructor (parent: HTMLElement, reporters: CandleReporters) {\n    super(parent, {\n      resize: () => this.resized(),\n      click: (/* e: MouseEvent */) => { this.clicked() },\n      zoom: (bigger: boolean) => this.zoomed(bigger)\n    })\n    this.reporters = reporters\n    this.zoomLevel = 1\n    this.numToShow = 100\n    this.resize()\n  }\n\n  /* resized is called when the window or parent element are resized. */\n  resized () {\n    const ext = this.plotRegion.extents\n    const candleExtents = new Extents(ext.x.min, ext.x.max, ext.y.min, ext.y.min + ext.yRange * 0.85)\n    this.candleRegion = new Region(this.ctx, candleExtents)\n    const volumeExtents = new Extents(ext.x.min, ext.x.max, ext.y.min + 0.85 * ext.yRange, ext.y.max)\n    this.volumeRegion = new Region(this.ctx, volumeExtents)\n    // Set a delay on the render to prevent lag.\n    if (this.resizeTimer) clearTimeout(this.resizeTimer)\n    this.resizeTimer = window.setTimeout(() => this.draw(), 100)\n  }\n\n  clicked (/* e: MouseEvent */) {\n    // handle clicks\n  }\n\n  /* zoomed zooms the current view in or out. bigger=true is zoom in. */\n  zoomed (bigger: boolean) {\n    // bigger actually means fewer candles -> reduce zoomLevels index.\n    const idx = this.zoomLevels.indexOf(this.numToShow)\n    if (bigger) {\n      if (idx === 0) return\n      this.numToShow = this.zoomLevels[idx - 1]\n    } else {\n      if (this.zoomLevels.length <= idx + 1 || this.numToShow > this.data.candles.length) return\n      this.numToShow = this.zoomLevels[idx + 1]\n    }\n    this.draw()\n  }\n\n  /* render draws the chart */\n  render () {\n    const data = this.data\n    if (!data || !this.visible || this.canvas.width === 0) {\n      this.renderScheduled = true\n      return\n    }\n    const candleWidth = data.ms\n    const mousePos = this.mousePos\n    const allCandles = data.candles || []\n\n    const n = Math.min(this.numToShow, allCandles.length)\n    const candles = allCandles.slice(allCandles.length - n)\n\n    this.clear()\n\n    // If there are no candles. just don't draw anything.\n    if (n === 0) return\n\n    // padding definition and some helper functions to parse candles.\n    const candleWidthPadding = 0.2\n    const start = (c: Candle) => truncate(c.endStamp, candleWidth)\n    const end = (c: Candle) => start(c) + candleWidth\n    const paddedStart = (c: Candle) => start(c) + candleWidthPadding * candleWidth\n    const paddedWidth = (1 - 2 * candleWidthPadding) * candleWidth\n\n    const first = candles[0]\n    const last = candles[n - 1]\n\n    let [high, low, highVol] = [first.highRate, first.lowRate, first.matchVolume]\n    for (const c of candles) {\n      if (c.highRate > high) high = c.highRate\n      if (c.lowRate < low) low = c.lowRate\n      if (c.matchVolume > highVol) highVol = c.matchVolume\n    }\n\n    // Calculate data extents and store them. They are used to apply labels.\n    const rateStep = this.market.ratestep\n    const dataExtents = new Extents(start(first), end(last), low, high)\n    if (low === high) {\n      // If there is no price movement at all in the window, show a little more\n      // top and bottom so things render nicely.\n      dataExtents.y.min -= rateStep\n      dataExtents.y.max += rateStep\n    }\n    this.dataExtents = dataExtents\n\n    // Apply labels.\n    const rFactor = this.rateConversionFactor\n    this.doYLabels(this.candleRegion, rateStep, this.market.quotesymbol, v => formatLabelValue(v / rFactor))\n    this.candleRegion.extents.x.min = this.yRegion.extents.x.max\n    this.volumeRegion.extents.x.min = this.yRegion.extents.x.max\n\n    const xLabels = makeCandleTimeLabels(candles, candleWidth, this.plotRegion.width(), 100)\n\n    this.plotXLabels(xLabels, start(first), end(last), [])\n\n    this.drawFrame()\n\n    // Highlight the candle if the user mouse is over the canvas.\n    let mouseCandle: Candle | null = null\n    if (mousePos) {\n      this.plotRegion.plot(new Extents(dataExtents.x.min, dataExtents.x.max, 0, 1), (ctx, tools) => {\n        const selectedStartStamp = truncate(tools.unx(mousePos.x), candleWidth)\n        for (const c of candles) {\n          if (start(c) === selectedStartStamp) {\n            mouseCandle = c\n            ctx.fillStyle = this.theme.gridLines\n            ctx.fillRect(tools.x(start(c)), tools.y(0), tools.w(candleWidth), tools.h(1))\n            break\n          }\n        }\n      })\n      if (mouseCandle) {\n        const yExt = this.xRegion.extents.y\n        this.xRegion.plot(new Extents(dataExtents.x.min, dataExtents.x.max, yExt.min, yExt.max), (ctx, tools) => {\n          if (!mouseCandle) return // For TypeScript. Duh.\n          this.applyLabelStyle()\n          const rangeTxt = `${new Date(start(mouseCandle)).toLocaleString()} - ${new Date(end(mouseCandle)).toLocaleString()}`\n          const [xPad, yPad] = [25, 2]\n          const rangeWidth = ctx.measureText(rangeTxt).width + 2 * xPad\n          const rangeHeight = 16\n          let centerX = tools.x((start(mouseCandle) + end(mouseCandle)) / 2)\n          let left = centerX - rangeWidth / 2\n          const xExt = this.xRegion.extents.x\n          if (left < xExt.min) left = xExt.min\n          else if (left + rangeWidth > xExt.max) left = xExt.max - rangeWidth\n          centerX = left + rangeWidth / 2\n          const top = yExt.min + (this.xRegion.height() - rangeHeight) / 2\n          ctx.fillStyle = this.theme.legendFill\n          ctx.strokeStyle = this.theme.gridBorder\n          const rectArgs: [number, number, number, number] = [left - xPad, top - yPad, rangeWidth + 2 * xPad, rangeHeight + 2 * yPad]\n          ctx.fillRect(...rectArgs)\n          ctx.strokeRect(...rectArgs)\n          this.applyLabelStyle()\n          ctx.fillText(rangeTxt, centerX, this.xRegion.extents.midY, rangeWidth)\n        })\n      }\n    }\n\n    // Draw the volume bars.\n    const volDataExtents = new Extents(start(first), end(last), 0, highVol)\n    this.volumeRegion.plot(volDataExtents, (ctx, tools) => {\n      ctx.fillStyle = this.theme.gridBorder\n      for (const c of candles) {\n        ctx.fillRect(tools.x(paddedStart(c)), tools.y(0), tools.w(paddedWidth), tools.h(c.matchVolume))\n      }\n    })\n\n    // Draw the candles.\n    this.candleRegion.plot(dataExtents, (ctx, tools) => {\n      ctx.lineWidth = 1\n      for (const c of candles) {\n        const desc = c.startRate > c.endRate\n        const [x, y, w, h] = [tools.x(paddedStart(c)), tools.y(c.startRate), tools.w(paddedWidth), tools.h(c.endRate - c.startRate)]\n        const [high, low, cx] = [tools.y(c.highRate), tools.y(c.lowRate), w / 2 + x]\n        ctx.strokeStyle = desc ? this.theme.sellLine : this.theme.buyLine\n        ctx.fillStyle = desc ? this.theme.sellFill : this.theme.buyFill\n\n        ctx.beginPath()\n        ctx.moveTo(cx, high)\n        ctx.lineTo(cx, low)\n        ctx.stroke()\n\n        ctx.fillRect(x, y, w, h)\n        ctx.strokeRect(x, y, w, h)\n      }\n    })\n\n    // Report the mouse candle.\n    this.reporters.mouse(mouseCandle)\n  }\n\n  /* setCandles sets the candle data and redraws the chart. */\n  setCandles (data: CandlesPayload, market: Market, baseUnitInfo: UnitInfo, quoteUnitInfo: UnitInfo) {\n    this.data = data\n    if (!data.candles) return\n    this.market = market\n    const [qFactor, bFactor] = [quoteUnitInfo.conventional.conversionFactor, baseUnitInfo.conventional.conversionFactor]\n    this.rateConversionFactor = RateEncodingFactor * qFactor / bFactor\n    let n = 25\n    this.zoomLevels = []\n    const maxCandles = Math.max(data.candles.length, 1000)\n    while (n < maxCandles) {\n      this.zoomLevels.push(n)\n      n *= 2\n    }\n    this.numToShow = 100\n    this.draw()\n  }\n}\n\ninterface WaveOpts {\n  message?: string\n  backgroundColor?: string | boolean // true for <body> background color\n}\n\n/* Wave is a loading animation that displays a colorful line that oscillates */\nexport class Wave extends Chart {\n  ani: Animation\n  size: [number, number]\n  region: Region\n  colorShift: number\n  opts: WaveOpts\n  msgRegion: Region\n  fontSize: number\n\n  constructor (parent: HTMLElement, opts?: WaveOpts) {\n    super(parent, {\n      resize: () => this.resized(),\n      click: (/* e: MouseEvent */) => { /* pass */ },\n      zoom: (/* bigger: boolean */) => { /* pass */ }\n    })\n    this.canvas.classList.add('fill-abs')\n    this.canvas.style.zIndex = '5'\n\n    this.opts = opts ?? {}\n\n    const period = 1500 // ms\n    const start = Math.random() * period\n    this.colorShift = Math.random() * 360\n\n    // y = A*cos(k*x + theta*t + c)\n    // combine three waves with different periods and speeds and phases.\n    const amplitudes = [1, 0.65, 0.75]\n    const ks = [3, 3, 2]\n    const speeds = [Math.PI, Math.PI * 10 / 9, Math.PI / 2.5]\n    const phases = [0, 0, Math.PI * 1.5]\n    const n = 75\n    const single = (n: number, angularX: number, angularTime: number): number => {\n      return amplitudes[n] * Math.cos(ks[n] * angularX + speeds[n] * angularTime + phases[n])\n    }\n    const value = (x: number, angularTime: number): number => {\n      const angularX = x * Math.PI * 2\n      return (single(0, angularX, angularTime) + single(1, angularX, angularTime) + single(2, angularX, angularTime)) / 3\n    }\n    this.resize()\n    this.ani = new Animation(Animation.Forever, () => {\n      const angularTime = (new Date().getTime() - start) / period * Math.PI * 2\n      const values = []\n      for (let i = 0; i < n; i++) {\n        values.push(value(i / (n - 1), angularTime))\n      }\n      this.drawValues(values)\n    })\n  }\n\n  resized () {\n    const opts = this.opts\n    const [maxW, maxH] = [150, 100]\n    const [cw, ch] = [this.canvas.width, this.canvas.height]\n    let [w, h] = [cw * 0.8, ch * 0.8]\n    if (w > maxW) w = maxW\n    if (h > maxH) h = maxH\n    let [l, t] = [(cw - w) / 2, (ch - h) / 2]\n    if (opts.message) {\n      this.fontSize = clamp(h * 0.15, 10, 14)\n      this.applyLabelStyle(this.fontSize)\n      const ypad = this.fontSize * 0.5\n      const halfH = (this.fontSize / 2) + ypad\n      t -= halfH\n      this.msgRegion = new Region(this.ctx, new Extents(0, cw, t + h, t + h + 2 * halfH))\n    }\n    this.region = new Region(this.ctx, new Extents(l, l + w, t, t + h))\n  }\n\n  drawValues (values: number[]) {\n    if (!this.region) return\n    this.clear()\n    const hsl = (h: number) => `hsl(${h}, 35%, 50%)`\n\n    const { region, msgRegion, canvas: { width: w, height: h }, opts: { backgroundColor: bg, message: msg }, colorShift, ctx } = this\n\n    if (bg) {\n      if (bg === true) ctx.fillStyle = window.getComputedStyle(document.body, null).getPropertyValue('background-color')\n      else ctx.fillStyle = bg\n      ctx.fillRect(0, 0, w, h)\n    }\n\n    region.plot(new Extents(0, 1, -1, 1), (ctx: CanvasRenderingContext2D, t: Translator) => {\n      ctx.lineWidth = 4\n      ctx.lineCap = 'round'\n\n      const shift = colorShift + (new Date().getTime() % 2000) / 2000 * 360 // colors move with frequency 1 / 2s\n      const grad = ctx.createLinearGradient(t.x(0), 0, t.x(1), 0)\n      grad.addColorStop(0, hsl(shift))\n      ctx.strokeStyle = grad\n\n      ctx.beginPath()\n      ctx.moveTo(t.x(0), t.y(values[0]))\n      for (let i = 1; i < values.length; i++) {\n        const prog = i / (values.length - 1)\n        grad.addColorStop(prog, hsl(prog * 300 + shift))\n        ctx.lineTo(t.x(prog), t.y(values[i]))\n      }\n      ctx.stroke()\n    })\n    if (!msg) return\n    msgRegion.plot(new Extents(0, 1, 0, 1), (ctx: CanvasRenderingContext2D, t: Translator) => {\n      ctx.fillText(msg, t.x(0.5), t.y(0.5), this.msgRegion.width())\n    })\n  }\n\n  render () { /* pass */ }\n\n  stop () {\n    this.ani.stop()\n    this.canvas.remove()\n  }\n}\n\n/*\n * Extents holds a min and max in both the x and y directions, and provides\n * getters for related data.\n */\nclass Extents {\n  x: MinMax\n  y: MinMax\n\n  constructor (xMin: number, xMax: number, yMin: number, yMax: number) {\n    this.setExtents(xMin, xMax, yMin, yMax)\n  }\n\n  setExtents (xMin: number, xMax: number, yMin: number, yMax: number) {\n    this.x = {\n      min: xMin,\n      max: xMax\n    }\n    this.y = {\n      min: yMin,\n      max: yMax\n    }\n  }\n\n  get xRange (): number {\n    return this.x.max - this.x.min\n  }\n\n  get midX (): number {\n    return (this.x.max + this.x.min) / 2\n  }\n\n  get yRange (): number {\n    return this.y.max - this.y.min\n  }\n\n  get midY (): number {\n    return (this.y.max + this.y.min) / 2\n  }\n}\n\n/*\n * Region applies an Extents to the canvas, providing utilities for coordinate\n * transformations and restricting drawing to a specified region of the canvas.\n */\nclass Region {\n  context: CanvasRenderingContext2D\n  extents: Extents\n\n  constructor (context: CanvasRenderingContext2D, extents: Extents) {\n    this.context = context\n    this.extents = extents\n  }\n\n  setExtents (xMin: number, xMax: number, yMin: number, yMax: number) {\n    this.extents.setExtents(xMin, xMax, yMin, yMax)\n  }\n\n  width (): number {\n    return this.extents.xRange\n  }\n\n  height (): number {\n    return this.extents.yRange\n  }\n\n  contains (x: number, y: number): boolean {\n    const ext = this.extents\n    return (x < ext.x.max && x > ext.x.min &&\n      y < ext.y.max && y > ext.y.min)\n  }\n\n  /*\n   * A translator provides 4 function for coordinate transformations. x and y\n   * translate data coordinates to canvas coordinates for the specified data\n   * Extents. unx and uny translate canvas coordinates to data coordinates.\n   */\n  translator (dataExtents: Extents): Translator {\n    const region = this.extents\n    const xMin = dataExtents.x.min\n    // const xMax = dataExtents.x.max\n    const yMin = dataExtents.y.min\n    // const yMax = dataExtents.y.max\n    const yRange = dataExtents.yRange\n    const xRange = dataExtents.xRange\n    const screenMinX = region.x.min\n    const screenW = region.x.max - screenMinX\n    const screenMaxY = region.y.max\n    const screenH = screenMaxY - region.y.min\n    const xFactor = screenW / xRange\n    const yFactor = screenH / yRange\n    return {\n      x: (x: number) => (x - xMin) * xFactor + screenMinX,\n      y: (y: number) => screenMaxY - (y - yMin) * yFactor,\n      unx: (x: number) => (x - screenMinX) / xFactor + xMin,\n      uny: (y: number) => yMin - (y - screenMaxY) / yFactor,\n      w: (w: number) => w / xRange * screenW,\n      h: (h: number) => -h / yRange * screenH,\n      dataCoords: () => { /* Added when using plot() */ }\n    }\n  }\n\n  /* clear clears the region. */\n  clear () {\n    const ext = this.extents\n    this.context.clearRect(ext.x.min, ext.y.min, ext.xRange, ext.yRange)\n  }\n\n  /* plot prepares tools for drawing using data coordinates. */\n  plot (dataExtents: Extents, drawFunc: (ctx: CanvasRenderingContext2D, tools: Translator) => void, skipMask?: boolean) {\n    const ctx = this.context\n    const region = this.extents\n    ctx.save() // Save the original state\n    if (!skipMask) {\n      ctx.beginPath()\n      ctx.rect(region.x.min, region.y.min, region.xRange, region.yRange)\n      ctx.clip()\n    }\n\n    // The drawFunc will be passed a set of tool that can be used to assist\n    // drawing. The tools start with the transformation functions.\n    const tools = this.translator(dataExtents)\n\n    // Create a transformation that allows drawing in data coordinates. It's\n    // not advisable to stroke or add text with this transform in place, as the\n    // result will be distorted. You can however use ctx.moveTo and ctx.lineTo\n    // with this transform in place using data coordinates, and remove the\n    // transform before stroking. The dataCoords method of the supplied tool\n    // provides this functionality.\n    const yRange = dataExtents.yRange\n    const xFactor = region.xRange / dataExtents.xRange\n    const yFactor = region.yRange / yRange\n    const xMin = dataExtents.x.min\n    const yMin = dataExtents.y.min\n    // These translation factors are complicated because the (0, 0) of the\n    // region is not necessarily the (0, 0) of the canvas.\n    const tx = (region.x.min + xMin) - xMin * xFactor\n    const ty = -region.y.min - (yRange - yMin) * yFactor\n    const setTransform = () => {\n      // Data coordinates are flipped about y. Flip the coordinates and\n      // translate top left corner to canvas (0, 0).\n      ctx.transform(1, 0, 0, -1, -xMin, yMin)\n      // Scale to data coordinates and shift into place for the region's offset\n      // on the canvas.\n      ctx.transform(xFactor, 0, 0, yFactor, tx, ty)\n    }\n    // dataCoords allows some drawing to be performed directly in data\n    // coordinates. Most actual drawing functions like ctx.stroke and\n    // ctx.fillRect should not be called from inside dataCoords, but\n    // ctx.moveTo and ctx.LineTo are fine.\n    tools.dataCoords = f => {\n      ctx.save()\n      setTransform()\n      f()\n      ctx.restore()\n    }\n\n    drawFunc(this.context, tools)\n    ctx.restore()\n  }\n}\n\n/*\n * makeLabels attempts to create the appropriate labels for the specified\n * screen size, context, and label spacing.\n */\nfunction makeLabels (\n  ctx: CanvasRenderingContext2D,\n  screenW: number,\n  min: number,\n  max: number,\n  spacingGuess: number,\n  step: number,\n  unit: string,\n  valFmt?: (v: number) => string\n): LabelSet {\n  valFmt = valFmt || formatLabelValue\n  const n = screenW / spacingGuess\n  const diff = max - min\n  if (n < 1 || diff <= 0) return { lbls: [] }\n  const tickGuess = diff / n\n  // make the tick spacing a multiple of the step\n  const tick = tickGuess + step - (tickGuess % step)\n  let x = min + tick - (min % tick)\n  const absMax = Math.max(Math.abs(max), Math.abs(min))\n  // The Math.round part is the minimum precision required to see the change in the numbers.\n  // The 2 accounts for the precision of the tick.\n  const sigFigs = Math.round(Math.log10(absMax / tick)) + 2\n  const pts: Label[] = []\n  let widest = 0\n  while (x < max) {\n    x = Number(x.toPrecision(sigFigs))\n    const lbl = valFmt(x)\n    widest = Math.max(widest, ctx.measureText(lbl).width)\n    pts.push({\n      val: x,\n      txt: lbl\n    })\n    x += tick\n  }\n  const unitW = ctx.measureText(unit).width\n  if (unitW > widest) widest = unitW\n  return {\n    widest: widest,\n    lbls: pts\n  }\n}\n\nconst months = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec']\n\n/* makeCandleTimeLabels prepares labels for candlestick data. */\nfunction makeCandleTimeLabels (candles: Candle[], dur: number, screenW: number, spacingGuess: number): LabelSet {\n  const first = candles[0]\n  const last = candles[candles.length - 1]\n  const start = truncate(first.endStamp, dur)\n  const end = truncate(last.endStamp, dur) + dur\n  const diff = end - start\n  const n = Math.min(candles.length, screenW / spacingGuess)\n  const tick = truncate(diff / n, dur)\n  if (tick === 0) {\n    console.error('zero tick', dur, diff, n) // probably won't happen, but it'd suck if it did\n    return { lbls: [] }\n  }\n  let x = start\n  const zoneOffset = new Date().getTimezoneOffset()\n  const dayStamp = (x: number) => {\n    x = x - zoneOffset * 60000\n    return x - (x % 86400000)\n  }\n  let lastDay = dayStamp(start)\n  let lastYear = 0 // new Date(start).getFullYear()\n  if (dayStamp(first.endStamp) === dayStamp(last.endStamp)) lastDay = 0 // Force at least one day stamp.\n  const pts = []\n  let label\n  if (dur < 86400000) {\n    label = (d: Date, x: number) => {\n      const day = dayStamp(x)\n      if (day !== lastDay) return `${months[d.getMonth()]}${d.getDate()} ${d.getHours()}:${String(d.getMinutes()).padStart(2, '0')}`\n      else return `${d.getHours()}:${String(d.getMinutes()).padStart(2, '0')}`\n    }\n  } else {\n    label = (d: Date) => {\n      const year = d.getFullYear()\n      if (year !== lastYear) return `${months[d.getMonth()]}${d.getDate()} '${String(year).slice(2, 4)}`\n      else return `${months[d.getMonth()]}${d.getDate()}`\n    }\n  }\n  while (x <= end) {\n    const d = new Date(x)\n    pts.push({\n      val: x,\n      txt: label(d, x)\n    })\n    lastDay = dayStamp(x)\n    lastYear = d.getFullYear()\n    x += tick\n  }\n  return { lbls: pts }\n}\n\n/* The last element of an array. */\nfunction last (arr: any[]): any {\n  return arr[arr.length - 1]\n}\n\n/* line draws a line with the provided context. */\nfunction line (ctx: CanvasRenderingContext2D, x0: number, y0: number, x1: number, y1: number, skipStroke?: boolean) {\n  ctx.beginPath()\n  ctx.moveTo(x0, y0)\n  ctx.lineTo(x1, y1)\n  if (!skipStroke) ctx.stroke()\n}\n\n/* dot draws a circle with the provided context. */\nfunction dot (ctx: CanvasRenderingContext2D, x: number, y: number, color: string, radius: number) {\n  ctx.fillStyle = color\n  ctx.beginPath()\n  ctx.arc(x, y, radius, 0, PIPI)\n  ctx.fill()\n}\n\n/* clamp returns v if min <= v <= max, else min or max. */\nfunction clamp (v: number, min: number, max: number): number {\n  if (v < min) return min\n  if (v > max) return max\n  return v\n}\n\n/* labelSpecs is specifications for axis tick labels. */\nconst labelSpecs = {\n  minimumSignificantDigits: 4,\n  maximumSignificantDigits: 5\n}\n\n/* formatLabelValue formats the provided value using the labelSpecs format. */\nfunction formatLabelValue (x: number) {\n  return x.toLocaleString('en-us', labelSpecs)\n}\n\n/* floatCompare compares two floats to within a tolerance of  1e-8. */\nfunction floatCompare (a: number, b: number) {\n  return withinTolerance(a, b, 1e-8)\n}\n\n/*\n * withinTolerance returns true if the difference between a and b are with\n * the specified tolerance.\n */\nfunction withinTolerance (a: number, b: number, tolerance: number) {\n  return Math.abs(a - b) < Math.abs(tolerance)\n}\n\nfunction truncate (v: number, w: number): number {\n  return v - (v % w)\n}\n","import Doc from './doc'\nimport { postJSON } from './http'\nimport State from './state'\nimport * as intl from './locales'\nimport * as OrderUtil from './orderutil'\nimport { Wave } from './charts'\nimport {\n  app,\n  PasswordCache,\n  SupportedAsset,\n  PageElement,\n  WalletDefinition,\n  ConfigOption,\n  Exchange,\n  Market,\n  UnitInfo,\n  BondAsset,\n  WalletState,\n  BalanceNote,\n  Order,\n  XYRange,\n  WalletStateNote,\n  WalletInfo,\n  Token,\n  WalletCreationNote,\n  CoreNote\n} from './registry'\nimport { XYRangeHandler } from './opts'\n\ninterface ConfigOptionInput extends HTMLInputElement {\n  configOpt: ConfigOption\n}\n\ninterface ProgressPoint {\n  stamp: number\n  progress: number\n}\n\ninterface CurrentAsset {\n  asset: SupportedAsset\n  parentAsset?: SupportedAsset\n  winfo: WalletInfo | Token\n  // selectedDef is used in a strange way for tokens. If a token's parent wallet\n  // already exists, then selectedDef is going to be the Token.definition.\n  // BUT, if the token's parent wallet doesn't exist yet, the NewWalletForm\n  // operates in a combined configuration mode, and the selectedDef will be the\n  // currently selected parent asset definition. There is no loss of info\n  // in such a case, because the token wallet only has one definition.\n  selectedDef: WalletDefinition\n}\n\ninterface WalletConfig {\n  assetID: number\n  config: Record<string, string>\n  walletType: string\n}\n\n/*\n * NewWalletForm should be used with the \"newWalletForm\" template. The enclosing\n * <form> element should be the first argument of the constructor.\n */\nexport class NewWalletForm {\n  page: Record<string, PageElement>\n  form: HTMLElement\n  pwCache: PasswordCache | null\n  success: (assetID: number) => void\n  current: CurrentAsset\n  pwHiders: HTMLElement[]\n  subform: WalletConfigForm\n  walletCfgGuide: PageElement\n  parentSyncer: null | ((w: WalletState) => void)\n  createUpdater: null | ((note: WalletCreationNote) => void)\n\n  constructor (form: HTMLElement, success: (assetID: number) => void, pwCache?: PasswordCache, backFunc?: () => void) {\n    this.form = form\n    this.success = success\n    this.pwCache = pwCache || null\n    const page = this.page = Doc.parseTemplate(form)\n    this.pwHiders = Array.from(form.querySelectorAll('.hide-pw'))\n    this.refresh()\n\n    if (backFunc) {\n      Doc.show(page.goBack)\n      Doc.bind(page.goBack, 'click', () => { backFunc() })\n    }\n\n    Doc.empty(page.walletTabTmpl)\n    page.walletTabTmpl.removeAttribute('id')\n\n    // WalletConfigForm will set the global app variable.\n    this.subform = new WalletConfigForm(page.walletSettings, true)\n\n    this.walletCfgGuide = Doc.tmplElement(form, 'walletCfgGuide')\n\n    bind(form, page.submitAdd, () => this.submit())\n    bind(form, page.oneBttn, () => this.submit())\n\n    app().registerNoteFeeder({\n      walletstate: (note: WalletStateNote) => { this.reportWalletState(note.wallet) },\n      createwallet: (note: WalletCreationNote) => { this.reportCreationUpdate(note) }\n    })\n  }\n\n  /*\n   * reportWalletState should be called when a 'walletstate' notification is\n   * received.\n   * TODO: Let form classes register for notifications.\n   */\n  reportWalletState (w: WalletState): void {\n    if (this.parentSyncer) this.parentSyncer(w)\n  }\n\n  /*\n   * reportWalletState should be called when a 'createwallet' notification is\n   * received.\n   */\n  reportCreationUpdate (note: WalletCreationNote) {\n    if (this.createUpdater) this.createUpdater(note)\n  }\n\n  refresh () {\n    const hidePWBox = State.passwordIsCached() || (this.pwCache && this.pwCache.pw)\n    if (hidePWBox) Doc.hide(...this.pwHiders)\n    else Doc.show(...this.pwHiders)\n  }\n\n  async createWallet (assetID: number, walletType: string, pw: string, parentForm?: WalletConfig) {\n    const createForm = {\n      assetID: assetID,\n      pass: this.page.newWalletPass.value || '',\n      config: this.subform.map(assetID),\n      appPass: pw,\n      walletType: walletType,\n      parentForm: parentForm\n    }\n\n    const ani = new Wave(this.page.mainForm, { backgroundColor: true })\n    const res = await postJSON('/api/newwallet', createForm)\n    ani.stop()\n    return res\n  }\n\n  async submit () {\n    const page = this.page\n    const appPass = page.appPass as HTMLInputElement\n    const newWalletPass = page.newWalletPass as HTMLInputElement\n    const pw = appPass.value || (this.pwCache ? this.pwCache.pw : '')\n    if (!pw && !State.passwordIsCached()) {\n      page.newWalletErr.textContent = intl.prep(intl.ID_NO_APP_PASS_ERROR_MSG)\n      Doc.show(page.newWalletErr)\n      return\n    }\n    Doc.hide(page.newWalletErr)\n\n    const { asset, parentAsset } = this.current\n    const selectedDef = this.current.selectedDef\n    let parentForm\n    if (parentAsset) {\n      parentForm = {\n        assetID: parentAsset.id,\n        config: this.subform.map(parentAsset.id),\n        walletType: selectedDef.type\n      }\n    }\n    // Register the selected asset.\n    const res = await this.createWallet(asset.id, selectedDef.type, pw, parentForm)\n    if (!app().checkResponse(res)) {\n      this.setError(res.msg)\n      return\n    }\n    if (this.pwCache) this.pwCache.pw = pw\n    page.appPass.value = ''\n    newWalletPass.value = ''\n    if (parentAsset) await this.runParentSync()\n    else this.success(this.current.asset.id)\n  }\n\n  /*\n   * runParentSync shows a syncing sub-dialog that tracks the parent asset's\n   * syncProgress and informs the user that the token wallet will be created\n   * after sync is complete.\n   */\n  async runParentSync () {\n    const { page, current: { parentAsset, asset } } = this\n    if (!parentAsset) return\n\n    page.parentSyncPct.textContent = '0'\n    page.parentName.textContent = parentAsset.name\n    page.parentLogo.src = Doc.logoPath(parentAsset.symbol)\n    page.childName.textContent = asset.name\n    page.childLogo.src = Doc.logoPath(asset.symbol)\n    Doc.hide(page.mainForm)\n    Doc.show(page.parentSyncing)\n\n    try {\n      await this.syncParent(parentAsset)\n      this.success(this.current.asset.id)\n    } catch (error) {\n      this.setError(error.message || error)\n    }\n    Doc.show(page.mainForm)\n    Doc.hide(page.parentSyncing)\n  }\n\n  /*\n   * syncParent monitors the sync progress of a token's parent asset, generating\n   * an Error if the token wallet creation does not complete successfully.\n   */\n  syncParent (parentAsset: SupportedAsset): Promise<void> {\n    const { page, current: { asset } } = this\n    return new Promise((resolve, reject) => {\n      // First, check if it's already synced.\n      const w = app().assets[parentAsset.id].wallet\n      if (w && w.synced) return resolve()\n      // Not synced, so create a syncer to update the parent sync pane.\n      this.parentSyncer = (w: WalletState) => {\n        if (w.assetID !== parentAsset.id) return\n        page.parentSyncPct.textContent = (w.syncProgress * 100).toFixed(1)\n      }\n      // Handle the async result.\n      this.createUpdater = (note: WalletCreationNote) => {\n        if (note.assetID !== asset.id) return\n        switch (note.topic) {\n          case 'QueuedCreationFailed':\n            reject(new Error(`${note.subject}: ${note.details}`))\n            break\n          case 'QueuedCreationSuccess':\n            resolve()\n            break\n          default:\n            return\n        }\n        this.parentSyncer = null\n        this.createUpdater = null\n      }\n    })\n  }\n\n  /* setAsset sets the current asset of the NewWalletForm */\n  async setAsset (assetID: number) {\n    if (!this.parseAsset(assetID)) return // nothing to change\n    const page = this.page\n    const tabs = page.walletTypeTabs\n    const { winfo, asset, parentAsset } = this.current\n    page.assetName.textContent = winfo.name\n    page.newWalletPass.value = ''\n\n    Doc.empty(tabs)\n    Doc.hide(tabs, page.newWalletErr)\n    page.header.classList.remove('bordertop')\n    this.page.assetLogo.src = Doc.logoPath(asset.symbol)\n\n    const pinfo = parentAsset ? parentAsset.info : null\n    const walletDefs = pinfo ? pinfo.availablewallets : (winfo as WalletInfo).availablewallets ? (winfo as WalletInfo).availablewallets : [(winfo as Token).definition]\n\n    if (walletDefs.length > 1) {\n      Doc.show(tabs)\n      for (const wDef of walletDefs) {\n        const tab = page.walletTabTmpl.cloneNode(true) as HTMLElement\n        tab.dataset.tooltip = wDef.description\n        tab.textContent = wDef.tab\n        tabs.appendChild(tab)\n        Doc.bind(tab, 'click', () => {\n          for (const t of Doc.kids(tabs)) t.classList.remove('selected')\n          tab.classList.add('selected')\n          this.update(wDef)\n        })\n      }\n      app().bindTooltips(tabs)\n      const first = tabs.firstChild as HTMLElement\n      first.classList.add('selected')\n    }\n\n    await this.update(this.current.selectedDef)\n    if (asset.walletCreationPending) await this.runParentSync()\n  }\n\n  /*\n  * parseAsset parses the current data for the asset ID.\n  */\n  parseAsset (assetID: number) {\n    if (this.current && this.current.asset.id === assetID) return false\n    const asset = app().assets[assetID]\n    const token = asset.token\n    if (!token) {\n      if (!asset.info) throw Error('this non-token asset has no wallet info!')\n      this.current = { asset, winfo: asset.info, selectedDef: asset.info.availablewallets[0] }\n      return true\n    }\n    const parentAsset = app().user.assets[token.parentID]\n    if (parentAsset.wallet) {\n      // If the parent asset already has a wallet, there's no need to configure\n      // the parent too. Just configure the token.\n      this.current = { asset, winfo: token, selectedDef: token.definition }\n      return true\n    }\n    if (!parentAsset.info) throw Error('this parent has no wallet info!')\n    this.current = { asset, parentAsset, winfo: token, selectedDef: parentAsset.info.availablewallets[0] }\n    return true\n  }\n\n  async update (walletDef: WalletDefinition) {\n    const page = this.page\n    this.current.selectedDef = walletDef\n    const appPwCached = State.passwordIsCached() || (this.pwCache && this.pwCache.pw)\n    Doc.hide(page.auth, page.oneBttnBox, page.newWalletPassBox)\n    const guideLink = walletDef.guidelink\n    const configOpts = walletDef.configopts || []\n    // If a config represents a wallet's birthday, we update the default\n    // selection to the current date if this installation of the client\n    // generated a seed.\n    configOpts.map((opt) => {\n      if (opt.isBirthdayConfig && app().seedGenTime > 0) {\n        opt.default = toUnixDate(new Date())\n      }\n      return opt\n    })\n    // Either this is a walletDef for a token's uncreated parent asset, or this\n    // is the definition for the token.\n    let containsRequired = false\n    for (const opt of configOpts) {\n      if (opt.required) {\n        containsRequired = true\n        break\n      }\n    }\n    const { asset, parentAsset, winfo } = this.current\n    const displayCreateBtn = walletDef.seeded || Boolean(asset.token)\n    if (appPwCached && displayCreateBtn && !containsRequired) {\n      Doc.show(page.oneBttnBox)\n    } else if (displayCreateBtn) {\n      Doc.show(page.auth)\n      page.newWalletPass.value = ''\n      page.submitAdd.textContent = intl.prep(intl.ID_CREATE)\n    } else {\n      Doc.show(page.auth)\n      if (!walletDef.noauth) Doc.show(page.newWalletPassBox)\n      page.submitAdd.textContent = intl.prep(intl.ID_ADD)\n    }\n\n    if (parentAsset) {\n      const parentAndTokenOpts = JSON.parse(JSON.stringify(configOpts))\n      // Add the regAsset field to the configurations so proper logos will be displayed\n      // next to them, and map can filter them out. The opts are copied here so the originals\n      // do not have the regAsset field added to them.\n      for (const opt of parentAndTokenOpts) opt.regAsset = parentAsset.id\n      const tokenOpts = (winfo as Token).definition.configopts || []\n      if (tokenOpts.length > 0) {\n        const tokenOptsCopy = JSON.parse(JSON.stringify(tokenOpts))\n        for (const opt of tokenOptsCopy) opt.regAsset = asset.id\n        parentAndTokenOpts.push(...tokenOptsCopy)\n      }\n      this.subform.update(asset.id, parentAndTokenOpts, false)\n    } else this.subform.update(asset.id, configOpts, false)\n    this.setGuideLink(guideLink)\n\n    if (this.subform.dynamicOpts.children.length || this.subform.defaultSettings.children.length) {\n      Doc.show(page.walletSettingsHeader)\n    } else Doc.hide(page.walletSettingsHeader)\n    // A seeded or token wallet is internal to the dex client and as such does\n    // not have an external config file to select.\n    if (walletDef.seeded || Boolean(this.current.asset.token)) Doc.hide(this.subform.fileSelector)\n    else Doc.show(this.subform.fileSelector)\n\n    this.refresh()\n    await this.loadDefaults()\n  }\n\n  setGuideLink (guideLink: string) {\n    Doc.hide(this.walletCfgGuide)\n    if (guideLink !== '') {\n      this.walletCfgGuide.href = guideLink\n      Doc.show(this.walletCfgGuide)\n    }\n  }\n\n  /* setError sets and shows the in-form error message. */\n  async setError (errMsg: string) {\n    this.page.newWalletErr.textContent = errMsg\n    Doc.show(this.page.newWalletErr)\n  }\n\n  /*\n   * loadDefaults attempts to load the ExchangeWallet configuration from the\n   * default wallet config path on the server and will auto-fill the page on\n   * the subform if settings are found.\n   */\n  async loadDefaults () {\n    // No default config files for seeded assets right now.\n    const { asset, parentAsset, selectedDef } = this.current\n    if (!selectedDef.configpath) return\n    let configID = asset.id\n    if (parentAsset) {\n      if (selectedDef.seeded) return\n      configID = parentAsset.id\n    }\n    const loaded = app().loading(this.form)\n    const res = await postJSON('/api/defaultwalletcfg', {\n      assetID: configID,\n      type: selectedDef.type\n    })\n    loaded()\n    if (!app().checkResponse(res)) {\n      this.setError(res.msg)\n      return\n    }\n    this.subform.setLoadedConfig(res.config)\n  }\n}\n\nlet dynamicInputCounter = 0\n\n/*\n * WalletConfigForm is a dynamically generated sub-form for setting\n * asset-specific wallet configuration options.\n*/\nexport class WalletConfigForm {\n  page: Record<string, PageElement>\n  form: HTMLElement\n  configElements: [ConfigOption, HTMLElement][]\n  configOpts: ConfigOption[]\n  sectionize: boolean\n  allSettings: PageElement\n  dynamicOpts: PageElement\n  textInputTmpl: PageElement\n  dateInputTmpl: PageElement\n  checkboxTmpl: PageElement\n  repeatableTmpl: PageElement\n  fileSelector: PageElement\n  fileInput: PageElement\n  errMsg: PageElement\n  showOther: PageElement\n  showIcon: PageElement\n  hideIcon: PageElement\n  showHideMsg: PageElement\n  otherSettings: PageElement\n  loadedSettingsMsg: PageElement\n  loadedSettings: PageElement\n  defaultSettingsMsg: PageElement\n  defaultSettings: PageElement\n  assetHasActiveOrders: boolean\n  assetID: number\n\n  constructor (form: HTMLElement, sectionize: boolean) {\n    this.page = Doc.idDescendants(form)\n    this.form = form\n    // A configElement is a div containing an input and its label.\n    this.configElements = []\n    // configOpts is the wallet options provided by core.\n    this.configOpts = []\n    this.sectionize = sectionize\n\n    // Get template elements\n    this.allSettings = Doc.tmplElement(form, 'allSettings')\n    this.dynamicOpts = Doc.tmplElement(form, 'dynamicOpts')\n    this.textInputTmpl = Doc.tmplElement(form, 'textInput')\n    this.textInputTmpl.remove()\n    this.dateInputTmpl = Doc.tmplElement(form, 'dateInput')\n    this.dateInputTmpl.remove()\n    this.checkboxTmpl = Doc.tmplElement(form, 'checkbox')\n    this.checkboxTmpl.remove()\n    this.repeatableTmpl = Doc.tmplElement(form, 'repeatableInput')\n    this.repeatableTmpl.remove()\n    this.fileSelector = Doc.tmplElement(form, 'fileSelector')\n    this.fileInput = Doc.tmplElement(form, 'fileInput')\n    this.errMsg = Doc.tmplElement(form, 'errMsg')\n    this.showOther = Doc.tmplElement(form, 'showOther')\n    this.showIcon = Doc.tmplElement(form, 'showIcon')\n    this.hideIcon = Doc.tmplElement(form, 'hideIcon')\n    this.showHideMsg = Doc.tmplElement(form, 'showHideMsg')\n    this.otherSettings = Doc.tmplElement(form, 'otherSettings')\n    this.loadedSettingsMsg = Doc.tmplElement(form, 'loadedSettingsMsg')\n    this.loadedSettings = Doc.tmplElement(form, 'loadedSettings')\n    this.defaultSettingsMsg = Doc.tmplElement(form, 'defaultSettingsMsg')\n    this.defaultSettings = Doc.tmplElement(form, 'defaultSettings')\n\n    if (!sectionize) Doc.hide(this.showOther)\n\n    Doc.bind(this.fileSelector, 'click', () => this.fileInput.click())\n\n    // config file upload\n    Doc.bind(this.fileInput, 'change', async () => this.fileInputChanged())\n\n    Doc.bind(this.showOther, 'click', () => {\n      this.setOtherSettingsViz(this.hideIcon.classList.contains('d-hide'))\n    })\n  }\n\n  /*\n   * fileInputChanged will read the selected file and attempt to load the\n   * configuration settings. All loaded settings will be made visible for\n   * inspection by the user.\n   */\n  async fileInputChanged () {\n    Doc.hide(this.errMsg)\n    if (!this.fileInput.value) return\n    const files = this.fileInput.files\n    if (!files || files.length === 0) return\n    const loaded = app().loading(this.form)\n    const config = await files[0].text()\n    if (!config) return\n    const res = await postJSON('/api/parseconfig', {\n      configtext: config\n    })\n    loaded()\n    if (!app().checkResponse(res)) {\n      this.errMsg.textContent = res.msg\n      Doc.show(this.errMsg)\n      return\n    }\n    if (Object.keys(res.map).length === 0) return\n    this.dynamicOpts.append(...this.setConfig(res.map))\n    this.reorder(this.dynamicOpts)\n    const [loadedOpts, defaultOpts] = [this.loadedSettings.children.length, this.defaultSettings.children.length]\n    if (loadedOpts === 0) Doc.hide(this.loadedSettings, this.loadedSettingsMsg)\n    if (defaultOpts === 0) Doc.hide(this.defaultSettings, this.defaultSettingsMsg)\n    if (loadedOpts + defaultOpts === 0) Doc.hide(this.showOther, this.otherSettings)\n  }\n\n  addOpt (box: HTMLElement, opt: ConfigOption, insertAfter?: PageElement, skipRepeatN?: boolean): PageElement {\n    let el: HTMLElement\n    if (opt.isboolean) el = this.checkboxTmpl.cloneNode(true) as HTMLElement\n    else if (opt.isdate) el = this.dateInputTmpl.cloneNode(true) as HTMLElement\n    else if (opt.repeatable) {\n      el = this.repeatableTmpl.cloneNode(true) as HTMLElement\n      el.classList.add('repeatable')\n      Doc.bind(Doc.tmplElement(el, 'add'), 'click', () => {\n        this.addOpt(box, opt, el, true)\n      })\n      if (!skipRepeatN) for (let i = 0; i < (opt.repeatN ? opt.repeatN - 1 : 0); i++) this.addOpt(box, opt, insertAfter, true)\n    } else el = this.textInputTmpl.cloneNode(true) as HTMLElement\n    const hiddenFields = app().user.extensionModeConfig?.restrictedWallets[baseChainSymbol(this.assetID)]?.hiddenFields || []\n    if (hiddenFields.indexOf(opt.key) !== -1) Doc.hide(el)\n    this.configElements.push([opt, el])\n    const input = el.querySelector('input') as ConfigOptionInput\n    input.dataset.configKey = opt.key\n    // We need to generate a unique ID only for the <input id> => <label for>\n    // matching.\n    dynamicInputCounter++\n    const elID = 'wcfg-' + String(dynamicInputCounter)\n    input.id = elID\n    const label = Doc.safeSelector(el, 'label')\n    label.htmlFor = elID // 'for' attribute, but 'for' is a keyword\n    label.prepend(opt.displayname)\n    if (opt.regAsset !== undefined) {\n      const logo = new window.Image(15, 15)\n      logo.src = Doc.logoPathFromID(opt.regAsset || -1)\n      label.prepend(logo)\n    }\n    if (insertAfter) insertAfter.after(el)\n    else box.appendChild(el)\n    if (opt.noecho) {\n      input.type = 'password'\n      input.autocomplete = 'off'\n    }\n    if (opt.description) label.dataset.tooltip = opt.description\n    if (opt.isboolean) input.checked = opt.default\n    else if (opt.isdate) {\n      const getMinMaxVal = (minMax: string | number) => {\n        if (!minMax) return ''\n        if (minMax === 'now') return dateToString(new Date())\n        return dateToString(new Date((minMax as number) * 1000))\n      }\n      input.max = getMinMaxVal(opt.max)\n      input.min = getMinMaxVal(opt.min)\n      const date = opt.default ? new Date(opt.default * 1000) : new Date()\n      // UI shows Dates in valueAsDate as UTC, but user interprets local. Set a\n      // local date string so the UI displays what the user expects. alt:\n      // input.valueAsDate = dateApplyOffset(date)\n      input.value = dateToString(date)\n    } else input.value = opt.default !== null ? opt.default : ''\n    input.disabled = Boolean(opt.disablewhenactive && this.assetHasActiveOrders)\n    return el\n  }\n\n  /*\n   * update creates the dynamic form.\n   */\n  update (assetID: number, configOpts: ConfigOption[] | null, activeOrders: boolean) {\n    this.assetHasActiveOrders = activeOrders\n    this.configElements = []\n    this.configOpts = configOpts || []\n    this.assetID = assetID\n    Doc.empty(this.dynamicOpts, this.defaultSettings, this.loadedSettings)\n\n    // If there are no options, just hide the entire form.\n    if (this.configOpts.length === 0) return Doc.hide(this.form)\n    Doc.show(this.form)\n\n    this.setOtherSettingsViz(false)\n    Doc.hide(\n      this.loadedSettingsMsg, this.loadedSettings, this.defaultSettingsMsg,\n      this.defaultSettings, this.errMsg\n    )\n    const defaultedOpts = []\n    for (const opt of this.configOpts) {\n      if (this.sectionize && opt.default !== null) defaultedOpts.push(opt)\n      else this.addOpt(this.dynamicOpts, opt)\n    }\n    if (defaultedOpts.length) {\n      for (const opt of defaultedOpts) this.addOpt(this.defaultSettings, opt)\n      Doc.show(this.showOther, this.defaultSettingsMsg, this.defaultSettings)\n    } else {\n      Doc.hide(this.showOther)\n    }\n    app().bindTooltips(this.allSettings)\n    if (this.dynamicOpts.children.length) Doc.show(this.dynamicOpts)\n    else Doc.hide(this.dynamicOpts)\n  }\n\n  /*\n   * setOtherSettingsViz sets the visibility of the additional settings section.\n   */\n  setOtherSettingsViz (visible: boolean) {\n    if (visible) {\n      Doc.hide(this.showIcon)\n      Doc.show(this.hideIcon, this.otherSettings)\n      this.showHideMsg.textContent = intl.prep(intl.ID_HIDE_ADDITIONAL_SETTINGS)\n      return\n    }\n    Doc.hide(this.hideIcon, this.otherSettings)\n    Doc.show(this.showIcon)\n    this.showHideMsg.textContent = intl.prep(intl.ID_SHOW_ADDITIONAL_SETTINGS)\n  }\n\n  /*\n   * setConfig looks for inputs with configOpt keys matching the cfg object, and\n   * sets the inputs value to the corresponding cfg value. A list of matching\n   * configElements is returned.\n   */\n  setConfig (cfg: Record<string, string>): HTMLElement[] {\n    const finds: HTMLElement[] = []\n    const handledRepeatables: Record<string, boolean> = {}\n    const removes: [ConfigOption, PageElement][] = []\n    for (const r of [...this.configElements]) {\n      const [opt, el] = r\n      const v = cfg[opt.key]\n      if (v === undefined) continue\n      if (opt.repeatable) {\n        if (handledRepeatables[opt.key]) {\n          el.remove()\n          removes.push(r)\n          continue\n        }\n        handledRepeatables[opt.key] = true\n        const vals = v.split(opt.repeatable)\n        const firstVal = vals[0]\n        finds.push(el)\n        Doc.safeSelector(el, 'input').value = firstVal\n        // Add repeatN - 1 empty elements to the reconfig form. Add them before\n        // the populated inputs just because of the way we're using the\n        // insertAfter argument to addOpt.\n        for (let i = 1; i < (opt.repeatN || 1); i++) finds.push(this.addOpt(el.parentElement as PageElement, opt, el, true))\n        for (let i = 1; i < vals.length; i++) {\n          const newEl = this.addOpt(el.parentElement as PageElement, opt, el, true)\n          Doc.safeSelector(newEl, 'input').value = vals[i]\n          finds.push(newEl)\n        }\n        continue\n      }\n      finds.push(el)\n      const input = Doc.safeSelector(el, 'input') as HTMLInputElement\n      if (opt.isboolean) input.checked = isTruthyString(v)\n      else if (opt.isdate) {\n        input.value = dateToString(new Date(parseInt(v) * 1000))\n        // alt: input.valueAsDate = dateApplyOffset(...)\n      } else input.value = v\n    }\n    for (const r of removes) {\n      const i = this.configElements.indexOf(r)\n      if (i >= 0) this.configElements.splice(i, 1)\n    }\n\n    return finds\n  }\n\n  /*\n   * setLoadedConfig sets the input values for the entries in cfg, and moves\n   * them to the loadedSettings box.\n   */\n  setLoadedConfig (cfg: Record<string, string>) {\n    const finds = this.setConfig(cfg)\n    if (!this.sectionize || finds.length === 0) return\n    this.loadedSettings.append(...finds)\n    this.reorder(this.loadedSettings)\n    Doc.show(this.loadedSettings, this.loadedSettingsMsg)\n    if (this.defaultSettings.children.length === 0) Doc.hide(this.defaultSettings, this.defaultSettingsMsg)\n  }\n\n  /*\n   * map reads all inputs and constructs an object from the configOpt keys and\n   * values.\n   */\n  map (assetID: number): Record<string, string> {\n    const config: Record<string, string> = {}\n    for (const [opt, el] of this.configElements) {\n      const input = Doc.safeSelector(el, 'input') as HTMLInputElement\n      if (opt.regAsset !== undefined && opt.regAsset !== assetID) continue\n      if (opt.isboolean && opt.key) {\n        config[opt.key] = input.checked ? '1' : '0'\n      } else if (opt.isdate && opt.key) {\n        // Force local time interpretation by appending a time to the date\n        // string, otherwise the Date constructor considers it UTC.\n        const minDate = input.min ? toUnixDate(new Date(input.min + 'T00:00')) : Number.MIN_SAFE_INTEGER\n        const maxDate = input.max ? toUnixDate(new Date(input.max + 'T00:00')) : Number.MAX_SAFE_INTEGER\n        let date = input.value ? toUnixDate(new Date(input.value + 'T00:00')) : 0\n        if (date < minDate) date = minDate\n        else if (date > maxDate) date = maxDate\n        config[opt.key] = '' + date\n      } else if (input.value) {\n        if (opt.repeatable && config[opt.key]) config[opt.key] += opt.repeatable + input.value\n        else config[opt.key] = input.value\n      }\n    }\n    return config\n  }\n\n  /*\n   * reorder sorts the configElements in the box by the order of the\n   * server-provided configOpts array.\n   */\n  reorder (box: HTMLElement) {\n    const inputs: Record<string, HTMLElement[]> = {}\n    box.querySelectorAll('input').forEach((input: ConfigOptionInput) => {\n      const k = input.dataset.configKey\n      if (!k) return // TS2538\n      const els = []\n      for (const [opt, el] of this.configElements) if (opt.key === k) els.push(el)\n      inputs[k] = els\n    })\n    for (const opt of this.configOpts) {\n      const els = inputs[opt.key] || []\n      for (const el of els) box.append(el)\n    }\n  }\n}\n\n/*\n * ConfirmRegistrationForm should be used with the \"confirmRegistrationForm\"\n * template.\n */\nexport class ConfirmRegistrationForm {\n  form: HTMLElement\n  success: () => void\n  page: Record<string, PageElement>\n  xc: Exchange\n  certFile: string\n  bondAssetID: number\n  pwCache: PasswordCache\n\n  constructor (form: HTMLElement, success: () => void, goBack: () => void, pwCache: PasswordCache) {\n    this.form = form\n    this.success = success\n    this.page = Doc.parseTemplate(form)\n    this.certFile = ''\n    this.pwCache = pwCache\n\n    Doc.bind(this.page.goBack, 'click', () => goBack())\n    // bondStrengthField is presently hidden since there is no scaling of user\n    // limits yet, and there needs to be considerable explanation of why\n    // anything other than 1 would be used. Unhide bondStrengthInput to show it\n    // when we are ready. (TODO)\n    Doc.bind(this.page.bondStrengthField, 'input', () => {\n      const asset = app().assets[this.bondAssetID]\n      if (!asset) return\n      const ui = asset.unitInfo\n      const bondAsset = this.xc.bondAssets[asset.symbol]\n      this.page.bondAmt.textContent = Doc.formatCoinValue(this.totalBondAmount(bondAsset.amount), ui)\n    })\n    bind(form, this.page.submit, () => this.submitForm())\n  }\n\n  setExchange (xc: Exchange, certFile: string) {\n    this.xc = xc\n    this.certFile = certFile\n    const page = this.page\n    if (State.passwordIsCached() || (this.pwCache && this.pwCache.pw)) Doc.hide(page.passBox)\n    else Doc.show(page.passBox)\n    page.host.textContent = xc.host\n  }\n\n  setAsset (assetID: number) {\n    const asset = app().assets[assetID]\n    const ui = asset.unitInfo\n    this.bondAssetID = asset.id\n    const page = this.page\n    const bondAsset = this.xc.bondAssets[asset.symbol]\n    page.bondAmt.textContent = Doc.formatCoinValue(this.totalBondAmount(bondAsset.amount), ui)\n    page.bondUnit.textContent = ui.conventional.unit.toUpperCase()\n    page.logo.src = Doc.logoPath(asset.symbol)\n  }\n\n  totalBondAmount (singleBondAmount: number): number {\n    const bondStrength = +(this.page.bondStrengthField.value ?? 1)\n    return bondStrength * singleBondAmount\n  }\n\n  /* Form expands into its space quickly from the lower-right as it fades in. */\n  async animate () {\n    const form = this.form\n    Doc.animate(400, prog => {\n      form.style.transform = `scale(${prog})`\n      form.style.opacity = String(Math.pow(prog, 4))\n      const offset = `${(1 - prog) * 500}px`\n      form.style.top = offset\n      form.style.left = offset\n    })\n  }\n\n  /*\n   * submitForm is called when the form is submitted.\n   */\n  async submitForm () {\n    const page = this.page\n    // if button is selected it can be clickable.\n    if (!page.submit.classList.contains('selected')) {\n      return\n    }\n    const asset = app().assets[this.bondAssetID]\n    if (!asset) {\n      page.regErr.innerText = intl.prep(intl.ID_SELECT_WALLET_FOR_FEE_PAYMENT)\n      Doc.show(page.regErr)\n      return\n    }\n    Doc.hide(page.regErr)\n    const bondAsset = this.xc.bondAssets[asset.wallet.symbol]\n    const cert = await this.certFile\n    const dexAddr = this.xc.host\n    const pw = page.appPass.value || (this.pwCache ? this.pwCache.pw : '')\n    const postBondForm = {\n      addr: dexAddr,\n      cert: cert,\n      pass: pw,\n      bond: this.totalBondAmount(bondAsset.amount),\n      asset: bondAsset.id\n    }\n    page.appPass.value = ''\n    const loaded = app().loading(this.form)\n    const res = await postJSON('/api/postbond', postBondForm)\n    loaded()\n    if (!app().checkResponse(res)) {\n      page.regErr.textContent = res.msg\n      Doc.show(page.regErr)\n      return\n    }\n    this.success()\n  }\n}\n\n/*\n * FeeAssetSelectionForm should be used with the \"regAssetForm\" template.\n */\nexport class FeeAssetSelectionForm {\n  form: HTMLElement\n  success: (assetID: number) => void\n  xc: Exchange\n  page: Record<string, PageElement>\n  assetTmpls: Record<number, Record<string, PageElement>>\n\n  constructor (form: HTMLElement, success: (assetID: number) => Promise<void>) {\n    this.form = form\n    this.success = success\n    this.page = Doc.parseTemplate(form)\n    Doc.cleanTemplates(this.page.marketTmpl, this.page.assetTmpl)\n\n    app().registerNoteFeeder({\n      createwallet: (note: WalletCreationNote) => {\n        if (note.topic === 'QueuedCreationSuccess') this.walletCreated(note.assetID)\n      }\n    })\n  }\n\n  setExchange (xc: Exchange) {\n    this.xc = xc\n    this.assetTmpls = {}\n    const page = this.page\n    Doc.empty(page.assets, page.allMarkets)\n\n    const cFactor = (ui: UnitInfo) => ui.conventional.conversionFactor\n\n    const marketNode = (mkt: Market, excludeIcon?: number) => {\n      const n = page.marketTmpl.cloneNode(true) as HTMLElement\n      const marketTmpl = Doc.parseTemplate(n)\n\n      const baseAsset = xc.assets[mkt.baseid]\n      const baseUnitInfo = app().unitInfo(mkt.baseid, xc)\n      const quoteAsset = xc.assets[mkt.quoteid]\n      const quoteUnitInfo = app().unitInfo(mkt.quoteid, xc)\n\n      if (cFactor(baseUnitInfo) === 0 || cFactor(quoteUnitInfo) === 0) return null\n\n      if (typeof excludeIcon !== 'undefined') {\n        const excludeBase = excludeIcon === mkt.baseid\n        const otherSymbol = xc.assets[excludeBase ? mkt.quoteid : mkt.baseid].symbol\n        marketTmpl.logo.src = Doc.logoPath(otherSymbol)\n      } else {\n        const otherLogo = marketTmpl.logo.cloneNode(true) as PageElement\n        marketTmpl.logo.src = Doc.logoPath(baseAsset.symbol)\n        otherLogo.src = Doc.logoPath(quoteAsset.symbol)\n        const parent = marketTmpl.logo.parentNode\n        if (parent) parent.insertBefore(otherLogo, marketTmpl.logo.nextSibling)\n      }\n\n      const baseSymbol = baseAsset.symbol.toUpperCase()\n      const quoteSymbol = quoteAsset.symbol.toUpperCase()\n\n      marketTmpl.baseName.replaceWith(Doc.symbolize(baseSymbol))\n      marketTmpl.quoteName.replaceWith(Doc.symbolize(quoteSymbol))\n\n      marketTmpl.lotSize.textContent = Doc.formatCoinValue(mkt.lotsize, baseUnitInfo)\n      marketTmpl.lotSizeSymbol.replaceWith(Doc.symbolize(baseSymbol))\n\n      if (mkt.spot) {\n        Doc.show(marketTmpl.quoteLotSize)\n        const r = cFactor(quoteUnitInfo) / cFactor(baseUnitInfo)\n        const quoteLot = mkt.lotsize * mkt.spot.rate / OrderUtil.RateEncodingFactor * r\n        const s = Doc.formatCoinValue(quoteLot, quoteUnitInfo)\n        marketTmpl.quoteLotSize.textContent = `(~${s} ${quoteSymbol})`\n      }\n      return n\n    }\n\n    for (const [symbol, bondAsset] of Object.entries(xc.bondAssets)) {\n      const asset = app().assets[bondAsset.id]\n      if (!asset) continue\n      const unitInfo = asset.unitInfo\n      const assetNode = page.assetTmpl.cloneNode(true) as HTMLElement\n      Doc.bind(assetNode, 'click', () => { this.success(bondAsset.id) })\n      const assetTmpl = this.assetTmpls[bondAsset.id] = Doc.parseTemplate(assetNode)\n      page.assets.appendChild(assetNode)\n      assetTmpl.logo.src = Doc.logoPath(symbol)\n      const fee = Doc.formatCoinValue(bondAsset.amount, unitInfo)\n      assetTmpl.feeAmt.textContent = String(fee)\n      assetTmpl.feeSymbol.replaceWith(Doc.symbolize(asset.symbol))\n      assetTmpl.confs.textContent = String(bondAsset.confs)\n      setReadyMessage(assetTmpl.ready, asset)\n\n      let count = 0\n      for (const mkt of Object.values(xc.markets)) {\n        if (mkt.baseid !== bondAsset.id && mkt.quoteid !== bondAsset.id) continue\n        const node = marketNode(mkt, bondAsset.id)\n        if (!node) continue\n        count++\n        assetTmpl.markets.appendChild(node)\n      }\n      if (count < 3) Doc.hide(assetTmpl.fader)\n    }\n\n    page.host.textContent = xc.host\n    for (const mkt of Object.values(xc.markets)) {\n      const node = marketNode(mkt)\n      if (!node) continue\n      page.allMarkets.appendChild(node)\n    }\n  }\n\n  /*\n   * walletCreated should be called when an asynchronous wallet creation\n   * completes successfully.\n   */\n  walletCreated (assetID: number) {\n    const tmpl = this.assetTmpls[assetID]\n    const asset = app().assets[assetID]\n    setReadyMessage(tmpl.ready, asset)\n  }\n\n  refresh () {\n    this.setExchange(this.xc)\n  }\n\n  /*\n   * Animation to make the elements sort of expand into their space from the\n   * bottom as they fade in.\n   */\n  async animate () {\n    const { page, form } = this\n    const how = page.how\n    const extraMargin = 75\n    const extraTop = 50\n    const fontSize = 24\n    const regAssetElements = Array.from(page.assets.children) as PageElement[]\n    regAssetElements.push(page.allmkts)\n    form.style.opacity = '0'\n\n    const aniLen = 350\n    await Doc.animate(aniLen, prog => {\n      for (const el of regAssetElements) {\n        el.style.marginTop = `${(1 - prog) * extraMargin}px`\n        el.style.transform = `scale(${prog})`\n      }\n      form.style.opacity = Math.pow(prog, 4).toFixed(1)\n      form.style.paddingTop = `${(1 - prog) * extraTop}px`\n      how.style.fontSize = `${fontSize * prog}px`\n    }, 'easeOut')\n  }\n}\n\n/*\n * setReadyMessage sets an asset's status message on the FeeAssetSelectionForm.\n */\nfunction setReadyMessage (el: PageElement, asset: SupportedAsset) {\n  if (asset.wallet) el.textContent = intl.prep(intl.WALLET_READY)\n  else if (asset.walletCreationPending) el.textContent = intl.prep(intl.WALLET_PENDING)\n  else el.textContent = intl.prep(intl.SETUP_NEEDED)\n  el.classList.remove('readygreen', 'setuporange')\n  el.classList.add(asset.wallet ? 'readygreen' : 'setuporange')\n}\n\n/*\n * WalletWaitForm is a form used to track the wallet sync status and balance\n * in preparation for posting a bond.\n */\nexport class WalletWaitForm {\n  form: HTMLElement\n  success: () => void\n  goBack: () => void\n  page: Record<string, PageElement>\n  assetID: number\n  parentID?: number\n  xc: Exchange\n  bondAsset: BondAsset\n  progressCache: ProgressPoint[]\n  progressed: boolean\n  funded: boolean\n  // if progressed && funded, stop reporting balance or state; call success()\n  bondFeeBuffer: number // in parent asset\n  parentAssetSynced: boolean\n\n  constructor (form: HTMLElement, success: () => void, goBack: () => void) {\n    this.form = form\n    this.success = success\n    this.page = Doc.parseTemplate(form)\n    this.assetID = -1\n    this.progressCache = []\n    this.progressed = false\n    this.funded = false\n\n    Doc.bind(this.page.goBack, 'click', () => {\n      this.assetID = -1\n      goBack()\n    })\n\n    app().registerNoteFeeder({\n      walletstate: (note: WalletStateNote) => this.reportWalletState(note.wallet),\n      balance: (note: BalanceNote) => this.reportBalance(note.assetID)\n    })\n  }\n\n  /* setExchange sets the exchange for which the fee is being paid. */\n  setExchange (xc: Exchange) {\n    this.xc = xc\n  }\n\n  /* setWallet must be called before showing the WalletWaitForm. */\n  setWallet (wallet: WalletState, bondFeeBuffer: number) {\n    this.assetID = wallet.assetID\n    this.progressCache = []\n    this.progressed = false\n    this.funded = false\n    this.bondFeeBuffer = bondFeeBuffer // in case we're a token, parent's balance must cover\n    this.parentAssetSynced = false\n    const page = this.page\n    const asset = app().assets[wallet.assetID]\n    this.parentID = asset.token?.parentID\n    const bondAsset = this.bondAsset = this.xc.bondAssets[asset.symbol]\n\n    const symbolize = (el: PageElement, symbol: string) => {\n      Doc.empty(el)\n      el.appendChild(Doc.symbolize(symbol))\n    }\n\n    for (const span of Doc.applySelector(this.form, '.unit')) symbolize(span, asset.symbol)\n    page.logo.src = Doc.logoPath(asset.symbol)\n    page.depoAddr.textContent = wallet.address\n    page.fee.textContent = Doc.formatCoinValue(bondAsset.amount, asset.unitInfo)\n\n    Doc.hide(page.syncUncheck, page.syncCheck, page.balUncheck, page.balCheck, page.syncRemainBox)\n    Doc.show(page.balanceBox)\n\n    if (bondFeeBuffer > 0) {\n      // overlap * increment + buffer\n      page.totalForBond.textContent = Doc.formatCoinValue(2 * bondAsset.amount + bondFeeBuffer, asset.unitInfo)\n      Doc.hide(page.sendEnough) // generic msg when no fee info available when\n      Doc.hide(page.txFeeBox, page.sendEnoughForToken, page.txFeeBalanceBox) // for tokens\n      Doc.hide(page.sendEnoughWithEst) // non-tokens\n\n      if (asset.token) {\n        Doc.show(page.txFeeBox, page.sendEnoughForToken, page.txFeeBalanceBox)\n        const parentAsset = app().assets[asset.token.parentID]\n        page.txFee.textContent = Doc.formatCoinValue(bondFeeBuffer, parentAsset.unitInfo)\n        page.parentFees.textContent = Doc.formatCoinValue(bondFeeBuffer, parentAsset.unitInfo)\n        page.tokenFees.textContent = Doc.formatCoinValue(bondAsset.amount, asset.unitInfo)\n        symbolize(page.txFeeUnit, parentAsset.symbol)\n        symbolize(page.parentUnit, parentAsset.symbol)\n        symbolize(page.parentBalUnit, parentAsset.symbol)\n        page.parentBal.textContent = parentAsset.wallet ? Doc.formatCoinValue(parentAsset.wallet.balance.available, parentAsset.unitInfo) : '0'\n      } else {\n        Doc.show(page.sendEnoughWithEst)\n      }\n    } else { // show some generic message with no amounts, this shouldn't happen... show wallet error?\n      Doc.show(page.sendEnough)\n    }\n\n    Doc.show(wallet.synced ? page.syncCheck : wallet.syncProgress >= 1 ? page.syncSpinner : page.syncUncheck)\n    Doc.show(wallet.balance.available >= 2 * bondAsset.amount + bondFeeBuffer ? page.balCheck : page.balUncheck)\n\n    page.progress.textContent = (wallet.syncProgress * 100).toFixed(1)\n\n    if (wallet.synced) {\n      this.progressed = true\n    }\n    this.reportBalance(wallet.assetID)\n  }\n\n  /*\n   * reportWalletState sets the progress and balance, ultimately calling the\n   * success function if conditions are met.\n   */\n  reportWalletState (wallet: WalletState) {\n    if (this.progressed && this.funded) return\n    if (wallet.assetID === this.assetID) this.reportProgress(wallet.synced, wallet.syncProgress)\n    this.reportBalance(wallet.assetID)\n  }\n\n  /*\n   * reportBalance sets the balance display and calls success if we go over the\n   * threshold.\n   */\n  reportBalance (assetID: number) {\n    if (this.funded || this.assetID === -1) return\n    if (assetID !== this.assetID && assetID !== this.parentID) return\n    const page = this.page\n    const asset = app().assets[this.assetID]\n\n    const avail = asset.wallet.balance.available\n    page.balance.textContent = Doc.formatCoinValue(avail, asset.unitInfo)\n\n    if (asset.token) {\n      const parentAsset = app().assets[asset.token.parentID]\n      const parentAvail = parentAsset.wallet.balance.available\n      page.parentBal.textContent = Doc.formatCoinValue(parentAvail, parentAsset.unitInfo)\n      if (parentAvail < this.bondFeeBuffer) return\n    }\n\n    // NOTE: when/if we allow one-time bond post (no maintenance) from the UI we\n    // may allow to proceed as long as they have enough for tx fees. For now,\n    // the balance check box will remain unchecked and we will not proceed.\n    if (avail < 2 * this.bondAsset.amount + this.bondFeeBuffer) return\n\n    Doc.show(page.balCheck)\n    Doc.hide(page.balUncheck, page.balanceBox, page.sendEnough)\n    this.funded = true\n    if (this.progressed) this.success()\n  }\n\n  /*\n   * reportProgress sets the progress display and calls success if we are fully\n   * synced.\n   */\n  reportProgress (synced: boolean, prog: number) {\n    const page = this.page\n    if (synced) {\n      page.progress.textContent = '100'\n      Doc.hide(page.syncUncheck, page.syncRemainBox, page.syncSpinner)\n      Doc.show(page.syncCheck)\n      this.progressed = true\n      if (this.funded) this.success()\n      return\n    } else if (prog === 1) {\n      Doc.hide(page.syncUncheck)\n      Doc.show(page.syncSpinner)\n    } else {\n      Doc.hide(page.syncSpinner)\n      Doc.show(page.syncUncheck)\n    }\n    page.progress.textContent = (prog * 100).toFixed(1)\n\n    if (prog >= 0.999) {\n      Doc.hide(page.syncRemaining)\n      Doc.show(page.syncFinishingUp)\n      Doc.show(page.syncRemainBox)\n      // The final stage of wallet sync process can take a while (it might hang\n      // at 99.9% for many minutes, indexing addresses for example), the simplest\n      // way to handle it is to keep displaying \"finishing up\" message until the\n      // sync is finished, since we can't reasonably show it progressing over time.\n      page.syncFinishingUp.textContent = intl.prep(intl.ID_WALLET_SYNC_FINISHING_UP)\n      return\n    }\n    // Before we get to 99.9% the remaining time estimate must be based on more\n    // than one progress report. We'll cache up to the last 20 and look at the\n    // difference between the first and last to make the estimate.\n    const cacheSize = 20\n    const cache = this.progressCache\n    cache.push({\n      stamp: new Date().getTime(),\n      progress: prog\n    })\n    if (cache.length < 2) {\n      // Can't meaningfully estimate remaining until we have at least 2 data points.\n      return\n    }\n    while (cache.length > cacheSize) cache.shift()\n    const [first, last] = [cache[0], cache[cache.length - 1]]\n    const progDelta = last.progress - first.progress\n    if (progDelta === 0) {\n      // Having no progress for a while likely means we are experiencing network\n      // issues, can't reasonably estimate time remaining in this case.\n      return\n    }\n    Doc.hide(page.syncFinishingUp)\n    Doc.show(page.syncRemaining)\n    Doc.show(page.syncRemainBox)\n    const timeDelta = last.stamp - first.stamp\n    const progRate = progDelta / timeDelta\n    const toGoProg = 1 - last.progress\n    const toGoTime = toGoProg / progRate\n    page.syncRemain.textContent = Doc.formatDuration(toGoTime)\n  }\n}\n\nexport class UnlockWalletForm {\n  form: HTMLElement\n  success: (assetID: number) => void\n  pwCache: PasswordCache | null\n  page: Record<string, PageElement>\n  currentAsset: SupportedAsset\n\n  constructor (form: HTMLElement, success: (assetID: number) => void, pwCache?: PasswordCache) {\n    this.page = Doc.idDescendants(form)\n    this.form = form\n    this.pwCache = pwCache || null\n    this.success = success\n    bind(form, this.page.submitUnlock, () => this.submit())\n  }\n\n  refresh (asset: SupportedAsset) {\n    const page = this.page\n    this.currentAsset = asset\n    page.uwAssetLogo.src = Doc.logoPath(asset.symbol)\n    page.uwAssetName.textContent = asset.name\n    page.uwAppPass.value = ''\n    page.unlockErr.textContent = ''\n    Doc.hide(page.unlockErr)\n    const hidePWBox = State.passwordIsCached() || (this.pwCache && this.pwCache.pw)\n    if (hidePWBox) Doc.hide(page.uwAppPassBox)\n    else Doc.show(page.uwAppPassBox)\n  }\n\n  /*\n   * setError displays an error on the form.\n   */\n  setError (msg: string) {\n    this.page.unlockErr.textContent = msg\n    Doc.show(this.page.unlockErr)\n  }\n\n  /*\n   * showErrorOnly displays only an error on the form. Hides the\n   * app pass field and the submit button.\n   */\n  showErrorOnly (msg: string) {\n    this.setError(msg)\n    Doc.hide(this.page.uwAppPassBox)\n    Doc.hide(this.page.submitUnlockDiv)\n  }\n\n  async submit () {\n    const page = this.page\n    const pw = page.uwAppPass.value || (this.pwCache ? this.pwCache.pw : '')\n    if (!pw && !State.passwordIsCached()) {\n      page.unlockErr.textContent = intl.prep(intl.ID_NO_APP_PASS_ERROR_MSG)\n      Doc.show(page.unlockErr)\n      return\n    }\n    const assetID = this.currentAsset.id\n    Doc.hide(this.page.unlockErr)\n    const open = {\n      assetID: assetID,\n      pass: pw\n    }\n    page.uwAppPass.value = ''\n    const loaded = app().loading(this.form)\n    const res = await postJSON('/api/openwallet', open)\n    loaded()\n    if (!app().checkResponse(res)) {\n      this.setError(res.msg)\n      return\n    }\n    if (this.pwCache) this.pwCache.pw = pw\n    this.success(assetID)\n  }\n}\n\ninterface EarlyAcceleration {\n  timePast: number,\n  wasAcceleration: boolean\n}\n\ninterface PreAccelerate {\n  swapRate: number\n  suggestedRate: number\n  suggestedRange: XYRange\n  earlyAcceleration?: EarlyAcceleration\n}\n\n/*\n * AccelerateOrderForm is used to submit an acceleration request for an order.\n */\nexport class AccelerateOrderForm {\n  form: HTMLElement\n  page: Record<string, PageElement>\n  order: Order\n  acceleratedRate: number\n  earlyAcceleration?: EarlyAcceleration\n  currencyUnit: string\n  success: () => void\n\n  constructor (form: HTMLElement, success: () => void) {\n    this.form = form\n    this.success = success\n    const page = this.page = Doc.idDescendants(form)\n\n    Doc.bind(page.accelerateSubmit, 'click', () => {\n      this.submit()\n    })\n    Doc.bind(page.submitEarlyConfirm, 'click', () => {\n      this.sendAccelerateRequest()\n    })\n  }\n\n  /*\n   * displayEarlyAccelerationMsg displays a message asking for confirmation\n   * when the user tries to submit an acceleration transaction very soon after\n   * the swap transaction was broadcast, or very soon after a previous\n   * acceleration.\n   */\n  displayEarlyAccelerationMsg () {\n    const page = this.page\n    // this is checked in submit, but another check is needed for ts compiler\n    if (!this.earlyAcceleration) return\n    page.recentAccelerationTime.textContent = `${Math.floor(this.earlyAcceleration.timePast / 60)}`\n    page.recentSwapTime.textContent = `${Math.floor(this.earlyAcceleration.timePast / 60)}`\n    if (this.earlyAcceleration.wasAcceleration) {\n      Doc.show(page.recentAccelerationMsg)\n      Doc.hide(page.recentSwapMsg)\n      page.recentAccelerationTime.textContent = `${Math.floor(this.earlyAcceleration.timePast / 60)}`\n    } else {\n      Doc.show(page.recentSwapMsg)\n      Doc.hide(page.recentAccelerationMsg)\n      page.recentSwapTime.textContent = `${Math.floor(this.earlyAcceleration.timePast / 60)}`\n    }\n    Doc.hide(page.configureAccelerationDiv, page.accelerateErr)\n    Doc.show(page.earlyAccelerationDiv)\n  }\n\n  // sendAccelerateRequest makes an accelerate order request to the client\n  // backend.\n  async sendAccelerateRequest () {\n    const order = this.order\n    const page = this.page\n    const req = {\n      pw: page.acceleratePass.value,\n      orderID: order.id,\n      newRate: this.acceleratedRate\n    }\n    page.acceleratePass.value = ''\n    const loaded = app().loading(page.accelerateMainDiv)\n    const res = await postJSON('/api/accelerateorder', req)\n    loaded()\n    if (app().checkResponse(res)) {\n      page.accelerateTxID.textContent = res.txID\n      Doc.hide(page.accelerateMainDiv, page.preAccelerateErr, page.accelerateErr)\n      Doc.show(page.accelerateMsgDiv, page.accelerateSuccess)\n      this.success()\n    } else {\n      page.accelerateErr.textContent = intl.prep(intl.ID_ORDER_ACCELERATION_ERR_MSG, { msg: res.msg })\n      Doc.hide(page.earlyAccelerationDiv)\n      Doc.show(page.accelerateErr, page.configureAccelerationDiv)\n    }\n  }\n\n  // submit is called when the submit button is clicked.\n  async submit () {\n    if (this.earlyAcceleration) {\n      this.displayEarlyAccelerationMsg()\n    } else {\n      this.sendAccelerateRequest()\n    }\n  }\n\n  // refresh should be called before the form is displayed. It makes a\n  // preaccelerate request to the client backend and sets up the form\n  // based on the results.\n  async refresh (order: Order) {\n    const page = this.page\n    this.order = order\n    const res = await postJSON('/api/preaccelerate', order.id)\n    if (!app().checkResponse(res)) {\n      page.preAccelerateErr.textContent = intl.prep(intl.ID_ORDER_ACCELERATION_ERR_MSG, { msg: res.msg })\n      Doc.hide(page.accelerateMainDiv, page.accelerateSuccess)\n      Doc.show(page.accelerateMsgDiv, page.preAccelerateErr)\n      return\n    }\n    Doc.hide(page.accelerateMsgDiv, page.preAccelerateErr, page.accelerateErr, page.feeEstimateDiv, page.earlyAccelerationDiv)\n    Doc.show(page.accelerateMainDiv, page.accelerateSuccess, page.configureAccelerationDiv)\n    const preAccelerate: PreAccelerate = res.preAccelerate\n    this.earlyAcceleration = preAccelerate.earlyAcceleration\n    this.currencyUnit = preAccelerate.suggestedRange.yUnit\n    page.accelerateAvgFeeRate.textContent = `${preAccelerate.swapRate} ${preAccelerate.suggestedRange.yUnit}`\n    page.accelerateCurrentFeeRate.textContent = `${preAccelerate.suggestedRate} ${preAccelerate.suggestedRange.yUnit}`\n    this.acceleratedRate = preAccelerate.suggestedRange.start.y\n    const selected = () => { /* do nothing */ }\n    const roundY = true\n    const updateRate = (_: number, newY: number) => { this.acceleratedRate = newY }\n    const rangeHandler = new XYRangeHandler(preAccelerate.suggestedRange,\n      preAccelerate.suggestedRange.start.x, updateRate, () => this.updateAccelerationEstimate(), selected, roundY)\n    Doc.empty(page.sliderContainer)\n    page.sliderContainer.appendChild(rangeHandler.control)\n    this.updateAccelerationEstimate()\n  }\n\n  // updateAccelerationEstimate makes an accelerate estimate request to the\n  // client backend using the currently selected rate on the slider, and\n  // displays the results.\n  async updateAccelerationEstimate () {\n    const page = this.page\n    const order = this.order\n    const req = {\n      orderID: order.id,\n      newRate: this.acceleratedRate\n    }\n    const loaded = app().loading(page.sliderContainer)\n    const res = await postJSON('/api/accelerationestimate', req)\n    loaded()\n    if (!app().checkResponse(res)) {\n      page.accelerateErr.textContent = intl.prep(intl.ID_ORDER_ACCELERATION_FEE_ERR_MSG, { msg: res.msg })\n      Doc.show(page.accelerateErr)\n      return\n    }\n    page.feeRateEstimate.textContent = `${this.acceleratedRate} ${this.currencyUnit}`\n    let assetID\n    let assetSymbol\n    if (order.sell) {\n      assetID = order.baseID\n      assetSymbol = order.baseSymbol\n    } else {\n      assetID = order.quoteID\n      assetSymbol = order.quoteSymbol\n    }\n    const unitInfo = app().unitInfo(assetID)\n    page.feeEstimate.textContent = `${res.fee / unitInfo.conventional.conversionFactor} ${assetSymbol}`\n    Doc.show(page.feeEstimateDiv)\n  }\n}\n\n/* DEXAddressForm accepts a DEX address and performs account discovery. */\nexport class DEXAddressForm {\n  form: HTMLElement\n  success: (xc: Exchange, cert: string) => void\n  pwCache: PasswordCache | null\n  page: Record<string, PageElement>\n  knownExchanges: HTMLElement[]\n  dexToUpdate?: string\n\n  constructor (form: HTMLElement, success: (xc: Exchange, cert: string) => void, pwCache?: PasswordCache, dexToUpdate?: string) {\n    this.form = form\n    this.success = success\n    this.pwCache = pwCache || null\n\n    const page = this.page = Doc.parseTemplate(form)\n\n    page.selectedCert.textContent = intl.prep(intl.ID_NONE_SELECTED)\n\n    Doc.bind(page.skipRegistration, 'change', () => this.showOrHidePWBox())\n    Doc.bind(page.certFile, 'change', () => this.onCertFileChange())\n    Doc.bind(page.removeCert, 'click', () => this.clearCertFile())\n    Doc.bind(page.addCert, 'click', () => page.certFile.click())\n    Doc.bind(page.showCustom, 'click', () => {\n      Doc.hide(page.showCustom)\n      Doc.show(page.customBox, page.auth)\n    })\n\n    this.knownExchanges = Array.from(page.knownXCs.querySelectorAll('.known-exchange'))\n    for (const div of this.knownExchanges) {\n      Doc.bind(div, 'click', () => {\n        const host = div.dataset.host\n        for (const d of this.knownExchanges) d.classList.remove('selected')\n        // If we don't intend to register or we have the password cached, we're\n        // good to go.\n        if (this.skipRegistration() || State.passwordIsCached() || (pwCache && pwCache.pw)) {\n          return this.checkDEX(host)\n        }\n        // Highlight the entry, but the user will have to enter their password\n        // and click submit.\n        div.classList.add('selected')\n        page.appPW.focus()\n        page.addr.value = host\n      })\n    }\n\n    bind(form, page.submit, () => this.checkDEX())\n\n    if (dexToUpdate) {\n      Doc.hide(page.addDexHdr, page.skipRegistrationBox)\n      Doc.show(page.updateDexHdr)\n      this.dexToUpdate = dexToUpdate\n    }\n\n    this.refresh()\n  }\n\n  refresh () {\n    const page = this.page\n    page.addr.value = ''\n    page.appPW.value = ''\n    this.clearCertFile()\n    Doc.hide(page.err)\n    if (this.knownExchanges.length === 0 || this.dexToUpdate) {\n      Doc.show(page.customBox, page.auth)\n      Doc.hide(page.showCustom, page.knownXCs, page.pickServerMsg, page.addCustomMsg)\n    } else {\n      Doc.hide(page.customBox)\n      Doc.show(page.showCustom)\n    }\n    for (const div of this.knownExchanges) div.classList.remove('selected')\n    this.showOrHidePWBox()\n  }\n\n  /**\n   * Show or hide appPWBox depending on if password is required. Show the\n   * submit button if connecting a custom server or password is required).\n   */\n  showOrHidePWBox () {\n    const passwordCached = State.passwordIsCached() || (this.pwCache && this.pwCache.pw)\n    const passwordRequired = !passwordCached && !this.skipRegistration()\n    const page = this.page\n    if (passwordRequired) {\n      Doc.show(page.appPWBox, page.auth)\n    } else {\n      Doc.hide(page.appPWBox)\n      Doc.setVis(Doc.isDisplayed(page.customBox), page.auth)\n    }\n  }\n\n  skipRegistration () : boolean {\n    return this.page.skipRegistration.checked ?? false\n  }\n\n  /* Just a small size tweak and fade-in. */\n  async animate () {\n    const form = this.form\n    Doc.animate(550, prog => {\n      form.style.transform = `scale(${0.9 + 0.1 * prog})`\n      form.style.opacity = String(Math.pow(prog, 4))\n    }, 'easeOut')\n  }\n\n  async checkDEX (addr?: string) {\n    const page = this.page\n    Doc.hide(page.err)\n    addr = addr || page.addr.value\n    if (addr === '') {\n      page.err.textContent = intl.prep(intl.ID_EMPTY_DEX_ADDRESS_MSG)\n      Doc.show(page.err)\n      return\n    }\n    let cert = ''\n    if (page.certFile.value) {\n      const files = page.certFile.files\n      if (files && files.length) {\n        cert = await files[0].text()\n      }\n    }\n    const skipRegistration = this.skipRegistration()\n    let pw = ''\n    if (!skipRegistration && !State.passwordIsCached()) {\n      pw = page.appPW.value || (this.pwCache ? this.pwCache.pw : '')\n    }\n    let endpoint : string, req: any\n    if (this.dexToUpdate) {\n      endpoint = '/api/updatedexhost'\n      req = {\n        newHost: addr,\n        cert: cert,\n        pw: pw,\n        oldHost: this.dexToUpdate\n      }\n    } else {\n      endpoint = skipRegistration ? '/api/adddex' : '/api/discoveracct'\n      req = {\n        addr: addr,\n        cert: cert,\n        pass: pw\n      }\n    }\n    const loaded = app().loading(this.form)\n    const res = await postJSON(endpoint, req)\n    loaded()\n    if (!app().checkResponse(res)) {\n      if (String(res.msg).includes('certificate required')) {\n        Doc.show(page.needCert)\n      } else {\n        page.err.textContent = res.msg\n        Doc.show(page.err)\n      }\n      return\n    }\n    if (!this.dexToUpdate && (skipRegistration || res.paid || Object.keys(res.xc.pendingBonds).length > 0)) {\n      await app().fetchUser()\n      await app().loadPage('markets')\n      return\n    }\n    if (this.pwCache) this.pwCache.pw = pw\n    this.success(res.xc, cert)\n  }\n\n  /**\n   * onCertFileChange when the input certFile changed, read the file\n   * and setting cert name into text of selectedCert to display on the view\n   */\n  async onCertFileChange () {\n    const page = this.page\n    const files = page.certFile.files\n    if (!files || !files.length) return\n    page.selectedCert.textContent = files[0].name\n    Doc.show(page.removeCert)\n    Doc.hide(page.addCert)\n  }\n\n  /* clearCertFile cleanup certFile value and selectedCert text */\n  clearCertFile () {\n    const page = this.page\n    page.certFile.value = ''\n    page.selectedCert.textContent = intl.prep(intl.ID_NONE_SELECTED)\n    Doc.hide(page.removeCert)\n    Doc.show(page.addCert)\n  }\n}\n\n/* DiscoverAccountForm performs account discovery for a pre-selected DEX. */\nexport class DiscoverAccountForm {\n  form: HTMLElement\n  addr: string\n  success: (xc: Exchange) => void\n  pwCache: PasswordCache | null\n  page: Record<string, PageElement>\n\n  constructor (form: HTMLElement, addr: string, success: (xc: Exchange) => void, pwCache?: PasswordCache) {\n    this.form = form\n    this.addr = addr\n    this.success = success\n    this.pwCache = pwCache || null\n\n    const page = this.page = Doc.parseTemplate(form)\n    page.dexHost.textContent = addr\n    bind(form, page.submit, () => this.checkDEX())\n\n    this.refresh()\n  }\n\n  refresh () {\n    const page = this.page\n    page.appPW.value = ''\n    Doc.hide(page.err)\n    const hidePWBox = State.passwordIsCached() || (this.pwCache && this.pwCache.pw)\n    if (hidePWBox) Doc.hide(page.appPWBox)\n    else Doc.show(page.appPWBox)\n  }\n\n  /* Just a small size tweak and fade-in. */\n  async animate () {\n    const form = this.form\n    Doc.animate(550, prog => {\n      form.style.transform = `scale(${0.9 + 0.1 * prog})`\n      form.style.opacity = String(Math.pow(prog, 4))\n    }, 'easeOut')\n  }\n\n  async checkDEX () {\n    const page = this.page\n    Doc.hide(page.err)\n    let pw = ''\n    if (!State.passwordIsCached()) {\n      pw = page.appPW.value || (this.pwCache ? this.pwCache.pw : '')\n    }\n    const req = {\n      addr: this.addr,\n      pass: pw\n    }\n    const loaded = app().loading(this.form)\n    const res = await postJSON('/api/discoveracct', req)\n    loaded()\n    if (!app().checkResponse(res)) {\n      page.err.textContent = res.msg\n      Doc.show(page.err)\n      return\n    }\n    if (res.paid) {\n      await app().fetchUser()\n      await app().loadPage('markets')\n      return\n    }\n    if (this.pwCache) this.pwCache.pw = pw\n    this.success(res.xc)\n  }\n}\n\n/* LoginForm is used to sign into the app. */\nexport class LoginForm {\n  form: HTMLElement\n  success: () => void\n  pwCache: PasswordCache | null\n  headerTxt: string\n  page: Record<string, PageElement>\n\n  constructor (form: HTMLElement, success: () => void, pwCache?: PasswordCache) {\n    this.success = success\n    this.form = form\n    this.pwCache = pwCache || null\n    const page = this.page = Doc.parseTemplate(form)\n    this.headerTxt = page.header.textContent || ''\n\n    bind(form, page.submit, () => { this.submit() })\n\n    app().registerNoteFeeder({\n      login: (note: CoreNote) => { this.handleLoginNote(note) }\n    })\n  }\n\n  handleLoginNote (n: CoreNote) {\n    if (n.details === '') return\n    const loginMsg = Doc.idel(this.form, 'loaderMsg')\n    if (loginMsg) loginMsg.textContent = n.details\n  }\n\n  focus () {\n    this.page.pw.focus()\n  }\n\n  async submit () {\n    const page = this.page\n    Doc.hide(page.errMsg)\n    const pw = page.pw.value || ''\n    page.pw.value = ''\n    const rememberPass = page.rememberPass.checked\n    if (pw === '') {\n      page.errMsg.textContent = intl.prep(intl.ID_NO_PASS_ERROR_MSG)\n      Doc.show(page.errMsg)\n      return\n    }\n    const loaded = app().loading(this.form)\n    const res = await postJSON('/api/login', { pass: pw, rememberPass })\n    loaded()\n    if (!app().checkResponse(res)) {\n      page.errMsg.textContent = res.msg\n      Doc.show(page.errMsg)\n      return\n    }\n    if (res.notes) {\n      res.notes.reverse()\n      app().setNotes(res.notes)\n    }\n    if (this.pwCache) this.pwCache.pw = pw\n    this.success()\n  }\n\n  /* Just a small size tweak and fade-in. */\n  async animate () {\n    const form = this.form\n    Doc.animate(550, prog => {\n      form.style.transform = `scale(${0.9 + 0.1 * prog})`\n      form.style.opacity = String(Math.pow(prog, 4))\n    }, 'easeOut')\n  }\n}\n\nconst traitNewAddresser = 1 << 1\n\n/*\n * DepositAddress displays a deposit address, a QR code, and a button to\n * generate a new address (if supported).\n */\nexport class DepositAddress {\n  form: PageElement\n  page: Record<string, PageElement>\n  assetID: number\n\n  constructor (form: PageElement) {\n    this.form = form\n    const page = this.page = Doc.idDescendants(form)\n    Doc.bind(page.newDepAddrBttn, 'click', async () => { this.newDepositAddress() })\n    Doc.bind(page.copyAddressBtn, 'click', () => { this.copyAddress() })\n  }\n\n  /* Display a deposit address. */\n  async setAsset (assetID: number) {\n    this.assetID = assetID\n    const page = this.page\n    Doc.hide(page.depositErr)\n    const asset = app().assets[assetID]\n    page.depositLogo.src = Doc.logoPath(asset.symbol)\n    const wallet = app().walletMap[assetID]\n    page.depositName.textContent = asset.name\n    page.depositAddress.textContent = wallet.address\n    page.qrcode.src = `/generateqrcode?address=${wallet.address}`\n    if ((wallet.traits & traitNewAddresser) !== 0) Doc.show(page.newDepAddrBttn)\n    else Doc.hide(page.newDepAddrBttn)\n  }\n\n  /* Fetch a new address from the wallet. */\n  async newDepositAddress () {\n    const page = this.page\n    Doc.hide(page.depositErr)\n    const loaded = app().loading(this.form)\n    const res = await postJSON('/api/depositaddress', {\n      assetID: this.assetID\n    })\n    loaded()\n    if (!app().checkResponse(res)) {\n      page.depositErr.textContent = res.msg\n      Doc.show(page.depositErr)\n      return\n    }\n    page.depositAddress.textContent = res.address\n    page.qrcode.src = `/generateqrcode?address=${res.address}`\n  }\n\n  async copyAddress () {\n    const page = this.page\n    navigator.clipboard.writeText(page.depositAddress.textContent || '')\n      .then(() => {\n        Doc.show(page.copyAlert)\n        setTimeout(() => {\n          Doc.hide(page.copyAlert)\n        }, 800)\n      })\n      .catch((reason) => {\n        console.error('Unable to copy: ', reason)\n      })\n  }\n}\n\nconst animationLength = 300\n\n/* Swap form1 for form2 with an animation. */\nexport async function slideSwap (form1: HTMLElement, form2: HTMLElement) {\n  const shift = document.body.offsetWidth / 2\n  await Doc.animate(animationLength, progress => {\n    form1.style.right = `${progress * shift}px`\n  }, 'easeInHard')\n  Doc.hide(form1)\n  form1.style.right = '0'\n  form2.style.right = String(-shift)\n  Doc.show(form2)\n  if (form2.querySelector('input')) {\n    Doc.safeSelector(form2, 'input').focus()\n  }\n  await Doc.animate(animationLength, progress => {\n    form2.style.right = `${-shift + progress * shift}px`\n  }, 'easeOutHard')\n  form2.style.right = '0'\n}\n\n/*\n * bind binds the click and submit events and prevents page reloading on\n * submission.\n */\nexport function bind (form: HTMLElement, submitBttn: HTMLElement, handler: (e: Event) => void) {\n  const wrapper = (e: Event) => {\n    if (e.preventDefault) e.preventDefault()\n    handler(e)\n  }\n  Doc.bind(submitBttn, 'click', wrapper)\n  Doc.bind(form, 'submit', wrapper)\n}\n\n// isTruthyString will be true if the provided string is recognized as a\n// value representing true.\nfunction isTruthyString (s: string) {\n  return s === '1' || s.toLowerCase() === 'true'\n}\n\n// toUnixDate converts a javascript date object to a unix date, which is\n// the number of *seconds* since the start of the epoch.\nfunction toUnixDate (date: Date) {\n  return Math.floor(date.getTime() / 1000)\n}\n\n// dateApplyOffset shifts a date by the timezone offset. This is used to make\n// UTC dates show the local date. This can be used to prepare a Date so\n// toISOString generates a local date string. This is also used to trick an html\n// input element to show the local date when setting the valueAsDate field. When\n// reading the date back to JS, the value field should be interpreted as local\n// using the \"T00:00\" suffix, or the Date in valueAsDate should be shifted in\n// the opposite direction.\nfunction dateApplyOffset (date: Date) {\n  return new Date(date.getTime() - date.getTimezoneOffset() * 60 * 1000)\n}\n\n// dateToString converts a javascript date object to a YYYY-MM-DD format string,\n// in the local time zone.\nfunction dateToString (date: Date) {\n  return dateApplyOffset(date).toISOString().split('T')[0]\n  // Another common hack:\n  // date.toLocaleString(\"sv-SE\", { year: \"numeric\", month: \"2-digit\", day: \"2-digit\" })\n}\n\n/*\n * baseChainSymbol returns the symbol for the asset's parent if the asset is a\n * token, otherwise the symbol for the asset itself.\n */\nexport function baseChainSymbol (assetID: number) {\n  const asset = app().user.assets[assetID]\n  return asset.token ? app().user.assets[asset.token.parentID].symbol : asset.symbol\n}\n","import Doc from './doc'\nimport BasePage from './basepage'\nimport { postJSON } from './http'\nimport {\n  NewWalletForm,\n  DEXAddressForm,\n  DiscoverAccountForm,\n  LoginForm,\n  ConfirmRegistrationForm,\n  FeeAssetSelectionForm,\n  WalletWaitForm,\n  slideSwap,\n  bind as bindForm\n} from './forms'\nimport * as intl from './locales'\nimport {\n  app,\n  PasswordCache,\n  Exchange,\n  PageElement\n} from './registry'\n\nexport default class RegistrationPage extends BasePage {\n  body: HTMLElement\n  pwCache: PasswordCache\n  currentDEX: Exchange\n  page: Record<string, PageElement>\n  loginForm: LoginForm\n  dexAddrForm: DEXAddressForm\n  discoverAcctForm: DiscoverAccountForm\n  newWalletForm: NewWalletForm\n  regAssetForm: FeeAssetSelectionForm\n  walletWaitForm: WalletWaitForm\n  confirmRegisterForm: ConfirmRegistrationForm\n\n  constructor (body: HTMLElement, data: any) {\n    super()\n    this.body = body\n    this.pwCache = { pw: '' }\n    const page = this.page = Doc.idDescendants(body)\n\n    if (data.host && page.dexAddrForm.classList.contains('selected')) {\n      page.dexAddrForm.classList.remove('selected')\n      page.discoverAcctForm.classList.add('selected')\n      page.discoverAcctForm.dataset.host = data.host\n    }\n\n    // Hide the form closers for the registration process.\n    body.querySelectorAll('.form-closer').forEach(el => Doc.hide(el))\n\n    // SET APP PASSWORD\n    bindForm(page.appPWForm, page.appPWSubmit, () => this.setAppPass())\n    Doc.bind(page.showSeedRestore, 'click', () => {\n      Doc.show(page.seedRestore)\n      Doc.hide(page.showSeedRestore)\n    })\n\n    this.loginForm = new LoginForm(page.loginForm, async () => {\n      await app().fetchUser()\n      if (this.discoverAcctForm) {\n        this.discoverAcctForm.refresh()\n        slideSwap(page.loginForm, page.discoverAcctForm)\n      } else {\n        this.dexAddrForm.refresh()\n        slideSwap(page.loginForm, page.dexAddrForm)\n      }\n    }, this.pwCache)\n\n    this.newWalletForm = new NewWalletForm(\n      page.newWalletForm,\n      assetID => this.newWalletCreated(assetID),\n      this.pwCache,\n      () => this.animateRegAsset(page.newWalletForm)\n    )\n\n    // ADD DEX\n    this.dexAddrForm = new DEXAddressForm(page.dexAddrForm, async (xc, certFile) => {\n      this.requestFeepayment(page.dexAddrForm, xc, certFile)\n    }, this.pwCache)\n\n    const addr = page.discoverAcctForm.dataset.host\n    if (addr) {\n      this.discoverAcctForm = new DiscoverAccountForm(page.discoverAcctForm, addr, async (xc) => {\n        this.requestFeepayment(page.discoverAcctForm, xc, '')\n      }, this.pwCache)\n    }\n\n    // SELECT REG ASSET\n    this.regAssetForm = new FeeAssetSelectionForm(page.regAssetForm, async assetID => {\n      this.confirmRegisterForm.setAsset(assetID)\n\n      const asset = app().assets[assetID]\n      const wallet = asset.wallet\n      if (wallet) {\n        const bondAsset = this.currentDEX.bondAssets[asset.symbol]\n        const bondsFeeBuffer = await this.getBondsFeeBuffer(assetID, page.regAssetForm)\n        if (wallet.synced && wallet.balance.available >= 2 * bondAsset.amount + bondsFeeBuffer) {\n          this.animateConfirmForm(page.regAssetForm)\n          return\n        }\n        this.walletWaitForm.setWallet(wallet, bondsFeeBuffer)\n        slideSwap(page.regAssetForm, page.walletWait)\n        return\n      }\n      this.newWalletForm.setAsset(assetID)\n      slideSwap(page.regAssetForm, page.newWalletForm)\n    })\n\n    this.walletWaitForm = new WalletWaitForm(page.walletWait, () => {\n      this.animateConfirmForm(page.walletWait)\n    }, () => { this.animateRegAsset(page.walletWait) })\n\n    // SUBMIT DEX REGISTRATION\n    this.confirmRegisterForm = new ConfirmRegistrationForm(page.confirmRegForm, () => {\n      this.registerDEXSuccess()\n    }, () => {\n      this.animateRegAsset(page.confirmRegForm)\n    }, this.pwCache)\n\n    const currentForm = Doc.safeSelector(page.forms, ':scope > form.selected')\n    currentForm.classList.remove('selected')\n    switch (currentForm) {\n      case page.loginForm:\n        this.loginForm.animate()\n        break\n      case page.dexAddrForm:\n        this.dexAddrForm.animate()\n        break\n      case page.discoverAcctForm:\n        this.discoverAcctForm.animate()\n    }\n    Doc.show(currentForm)\n\n    if (app().authed()) this.auth()\n  }\n\n  unload () {\n    this.pwCache.pw = ''\n  }\n\n  // auth should be called once user is known to be authed with the server.\n  async auth () {\n    await app().fetchUser()\n  }\n\n  async requestFeepayment (oldForm: HTMLElement, xc: Exchange, certFile: string) {\n    this.currentDEX = xc\n    this.confirmRegisterForm.setExchange(xc, certFile)\n    this.walletWaitForm.setExchange(xc)\n    this.regAssetForm.setExchange(xc)\n    this.animateRegAsset(oldForm)\n  }\n\n  /* Swap in the asset selection form and run the animation. */\n  async animateRegAsset (oldForm: HTMLElement) {\n    Doc.hide(oldForm)\n    this.regAssetForm.animate()\n    Doc.show(this.page.regAssetForm)\n  }\n\n  /* Swap in the confirmation form and run the animation. */\n  async animateConfirmForm (oldForm: HTMLElement) {\n    this.confirmRegisterForm.animate()\n    Doc.hide(oldForm)\n    Doc.show(this.page.confirmRegForm)\n  }\n\n  // Retrieve an estimate for the tx fee needed to create new bond reserves.\n  async getBondsFeeBuffer (assetID: number, form: HTMLElement) {\n    const loaded = app().loading(form)\n    const res = await postJSON('/api/bondsfeebuffer', { assetID })\n    loaded()\n    if (!app().checkResponse(res)) {\n      return 0\n    }\n    return res.feeBuffer\n  }\n\n  /* Set the application password. Attached to form submission. */\n  async setAppPass () {\n    const page = this.page\n    Doc.hide(page.appPWErrMsg)\n    const pw = page.appPW.value || ''\n    const pwAgain = page.appPWAgain.value\n    if (pw === '') {\n      page.appPWErrMsg.textContent = intl.prep(intl.ID_NO_PASS_ERROR_MSG)\n      Doc.show(page.appPWErrMsg)\n      return\n    }\n    if (pw !== pwAgain) {\n      page.appPWErrMsg.textContent = intl.prep(intl.ID_PASSWORD_NOT_MATCH)\n      Doc.show(page.appPWErrMsg)\n      return\n    }\n\n    // Clear the notification cache. Useful for development purposes, since\n    // the Application will only clear them on login, which would leave old\n    // browser-cached notifications in place after registering even if the\n    // client db is wiped.\n    app().setNotes([])\n    page.appPW.value = ''\n    page.appPWAgain.value = ''\n    const loaded = app().loading(page.appPWForm)\n    const seed = page.seedInput.value\n    const rememberPass = page.rememberPass.checked\n    const res = await postJSON('/api/init', {\n      pass: pw,\n      seed,\n      rememberPass\n    })\n    loaded()\n    if (!app().checkResponse(res)) {\n      page.appPWErrMsg.textContent = res.msg\n      Doc.show(page.appPWErrMsg)\n      return\n    }\n    this.pwCache.pw = pw\n    this.auth()\n    app().updateMenuItemsDisplay()\n    this.newWalletForm.refresh()\n    this.dexAddrForm.refresh()\n    await slideSwap(page.appPWForm, page.dexAddrForm)\n  }\n\n  /* gets the contents of the cert file */\n  async getCertFile () {\n    let cert = ''\n    if (this.dexAddrForm.page.certFile.value) {\n      const files = this.dexAddrForm.page.certFile.files\n      if (files && files.length) cert = await files[0].text()\n    }\n    return cert\n  }\n\n  /* Called after successful registration to a DEX. */\n  async registerDEXSuccess () {\n    await app().fetchUser()\n    await app().loadPage('markets')\n  }\n\n  async newWalletCreated (assetID: number) {\n    this.regAssetForm.refresh()\n    const user = await app().fetchUser()\n    if (!user) return\n    const page = this.page\n    const asset = user.assets[assetID]\n    const wallet = asset.wallet\n    const bondAmt = this.currentDEX.bondAssets[asset.symbol].amount\n\n    const bondsFeeBuffer = await this.getBondsFeeBuffer(assetID, page.newWalletForm)\n    if (wallet.synced && wallet.balance.available >= 2 * bondAmt + bondsFeeBuffer) {\n      await this.animateConfirmForm(page.newWalletForm)\n      return\n    }\n\n    this.walletWaitForm.setWallet(wallet, bondsFeeBuffer)\n    await slideSwap(page.newWalletForm, page.walletWait)\n  }\n}\n","import { app } from './registry'\nimport Doc from './doc'\nimport BasePage from './basepage'\nimport { LoginForm } from './forms'\n\nexport default class LoginPage extends BasePage {\n  form: HTMLElement\n  loginForm: LoginForm\n\n  constructor (body: HTMLElement) {\n    super()\n    this.form = Doc.idel(body, 'loginForm')\n    Doc.show(this.form)\n    this.loginForm = new LoginForm(this.form, () => { this.loggedIn() })\n    this.loginForm.focus()\n  }\n\n  /* login submits the sign-in form and parses the result. */\n  async loggedIn () {\n    await app().fetchUser()\n    await app().loadPage('markets')\n  }\n}\n","import Doc, { Animation } from './doc'\nimport BasePage from './basepage'\nimport { postJSON, Errors } from './http'\nimport {\n  NewWalletForm,\n  WalletConfigForm,\n  UnlockWalletForm,\n  DepositAddress,\n  bind as bindForm,\n  baseChainSymbol\n} from './forms'\nimport State from './state'\nimport * as intl from './locales'\nimport * as OrderUtil from './orderutil'\nimport {\n  app,\n  PageElement,\n  SupportedAsset,\n  WalletDefinition,\n  BalanceNote,\n  WalletStateNote,\n  RateNote,\n  Order,\n  OrderFilter,\n  WalletCreationNote,\n  Market,\n  PeerSource,\n  WalletPeer\n} from './registry'\n\nconst animationLength = 300\nconst traitRescanner = 1\nconst traitLogFiler = 1 << 2\nconst traitRecoverer = 1 << 5\nconst traitWithdrawer = 1 << 6\nconst traitRestorer = 1 << 8\nconst traitTxFeeEstimator = 1 << 10\nconst traitPeerManager = 1 << 11\nconst traitsExtraOpts = traitLogFiler & traitRecoverer & traitRestorer & traitRescanner & traitPeerManager\n\ninterface ReconfigRequest {\n  assetID: number\n  walletType: string\n  config: Record<string, string>\n  newWalletPW?: string\n  appPW: string\n}\n\ninterface RescanRecoveryRequest {\n  assetID: number\n  appPW?: string\n  force?: boolean\n}\n\ninterface WalletRestoration {\n  target: string\n  seed: string\n  seedName: string\n  instructions: string\n}\n\ninterface AssetButton {\n  tmpl: Record<string, PageElement>\n  bttn: PageElement\n}\n\nexport default class WalletsPage extends BasePage {\n  body: HTMLElement\n  page: Record<string, PageElement>\n  assetButtons: Record<number, AssetButton>\n  newWalletForm: NewWalletForm\n  reconfigForm: WalletConfigForm\n  walletCfgGuide: PageElement\n  unlockForm: UnlockWalletForm\n  depositAddrForm: DepositAddress\n  keyup: (e: KeyboardEvent) => void\n  changeWalletPW: boolean\n  displayed: HTMLElement\n  animation: Animation\n  forms: PageElement[]\n  forceReq: RescanRecoveryRequest\n  forceUrl: string\n  currentForm: PageElement\n  restoreInfoCard: HTMLElement\n  selectedAssetID: number\n  maxSend: number\n\n  constructor (body: HTMLElement) {\n    super()\n    this.body = body\n    const page = this.page = Doc.idDescendants(body)\n\n    Doc.cleanTemplates(page.restoreInfoCard, page.connectedIconTmpl, page.disconnectedIconTmpl, page.removeIconTmpl)\n    this.restoreInfoCard = page.restoreInfoCard.cloneNode(true) as HTMLElement\n    Doc.show(page.connectedIconTmpl, page.disconnectedIconTmpl, page.removeIconTmpl)\n\n    this.forms = Doc.applySelector(page.forms, ':scope > form')\n    page.forms.querySelectorAll('.form-closer').forEach(el => {\n      Doc.bind(el, 'click', () => { this.closePopups() })\n    })\n    Doc.bind(page.cancelForce, 'click', () => { this.closePopups() })\n\n    this.selectedAssetID = -1\n    Doc.cleanTemplates(\n      page.iconSelectTmpl, page.balanceDetailRow, page.recentOrderTmpl\n    )\n\n    Doc.bind(page.createWallet, 'click', () => this.showNewWallet(this.selectedAssetID))\n    Doc.bind(page.connectBttn, 'click', () => this.doConnect(this.selectedAssetID))\n    Doc.bind(page.send, 'click', () => this.showSendForm(this.selectedAssetID))\n    Doc.bind(page.receive, 'click', () => this.showDeposit(this.selectedAssetID))\n    Doc.bind(page.unlockBttn, 'click', () => this.openWallet(this.selectedAssetID))\n    Doc.bind(page.lockBttn, 'click', () => this.lock(this.selectedAssetID))\n    Doc.bind(page.reconfigureBttn, 'click', () => this.showReconfig(this.selectedAssetID))\n    Doc.bind(page.rescanWallet, 'click', () => this.rescanWallet(this.selectedAssetID))\n\n    // Bind the new wallet form.\n    this.newWalletForm = new NewWalletForm(page.newWalletForm, (assetID: number) => {\n      const fmtParams = { assetName: app().assets[assetID].name }\n      this.assetUpdated(assetID, page.newWalletForm, intl.prep(intl.ID_NEW_WALLET_SUCCESS, fmtParams))\n      this.sortAssetButtons()\n    })\n\n    // Bind the wallet reconfig form.\n    this.reconfigForm = new WalletConfigForm(page.reconfigInputs, false)\n\n    this.walletCfgGuide = Doc.tmplElement(page.reconfigForm, 'walletCfgGuide')\n\n    // Bind the wallet unlock form.\n    this.unlockForm = new UnlockWalletForm(page.unlockWalletForm, (assetID: number) => this.openWalletSuccess(assetID, page.unlockWalletForm))\n\n    // Bind the send form.\n    bindForm(page.sendForm, page.submitSendForm, async () => { this.stepSend() })\n    // Send confirmation form.\n    bindForm(page.vSendForm, page.vSend, async () => { this.send() })\n    // Cancel send confirmation form.\n    Doc.bind(page.vCancelSend, 'click', async () => { this.cancelSend() })\n    // Bind the wallet reconfiguration submission.\n    bindForm(page.reconfigForm, page.submitReconfig, () => this.reconfig())\n\n    page.forms.querySelectorAll('.form-closer').forEach(el => {\n      Doc.bind(el, 'click', () => this.closePopups())\n    })\n\n    Doc.bind(page.forms, 'mousedown', (e: MouseEvent) => {\n      if (!Doc.mouseInElement(e, this.currentForm)) { this.closePopups() }\n    })\n\n    this.keyup = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        if (Doc.isDisplayed(this.page.forms)) this.closePopups()\n      }\n    }\n    Doc.bind(document, 'keyup', this.keyup)\n\n    Doc.bind(page.downloadLogs, 'click', async () => { this.downloadLogs() })\n    Doc.bind(page.exportWallet, 'click', async () => { this.displayExportWalletAuth() })\n    Doc.bind(page.recoverWallet, 'click', async () => { this.showRecoverWallet() })\n    bindForm(page.exportWalletAuth, page.exportWalletAuthSubmit, async () => { this.exportWalletAuthSubmit() })\n    bindForm(page.recoverWalletConfirm, page.recoverWalletSubmit, () => { this.recoverWallet() })\n    bindForm(page.confirmForce, page.confirmForceSubmit, async () => { this.confirmForceSubmit() })\n    Doc.bind(page.disableWallet, 'click', async () => { this.showToggleWalletStatus(true) })\n    Doc.bind(page.enableWallet, 'click', async () => { this.showToggleWalletStatus(false) })\n    bindForm(page.toggleWalletStatusConfirm, page.toggleWalletStatusSubmit, async () => { this.toggleWalletStatus() })\n    Doc.bind(page.managePeers, 'click', async () => { this.showManagePeersForm() })\n    Doc.bind(page.addPeerSubmit, 'click', async () => { this.submitAddPeer() })\n\n    // New deposit address button.\n    this.depositAddrForm = new DepositAddress(page.deposit)\n\n    // Clicking on the available amount on the Send form populates the\n    // amount field.\n    Doc.bind(page.walletBal, 'click', () => { this.populateMaxSend() })\n\n    // Display fiat value for current send amount.\n    Doc.bind(page.sendAmt, 'input', () => {\n      const { unitInfo: ui } = app().assets[this.selectedAssetID]\n      const amt = parseFloat(page.sendAmt.value || '0')\n      const conversionFactor = ui.conventional.conversionFactor\n      this.showFiatValue(this.selectedAssetID, amt * conversionFactor, page.sendValue)\n    })\n\n    // Clicking on maxSend on the send form should populate the amount field.\n    Doc.bind(page.maxSend, 'click', () => { this.populateMaxSend() })\n\n    // Validate send address on input.\n    Doc.bind(page.sendAddr, 'input', async () => {\n      const asset = app().assets[this.selectedAssetID]\n      Doc.hide(page.validAddr)\n      page.sendAddr.classList.remove('invalid')\n      const addr = page.sendAddr.value || ''\n      if (!asset || addr === '') return\n      const valid = await this.validateSendAddress(addr, asset.id)\n      if (valid) Doc.show(page.validAddr)\n      else page.sendAddr.classList.add('invalid')\n    })\n\n    // A link on the wallet reconfiguration form to show/hide the password field.\n    Doc.bind(page.showChangePW, 'click', () => {\n      this.changeWalletPW = !this.changeWalletPW\n      this.setPWSettingViz(this.changeWalletPW)\n    })\n\n    // Changing the type of wallet.\n    Doc.bind(page.changeWalletTypeSelect, 'change', () => {\n      this.changeWalletType()\n    })\n    Doc.bind(page.showChangeType, 'click', () => {\n      if (Doc.isHidden(page.changeWalletType)) {\n        Doc.show(page.changeWalletType, page.changeTypeHideIcon)\n        Doc.hide(page.changeTypeShowIcon)\n        page.changeTypeMsg.textContent = intl.prep(intl.ID_KEEP_WALLET_TYPE)\n      } else this.showReconfig(this.selectedAssetID, true)\n    })\n\n    app().registerNoteFeeder({\n      fiatrateupdate: (note: RateNote) => { this.handleRatesNote(note) },\n      balance: (note: BalanceNote) => { this.handleBalanceNote(note) },\n      walletstate: (note: WalletStateNote) => { this.handleWalletStateNote(note) },\n      walletconfig: (note: WalletStateNote) => { this.handleWalletStateNote(note) },\n      createwallet: (note: WalletCreationNote) => { this.handleCreateWalletNote(note) }\n    })\n\n    const firstAsset = this.sortAssetButtons()\n    let selectedAsset = firstAsset.id\n    const assetIDStr = State.fetchLocal(State.selectedAssetLK)\n    if (assetIDStr) selectedAsset = Number(assetIDStr)\n    this.setSelectedAsset(selectedAsset)\n  }\n\n  closePopups () {\n    Doc.hide(this.page.forms)\n    if (this.animation) this.animation.stop()\n  }\n\n  // stepSend makes a request to get an estimated fee and displays the confirm\n  // send form.\n  async stepSend () {\n    const page = this.page\n    Doc.hide(page.vSendErr, page.sendErr, page.vSendEstimates, page.txFeeNotAvailable)\n    const assetID = parseInt(page.sendForm.dataset.assetID || '')\n    const token = app().assets[assetID].token\n    const subtract = page.subtractCheckBox.checked || false\n    const conversionFactor = app().unitInfo(assetID).conventional.conversionFactor\n    const value = Math.round(parseFloat(page.sendAmt.value || '') * conversionFactor)\n    const addr = page.sendAddr.value || ''\n    if (addr === '') return Doc.showFormError(page.sendErr, intl.prep(intl.ID_INVALID_ADDRESS_MSG, { address: addr }))\n    const { wallet, unitInfo: ui, symbol } = app().assets[assetID]\n\n    // txfee will not be available if wallet is not a fee estimator or the\n    // request failed.\n    let txfee = 0\n    if ((wallet.traits & traitTxFeeEstimator) !== 0) {\n      const open = {\n        addr: page.sendAddr.value,\n        assetID: assetID,\n        subtract: subtract,\n        value: value\n      }\n\n      const loaded = app().loading(page.sendForm)\n      const res = await postJSON('/api/txfee', open)\n      loaded()\n      if (!app().checkResponse(res)) {\n        page.txFeeNotAvailable.dataset.tooltip = intl.prep(intl.ID_TXFEE_ERR_MSG, { err: res.msg })\n        Doc.show(page.txFeeNotAvailable)\n        // We still want to ensure user address is valid before proceeding to send\n        // confirm form if there's an error while calculating the transaction fee.\n        const valid = await this.validateSendAddress(addr, assetID)\n        if (!valid) return Doc.showFormError(page.sendErr, intl.prep(intl.ID_INVALID_ADDRESS_MSG, { address: addr || '' }))\n      } else if (res.ok) {\n        if (!res.validaddress) return Doc.showFormError(page.sendErr, intl.prep(intl.ID_INVALID_ADDRESS_MSG, { address: page.sendAddr.value || '' }))\n        txfee = res.txfee\n        Doc.show(page.vSendEstimates)\n      }\n    } else {\n      // Validate only the send address for assets that are not fee estimators.\n      const valid = await this.validateSendAddress(addr, assetID)\n      if (!valid) return Doc.showFormError(page.sendErr, intl.prep(intl.ID_INVALID_ADDRESS_MSG, { address: addr || '' }))\n    }\n\n    page.vSendSymbol.textContent = symbol.toUpperCase()\n    page.vSendLogo.src = Doc.logoPath(symbol)\n\n    if (token) {\n      const { unitInfo: feeUI, symbol: feeSymbol } = app().assets[token.parentID]\n      page.vSendFee.textContent = Doc.formatFullPrecision(txfee, feeUI) + ' ' + feeSymbol\n    } else {\n      page.vSendFee.textContent = Doc.formatFullPrecision(txfee, ui)\n    }\n    this.showFiatValue(assetID, txfee, page.vSendFeeFiat)\n    page.vSendDestinationAmt.textContent = Doc.formatFullPrecision(value - txfee, ui)\n    page.vTotalSend.textContent = Doc.formatFullPrecision(value, ui)\n    this.showFiatValue(assetID, value, page.vTotalSendFiat)\n    page.vSendAddr.textContent = page.sendAddr.value || ''\n    const bal = wallet.balance.available - value\n    page.balanceAfterSend.textContent = Doc.formatFullPrecision(bal, ui)\n    this.showFiatValue(assetID, bal, page.balanceAfterSendFiat)\n    Doc.show(page.approxSign)\n    // NOTE: All tokens take this route because they cannot pay the fee.\n    if (!subtract) {\n      Doc.hide(page.approxSign)\n      page.vSendDestinationAmt.textContent = Doc.formatFullPrecision(value, ui)\n      let totalSend = value\n      if (!token) totalSend += txfee\n      page.vTotalSend.textContent = Doc.formatFullPrecision(totalSend, ui)\n      this.showFiatValue(assetID, totalSend, page.vTotalSendFiat)\n      let bal = wallet.balance.available - value\n      if (!token) bal -= txfee\n      // handle edge cases where bal is not enough to cover totalSend.\n      // we don't want a minus display of user bal.\n      if (bal <= 0) {\n        page.balanceAfterSend.textContent = Doc.formatFullPrecision(0, ui)\n        this.showFiatValue(assetID, 0, page.balanceAfterSendFiat)\n      } else {\n        page.balanceAfterSend.textContent = Doc.formatFullPrecision(bal, ui)\n        this.showFiatValue(assetID, bal, page.balanceAfterSendFiat)\n      }\n    }\n    Doc.hide(page.sendForm)\n    await this.showForm(page.vSendForm)\n  }\n\n  // cancelSend displays the send form if user wants to make modification.\n  async cancelSend () {\n    const page = this.page\n    Doc.hide(page.vSendForm, page.sendErr)\n    await this.showForm(page.sendForm)\n  }\n\n  /*\n   * validateSendAddress validates the provided address for an asset.\n   */\n  async validateSendAddress (addr: string, assetID: number): Promise<boolean> {\n    const resp = await postJSON('/api/validateaddress', { addr: addr, assetID: assetID })\n    return app().checkResponse(resp)\n  }\n\n  /*\n   * setPWSettingViz sets the visibility of the password field section.\n   */\n  setPWSettingViz (visible: boolean) {\n    const page = this.page\n    if (visible) {\n      Doc.hide(page.showIcon)\n      Doc.show(page.hideIcon, page.changePW)\n      page.switchPWMsg.textContent = intl.prep(intl.ID_KEEP_WALLET_PASS)\n      return\n    }\n    Doc.hide(page.hideIcon, page.changePW)\n    Doc.show(page.showIcon)\n    page.switchPWMsg.textContent = intl.prep(intl.ID_NEW_WALLET_PASS)\n  }\n\n  /*\n   * updateWalletPeers retrieves the wallet peers and displays them in the\n   * wallet peers table.\n   */\n  async updateWalletPeersTable () {\n    const page = this.page\n\n    Doc.hide(page.peerSpinner)\n\n    const res = await postJSON('/api/getwalletpeers', {\n      assetID: this.selectedAssetID\n    })\n    if (!app().checkResponse(res)) {\n      page.managePeersErr.textContent = res.msg\n      Doc.show(page.managePeersErr)\n      return\n    }\n\n    while (page.peersTableBody.firstChild) {\n      page.peersTableBody.removeChild(page.peersTableBody.firstChild)\n    }\n\n    const peers : WalletPeer[] = res.peers || []\n    peers.sort((a: WalletPeer, b: WalletPeer) : number => {\n      return a.source - b.source\n    })\n\n    const defaultText = intl.prep(intl.ID_DEFAULT)\n    const addedText = intl.prep(intl.ID_ADDED)\n    const discoveredText = intl.prep(intl.ID_DISCOVERED)\n\n    peers.forEach((peer: WalletPeer) => {\n      const row = page.peerTableRow.cloneNode(true) as PageElement\n      const tmpl = Doc.parseTemplate(row)\n\n      tmpl.addr.textContent = peer.addr\n\n      switch (peer.source) {\n        case PeerSource.WalletDefault:\n          tmpl.source.textContent = defaultText\n          break\n        case PeerSource.UserAdded:\n          tmpl.source.textContent = addedText\n          break\n        case PeerSource.Discovered:\n          tmpl.source.textContent = discoveredText\n          break\n      }\n\n      let connectionIcon\n      if (peer.connected) {\n        connectionIcon = this.page.connectedIconTmpl.cloneNode(true)\n      } else {\n        connectionIcon = this.page.disconnectedIconTmpl.cloneNode(true)\n      }\n      tmpl.connected.appendChild(connectionIcon)\n\n      if (peer.source === PeerSource.UserAdded) {\n        const removeIcon = this.page.removeIconTmpl.cloneNode(true)\n        Doc.bind(removeIcon, 'click', async () => {\n          Doc.hide(page.managePeersErr)\n          const res = await postJSON('/api/removewalletpeer', {\n            assetID: this.selectedAssetID,\n            addr: peer.addr\n          })\n          if (!app().checkResponse(res)) {\n            page.managePeersErr.textContent = res.msg\n            Doc.show(page.managePeersErr)\n            return\n          }\n          this.spinUntilPeersUpdate()\n        })\n        tmpl.remove.appendChild(removeIcon)\n      }\n\n      page.peersTableBody.appendChild(row)\n    })\n  }\n\n  // showManagePeersForm displays the manage peers form.\n  async showManagePeersForm () {\n    const page = this.page\n    await this.updateWalletPeersTable()\n    Doc.hide(page.managePeersErr)\n    this.showForm(page.managePeersForm)\n  }\n\n  // submitAddPeers sends a request for the the wallet to connect to a new\n  // peer.\n  async submitAddPeer () {\n    const page = this.page\n    Doc.hide(page.managePeersErr)\n    const res = await postJSON('/api/addwalletpeer', {\n      assetID: this.selectedAssetID,\n      addr: page.addPeerInput.value\n    })\n    if (!app().checkResponse(res)) {\n      page.managePeersErr.textContent = res.msg\n      Doc.show(page.managePeersErr)\n      return\n    }\n    this.spinUntilPeersUpdate()\n    page.addPeerInput.value = ''\n  }\n\n  /*\n   * spinUntilPeersUpdate will show the spinner on the manage peers fork.\n   * If it is still showing after 10 seconds, the peers table will be updated\n   * instead of waiting for a notification.\n   */\n  async spinUntilPeersUpdate () {\n    const page = this.page\n    Doc.show(page.peerSpinner)\n    setTimeout(() => {\n      if (Doc.isDisplayed(page.peerSpinner)) {\n        this.updateWalletPeersTable()\n      }\n    }, 10000)\n  }\n\n  /*\n   * showToggleWalletStatus displays the toggleWalletStatusConfirm form with\n   * relevant help message.\n   */\n  showToggleWalletStatus (disable: boolean) {\n    const page = this.page\n    Doc.hide(page.toggleWalletStatusErr, page.walletStatusDisable, page.disableWalletMsg, page.walletStatusEnable, page.enableWalletMsg)\n    if (disable) Doc.show(page.walletStatusDisable, page.disableWalletMsg)\n    else Doc.show(page.walletStatusEnable, page.enableWalletMsg)\n    this.showForm(page.toggleWalletStatusConfirm)\n  }\n\n  /*\n   * toggleWalletStatus toggles a wallets status to either disabled or enabled.\n   */\n  async toggleWalletStatus () {\n    const page = this.page\n    Doc.hide(page.toggleWalletStatusErr)\n\n    const asset = app().assets[this.selectedAssetID]\n    const disable = !asset.wallet.disabled\n    const url = '/api/togglewalletstatus'\n    const req = {\n      assetID: this.selectedAssetID,\n      disable: disable\n    }\n\n    const fmtParams = { assetName: asset.name }\n    const loaded = app().loading(page.toggleWalletStatusConfirm)\n    const res = await postJSON(url, req)\n    loaded()\n    if (!app().checkResponse(res)) {\n      if (res.code === Errors.activeOrdersErr) page.toggleWalletStatusErr.textContent = intl.prep(intl.ID_ACTIVE_ORDERS_ERR_MSG, fmtParams)\n      else page.toggleWalletStatusErr.textContent = res.msg\n      Doc.show(page.toggleWalletStatusErr)\n      return\n    }\n\n    let successMsg = intl.prep(intl.ID_WALLET_DISABLED_MSG, fmtParams)\n    if (!disable) successMsg = intl.prep(intl.ID_WALLET_ENABLED_MSG, fmtParams)\n    this.assetUpdated(this.selectedAssetID, page.toggleWalletStatusConfirm, successMsg)\n  }\n\n  /*\n   * showBox shows the box with a fade-in animation.\n   */\n  async showBox (box: HTMLElement, focuser?: PageElement) {\n    box.style.opacity = '0'\n    Doc.show(box)\n    if (focuser) focuser.focus()\n    await Doc.animate(animationLength, progress => {\n      box.style.opacity = `${progress}`\n    }, 'easeOut')\n    box.style.opacity = '1'\n    this.displayed = box\n  }\n\n  /* showForm shows a modal form with a little animation. */\n  async showForm (form: PageElement) {\n    const page = this.page\n    this.currentForm = form\n    this.forms.forEach(form => Doc.hide(form))\n    form.style.right = '10000px'\n    Doc.show(page.forms, form)\n    const shift = (page.forms.offsetWidth + form.offsetWidth) / 2\n    await Doc.animate(animationLength, progress => {\n      form.style.right = `${(1 - progress) * shift}px`\n    }, 'easeOutHard')\n    form.style.right = '0'\n  }\n\n  async showSuccess (msg: string) {\n    const page = this.page\n    page.successMessage.textContent = msg\n    this.currentForm = page.checkmarkForm\n    this.forms.forEach(form => Doc.hide(form))\n    Doc.show(page.forms, page.checkmarkForm)\n    page.checkmarkForm.style.right = '0'\n    page.checkmark.style.fontSize = '0px'\n\n    const [startR, startG, startB] = State.isDark() ? [223, 226, 225] : [51, 51, 51]\n    const [endR, endG, endB] = [16, 163, 16]\n    const [diffR, diffG, diffB] = [endR - startR, endG - startG, endB - startB]\n\n    this.animation = new Animation(1200, (prog: number) => {\n      page.checkmark.style.fontSize = `${prog * 80}px`\n      page.checkmark.style.color = `rgb(${startR + prog * diffR}, ${startG + prog * diffG}, ${startB + prog * diffB})`\n    }, 'easeOutElastic', () => {\n      this.animation = new Animation(1500, () => { /* pass */ }, '', () => {\n        if (this.currentForm === page.checkmarkForm) this.closePopups()\n      })\n    })\n  }\n\n  /* Show the new wallet form. */\n  async showNewWallet (assetID: number) {\n    const page = this.page\n    const box = page.newWalletForm\n    this.newWalletForm.setAsset(assetID)\n    const defaultsLoaded = this.newWalletForm.loadDefaults()\n    await this.showForm(box)\n    await defaultsLoaded\n  }\n\n  // sortAssetButtons displays supported assets, sorted. Returns first asset in the\n  // list.\n  sortAssetButtons (): SupportedAsset {\n    const page = this.page\n    this.assetButtons = {}\n    Doc.empty(page.assetSelect)\n    const sortedAssets = [...Object.values(app().assets)]\n    sortedAssets.sort((a: SupportedAsset, b: SupportedAsset) => {\n      if (a.wallet && !b.wallet) return -1\n      if (!a.wallet && b.wallet) return 1\n      return a.symbol.localeCompare(b.symbol)\n    })\n    for (const a of sortedAssets) {\n      const bttn = page.iconSelectTmpl.cloneNode(true) as HTMLElement\n      page.assetSelect.appendChild(bttn)\n      const tmpl = Doc.parseTemplate(bttn)\n      this.assetButtons[a.id] = { tmpl, bttn }\n      this.updateAssetButton(a.id)\n      Doc.bind(bttn, 'click', () => {\n        this.setSelectedAsset(a.id)\n        State.storeLocal(State.selectedAssetLK, String(a.id))\n      })\n    }\n    page.assetSelect.classList.remove('invisible')\n    return sortedAssets[0]\n  }\n\n  updateAssetButton (assetID: number) {\n    const a = app().assets[assetID]\n    const { bttn, tmpl } = this.assetButtons[assetID]\n    Doc.hide(tmpl.fiat, tmpl.noWallet)\n    bttn.classList.add('nowallet')\n    tmpl.img.src ||= Doc.logoPath(a.symbol) // don't initiate GET if already set (e.g. update on some notification)\n    tmpl.name.textContent = a.name\n    if (a.wallet) {\n      bttn.classList.remove('nowallet')\n      const { wallet: { balance: b }, unitInfo: ui } = a\n      const totalBalance = b.available + b.locked + b.immature\n      tmpl.balance.textContent = Doc.formatCoinValue(totalBalance, ui)\n      const rate = app().fiatRatesMap[a.id]\n      if (rate) {\n        Doc.show(tmpl.fiat)\n        tmpl.fiat.textContent = Doc.formatFiatConversion(totalBalance, rate, ui)\n      }\n    } else Doc.show(tmpl.noWallet)\n  }\n\n  setSelectedAsset (assetID: number) {\n    const { assetSelect } = this.page\n    for (const b of assetSelect.children) b.classList.remove('selected')\n    this.assetButtons[assetID].bttn.classList.add('selected')\n    this.selectedAssetID = assetID\n    this.updateDisplayedAsset(assetID)\n    this.showAvailableMarkets(assetID)\n    this.showRecentActivity(assetID)\n  }\n\n  updateDisplayedAsset (assetID: number) {\n    if (assetID !== this.selectedAssetID) return\n    const { symbol, wallet, name } = app().assets[assetID]\n    const page = this.page\n    for (const el of document.querySelectorAll('[data-asset-name]')) el.textContent = name\n    page.assetLogo.src = Doc.logoPath(symbol)\n    Doc.hide(\n      page.balanceBox, page.fiatBalanceBox, page.createWalletBox, page.walletDetails,\n      page.sendReceive, page.connectBttnBox, page.statusLocked, page.statusReady,\n      page.statusOff, page.unlockBttnBox, page.lockBttnBox, page.connectBttnBox,\n      page.peerCountBox, page.syncProgressBox, page.statusDisabled\n    )\n    if (wallet) {\n      this.updateDisplayedAssetBalance()\n\n      const walletDef = app().walletDefinition(assetID, wallet.type)\n      page.walletType.textContent = walletDef.tab\n      const configurable = assetIsConfigurable(assetID)\n      Doc.setVis(configurable, page.passwordWrapper)\n\n      if (wallet.disabled) Doc.show(page.statusDisabled) // wallet is disabled\n      else if (wallet.running) {\n        Doc.show(page.sendReceive, page.peerCountBox, page.syncProgressBox)\n        page.peerCount.textContent = String(wallet.peerCount)\n        page.syncProgress.textContent = `${(wallet.syncProgress * 100).toFixed(1)}%`\n        if (wallet.open) {\n          Doc.show(page.statusReady)\n          if (!app().haveActiveOrders(assetID) && wallet.encrypted) Doc.show(page.lockBttnBox)\n        } else Doc.show(page.statusLocked, page.unlockBttnBox) // wallet not unlocked\n      } else Doc.show(page.statusOff, page.connectBttnBox) // wallet not running\n    } else Doc.show(page.createWalletBox) // no wallet\n\n    page.walletDetailsBox.classList.remove('invisible')\n  }\n\n  updateDisplayedAssetBalance (): void {\n    const page = this.page\n    const { wallet, unitInfo: ui, symbol, id: assetID } = app().assets[this.selectedAssetID]\n    const bal = wallet.balance\n    Doc.show(page.balanceBox, page.walletDetails)\n    const totalLocked = bal.locked + bal.contractlocked + bal.bondlocked\n    const totalBalance = bal.available + totalLocked + bal.immature\n    page.balance.textContent = Doc.formatCoinValue(totalBalance, ui)\n    Doc.empty(page.balanceUnit)\n    page.balanceUnit.appendChild(Doc.symbolize(symbol))\n    const rate = app().fiatRatesMap[assetID]\n    if (rate) {\n      Doc.show(page.fiatBalanceBox)\n      page.fiatBalance.textContent = Doc.formatFiatConversion(totalBalance, rate, ui)\n    }\n    let firstOther = false\n    Doc.empty(page.balanceDetailBox)\n    const addSubBalance = (category: string, subBalance: number) => {\n      const row = page.balanceDetailRow.cloneNode(true) as PageElement\n      if (firstOther) {\n        row.classList.add('first-other')\n        firstOther = false\n      }\n      page.balanceDetailBox.appendChild(row)\n      const tmpl = Doc.parseTemplate(row)\n      tmpl.category.textContent = category\n      tmpl.subBalance.textContent = Doc.formatCoinValue(subBalance, ui)\n    }\n    addSubBalance('Available', bal.available)\n    addSubBalance('Locked', totalLocked)\n    addSubBalance('Immature', bal.immature)\n    const sortedCats = Object.entries(bal.other || {})\n    sortedCats.sort((a: [string, number], b: [string, number]): number => a[0].localeCompare(b[0]))\n    firstOther = true\n    if (bal.contractlocked > 0) addSubBalance('Swapping (locked)', bal.contractlocked)\n    if (bal.bondlocked > 0) addSubBalance('Bonded (locked)', bal.bondlocked)\n    for (const [cat, sub] of sortedCats) addSubBalance(cat, sub)\n  }\n\n  showAvailableMarkets (assetID: number) {\n    const page = this.page\n    const exchanges = app().user.exchanges\n    const markets: [string, Market][] = []\n    for (const xc of Object.values(exchanges)) {\n      if (!xc.markets) continue\n      for (const mkt of Object.values(xc.markets)) {\n        if (mkt.baseid === assetID || mkt.quoteid === assetID) markets.push([xc.host, mkt])\n      }\n    }\n\n    const spotVolume = (assetID: number, mkt: Market): number => {\n      const spot = mkt.spot\n      if (!spot) return 0\n      const conversionFactor = app().unitInfo(assetID).conventional.conversionFactor\n      const volume = assetID === mkt.baseid ? spot.vol24 : spot.vol24 * spot.rate / OrderUtil.RateEncodingFactor\n      return volume / conversionFactor\n    }\n\n    markets.sort((a: [string, Market], b: [string, Market]): number => {\n      const [hostA, mktA] = a\n      const [hostB, mktB] = b\n      if (!mktA.spot && !mktB.spot) return hostA.localeCompare(hostB)\n      return spotVolume(assetID, mktB) - spotVolume(assetID, mktA)\n    })\n    Doc.empty(page.availableMarkets)\n\n    for (const [host, mkt] of markets) {\n      const { spot, baseid, basesymbol, quoteid, quotesymbol } = mkt\n      const row = page.marketRow.cloneNode(true) as PageElement\n      page.availableMarkets.appendChild(row)\n      const tmpl = Doc.parseTemplate(row)\n      tmpl.host.textContent = host\n      tmpl.baseLogo.src = Doc.logoPath(basesymbol)\n      tmpl.quoteLogo.src = Doc.logoPath(quotesymbol)\n      Doc.empty(tmpl.baseSymbol, tmpl.quoteSymbol)\n      tmpl.baseSymbol.appendChild(Doc.symbolize(basesymbol))\n      tmpl.quoteSymbol.appendChild(Doc.symbolize(quotesymbol))\n\n      if (spot) {\n        const convRate = app().conventionalRate(baseid, quoteid, spot.rate, exchanges[host])\n        tmpl.price.textContent = fourSigFigs(convRate)\n        tmpl.priceQuoteUnit.textContent = quotesymbol.toUpperCase()\n        tmpl.priceBaseUnit.textContent = basesymbol.toUpperCase()\n        tmpl.volume.textContent = fourSigFigs(spotVolume(assetID, mkt))\n        tmpl.volumeUnit.textContent = assetID === baseid ? basesymbol.toUpperCase() : quotesymbol.toUpperCase()\n      } else Doc.hide(tmpl.priceBox, tmpl.volumeBox)\n      Doc.bind(row, 'click', () => app().loadPage('markets', { host, base: baseid, quote: quoteid }))\n    }\n    page.marketsOverviewBox.classList.remove('invisible')\n  }\n\n  async showRecentActivity (assetID: number) {\n    const page = this.page\n    const loaded = app().loading(page.orderActivityBox)\n    const filter: OrderFilter = {\n      n: 20,\n      assets: [assetID],\n      hosts: [],\n      statuses: []\n    }\n    const res = await postJSON('/api/orders', filter)\n    loaded()\n    Doc.hide(page.noActivity, page.orderActivity)\n    if (!res.orders || res.orders.length === 0) {\n      Doc.show(page.noActivity)\n      page.orderActivityBox.classList.remove('invisible')\n      return\n    }\n    Doc.show(page.orderActivity)\n    Doc.empty(page.recentOrders)\n    for (const ord of (res.orders as Order[])) {\n      const row = page.recentOrderTmpl.cloneNode(true) as PageElement\n      page.recentOrders.appendChild(row)\n      const tmpl = Doc.parseTemplate(row)\n      let from: string, to: string\n      const [baseUnitInfo, quoteUnitInfo] = [app().unitInfo(ord.baseID), app().unitInfo(ord.quoteID)]\n      if (ord.sell) {\n        [from, to] = [ord.baseSymbol, ord.quoteSymbol]\n        tmpl.fromQty.textContent = Doc.formatCoinValue(ord.qty, baseUnitInfo)\n        if (ord.type === OrderUtil.Limit) {\n          tmpl.toQty.textContent = Doc.formatCoinValue(ord.qty / OrderUtil.RateEncodingFactor * ord.rate, quoteUnitInfo)\n        }\n      } else {\n        [from, to] = [ord.quoteSymbol, ord.baseSymbol]\n        if (ord.type === OrderUtil.Market) {\n          tmpl.fromQty.textContent = Doc.formatCoinValue(ord.qty, baseUnitInfo)\n        } else {\n          tmpl.fromQty.textContent = Doc.formatCoinValue(ord.qty / OrderUtil.RateEncodingFactor * ord.rate, quoteUnitInfo)\n          tmpl.toQty.textContent = Doc.formatCoinValue(ord.qty, baseUnitInfo)\n        }\n      }\n\n      tmpl.fromLogo.src = Doc.logoPath(from)\n      Doc.empty(tmpl.fromSymbol, tmpl.toSymbol)\n      tmpl.fromSymbol.appendChild(Doc.symbolize(from))\n      tmpl.toLogo.src = Doc.logoPath(to)\n      tmpl.toSymbol.appendChild(Doc.symbolize(to))\n      tmpl.status.textContent = OrderUtil.statusString(ord)\n      tmpl.filled.textContent = `${(OrderUtil.filled(ord) / ord.qty * 100).toFixed(1)}%`\n      tmpl.age.textContent = Doc.timeSince(ord.submitTime)\n      tmpl.link.href = `order/${ord.id}`\n      app().bindInternalNavigation(row)\n    }\n    page.orderActivityBox.classList.remove('invisible')\n  }\n\n  async rescanWallet (assetID: number) {\n    const page = this.page\n    Doc.hide(page.reconfigErr)\n\n    const url = '/api/rescanwallet'\n    const req = { assetID: assetID }\n\n    const loaded = app().loading(this.body)\n    const res = await postJSON(url, req)\n    loaded()\n    if (res.code === Errors.activeOrdersErr) {\n      this.forceUrl = url\n      this.forceReq = req\n      this.showConfirmForce()\n      return\n    }\n    if (!app().checkResponse(res)) {\n      Doc.showFormError(page.reconfigErr, res.msg)\n      return\n    }\n    this.assetUpdated(assetID, page.reconfigForm, intl.prep(intl.ID_RESCAN_STARTED))\n  }\n\n  showConfirmForce () {\n    Doc.hide(this.page.confirmForceErr)\n    this.showForm(this.page.confirmForce)\n  }\n\n  showRecoverWallet () {\n    Doc.hide(this.page.recoverWalletErr)\n    this.showForm(this.page.recoverWalletConfirm)\n  }\n\n  /* Show the open wallet form if the password is not cached, and otherwise\n   * attempt to open the wallet.\n   */\n  async openWallet (assetID: number) {\n    if (!State.passwordIsCached()) {\n      this.showOpen(assetID)\n    } else {\n      const open = {\n        assetID: assetID\n      }\n      const res = await postJSON('/api/openwallet', open)\n      if (app().checkResponse(res)) {\n        this.openWalletSuccess(assetID)\n      } else {\n        this.showOpen(assetID, intl.prep(intl.ID_OPEN_WALLET_ERR_MSG, { msg: res.msg }))\n      }\n    }\n  }\n\n  /* Show the form used to unlock a wallet. */\n  async showOpen (assetID: number, errorMsg?: string) {\n    const page = this.page\n    // await this.hideBox()\n    this.unlockForm.refresh(app().assets[assetID])\n    if (errorMsg) this.unlockForm.showErrorOnly(errorMsg)\n    this.showForm(page.unlockWalletForm)\n  }\n\n  /* Show the form used to change wallet configuration settings. */\n  async showReconfig (assetID: number, skipAnimation?: boolean) {\n    const page = this.page\n    Doc.hide(\n      page.changeWalletType, page.changeTypeHideIcon, page.reconfigErr,\n      page.showChangeType, page.changeTypeHideIcon, page.reconfigErr,\n      page.enableWallet, page.disableWallet\n    )\n    // Hide update password section by default\n    this.changeWalletPW = false\n    this.setPWSettingViz(this.changeWalletPW)\n    const asset = app().assets[assetID]\n\n    const currentDef = app().currentWalletDefinition(assetID)\n    const walletDefs = asset.token ? [asset.token.definition] : asset.info ? asset.info.availablewallets : []\n    const disableWalletType = app().user.extensionModeConfig?.restrictedWallets[baseChainSymbol(assetID)]?.disableWalletType\n    if (walletDefs.length > 1 && !disableWalletType) {\n      Doc.empty(page.changeWalletTypeSelect)\n      Doc.show(page.showChangeType, page.changeTypeShowIcon)\n      page.changeTypeMsg.textContent = intl.prep(intl.ID_CHANGE_WALLET_TYPE)\n      for (const wDef of walletDefs) {\n        const option = document.createElement('option') as HTMLOptionElement\n        if (wDef.type === currentDef.type) option.selected = true\n        option.value = option.textContent = wDef.type\n        page.changeWalletTypeSelect.appendChild(option)\n      }\n    }\n\n    const wallet = app().walletMap[assetID]\n    Doc.setVis(wallet.traits & traitLogFiler, page.downloadLogs)\n    Doc.setVis(wallet.traits & traitRecoverer, page.recoverWallet)\n    Doc.setVis(wallet.traits & traitRestorer, page.exportWallet)\n    Doc.setVis(wallet.traits & traitRescanner, page.rescanWallet)\n    Doc.setVis(wallet.traits & traitPeerManager, page.managePeers)\n\n    Doc.setVis(wallet.traits & traitsExtraOpts, page.otherActionsLabel)\n\n    if (wallet.disabled) Doc.show(page.enableWallet)\n    else Doc.show(page.disableWallet)\n\n    page.recfgAssetLogo.src = Doc.logoPath(asset.symbol)\n    page.recfgAssetName.textContent = asset.name\n    if (!skipAnimation) this.showForm(page.reconfigForm)\n    const loaded = app().loading(page.reconfigForm)\n    const res = await postJSON('/api/walletsettings', { assetID })\n    loaded()\n    if (!app().checkResponse(res)) {\n      Doc.showFormError(page.reconfigErr, res.msg)\n      return\n    }\n    const assetHasActiveOrders = app().haveActiveOrders(assetID)\n    this.reconfigForm.update(asset.id, currentDef.configopts || [], assetHasActiveOrders)\n    this.setGuideLink(currentDef.guidelink)\n    this.reconfigForm.setConfig(res.map)\n    this.updateDisplayedReconfigFields(currentDef)\n  }\n\n  changeWalletType () {\n    const page = this.page\n    const walletType = page.changeWalletTypeSelect.value || ''\n    const walletDef = app().walletDefinition(this.selectedAssetID, walletType)\n    this.reconfigForm.update(this.selectedAssetID, walletDef.configopts || [], false)\n    this.setGuideLink(walletDef.guidelink)\n    this.updateDisplayedReconfigFields(walletDef)\n  }\n\n  setGuideLink (guideLink: string) {\n    Doc.hide(this.walletCfgGuide)\n    if (guideLink !== '') {\n      this.walletCfgGuide.href = guideLink\n      Doc.show(this.walletCfgGuide)\n    }\n  }\n\n  updateDisplayedReconfigFields (walletDef: WalletDefinition) {\n    const disablePassword = app().user.extensionModeConfig?.restrictedWallets[baseChainSymbol(this.selectedAssetID)]?.disablePassword\n    if (walletDef.seeded || walletDef.type === 'token' || disablePassword) {\n      Doc.hide(this.page.showChangePW, this.reconfigForm.fileSelector)\n      this.changeWalletPW = false\n      this.setPWSettingViz(false)\n    } else Doc.show(this.page.showChangePW, this.reconfigForm.fileSelector)\n  }\n\n  /* Display a deposit address. */\n  async showDeposit (assetID: number) {\n    this.depositAddrForm.setAsset(assetID)\n    this.showForm(this.page.deposit)\n  }\n\n  /* Show the form to either send or withdraw funds. */\n  async showSendForm (assetID: number) {\n    const page = this.page\n    const box = page.sendForm\n    const { wallet, name, unitInfo: ui, symbol, token } = app().assets[assetID]\n    Doc.hide(page.toggleSubtract)\n    page.subtractCheckBox.checked = false\n\n    const isWithdrawer = (wallet.traits & traitWithdrawer) !== 0\n    if (isWithdrawer) {\n      Doc.show(page.toggleSubtract)\n    }\n\n    Doc.hide(page.validAddr, page.sendErr, page.maxSendDisplay)\n    page.sendAddr.classList.remove('invalid')\n    page.sendAddr.value = ''\n    page.sendAmt.value = ''\n    this.showFiatValue(assetID, 0, page.sendValue)\n    page.walletBal.textContent = Doc.formatFullPrecision(wallet.balance.available, ui)\n    page.sendLogo.src = Doc.logoPath(symbol)\n    page.sendName.textContent = name\n    // page.sendFee.textContent = wallet.feerate\n    // page.sendUnit.textContent = wallet.units\n\n    if (wallet.balance.available > 0 && (wallet.traits & traitTxFeeEstimator) !== 0) {\n      const feeReq = {\n        assetID: assetID,\n        subtract: isWithdrawer,\n        value: wallet.balance.available\n      }\n\n      const loaded = app().loading(this.body)\n      const res = await postJSON('/api/txfee', feeReq)\n      loaded()\n      if (app().checkResponse(res)) {\n        let canSend = wallet.balance.available\n        if (!token) {\n          canSend -= res.txfee\n          if (canSend < 0) canSend = 0\n        }\n        this.maxSend = canSend\n        page.maxSend.textContent = Doc.formatFullPrecision(canSend, ui)\n        this.showFiatValue(assetID, canSend, page.maxSendFiat)\n        if (token) {\n          const { unitInfo: feeUI, symbol: feeSymbol } = app().assets[token.parentID]\n          page.maxSendFee.textContent = Doc.formatFullPrecision(res.txfee, feeUI) + ' ' + feeSymbol\n          this.showFiatValue(token.parentID, res.txfee, page.maxSendFeeFiat)\n        } else {\n          page.maxSendFee.textContent = Doc.formatFullPrecision(res.txfee, ui)\n          this.showFiatValue(assetID, res.txfee, page.maxSendFeeFiat)\n        }\n        Doc.show(page.maxSendDisplay)\n      }\n    }\n\n    this.showFiatValue(assetID, 0, page.sendValue)\n    page.walletBal.textContent = Doc.formatFullPrecision(wallet.balance.available, ui)\n    page.sendLogo.src = Doc.logoPath(wallet.symbol)\n    page.sendName.textContent = name\n    box.dataset.assetID = String(assetID)\n    this.showForm(box)\n  }\n\n  /* doConnect connects to a wallet via the connectwallet API route. */\n  async doConnect (assetID: number) {\n    const loaded = app().loading(this.body)\n    const res = await postJSON('/api/connectwallet', { assetID })\n    loaded()\n    if (!app().checkResponse(res)) {\n      const { symbol } = app().assets[assetID]\n      const page = this.page\n      page.errorModalMsg.textContent = intl.prep(intl.ID_CONNECT_WALLET_ERR_MSG, { assetName: symbol, errMsg: res.msg })\n      this.showForm(page.errorModal)\n    }\n    this.updateDisplayedAsset(assetID)\n  }\n\n  /* openWalletSuccess is the success callback for wallet unlocking. */\n  async openWalletSuccess (assetID: number, form?: PageElement) {\n    this.assetUpdated(assetID, form, intl.prep(intl.ID_WALLET_UNLOCKED))\n  }\n\n  assetUpdated (assetID: number, oldForm?: PageElement, successMsg?: string) {\n    if (assetID !== this.selectedAssetID) return\n    this.updateDisplayedAsset(assetID)\n    if (oldForm && Object.is(this.currentForm, oldForm)) {\n      if (successMsg) this.showSuccess(successMsg)\n      else this.closePopups()\n    }\n  }\n\n  /* populateMaxSend populates the amount field with the max amount the wallet\n     can send. The max send amount can be the maximum amount based on our\n     pre-estimation or the asset's wallet balance.\n  */\n  async populateMaxSend () {\n    const page = this.page\n    const asset = app().assets[this.selectedAssetID]\n    if (!asset) return\n    // Populate send amount with max send value and ensure we don't check\n    // subtract checkbox for assets that don't have a withdraw method.\n    if ((asset.wallet.traits & traitWithdrawer) === 0) {\n      page.sendAmt.value = String(this.maxSend / asset.unitInfo.conventional.conversionFactor)\n      this.showFiatValue(asset.id, this.maxSend, page.sendValue)\n      page.subtractCheckBox.checked = false\n    } else {\n      const amt = asset.wallet.balance.available\n      page.sendAmt.value = String(amt / asset.unitInfo.conventional.conversionFactor)\n      this.showFiatValue(asset.id, amt, page.sendValue)\n      page.subtractCheckBox.checked = true\n    }\n  }\n\n  /* send submits the send form to the API. */\n  async send (): Promise<void> {\n    const page = this.page\n    const assetID = parseInt(page.sendForm.dataset.assetID ?? '')\n    const subtract = page.subtractCheckBox.checked ?? false\n    const conversionFactor = app().unitInfo(assetID).conventional.conversionFactor\n    const pw = page.vSendPw.value || ''\n    page.vSendPw.value = ''\n    if (pw === '') {\n      Doc.showFormError(page.vSendErr, intl.prep(intl.ID_NO_PASS_ERROR_MSG))\n      return\n    }\n    const open = {\n      assetID: assetID,\n      address: page.sendAddr.value,\n      subtract: subtract,\n      value: Math.round(parseFloat(page.sendAmt.value ?? '') * conversionFactor),\n      pw: pw\n    }\n    const loaded = app().loading(page.vSendForm)\n    const res = await postJSON('/api/send', open)\n    loaded()\n    if (!app().checkResponse(res)) {\n      Doc.showFormError(page.vSendErr, res.msg)\n      return\n    }\n    const name = app().assets[assetID].name\n    this.assetUpdated(assetID, page.vSendForm, intl.prep(intl.ID_SEND_SUCCESS, { assetName: name }))\n  }\n\n  /* update wallet configuration */\n  async reconfig (): Promise<void> {\n    const page = this.page\n    const assetID = this.selectedAssetID\n    Doc.hide(page.reconfigErr)\n    if (!page.appPW.value && !State.passwordIsCached()) {\n      Doc.showFormError(page.reconfigErr, intl.prep(intl.ID_NO_APP_PASS_ERROR_MSG))\n      return\n    }\n\n    let walletType = app().currentWalletDefinition(assetID).type\n    if (!Doc.isHidden(page.changeWalletType)) {\n      walletType = page.changeWalletTypeSelect.value || ''\n    }\n\n    const loaded = app().loading(page.reconfigForm)\n    const req: ReconfigRequest = {\n      assetID: assetID,\n      config: this.reconfigForm.map(assetID),\n      appPW: page.appPW.value ?? '',\n      walletType: walletType\n    }\n    if (this.changeWalletPW) req.newWalletPW = page.newPW.value\n    const res = await postJSON('/api/reconfigurewallet', req)\n    page.appPW.value = ''\n    page.newPW.value = ''\n    loaded()\n    if (!app().checkResponse(res)) {\n      Doc.showFormError(page.reconfigErr, res.msg)\n      return\n    }\n    this.assetUpdated(assetID, page.reconfigForm, intl.prep(intl.ID_RECONFIG_SUCCESS))\n  }\n\n  /* lock instructs the API to lock the wallet. */\n  async lock (assetID: number): Promise<void> {\n    const page = this.page\n    const loaded = app().loading(page.newWalletForm)\n    const res = await postJSON('/api/closewallet', { assetID: assetID })\n    loaded()\n    if (!app().checkResponse(res)) return\n    this.updateDisplayedAsset(assetID)\n  }\n\n  async downloadLogs (): Promise<void> {\n    const search = new URLSearchParams('')\n    search.append('assetid', `${this.selectedAssetID}`)\n    const url = new URL(window.location.href)\n    url.search = search.toString()\n    url.pathname = '/wallets/logfile'\n    window.open(url.toString())\n  }\n\n  // displayExportWalletAuth displays a form to warn the user about the\n  // dangers of exporting a wallet, and asks them to enter their password.\n  async displayExportWalletAuth (): Promise<void> {\n    const page = this.page\n    Doc.hide(page.exportWalletErr)\n    page.exportWalletPW.value = ''\n    this.showForm(page.exportWalletAuth)\n  }\n\n  // exportWalletAuthSubmit is called after the user enters their password to\n  // authorize looking up the information to restore their wallet in an\n  // external wallet.\n  async exportWalletAuthSubmit (): Promise<void> {\n    const page = this.page\n    const req = {\n      assetID: this.selectedAssetID,\n      pass: page.exportWalletPW.value\n    }\n    const url = '/api/restorewalletinfo'\n    const loaded = app().loading(page.forms)\n    const res = await postJSON(url, req)\n    loaded()\n    if (app().checkResponse(res)) {\n      page.exportWalletPW.value = ''\n      this.displayRestoreWalletInfo(res.restorationinfo)\n    } else {\n      Doc.showFormError(page.exportWalletErr, res.msg)\n    }\n  }\n\n  // displayRestoreWalletInfo displays the information needed to restore a\n  // wallet in external wallets.\n  async displayRestoreWalletInfo (info: WalletRestoration[]): Promise<void> {\n    const page = this.page\n    Doc.empty(page.restoreInfoCardsList)\n    for (const wr of info) {\n      const card = this.restoreInfoCard.cloneNode(true) as HTMLElement\n      const tmpl = Doc.parseTemplate(card)\n      tmpl.name.textContent = wr.target\n      tmpl.seed.textContent = wr.seed\n      tmpl.seedName.textContent = `${wr.seedName}:`\n      tmpl.instructions.textContent = wr.instructions\n      page.restoreInfoCardsList.appendChild(card)\n    }\n    this.showForm(page.restoreWalletInfo)\n  }\n\n  async recoverWallet (): Promise<void> {\n    const page = this.page\n    Doc.hide(page.recoverWalletErr)\n    const req = {\n      assetID: this.selectedAssetID,\n      appPW: page.recoverWalletPW.value\n    }\n    page.recoverWalletPW.value = ''\n    const url = '/api/recoverwallet'\n    const loaded = app().loading(page.forms)\n    const res = await postJSON(url, req)\n    loaded()\n    if (res.code === Errors.activeOrdersErr) {\n      this.forceUrl = url\n      this.forceReq = req\n      this.showConfirmForce()\n    } else if (app().checkResponse(res)) {\n      this.closePopups()\n    } else {\n      Doc.showFormError(page.recoverWalletErr, res.msg)\n    }\n  }\n\n  /*\n   * confirmForceSubmit resubmits either the recover or rescan requests with\n   * force set to true. These two requests require force to be set to true if\n   * they are called while the wallet is managing active orders.\n   */\n  async confirmForceSubmit (): Promise<void> {\n    const page = this.page\n    this.forceReq.force = true\n    const loaded = app().loading(page.forms)\n    const res = await postJSON(this.forceUrl, this.forceReq)\n    loaded()\n    if (app().checkResponse(res)) this.closePopups()\n    else {\n      Doc.showFormError(page.confirmForceErr, res.msg)\n    }\n  }\n\n  /* handleBalance handles notifications updating a wallet's balance and assets'\n     value in default fiat rate.\n  . */\n  handleBalanceNote (note: BalanceNote): void {\n    this.updateAssetButton(note.assetID)\n    if (note.assetID === this.selectedAssetID) this.updateDisplayedAssetBalance()\n  }\n\n  /* handleRatesNote handles fiat rate notifications, updating the fiat value of\n   *  all supported assets.\n   */\n  handleRatesNote (note: RateNote): void {\n    this.updateAssetButton(this.selectedAssetID)\n    if (!note.fiatRates[this.selectedAssetID]) return\n    this.updateDisplayedAssetBalance()\n  }\n\n  // showFiatValue displays the fiat equivalent for the provided amount.\n  showFiatValue (assetID: number, amount: number, display: PageElement): void {\n    const rate = app().fiatRatesMap[assetID]\n    if (rate) {\n      display.textContent = Doc.formatFiatConversion(amount, rate, app().unitInfo(assetID))\n      Doc.show(display.parentElement as Element)\n    } else Doc.hide(display.parentElement as Element)\n  }\n\n  /*\n   * handleWalletStateNote is a handler for both the 'walletstate' and\n   * 'walletconfig' notifications.\n   */\n  handleWalletStateNote (note: WalletStateNote): void {\n    this.updateAssetButton(note.wallet.assetID)\n    this.assetUpdated(note.wallet.assetID)\n    if (note.topic === 'WalletPeersUpdate' &&\n        note.wallet.assetID === this.selectedAssetID &&\n        Doc.isDisplayed(this.page.managePeersForm)) {\n      this.updateWalletPeersTable()\n    }\n  }\n\n  /*\n   * handleCreateWalletNote is a handler for 'createwallet' notifications.\n   */\n  handleCreateWalletNote (note: WalletCreationNote) {\n    this.updateAssetButton(note.assetID)\n    this.assetUpdated(note.assetID)\n  }\n\n  /*\n   * unload is called by the Application when the user navigates away from\n   * the /wallets page.\n   */\n  unload (): void {\n    Doc.unbind(document, 'keyup', this.keyup)\n  }\n}\n\n/*\n * assetIsConfigurable indicates whether there are any user-configurable wallet\n * settings for the asset.\n */\nfunction assetIsConfigurable (assetID: number) {\n  const asset = app().assets[assetID]\n  if (asset.token) {\n    const opts = asset.token.definition.configopts\n    return opts && opts.length > 0\n  }\n  if (!asset.info) throw Error('this asset isn\\'t an asset, I guess')\n  const defs = asset.info.availablewallets\n  const zerothOpts = defs[0].configopts\n  return defs.length > 1 || (zerothOpts && zerothOpts.length > 0)\n}\n\nconst FourSigFigs = new Intl.NumberFormat((navigator.languages as string[]), {\n  maximumSignificantDigits: 4\n})\n\nconst OneFractionalDigit = new Intl.NumberFormat((navigator.languages as string[]), {\n  minimumFractionDigits: 1,\n  maximumFractionDigits: 1\n})\n\nfunction fourSigFigs (v: number) {\n  if (v >= 1000 || Math.round(v) === v) return OneFractionalDigit.format(v)\n  return FourSigFigs.format(v)\n}\n","import objectWithoutPropertiesLoose from \"./objectWithoutPropertiesLoose.js\";\nexport default function _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n  return target;\n}","export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}","import Doc from './doc'\nimport BasePage from './basepage'\nimport State from './state'\nimport { postJSON } from './http'\nimport * as forms from './forms'\nimport * as intl from './locales'\nimport {\n  app,\n  Exchange,\n  PageElement,\n  PasswordCache\n} from './registry'\n\nconst animationLength = 300\n\nexport default class SettingsPage extends BasePage {\n  body: HTMLElement\n  currentDEX: Exchange\n  page: Record<string, PageElement>\n  forms: PageElement[]\n  fiatRateSources: PageElement[]\n  regAssetForm: forms.FeeAssetSelectionForm\n  confirmRegisterForm: forms.ConfirmRegistrationForm\n  newWalletForm: forms.NewWalletForm\n  walletWaitForm: forms.WalletWaitForm\n  dexAddrForm: forms.DEXAddressForm\n  currentForm: PageElement\n  pwCache: PasswordCache\n  keyup: (e: KeyboardEvent) => void\n\n  constructor (body: HTMLElement) {\n    super()\n    this.body = body\n    const page = this.page = Doc.idDescendants(body)\n\n    this.forms = Doc.applySelector(page.forms, ':scope > form')\n    this.fiatRateSources = Doc.applySelector(page.fiatRateSources, 'input[type=checkbox]')\n\n    Doc.bind(page.darkMode, 'click', () => {\n      State.setCookie(State.darkModeCK, page.darkMode.checked || false ? '1' : '0')\n      if (page.darkMode.checked) {\n        document.body.classList.add('dark')\n      } else {\n        document.body.classList.remove('dark')\n      }\n    })\n\n    page.showPokes.checked = State.fetchLocal(State.popupsLK) === '1'\n    Doc.bind(page.showPokes, 'click', () => {\n      const show = page.showPokes.checked || false\n      State.storeLocal(State.popupsLK, show ? '1' : '0')\n      app().showPopups = show\n    })\n\n    page.commitHash.textContent = app().commitHash.substring(0, 7)\n    Doc.bind(page.addADex, 'click', () => {\n      this.dexAddrForm.refresh()\n      this.showForm(page.dexAddrForm)\n    })\n\n    this.fiatRateSources.forEach(src => {\n      Doc.bind(src, 'change', async () => {\n        const res = await postJSON('/api/toggleratesource', {\n          disable: !src.checked,\n          source: src.value\n        })\n        if (!app().checkResponse(res)) {\n          src.checked = !src.checked\n        }\n        // Update asset rate values and disable conversion status.\n        await app().fetchUser()\n      })\n    })\n\n    // Asset selection\n    this.regAssetForm = new forms.FeeAssetSelectionForm(page.regAssetForm, async (assetID: number) => {\n      this.confirmRegisterForm.setAsset(assetID)\n\n      const asset = app().assets[assetID]\n      const wallet = asset.wallet\n      if (wallet) {\n        const bondAsset = this.currentDEX.bondAssets[asset.symbol]\n        const bondsFeeBuffer = await this.getBondsFeeBuffer(assetID, page.regAssetForm)\n        if (wallet.synced && wallet.balance.available >= 2 * bondAsset.amount + bondsFeeBuffer) {\n          this.animateConfirmForm(page.regAssetForm)\n          return\n        }\n        this.walletWaitForm.setWallet(wallet, bondsFeeBuffer)\n        this.currentForm = page.walletWait\n        forms.slideSwap(page.regAssetForm, page.walletWait)\n        return\n      }\n\n      this.newWalletForm.setAsset(assetID)\n      this.currentForm = page.newWalletForm\n      forms.slideSwap(page.regAssetForm, page.newWalletForm)\n    })\n\n    // Approve fee payment\n    this.confirmRegisterForm = new forms.ConfirmRegistrationForm(page.confirmRegForm, () => {\n      this.registerDEXSuccess()\n    }, () => {\n      this.animateRegAsset(page.confirmRegForm)\n    }, this.pwCache)\n\n    // Create a new wallet\n    this.newWalletForm = new forms.NewWalletForm(\n      page.newWalletForm,\n      assetID => this.newWalletCreated(assetID),\n      this.pwCache,\n      () => this.animateRegAsset(page.newWalletForm)\n    )\n\n    this.walletWaitForm = new forms.WalletWaitForm(page.walletWait, () => {\n      this.animateConfirmForm(page.walletWait)\n    }, () => { this.animateRegAsset(page.walletWait) })\n\n    // Enter an address for a new DEX\n    this.dexAddrForm = new forms.DEXAddressForm(page.dexAddrForm, async (xc: Exchange, certFile: string) => {\n      this.currentDEX = xc\n      this.confirmRegisterForm.setExchange(xc, certFile)\n      this.walletWaitForm.setExchange(xc)\n      this.regAssetForm.setExchange(xc)\n      this.animateRegAsset(page.dexAddrForm)\n    })\n\n    Doc.bind(page.importAccount, 'click', () => this.prepareAccountImport(page.authorizeAccountImportForm))\n    forms.bind(page.authorizeAccountImportForm, page.authorizeImportAccountConfirm, () => this.importAccount())\n\n    Doc.bind(page.changeAppPW, 'click', () => this.showForm(page.changeAppPWForm))\n    forms.bind(page.changeAppPWForm, page.submitNewPW, () => this.changeAppPW())\n\n    Doc.bind(page.accountFile, 'change', () => this.onAccountFileChange())\n    Doc.bind(page.removeAccount, 'click', () => this.clearAccountFile())\n    Doc.bind(page.addAccount, 'click', () => page.accountFile.click())\n\n    Doc.bind(page.exportSeed, 'click', () => this.showForm(page.exportSeedAuth))\n    forms.bind(page.exportSeedAuth, page.exportSeedSubmit, () => this.submitExportSeedReq())\n\n    const closePopups = () => {\n      Doc.hide(page.forms)\n      page.exportSeedPW.value = ''\n      page.seedDiv.textContent = ''\n    }\n\n    Doc.bind(page.forms, 'mousedown', (e: MouseEvent) => {\n      if (!Doc.mouseInElement(e, this.currentForm)) { closePopups() }\n    })\n\n    this.keyup = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        closePopups()\n      }\n    }\n    Doc.bind(document, 'keyup', this.keyup)\n\n    page.forms.querySelectorAll('.form-closer').forEach(el => {\n      Doc.bind(el, 'click', () => { closePopups() })\n    })\n  }\n\n  // Retrieve an estimate for the tx fee needed to create new bond reserves.\n  async getBondsFeeBuffer (assetID: number, form: HTMLElement) {\n    const loaded = app().loading(form)\n    const res = await postJSON('/api/bondsfeebuffer', { assetID })\n    loaded()\n    if (!app().checkResponse(res)) {\n      return 0\n    }\n    return res.feeBuffer\n  }\n\n  async newWalletCreated (assetID: number) {\n    const user = await app().fetchUser()\n    if (!user) return\n    const page = this.page\n    const asset = user.assets[assetID]\n    const wallet = asset.wallet\n    const bondAmt = this.currentDEX.bondAssets[asset.symbol].amount\n\n    const bondsFeeBuffer = await this.getBondsFeeBuffer(assetID, page.newWalletForm)\n    if (wallet.synced && wallet.balance.available >= 2 * bondAmt + bondsFeeBuffer) {\n      await this.animateConfirmForm(page.newWalletForm)\n      return\n    }\n\n    this.walletWaitForm.setWallet(wallet, bondsFeeBuffer)\n    this.currentForm = page.walletWait\n    await forms.slideSwap(page.newWalletForm, page.walletWait)\n  }\n\n  async onAccountFileChange () {\n    const page = this.page\n    const files = page.accountFile.files\n    if (!files || !files.length) return\n    page.selectedAccount.textContent = files[0].name\n    Doc.show(page.removeAccount)\n    Doc.hide(page.addAccount)\n  }\n\n  /* clearAccountFile cleanup accountFile value and selectedAccount text */\n  clearAccountFile () {\n    const page = this.page\n    page.accountFile.value = ''\n    page.selectedAccount.textContent = intl.prep(intl.ID_NONE_SELECTED)\n    Doc.hide(page.removeAccount)\n    Doc.show(page.addAccount)\n  }\n\n  async prepareAccountImport (authorizeAccountImportForm: HTMLElement) {\n    const page = this.page\n    page.importAccountErr.textContent = ''\n    this.showForm(authorizeAccountImportForm)\n  }\n\n  // importAccount imports the account\n  async importAccount () {\n    const page = this.page\n    const pw = page.importAccountAppPass.value\n    page.importAccountAppPass.value = ''\n    let accountString = ''\n    if (page.accountFile.value) {\n      const files = page.accountFile.files\n      if (!files || !files.length) {\n        console.error('importAccount: no file specified')\n        return\n      }\n      accountString = await files[0].text()\n    }\n    let account\n    try {\n      account = JSON.parse(accountString)\n    } catch (e) {\n      page.importAccountErr.textContent = e.message\n      Doc.show(page.importAccountErr)\n      return\n    }\n    if (typeof account === 'undefined') {\n      page.importAccountErr.textContent = intl.prep(intl.ID_ACCT_UNDEFINED)\n      Doc.show(page.importAccountErr)\n      return\n    }\n    const { bonds = [], ...acctInf } = account\n    const req = {\n      pw: pw,\n      account: acctInf,\n      bonds: bonds\n    }\n    const loaded = app().loading(this.body)\n    const importResponse = await postJSON('/api/importaccount', req)\n    loaded()\n    if (!app().checkResponse(importResponse)) {\n      page.importAccountErr.textContent = importResponse.msg\n      Doc.show(page.importAccountErr)\n      return\n    }\n    await app().fetchUser()\n    Doc.hide(page.forms)\n    // Initial method of displaying imported account.\n    window.location.reload()\n  }\n\n  async submitExportSeedReq () {\n    const page = this.page\n    const pw = page.exportSeedPW.value\n    const loaded = app().loading(this.body)\n    const res = await postJSON('/api/exportseed', { pass: pw })\n    loaded()\n    if (!app().checkResponse(res)) {\n      page.exportAccountErr.textContent = res.msg\n      Doc.show(page.exportSeedE)\n      return\n    }\n    page.exportSeedPW.value = ''\n    page.seedDiv.textContent = res.seed\n    this.showForm(page.authorizeSeedDisplay)\n  }\n\n  /* showForm shows a modal form with a little animation. */\n  async showForm (form: HTMLElement) {\n    const page = this.page\n    this.currentForm = form\n    this.forms.forEach(form => Doc.hide(form))\n    form.style.right = '10000px'\n    Doc.show(page.forms, form)\n    const shift = (page.forms.offsetWidth + form.offsetWidth) / 2\n    await Doc.animate(animationLength, progress => {\n      form.style.right = `${(1 - progress) * shift}px`\n    }, 'easeOutHard')\n    form.style.right = '0'\n  }\n\n  /* gets the contents of the cert file */\n  async getCertFile () {\n    let cert = ''\n    if (this.dexAddrForm.page.certFile.value) {\n      const files = this.dexAddrForm.page.certFile.files\n      if (files && files.length) cert = await files[0].text()\n    }\n    return cert\n  }\n\n  /* Called after successful registration to a DEX. */\n  async registerDEXSuccess () {\n    const page = this.page\n    Doc.hide(page.forms)\n    await app().fetchUser()\n    // Initial method of displaying added dex.\n    window.location.reload()\n  }\n\n  /* Change application password  */\n  async changeAppPW () {\n    const page = this.page\n    Doc.hide(page.changePWErrMsg)\n\n    const clearValues = () => {\n      page.appPW.value = ''\n      page.newAppPW.value = ''\n      page.confirmNewPW.value = ''\n    }\n    // Ensure password fields are nonempty.\n    if (!page.appPW.value || !page.newAppPW.value || !page.confirmNewPW.value) {\n      page.changePWErrMsg.textContent = intl.prep(intl.ID_NO_APP_PASS_ERROR_MSG)\n      Doc.show(page.changePWErrMsg)\n      clearValues()\n      return\n    }\n    // Ensure password confirmation matches.\n    if (page.newAppPW.value !== page.confirmNewPW.value) {\n      page.changePWErrMsg.textContent = intl.prep(intl.ID_PASSWORD_NOT_MATCH)\n      Doc.show(page.changePWErrMsg)\n      clearValues()\n      return\n    }\n    const loaded = app().loading(page.changeAppPW)\n    const req = {\n      appPW: page.appPW.value,\n      newAppPW: page.newAppPW.value\n    }\n    clearValues()\n    const res = await postJSON('/api/changeapppass', req)\n    loaded()\n    if (!app().checkResponse(res)) {\n      page.changePWErrMsg.textContent = res.msg\n      Doc.show(page.changePWErrMsg)\n      return\n    }\n    Doc.hide(page.forms)\n  }\n\n  /*\n   * unload is called by the Application when the user navigates away from\n   * the /settings page.\n   */\n  unload () {\n    Doc.unbind(document, 'keyup', this.keyup)\n  }\n\n  /* Swap in the asset selection form and run the animation. */\n  async animateRegAsset (oldForm: HTMLElement) {\n    Doc.hide(oldForm)\n    const form = this.page.regAssetForm\n    this.currentForm = form\n    this.regAssetForm.animate()\n    Doc.show(form)\n  }\n\n  /* Swap in the confirmation form and run the animation. */\n  async animateConfirmForm (oldForm: HTMLElement) {\n    this.confirmRegisterForm.animate()\n    const form = this.page.confirmRegForm\n    this.currentForm = form\n    Doc.hide(oldForm)\n    Doc.show(form)\n  }\n}\n","import {\n  MarketOrderBook,\n  MiniOrder\n} from './registry'\n\nexport default class OrderBook {\n  base: number\n  baseSymbol: string\n  quote: number\n  quoteSymbol: string\n  buys: MiniOrder[]\n  sells: MiniOrder[]\n\n  constructor (mktBook: MarketOrderBook, baseSymbol: string, quoteSymbol: string) {\n    this.base = mktBook.base\n    this.baseSymbol = baseSymbol\n    this.quote = mktBook.quote\n    this.quoteSymbol = quoteSymbol\n    // Books are sorted mid-gap first.\n    this.buys = mktBook.book.buys || []\n    this.sells = mktBook.book.sells || []\n  }\n\n  /* add adds an order to the order book. */\n  add (ord: MiniOrder) {\n    if (ord.qtyAtomic === 0) {\n      // TODO: Somebody, for the love of god, figure out why the hell this helps\n      // with the ghost orders problem. As far as I know, this order is a booked\n      // order that had more than one match in an epoch and completely filled.\n      // Because the first match didn't exhaust the order, there would be a\n      // 'update_remaining' notification scheduled for the order. But by the\n      // time OrderRouter generates the notification long after matching, the\n      // order has zero qty left to fill. It's all good though, kinda, because\n      // the notification is quickly followed with an 'unbook_order'\n      // notification. I have tried my damnedest to catch an update_remaining\n      // note without an accompanying unbook_order note, and have thus failed.\n      // Yet, this fix somehow seems to work. It's infuriating, tbh.\n      window.log('zeroqty', 'zero quantity order encountered', ord)\n      return\n    }\n    const side = ord.sell ? this.sells : this.buys\n    side.splice(findIdx(side, ord.rate, !ord.sell), 0, ord)\n  }\n\n  /* remove removes an order from the order book. */\n  remove (token: string) {\n    if (this.removeFromSide(this.sells, token)) return\n    this.removeFromSide(this.buys, token)\n  }\n\n  /* removeFromSide removes an order from the list of orders. */\n  removeFromSide (side: MiniOrder[], token: string) {\n    const [ord, i] = this.findOrder(side, token)\n    if (ord) {\n      side.splice(i, 1)\n      return true\n    }\n    return false\n  }\n\n  /* findOrder finds an order in a specified side */\n  findOrder (side: MiniOrder[], token: string): [MiniOrder | null, number] {\n    for (let i = 0; i < side.length; i++) {\n      if (side[i].token === token) {\n        return [side[i], i]\n      }\n    }\n    return [null, -1]\n  }\n\n  /* updates the remaining quantity of an order. */\n  updateRemaining (token: string, qty: number, qtyAtomic: number) {\n    if (this.updateRemainingSide(this.sells, token, qty, qtyAtomic)) return\n    this.updateRemainingSide(this.buys, token, qty, qtyAtomic)\n  }\n\n  /*\n   * updateRemainingSide looks for the order in the side and updates the\n   * quantity, returning true on success, false if order not found.\n   */\n  updateRemainingSide (side: MiniOrder[], token: string, qty: number, qtyAtomic: number) {\n    const ord = this.findOrder(side, token)[0]\n    if (ord) {\n      ord.qty = qty\n      ord.qtyAtomic = qtyAtomic\n      return true\n    }\n    return false\n  }\n\n  /*\n   * setEpoch sets the current epoch and clear any orders from previous epochs.\n   */\n  setEpoch (epochIdx: number) {\n    const approve = (ord: MiniOrder) => ord.epoch === undefined || ord.epoch === 0 || ord.epoch === epochIdx\n    this.sells = this.sells.filter(approve)\n    this.buys = this.buys.filter(approve)\n  }\n\n  /* empty will return true if both the buys and sells lists are empty. */\n  empty () {\n    return !this.sells.length && !this.buys.length\n  }\n\n  /* count is the total count of both buy and sell orders. */\n  count () {\n    return this.sells.length + this.buys.length\n  }\n\n  /* bestGapOrder will return the best non-epoch order if one exists, or the\n   * best epoch order if there are only epoch orders, or null if there are no\n   * orders.\n   */\n  bestGapOrder (side: MiniOrder[]) {\n    let best = null\n    for (const ord of side) {\n      if (!ord.epoch) return ord\n      if (!best) {\n        best = ord\n      }\n    }\n    return best\n  }\n\n  bestGapBuy () {\n    return this.bestGapOrder(this.buys)\n  }\n\n  bestGapSell () {\n    return this.bestGapOrder(this.sells)\n  }\n}\n\n/*\n * findIdx find the index at which to insert the order into the list of orders.\n */\nfunction findIdx (side: MiniOrder[], rate: number, less: boolean): number {\n  for (let i = 0; i < side.length; i++) {\n    if ((side[i].rate < rate) === less) return i\n  }\n  return side.length\n}\n","// MessageSocket is a WebSocket manager that uses the Decred DEX Message format\n// for communications.\n//\n// Message request format:\n// {\n//   route: 'name',\n//   id: int,\n//   payload: anything or nothing\n// }\n//\n// Message response payload will be a result object with either a valid 'result'\n// field or an 'error' field\n//\n// Functions for external use:\n// registerRoute (route, handler) -- register a function to handle events\n// of the given type\n// request (route, payload) -- create a JSON message in the above format and\n// send it\n//\n// Based on messagesocket_service.js by Jonathan Chappelow @ dcrdata, which is\n// based on ws_events_dispatcher.js by Ismael Celis\nconst typeRequest = 1\n\nfunction forward (route: string, payload: any, handlers: Record<string, ((payload: any) => void)[]>) {\n  if (!route && payload.error) {\n    const err = payload.error\n    console.error(`websocket error (code ${err.code}): ${err.message}`)\n    return\n  }\n  if (typeof handlers[route] === 'undefined') {\n    // console.log(`unhandled message for ${route}: ${payload}`)\n    return\n  }\n  // call each handler\n  for (let i = 0; i < handlers[route].length; i++) {\n    handlers[route][i](payload)\n  }\n}\n\nlet id = 0\n\ntype NoteReceiver = (payload: any) => void\n\nclass MessageSocket {\n  uri: string\n  connection: WebSocket | null\n  handlers: Record<string, NoteReceiver[]>\n  queue: [string, any][]\n  maxQlength: number\n  reloader: () => void // appears unused\n\n  constructor () {\n    this.handlers = {}\n    this.queue = []\n    this.maxQlength = 5\n  }\n\n  registerRoute (route: string, handler: NoteReceiver) {\n    this.handlers[route] = this.handlers[route] || []\n    this.handlers[route].push(handler)\n  }\n\n  deregisterRoute (route: string) {\n    this.handlers[route] = []\n  }\n\n  // request sends a request-type message to the server\n  request (route: string, payload: any) {\n    if (!this.connection || this.connection.readyState !== window.WebSocket.OPEN) {\n      while (this.queue.length > this.maxQlength - 1) this.queue.shift()\n      this.queue.push([route, payload])\n      return\n    }\n    id++\n    const message = JSON.stringify({\n      route: route,\n      type: typeRequest,\n      id: id,\n      payload: payload\n    })\n\n    window.log('ws', 'sending', message)\n    this.connection.send(message)\n  }\n\n  close (reason: string) {\n    window.log('ws', 'close, reason:', reason, this.handlers)\n    this.handlers = {}\n    if (this.connection) this.connection.close()\n  }\n\n  connect (uri: string, reloader: () => void) {\n    this.uri = uri\n    this.reloader = reloader\n    let retrys = 0\n    const go = () => {\n      window.log('ws', `connecting to ${uri}`)\n      let conn: WebSocket | null = this.connection = new window.WebSocket(uri)\n      if (!conn) return\n      const timeout = setTimeout(() => {\n        // readyState is still WebSocket.CONNECTING. Cancel and trigger onclose.\n        if (conn) conn.close()\n      }, 500)\n\n      // unmarshal message, and forward the message to registered handlers\n      conn.onmessage = (evt: MessageEvent) => {\n        const message = JSON.parse(evt.data)\n        forward(message.route, message.payload, this.handlers)\n      }\n\n      // Stub out standard functions\n      conn.onclose = (evt: CloseEvent) => {\n        window.log('ws', 'onclose')\n        clearTimeout(timeout)\n        conn = this.connection = null\n        forward('close', null, this.handlers)\n        retrys++\n        // 1.2, 1.6, 2.0, 2.4, 3.1, 3.8, 4.8, 6.0, 7.5, 9.3, ...\n        const delay = Math.min(Math.pow(1.25, retrys), 10)\n        console.error(`websocket disconnected (${evt.code}), trying again in ${delay.toFixed(1)} seconds`)\n        setTimeout(() => {\n          go()\n        }, delay * 1000)\n      }\n\n      conn.onopen = () => {\n        window.log('ws', 'onopen')\n        clearTimeout(timeout)\n        if (retrys > 0) {\n          retrys = 0\n          reloader()\n        }\n        forward('open', null, this.handlers)\n        const queue = this.queue\n        this.queue = []\n        for (const [route, message] of queue) {\n          this.request(route, message)\n        }\n      }\n\n      conn.onerror = (evt: Event) => {\n        window.log('ws', 'onerror:', evt)\n        forward('error', evt, this.handlers)\n      }\n    }\n    go()\n  }\n}\n\nconst ws = new MessageSocket()\nexport default ws\n","import Doc, { WalletIcons } from './doc'\nimport State from './state'\nimport BasePage from './basepage'\nimport OrderBook from './orderbook'\nimport {\n  CandleChart,\n  DepthChart,\n  DepthLine,\n  CandleReporters,\n  MouseReport,\n  VolumeReport,\n  DepthMarker,\n  Wave\n} from './charts'\nimport { postJSON } from './http'\nimport {\n  NewWalletForm,\n  UnlockWalletForm,\n  AccelerateOrderForm,\n  DepositAddress,\n  bind as bindForm\n} from './forms'\nimport * as OrderUtil from './orderutil'\nimport ws from './ws'\nimport * as intl from './locales'\nimport {\n  app,\n  SupportedAsset,\n  PageElement,\n  Order,\n  Market,\n  OrderEstimate,\n  MaxOrderEstimate,\n  Exchange,\n  UnitInfo,\n  Asset,\n  Candle,\n  CandlesPayload,\n  TradeForm,\n  BookUpdate,\n  MaxSell,\n  MaxBuy,\n  SwapEstimate,\n  MarketOrderBook,\n  APIResponse,\n  PreSwap,\n  PreRedeem,\n  WalletStateNote,\n  WalletCreationNote,\n  SpotPriceNote,\n  BondNote,\n  OrderNote,\n  EpochNote,\n  BalanceNote,\n  MiniOrder,\n  RemainderUpdate,\n  ConnEventNote,\n  OrderOption,\n  ConnectionStatus,\n  RecentMatch,\n  MatchNote\n} from './registry'\nimport { setOptionTemplates } from './opts'\n\nconst bind = Doc.bind\n\nconst bookRoute = 'book'\nconst bookOrderRoute = 'book_order'\nconst unbookOrderRoute = 'unbook_order'\nconst updateRemainingRoute = 'update_remaining'\nconst epochOrderRoute = 'epoch_order'\nconst candlesRoute = 'candles'\nconst candleUpdateRoute = 'candle_update'\nconst unmarketRoute = 'unmarket'\nconst epochMatchSummaryRoute = 'epoch_match_summary'\n\nconst animationLength = 500\n\nconst anHour = 60 * 60 * 1000 // milliseconds\n\nconst check = document.createElement('span')\ncheck.classList.add('ico-check')\n\nconst buyBtnClass = 'buygreen-bg'\nconst sellBtnClass = 'sellred-bg'\n\nconst fiveMinBinKey = '5m'\nconst oneHrBinKey = '1h'\n\nconst percentFormatter = new Intl.NumberFormat(document.documentElement.lang, {\n  minimumFractionDigits: 1,\n  maximumFractionDigits: 2\n})\n\nconst parentIDNone = 0xFFFFFFFF\n\ninterface MetaOrder {\n  div: HTMLElement\n  header: Record<string, PageElement>\n  details: Record<string, PageElement>\n  ord: Order\n  cancelling?: boolean\n  status?: number\n}\n\ninterface CancelData {\n  bttn: PageElement\n  order: Order\n}\n\ninterface CurrentMarket {\n  dex: Exchange\n  sid: string // A string market identifier used by the DEX.\n  cfg: Market\n  base: SupportedAsset\n  quote: SupportedAsset\n  baseUnitInfo: UnitInfo\n  quoteUnitInfo: UnitInfo\n  maxSellRequested: boolean\n  maxSell: MaxOrderEstimate | null\n  sellBalance: number\n  buyBalance: number\n  maxBuys: Record<number, MaxOrderEstimate>\n  candleCaches: Record<string, CandlesPayload>\n  baseCfg: Asset\n  quoteCfg: Asset\n  rateConversionFactor: number\n}\n\ninterface LoadTracker {\n  loaded: () => void\n  timer: number\n}\n\ninterface OrderRow extends HTMLElement {\n  manager: OrderTableRowManager\n}\n\ninterface StatsDisplay {\n  row: PageElement\n  tmpl: Record<string, PageElement>\n}\n\nexport default class MarketsPage extends BasePage {\n  page: Record<string, PageElement>\n  main: HTMLElement\n  maxLoaded: (() => void) | null\n  maxOrderUpdateCounter: number\n  market: CurrentMarket\n  currentForm: HTMLElement\n  openAsset: SupportedAsset\n  openFunc: () => void\n  currentCreate: SupportedAsset\n  maxEstimateTimer: number | null\n  book: OrderBook\n  cancelData: CancelData\n  metaOrders: Record<string, MetaOrder>\n  preorderCache: Record<string, OrderEstimate>\n  currentOrder: TradeForm\n  depthLines: Record<string, DepthLine[]>\n  activeMarkerRate: number | null\n  hovers: HTMLElement[]\n  ogTitle: string\n  depthChart: DepthChart\n  candleChart: CandleChart\n  candleDur: string\n  balanceWgt: BalanceWidget\n  marketList: MarketList\n  quoteUnits: NodeListOf<HTMLElement>\n  baseUnits: NodeListOf<HTMLElement>\n  unlockForm: UnlockWalletForm\n  newWalletForm: NewWalletForm\n  depositAddrForm: DepositAddress\n  keyup: (e: KeyboardEvent) => void\n  secondTicker: number\n  candlesLoading: LoadTracker | null\n  accelerateOrderForm: AccelerateOrderForm\n  recentMatches: RecentMatch[]\n  recentMatchesSortKey: string\n  recentMatchesSortDirection: 1 | -1\n  stats: [StatsDisplay, StatsDisplay]\n  loadingAnimations: { candles?: Wave, depth?: Wave }\n\n  constructor (main: HTMLElement, data: any) {\n    super()\n    const page = this.page = Doc.idDescendants(main)\n    this.main = main\n    if (!this.main.parentElement) return // Not gonna happen, but TypeScript cares.\n    // There may be multiple pending updates to the max order. This makes sure\n    // that the screen is updated with the most recent one.\n    this.maxOrderUpdateCounter = 0\n    this.metaOrders = {}\n    this.recentMatches = []\n    this.preorderCache = {}\n    this.depthLines = {\n      hover: [],\n      input: []\n    }\n    this.hovers = []\n    // 'Recent Matches' list sort key and direction.\n    this.recentMatchesSortKey = 'age'\n    this.recentMatchesSortDirection = -1\n    // store original title so we can re-append it when updating market value.\n    this.ogTitle = document.title\n\n    const depthReporters = {\n      click: (x: number) => { this.reportDepthClick(x) },\n      volume: (r: VolumeReport) => { this.reportDepthVolume(r) },\n      mouse: (r: MouseReport) => { this.reportDepthMouse(r) },\n      zoom: (z: number) => { this.reportDepthZoom(z) }\n    }\n    this.depthChart = new DepthChart(page.depthChart, depthReporters, State.fetchLocal(State.depthZoomLK))\n\n    const candleReporters: CandleReporters = {\n      mouse: c => { this.reportMouseCandle(c) }\n    }\n    this.candleChart = new CandleChart(page.candlesChart, candleReporters)\n\n    const success = () => { /* do nothing */ }\n    // Do not call cleanTemplates before creating the AccelerateOrderForm\n    this.accelerateOrderForm = new AccelerateOrderForm(page.accelerateForm, success)\n\n    // Set user's last known candle duration.\n    this.candleDur = State.fetchLocal(State.lastCandleDurationLK) || oneHrBinKey\n\n    // Setup the register to trade button.\n    // TODO: Use dexsettings page?\n    const registerBttn = Doc.tmplElement(page.notRegistered, 'registerBttn')\n    bind(registerBttn, 'click', () => {\n      app().loadPage('register', { host: this.market.dex.host })\n    })\n\n    // Set up the BalanceWidget.\n    {\n      page.walletInfoTmpl.removeAttribute('id')\n      const bWidget = page.walletInfoTmpl\n      const qWidget = page.walletInfoTmpl.cloneNode(true) as PageElement\n      bWidget.after(qWidget)\n      const wgt = this.balanceWgt = new BalanceWidget(bWidget, qWidget)\n      const baseIcons = wgt.base.stateIcons.icons\n      const quoteIcons = wgt.quote.stateIcons.icons\n      bind(wgt.base.tmpl.connect, 'click', () => { this.showOpen(this.market.base, this.walletUnlocked) })\n      bind(wgt.quote.tmpl.connect, 'click', () => { this.showOpen(this.market.quote, this.walletUnlocked) })\n      bind(wgt.base.tmpl.expired, 'click', () => { this.showOpen(this.market.base, this.walletUnlocked) })\n      bind(wgt.quote.tmpl.expired, 'click', () => { this.showOpen(this.market.quote, this.walletUnlocked) })\n      bind(baseIcons.sleeping, 'click', () => { this.showOpen(this.market.base, this.walletUnlocked) })\n      bind(quoteIcons.sleeping, 'click', () => { this.showOpen(this.market.quote, this.walletUnlocked) })\n      bind(baseIcons.locked, 'click', () => { this.showOpen(this.market.base, this.walletUnlocked) })\n      bind(quoteIcons.locked, 'click', () => { this.showOpen(this.market.quote, this.walletUnlocked) })\n      bind(baseIcons.disabled, 'click', () => { this.showToggleWalletStatus(this.market.base) })\n      bind(quoteIcons.disabled, 'click', () => { this.showToggleWalletStatus(this.market.quote) })\n      bind(wgt.base.tmpl.newWalletBttn, 'click', () => { this.showCreate(this.market.base) })\n      bind(wgt.quote.tmpl.newWalletBttn, 'click', () => { this.showCreate(this.market.quote) })\n      Doc.bind(wgt.base.tmpl.walletAddr, 'click', () => { this.showDeposit(this.market.base.id) })\n      Doc.bind(wgt.quote.tmpl.walletAddr, 'click', () => { this.showDeposit(this.market.quote.id) })\n      this.depositAddrForm = new DepositAddress(page.deposit)\n    }\n\n    // Bind toggle wallet status form.\n    bindForm(page.toggleWalletStatusConfirm, page.toggleWalletStatusSubmit, async () => { this.toggleWalletStatus() })\n\n    // Prepare templates for the buy and sell tables and the user's order table.\n    setOptionTemplates(page)\n    Doc.cleanTemplates(page.rowTemplate, page.durBttnTemplate, page.booleanOptTmpl, page.rangeOptTmpl, page.orderOptTmpl, page.userOrderTmpl)\n\n    // Store the elements that need their ticker changed when the market\n    // changes.\n    this.quoteUnits = main.querySelectorAll('[data-unit=quote]')\n    this.baseUnits = main.querySelectorAll('[data-unit=base]')\n\n    // Buttons to set order type and side.\n    bind(page.buyBttn, 'click', () => {\n      swapBttns(page.sellBttn, page.buyBttn)\n      page.submitBttn.classList.remove(sellBtnClass)\n      page.submitBttn.classList.add(buyBtnClass)\n      page.maxLbl.textContent = intl.prep(intl.ID_BUY)\n      this.setOrderBttnText()\n      this.setOrderVisibility()\n      this.drawChartLines()\n    })\n    bind(page.sellBttn, 'click', () => {\n      swapBttns(page.buyBttn, page.sellBttn)\n      page.submitBttn.classList.add(sellBtnClass)\n      page.submitBttn.classList.remove(buyBtnClass)\n      page.maxLbl.textContent = intl.prep(intl.ID_SELL)\n      this.setOrderBttnText()\n      this.setOrderVisibility()\n      this.drawChartLines()\n    })\n    bind(page.limitBttn, 'click', () => {\n      swapBttns(page.marketBttn, page.limitBttn)\n      this.setOrderVisibility()\n      if (!page.rateField.value) return\n      this.depthLines.input = [{\n        rate: parseFloat(page.rateField.value || '0'),\n        color: this.isSell() ? this.depthChart.theme.sellLine : this.depthChart.theme.buyLine\n      }]\n      this.drawChartLines()\n    })\n    bind(page.marketBttn, 'click', () => {\n      swapBttns(page.limitBttn, page.marketBttn)\n      this.setOrderVisibility()\n      this.setMarketBuyOrderEstimate()\n      this.depthLines.input = []\n      this.drawChartLines()\n    })\n    bind(page.maxOrd, 'click', () => {\n      if (this.isSell()) {\n        const maxSell = this.market.maxSell\n        if (!maxSell) return\n        page.lotField.value = String(maxSell.swap.lots)\n      } else page.lotField.value = String(this.market.maxBuys[this.adjustedRate()].swap.lots)\n      this.lotChanged()\n    })\n\n    Doc.disableMouseWheel(page.rateField, page.lotField, page.qtyField, page.mktBuyField)\n\n    // Handle the full orderbook sent on the 'book' route.\n    ws.registerRoute(bookRoute, (data: BookUpdate) => { this.handleBookRoute(data) })\n    // Handle the new order for the order book on the 'book_order' route.\n    ws.registerRoute(bookOrderRoute, (data: BookUpdate) => { this.handleBookOrderRoute(data) })\n    // Remove the order sent on the 'unbook_order' route from the orderbook.\n    ws.registerRoute(unbookOrderRoute, (data: BookUpdate) => { this.handleUnbookOrderRoute(data) })\n    // Update the remaining quantity on a booked order.\n    ws.registerRoute(updateRemainingRoute, (data: BookUpdate) => { this.handleUpdateRemainingRoute(data) })\n    // Handle the new order for the order book on the 'epoch_order' route.\n    ws.registerRoute(epochOrderRoute, (data: BookUpdate) => { this.handleEpochOrderRoute(data) })\n    // Handle the initial candlestick data on the 'candles' route.\n    ws.registerRoute(candlesRoute, (data: BookUpdate) => { this.handleCandlesRoute(data) })\n    // Handle the candles update on the 'candles' route.\n    ws.registerRoute(candleUpdateRoute, (data: BookUpdate) => { this.handleCandleUpdateRoute(data) })\n\n    // Handle the recent matches update on the 'epoch_report' route.\n    ws.registerRoute(epochMatchSummaryRoute, (data: BookUpdate) => { this.handleEpochMatchSummary(data) })\n    // Bind the wallet unlock form.\n    this.unlockForm = new UnlockWalletForm(page.unlockWalletForm, async () => { this.openFunc() })\n    // Create a wallet\n    this.newWalletForm = new NewWalletForm(page.newWalletForm, async () => { this.createWallet() })\n    // Main order form.\n    bindForm(page.orderForm, page.submitBttn, async () => { this.stepSubmit() })\n    // Order verification form.\n    bindForm(page.verifyForm, page.vSubmit, async () => { this.submitOrder() })\n    // Unlock for order estimation\n    Doc.bind(page.vUnlockSubmit, 'click', async () => { this.submitEstimateUnlock() })\n    // Cancel order form.\n    bindForm(page.cancelForm, page.cancelSubmit, async () => { this.submitCancel() })\n    // Order detail view.\n    Doc.bind(page.vFeeDetails, 'click', () => this.showForm(page.vDetailPane))\n    Doc.bind(page.closeDetailPane, 'click', () => this.showVerifyForm())\n    // // Bind active orders list's header sort events.\n    page.recentMatchesTable.querySelectorAll('[data-ordercol]')\n      .forEach((th: HTMLElement) => bind(\n        th, 'click', () => setRecentMatchesSortCol(th.dataset.ordercol || '')\n      ))\n\n    const setRecentMatchesSortCol = (key: string) => {\n      // First unset header's current sorted col classes.\n      unsetRecentMatchesSortColClasses()\n      if (this.recentMatchesSortKey === key) {\n        this.recentMatchesSortDirection *= -1\n      } else {\n        this.recentMatchesSortKey = key\n        this.recentMatchesSortDirection = 1\n      }\n      this.refreshRecentMatchesTable()\n      setRecentMatchesSortColClasses()\n    }\n\n    // sortClassByDirection receives a sort direction and return a class based on it.\n    const sortClassByDirection = (element: 1 | -1) => {\n      if (element === 1) return 'sorted-asc'\n      return 'sorted-dsc'\n    }\n\n    const unsetRecentMatchesSortColClasses = () => {\n      page.recentMatchesTable.querySelectorAll('[data-ordercol]')\n        .forEach(th => th.classList.remove('sorted-asc', 'sorted-dsc'))\n    }\n\n    const setRecentMatchesSortColClasses = () => {\n      const key = this.recentMatchesSortKey\n      const sortCls = sortClassByDirection(this.recentMatchesSortDirection)\n      Doc.safeSelector(page.recentMatchesTable, `[data-ordercol=${key}]`).classList.add(sortCls)\n    }\n\n    // Set default's sorted col header classes.\n    setRecentMatchesSortColClasses()\n\n    const closePopups = () => {\n      Doc.hide(page.forms)\n      page.vPass.value = ''\n      page.cancelPass.value = ''\n    }\n\n    // If the user clicks outside of a form, it should close the page overlay.\n    bind(page.forms, 'mousedown', (e: MouseEvent) => {\n      if (Doc.isDisplayed(page.vDetailPane) && !Doc.mouseInElement(e, page.vDetailPane)) return this.showVerifyForm()\n      if (!Doc.mouseInElement(e, this.currentForm)) {\n        closePopups()\n      }\n    })\n\n    this.keyup = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        closePopups()\n      }\n    }\n    bind(document, 'keyup', this.keyup)\n\n    page.forms.querySelectorAll('.form-closer').forEach(el => {\n      Doc.bind(el, 'click', () => { closePopups() })\n    })\n\n    // Event listeners for interactions with the various input fields.\n    bind(page.lotField, 'change', () => { this.lotChanged() })\n    bind(page.lotField, 'keyup', () => { this.lotChanged() })\n    bind(page.qtyField, 'change', () => { this.quantityChanged(true) })\n    bind(page.qtyField, 'keyup', () => { this.quantityChanged(false) })\n    bind(page.mktBuyField, 'change', () => { this.marketBuyChanged() })\n    bind(page.mktBuyField, 'keyup', () => { this.marketBuyChanged() })\n    bind(page.rateField, 'change', () => { this.rateFieldChanged() })\n    bind(page.rateField, 'keyup', () => { this.previewQuoteAmt(true) })\n\n    // Market search input bindings.\n    bind(page.marketSearchV1, 'change', () => { this.filterMarkets() })\n    bind(page.marketSearchV1, 'keyup', () => { this.filterMarkets() })\n\n    // Acknowledge the order disclaimer.\n    const setDisclaimerAckViz = (acked: boolean) => {\n      Doc.setVis(!acked, page.disclaimer, page.disclaimerAck)\n      Doc.setVis(acked, page.showDisclaimer)\n    }\n    bind(page.disclaimerAck, 'click', () => {\n      State.storeLocal(State.orderDisclaimerAckedLK, true)\n      setDisclaimerAckViz(true)\n    })\n    bind(page.showDisclaimer, 'click', () => {\n      State.storeLocal(State.orderDisclaimerAckedLK, false)\n      setDisclaimerAckViz(false)\n    })\n    setDisclaimerAckViz(State.fetchLocal(State.orderDisclaimerAckedLK))\n\n    const clearChartLines = () => {\n      this.depthLines.hover = []\n      this.drawChartLines()\n    }\n    bind(page.buyRows, 'mouseleave', clearChartLines)\n    bind(page.sellRows, 'mouseleave', clearChartLines)\n    bind(page.userOrders, 'mouseleave', () => {\n      this.activeMarkerRate = null\n      this.setDepthMarkers()\n    })\n\n    const stats0 = page.marketStatsV1\n    const stats1 = stats0.cloneNode(true) as PageElement\n    stats1.classList.add('listopen')\n    Doc.hide(stats0, stats1)\n    stats1.removeAttribute('id')\n    app().headerSpace.appendChild(stats1)\n    this.stats = [{ row: stats0, tmpl: Doc.parseTemplate(stats0) }, { row: stats1, tmpl: Doc.parseTemplate(stats1) }]\n\n    const closeMarketsList = () => {\n      State.storeLocal(State.leftMarketDockLK, '0')\n      page.leftMarketDock.classList.remove('default')\n      page.leftMarketDock.classList.add('stashed')\n      for (const s of this.stats) s.row.classList.remove('listopen')\n    }\n    const openMarketsList = () => {\n      State.storeLocal(State.leftMarketDockLK, '1')\n      page.leftMarketDock.classList.remove('default', 'stashed')\n      for (const s of this.stats) s.row.classList.add('listopen')\n    }\n    Doc.bind(page.leftHider, 'click', () => closeMarketsList())\n    Doc.bind(page.marketReopener, 'click', () => openMarketsList())\n    for (const s of this.stats) {\n      Doc.bind(s.tmpl.marketSelect, 'click', () => {\n        if (page.leftMarketDock.clientWidth === 0) openMarketsList()\n        else closeMarketsList()\n      })\n    }\n    this.marketList = new MarketList(page.marketListV1)\n    // Prepare the list of markets.\n    for (const row of this.marketList.markets) {\n      bind(row.node, 'click', () => {\n        this.startLoadingAnimations()\n        this.setMarket(row.mkt.xc.host, row.mkt.baseid, row.mkt.quoteid)\n      })\n    }\n    if (State.fetchLocal(State.leftMarketDockLK) !== '1') { // It is shown by default, hiding if necessary.\n      closeMarketsList()\n    }\n\n    // Notification filters.\n    app().registerNoteFeeder({\n      order: (note: OrderNote) => { this.handleOrderNote(note) },\n      match: (note: MatchNote) => { this.handleMatchNote(note) },\n      epoch: (note: EpochNote) => { this.handleEpochNote(note) },\n      conn: (note: ConnEventNote) => { this.handleConnNote(note) },\n      balance: (note: BalanceNote) => { this.handleBalanceNote(note) },\n      bondpost: (note: BondNote) => { this.handleBondUpdate(note) },\n      spots: (note: SpotPriceNote) => { this.handlePriceUpdate(note) }\n    })\n\n    this.loadingAnimations = {}\n    this.startLoadingAnimations()\n\n    // Start a ticker to update time-since values.\n    this.secondTicker = window.setInterval(() => {\n      for (const mord of Object.values(this.metaOrders)) {\n        mord.details.age.textContent = Doc.timeSince(mord.ord.submitTime)\n      }\n      for (const td of Doc.applySelector(page.recentMatchesLiveList, '[data-tmpl=age]')) {\n        td.textContent = Doc.timeSince(parseFloat(td.dataset.sinceStamp ?? '0'))\n      }\n    }, 1000)\n\n    this.init(data)\n  }\n\n  async init (data: any) {\n    // Fetch the first market in the list, or the users last selected market, if\n    // it exists.\n    let selected\n    if (data && data.host && typeof data.base !== 'undefined' && typeof data.quote !== 'undefined') {\n      selected = makeMarket(data.host, parseInt(data.base), parseInt(data.quote))\n    } else {\n      selected = State.fetchLocal(State.lastMarketLK)\n    }\n    if (!selected || !this.marketList.exists(selected.host, selected.base, selected.quote)) {\n      const first = this.marketList.first()\n      if (first) selected = { host: first.mkt.xc.host, base: first.mkt.baseid, quote: first.mkt.quoteid }\n    }\n    if (selected) this.setMarket(selected.host, selected.base, selected.quote)\n\n    // set the initial state for the registration status\n    this.setRegistrationStatusVisibility()\n    this.setBalanceVisibility()\n  }\n\n  startLoadingAnimations () {\n    const { page, loadingAnimations: anis, depthChart, candleChart } = this\n    depthChart.canvas.classList.add('invisible')\n    candleChart.canvas.classList.add('invisible')\n    if (anis.candles) anis.candles.stop()\n    anis.candles = new Wave(page.candlesChart, { message: intl.prep(intl.ID_CANDLES_LOADING) })\n    if (anis.depth) anis.depth.stop()\n    anis.depth = new Wave(page.depthChart, { message: intl.prep(intl.ID_DEPTH_LOADING) })\n  }\n\n  /* isSell is true if the user has selected sell in the order options. */\n  isSell () {\n    return this.page.sellBttn.classList.contains('selected')\n  }\n\n  /* isLimit is true if the user has selected the \"limit order\" tab. */\n  isLimit () {\n    return this.page.limitBttn.classList.contains('selected')\n  }\n\n  /* hasPendingBonds is true if there are pending bonds */\n  hasPendingBonds (): boolean {\n    return Object.keys(this.market.dex.pendingBonds).length > 0\n  }\n\n  /* setCurrMarketPrice updates the current market price on the stats displays\n     and the orderbook display. */\n  setCurrMarketPrice (): void {\n    const selected = this.market\n    if (!selected) return\n    // Get an up-to-date Market.\n    const xc = app().exchanges[selected.dex.host]\n    const mkt = xc.markets[selected.cfg.name]\n    if (!mkt.spot) return\n\n    for (const s of this.stats) {\n      const bconv = xc.assets[mkt.baseid].unitInfo.conventional.conversionFactor\n      s.tmpl.volume.textContent = fourSigFigs(mkt.spot.vol24 / bconv)\n      setPriceAndChange(s.tmpl, xc, mkt)\n    }\n\n    this.page.obPrice.textContent = Doc.formatFullPrecision(mkt.spot.rate / this.market.rateConversionFactor)\n    this.page.obPrice.classList.remove('sellcolor', 'buycolor')\n    this.page.obPrice.classList.add(mkt.spot.change24 >= 0 ? 'buycolor' : 'sellcolor')\n    Doc.setVis(mkt.spot.change24 >= 0, this.page.obUp)\n    Doc.setVis(mkt.spot.change24 < 0, this.page.obDown)\n  }\n\n  /* setMarketDetails updates the currency names on the stats displays. */\n  setMarketDetails () {\n    if (!this.market) return\n    for (const s of this.stats) {\n      s.tmpl.baseIcon.src = Doc.logoPath(this.market.cfg.basesymbol)\n      s.tmpl.quoteIcon.src = Doc.logoPath(this.market.cfg.quotesymbol)\n      Doc.empty(s.tmpl.baseSymbol, s.tmpl.quoteSymbol)\n      s.tmpl.baseSymbol.appendChild(Doc.symbolize(this.market.cfg.basesymbol))\n      s.tmpl.quoteSymbol.appendChild(Doc.symbolize(this.market.cfg.quotesymbol))\n    }\n  }\n\n  /* setHighLow calculates the high and low rates over the last 24 hours. */\n  setHighLow () {\n    let [high, low] = [0, 0]\n    const spot = this.market.cfg.spot\n    // Use spot values for 24 hours high and low rates if it is available. We\n    // will default to setting it from candles if it's not.\n    if (spot && spot.low24 && spot.high24) {\n      high = spot.high24\n      low = spot.low24\n    } else {\n      const cache = this.market?.candleCaches[fiveMinBinKey]\n      if (!cache) {\n        if (this.candleDur !== fiveMinBinKey) {\n          this.requestCandles(fiveMinBinKey)\n          return\n        }\n        for (const s of this.stats) {\n          s.tmpl.high.textContent = '-'\n          s.tmpl.low.textContent = '-'\n        }\n        return\n      }\n\n      // Set high and low rates from candles.\n      const aDayAgo = new Date().getTime() - 86400000\n      for (let i = cache.candles.length - 1; i >= 0; i--) {\n        const c = cache.candles[i]\n        if (c.endStamp < aDayAgo) break\n        if (low === 0 || (c.lowRate > 0 && c.lowRate < low)) low = c.lowRate\n        if (c.highRate > high) high = c.highRate\n      }\n    }\n\n    const qconv = app().unitInfo(this.market.cfg.quoteid, this.market.dex).conventional.conversionFactor\n    for (const s of this.stats) {\n      s.tmpl.high.textContent = high > 0 ? fourSigFigs(high / qconv) : '-'\n      s.tmpl.low.textContent = low > 0 ? fourSigFigs(low / qconv) : '-'\n    }\n  }\n\n  /* assetsAreSupported is true if all the assets of the current market are\n   * supported\n   */\n  assetsAreSupported (): {\n    isSupported: boolean;\n    text: string;\n    } {\n    const { market: { base, quote, baseCfg, quoteCfg } } = this\n    if (!base || !quote) {\n      const symbol = base ? quoteCfg.symbol : baseCfg.symbol\n      return {\n        isSupported: false,\n        text: intl.prep(intl.ID_NOT_SUPPORTED, { asset: symbol.toUpperCase() })\n      }\n    }\n    // check if versions are supported. If asset is a token, we check if its\n    // parent supports the version.\n    const bVers = (base.token ? app().assets[base.token.parentID].info?.versions : base.info?.versions) as number[]\n    const qVers = (quote.token ? app().assets[quote.token.parentID].info?.versions : quote.info?.versions) as number[]\n    // if none them are token, just check if own asset is supported.\n    let text = ''\n    if (!bVers.includes(baseCfg.version)) {\n      text = intl.prep(intl.ID_VERSION_NOT_SUPPORTED, { asset: base.symbol.toUpperCase(), version: baseCfg.version + '' })\n    } else if (!qVers.includes(quoteCfg.version)) {\n      text = intl.prep(intl.ID_VERSION_NOT_SUPPORTED, { asset: quote.symbol.toUpperCase(), version: quoteCfg.version + '' })\n    }\n    return {\n      isSupported: bVers.includes(baseCfg.version) && qVers.includes(quoteCfg.version),\n      text\n    }\n  }\n\n  /*\n   * setOrderVisibility sets which form is visible based on the specified\n   * options.\n   */\n  setOrderVisibility () {\n    const page = this.page\n    if (this.isLimit()) {\n      Doc.show(page.priceBox, page.tifBox, page.qtyBox, page.maxBox)\n      Doc.hide(page.mktBuyBox)\n      this.previewQuoteAmt(true)\n    } else {\n      Doc.hide(page.tifBox, page.maxBox, page.priceBox)\n      if (this.isSell()) {\n        Doc.hide(page.mktBuyBox)\n        Doc.show(page.qtyBox)\n        this.previewQuoteAmt(true)\n      } else {\n        Doc.show(page.mktBuyBox)\n        Doc.hide(page.qtyBox)\n        this.previewQuoteAmt(false)\n      }\n    }\n  }\n\n  /* resolveOrderFormVisibility displays or hides the 'orderForm' based on\n   * a set of conditions to be met.\n   */\n  resolveOrderFormVisibility () {\n    const page = this.page\n    // By default the order form should be hidden, and only if market is set\n    // and ready for trading the form should show up.\n    Doc.hide(page.orderForm, page.orderTypeBttns)\n\n    if (!this.assetsAreSupported().isSupported) return // assets not supported\n\n    if (this.market.dex.tier < 1) return // acct suspended or not registered\n\n    const { base, quote } = this.market\n    const hasWallets = base && app().assets[base.id].wallet && quote && app().assets[quote.id].wallet\n    if (!hasWallets) return\n\n    Doc.show(page.orderForm, page.orderTypeBttns)\n  }\n\n  /* setLoaderMsgVisibility displays a message in case a dex asset is not\n   * supported\n   */\n  setLoaderMsgVisibility () {\n    const { page } = this\n\n    const { isSupported, text } = this.assetsAreSupported()\n    if (isSupported) {\n      // make sure to hide the loader msg\n      Doc.hide(page.loaderMsg)\n      return\n    }\n    page.loaderMsg.textContent = text\n    Doc.show(page.loaderMsg)\n    Doc.hide(page.notRegistered)\n    Doc.hide(page.noWallet)\n  }\n\n  /* setRegistrationStatusView sets the text content and class for the\n   * registration status view\n   */\n  setRegistrationStatusView (titleContent: string, confStatusMsg: string, titleClass: string) {\n    const page = this.page\n    page.regStatusTitle.textContent = titleContent\n    page.regStatusConfsDisplay.textContent = confStatusMsg\n    page.registrationStatus.classList.remove('completed', 'error', 'waiting')\n    page.registrationStatus.classList.add(titleClass)\n  }\n\n  /*\n   * updateRegistrationStatusView updates the view based on the current\n   * registration status\n   */\n  updateRegistrationStatusView () {\n    const { page, market: { dex } } = this\n    page.regStatusDex.textContent = dex.host\n\n    if (dex.tier >= 1) {\n      this.setRegistrationStatusView(intl.prep(intl.ID_REGISTRATION_FEE_SUCCESS), '', 'completed')\n      return\n    }\n\n    const confStatuses = Object.values(dex.pendingBonds).map(pending => {\n      const confirmationsRequired = dex.bondAssets[pending.symbol].confs\n      return `${pending.confs} / ${confirmationsRequired}`\n    })\n    const confStatusMsg = confStatuses.join(', ')\n    this.setRegistrationStatusView(intl.prep(intl.ID_WAITING_FOR_CONFS), confStatusMsg, 'waiting')\n  }\n\n  /*\n   * setRegistrationStatusVisibility toggles the registration status view based\n   * on the dex data.\n   */\n  setRegistrationStatusVisibility () {\n    const { page, market } = this\n    if (!market || !market.dex) return\n\n    // If dex is not connected to server, is not possible to know the\n    // registration status.\n    if (market.dex.connectionStatus !== ConnectionStatus.Connected) return\n\n    this.updateRegistrationStatusView()\n\n    if (market.dex.tier >= 1) {\n      const toggle = () => {\n        Doc.hide(page.registrationStatus, page.bondRequired)\n        this.resolveOrderFormVisibility()\n      }\n      if (Doc.isHidden(page.orderForm)) {\n        // wait a couple of seconds before showing the form so the success\n        // message is shown to the user\n        setTimeout(toggle, 5000)\n        return\n      }\n      toggle()\n    } else if (market.dex.viewOnly) {\n      page.unregisteredDex.textContent = market.dex.host\n      Doc.show(page.notRegistered)\n    } else if (this.hasPendingBonds()) {\n      Doc.show(page.registrationStatus)\n    } else {\n      page.acctTier.textContent = `${market.dex.tier}`\n      page.dexSettingsLink.href = `/dexsettings/${market.dex.host}`\n      Doc.show(page.bondRequired)\n    }\n  }\n\n  setOrderBttnText () {\n    if (this.isSell()) {\n      this.page.submitBttn.textContent = intl.prep(intl.ID_SET_BUTTON_SELL, { asset: Doc.shortSymbol(this.market.baseCfg.symbol) })\n    } else this.page.submitBttn.textContent = intl.prep(intl.ID_SET_BUTTON_BUY, { asset: Doc.shortSymbol(this.market.baseCfg.symbol) })\n  }\n\n  setCandleDurBttns () {\n    const { page, market } = this\n    Doc.empty(page.durBttnBox)\n    for (const dur of market.dex.candleDurs) {\n      const bttn = page.durBttnTemplate.cloneNode(true)\n      bttn.textContent = dur\n      Doc.bind(bttn, 'click', () => this.candleDurationSelected(dur))\n      page.durBttnBox.appendChild(bttn)\n    }\n\n    // load candlesticks here since we are resetting page.durBttnBox above.\n    this.loadCandles()\n  }\n\n  /* setMarket sets the currently displayed market. */\n  async setMarket (host: string, base: number, quote: number) {\n    const dex = app().user.exchanges[host]\n    const page = this.page\n\n    // reset form inputs\n    page.lotField.value = ''\n    page.qtyField.value = ''\n    page.rateField.value = ''\n\n    Doc.hide(page.notRegistered, page.bondRequired, page.noWallet)\n\n    // If we have not yet connected, there is no dex.assets or any other\n    // exchange data, so just put up a message and wait for the connection to be\n    // established, at which time handleConnNote will refresh and reload.\n    if (!dex || !dex.markets || dex.connectionStatus !== ConnectionStatus.Connected) {\n      page.chartErrMsg.textContent = intl.prep(intl.ID_CONNECTION_FAILED)\n      Doc.show(page.chartErrMsg)\n      return\n    }\n\n    for (const s of this.stats) Doc.show(s.row)\n\n    const baseCfg = dex.assets[base]\n    const quoteCfg = dex.assets[quote]\n\n    const [bui, qui] = [app().unitInfo(base, dex), app().unitInfo(quote, dex)]\n\n    const rateConversionFactor = OrderUtil.RateEncodingFactor / bui.conventional.conversionFactor * qui.conventional.conversionFactor\n    Doc.hide(page.maxOrd, page.chartErrMsg)\n    if (this.maxEstimateTimer) {\n      window.clearTimeout(this.maxEstimateTimer)\n      this.maxEstimateTimer = null\n    }\n    const mktId = marketID(baseCfg.symbol, quoteCfg.symbol)\n    const baseAsset = app().assets[base]\n    const quoteAsset = app().assets[quote]\n    this.market = {\n      dex: dex,\n      sid: mktId, // A string market identifier used by the DEX.\n      cfg: dex.markets[mktId],\n      // app().assets is a map of core.SupportedAsset type, which can be found at\n      // client/core/types.go.\n      base: baseAsset,\n      quote: quoteAsset,\n      baseUnitInfo: bui,\n      quoteUnitInfo: qui,\n      maxSell: null,\n      maxBuys: {},\n      maxSellRequested: false,\n      candleCaches: {},\n      baseCfg,\n      quoteCfg,\n      rateConversionFactor,\n      sellBalance: 0,\n      buyBalance: 0\n    }\n\n    Doc.setVis(!(baseAsset && quoteAsset) || !(baseAsset.wallet && quoteAsset.wallet), page.noWallet)\n    this.setMarketDetails()\n    this.setCurrMarketPrice()\n    this.refreshRecentMatchesTable()\n\n    // if (!dex.candleDurs || dex.candleDurs.length === 0) this.currentChart = depthChart\n\n    // depth chart\n    ws.request('loadmarket', makeMarket(host, base, quote))\n\n    this.setLoaderMsgVisibility()\n    this.setRegistrationStatusVisibility()\n    this.resolveOrderFormVisibility()\n    this.setOrderBttnText()\n    this.setCandleDurBttns()\n    this.previewQuoteAmt(false)\n  }\n\n  /*\n   * reportDepthClick is a callback used by the DepthChart when the user clicks\n   * on the chart area. The rate field is set to the x-value of the click.\n   */\n  reportDepthClick (r: number) {\n    this.page.rateField.value = String(r)\n    this.rateFieldChanged()\n  }\n\n  /*\n   * reportDepthVolume accepts a volume report from the DepthChart and sets the\n   * values in the chart legend.\n   */\n  reportDepthVolume (r: VolumeReport) {\n    const page = this.page\n    const { baseUnitInfo: b, quoteUnitInfo: q } = this.market\n    // DepthChart reports volumes in conventional units. We'll still use\n    // formatCoinValue for formatting though.\n    page.sellBookedBase.textContent = Doc.formatCoinValue(r.sellBase * b.conventional.conversionFactor, b)\n    page.sellBookedQuote.textContent = Doc.formatCoinValue(r.sellQuote * q.conventional.conversionFactor, q)\n    page.buyBookedBase.textContent = Doc.formatCoinValue(r.buyBase * b.conventional.conversionFactor, b)\n    page.buyBookedQuote.textContent = Doc.formatCoinValue(r.buyQuote * q.conventional.conversionFactor, q)\n  }\n\n  /*\n   * reportDepthMouse accepts informations about the mouse position on the\n   * chart area.\n   */\n  reportDepthMouse (r: MouseReport) {\n    while (this.hovers.length) (this.hovers.shift() as HTMLElement).classList.remove('hover')\n    const page = this.page\n    if (!r) {\n      Doc.hide(page.hoverData, page.depthHoverData)\n      return\n    }\n    Doc.show(page.hoverData, page.depthHoverData)\n\n    // If the user is hovered to within a small percent (based on chart width)\n    // of a user order, highlight that order's row.\n    for (const { div, ord } of Object.values(this.metaOrders)) {\n      if (ord.status !== OrderUtil.StatusBooked) continue\n      if (r.hoverMarkers.indexOf(ord.rate) > -1) {\n        div.classList.add('hover')\n        this.hovers.push(div)\n      }\n    }\n\n    page.hoverPrice.textContent = Doc.formatCoinValue(r.rate)\n    page.hoverVolume.textContent = Doc.formatCoinValue(r.depth)\n    page.hoverVolume.style.color = r.dotColor\n  }\n\n  /*\n   * reportDepthZoom accepts informations about the current depth chart zoom level.\n   * This information is saved to disk so that the zoom level can be maintained\n   * across reloads.\n   */\n  reportDepthZoom (zoom: number) {\n    State.storeLocal(State.depthZoomLK, zoom)\n  }\n\n  reportMouseCandle (candle: Candle | null) {\n    const page = this.page\n    if (!candle) {\n      Doc.hide(page.hoverData, page.candleHoverData)\n      return\n    }\n    Doc.show(page.hoverData, page.candleHoverData)\n    page.candleStart.textContent = Doc.formatCoinValue(candle.startRate / this.market.rateConversionFactor)\n    page.candleEnd.textContent = Doc.formatCoinValue(candle.endRate / this.market.rateConversionFactor)\n    page.candleHigh.textContent = Doc.formatCoinValue(candle.highRate / this.market.rateConversionFactor)\n    page.candleLow.textContent = Doc.formatCoinValue(candle.lowRate / this.market.rateConversionFactor)\n    page.candleVol.textContent = Doc.formatCoinValue(candle.matchVolume, this.market.baseUnitInfo)\n  }\n\n  /*\n   * parseOrder pulls the order information from the form fields. Data is not\n   * validated in any way.\n   */\n  parseOrder (): TradeForm {\n    const page = this.page\n    let qtyField = page.qtyField\n    const limit = this.isLimit()\n    const sell = this.isSell()\n    const market = this.market\n    let qtyConv = market.baseUnitInfo.conventional.conversionFactor\n    if (!limit && !sell) {\n      qtyField = page.mktBuyField\n      qtyConv = market.quoteUnitInfo.conventional.conversionFactor\n    }\n    return {\n      host: market.dex.host,\n      isLimit: limit,\n      sell: sell,\n      base: market.base.id,\n      quote: market.quote.id,\n      qty: convertToAtoms(qtyField.value || '', qtyConv),\n      rate: convertToAtoms(page.rateField.value || '', market.rateConversionFactor), // message-rate\n      tifnow: page.tifNow.checked || false,\n      options: {}\n    }\n  }\n\n  /**\n   * previewQuoteAmt shows quote amount when rate or quantity input are changed\n   */\n  previewQuoteAmt (show: boolean) {\n    const page = this.page\n    if (!this.market.base || !this.market.quote) return // Not a supported asset\n    const order = this.parseOrder()\n    const adjusted = this.adjustedRate()\n    page.orderErr.textContent = ''\n    if (adjusted) {\n      if (order.sell) this.preSell()\n      else this.preBuy()\n    }\n    this.depthLines.input = []\n    if (adjusted && this.isLimit()) {\n      this.depthLines.input = [{\n        rate: order.rate / this.market.rateConversionFactor,\n        color: order.sell ? this.depthChart.theme.sellLine : this.depthChart.theme.buyLine\n      }]\n    }\n    this.drawChartLines()\n    if (!show || !adjusted || !order.qty) {\n      page.orderPreview.textContent = ''\n      this.drawChartLines()\n      return\n    }\n    const quoteAsset = app().assets[order.quote]\n    const quoteQty = order.qty * order.rate / OrderUtil.RateEncodingFactor\n    const total = Doc.formatCoinValue(quoteQty, this.market.quoteUnitInfo)\n\n    page.orderPreview.textContent = intl.prep(intl.ID_ORDER_PREVIEW, { total, asset: quoteAsset.symbol.toUpperCase() })\n    if (this.isSell()) this.preSell()\n    else this.preBuy()\n  }\n\n  /**\n   * preSell populates the max order message for the largest available sell.\n   */\n  preSell () {\n    const mkt = this.market\n    const baseWallet = app().assets[mkt.base.id].wallet\n    if (baseWallet.balance.available < mkt.cfg.lotsize) {\n      this.setMaxOrder(null)\n      return\n    }\n    if (mkt.maxSell) {\n      this.setMaxOrder(mkt.maxSell.swap)\n      return\n    }\n    if (mkt.maxSellRequested) return\n    mkt.maxSellRequested = true\n    // We only fetch pre-sell once per balance update, so don't delay.\n    this.scheduleMaxEstimate('/api/maxsell', {}, 0, (res: MaxSell) => {\n      mkt.maxSellRequested = false\n      mkt.maxSell = res.maxSell\n      mkt.sellBalance = baseWallet.balance.available\n      this.setMaxOrder(res.maxSell.swap)\n    })\n  }\n\n  /**\n   * preBuy populates the max order message for the largest available buy.\n   */\n  preBuy () {\n    const mkt = this.market\n    const rate = this.adjustedRate()\n    const quoteWallet = app().assets[mkt.quote.id].wallet\n    if (!quoteWallet) return\n    const aLot = mkt.cfg.lotsize * (rate / OrderUtil.RateEncodingFactor)\n    if (quoteWallet.balance.available < aLot) {\n      this.setMaxOrder(null)\n      return\n    }\n    if (mkt.maxBuys[rate]) {\n      this.setMaxOrder(mkt.maxBuys[rate].swap)\n      return\n    }\n    // 0 delay for first fetch after balance update or market change, otherwise\n    // meter these at 1 / sec.\n    const delay = Object.keys(mkt.maxBuys).length ? 350 : 0\n    this.scheduleMaxEstimate('/api/maxbuy', { rate }, delay, (res: MaxBuy) => {\n      mkt.maxBuys[rate] = res.maxBuy\n      mkt.buyBalance = app().assets[mkt.quote.id].wallet.balance.available\n      this.setMaxOrder(res.maxBuy.swap)\n    })\n  }\n\n  /**\n   * scheduleMaxEstimate shows the loading icon and schedules a call to an order\n   * estimate api endpoint. If another call to scheduleMaxEstimate is made before\n   * this one is fired (after delay), this call will be canceled.\n   */\n  scheduleMaxEstimate (path: string, args: any, delay: number, success: (res: any) => void) {\n    const page = this.page\n    if (!this.maxLoaded) this.maxLoaded = app().loading(page.maxOrd)\n    const [bid, qid] = [this.market.base.id, this.market.quote.id]\n    const [bWallet, qWallet] = [app().assets[bid].wallet, app().assets[qid].wallet]\n    if (!bWallet || !bWallet.running || !qWallet || !qWallet.running) return\n    if (this.maxEstimateTimer) window.clearTimeout(this.maxEstimateTimer)\n\n    Doc.show(page.maxOrd, page.maxLotBox)\n    Doc.hide(page.maxAboveZero)\n    page.maxFromLots.textContent = intl.prep(intl.ID_CALCULATING)\n    page.maxFromLotsLbl.textContent = ''\n    this.maxOrderUpdateCounter++\n    const counter = this.maxOrderUpdateCounter\n    this.maxEstimateTimer = window.setTimeout(async () => {\n      this.maxEstimateTimer = null\n      if (counter !== this.maxOrderUpdateCounter) return\n      const res = await postJSON(path, {\n        host: this.market.dex.host,\n        base: bid,\n        quote: qid,\n        ...args\n      })\n      if (counter !== this.maxOrderUpdateCounter) return\n      if (!app().checkResponse(res)) {\n        console.warn('max order estimate not available:', res)\n        page.maxFromLots.textContent = intl.prep(intl.ID_ESTIMATE_UNAVAILABLE)\n        if (this.maxLoaded) {\n          this.maxLoaded()\n          this.maxLoaded = null\n        }\n        return\n      }\n      success(res)\n    }, delay)\n  }\n\n  /* setMaxOrder sets the max order text. */\n  setMaxOrder (maxOrder: SwapEstimate | null) {\n    const page = this.page\n    if (this.maxLoaded) {\n      this.maxLoaded()\n      this.maxLoaded = null\n    }\n    Doc.show(page.maxOrd, page.maxLotBox, page.maxAboveZero)\n    const sell = this.isSell()\n\n    let lots = 0\n    if (maxOrder) lots = maxOrder.lots\n\n    page.maxFromLots.textContent = lots.toString()\n    // XXX add plural into format details, so we don't need this\n    page.maxFromLotsLbl.textContent = intl.prep(lots === 1 ? intl.ID_LOT : intl.ID_LOTS)\n    if (!maxOrder) {\n      Doc.hide(page.maxAboveZero)\n      return\n    }\n    // Could add the estimatedFees here, but that might also be\n    // confusing.\n    const fromAsset = sell ? this.market.base : this.market.quote\n    // DRAFT NOTE: Maybe just use base qty from lots.\n    page.maxFromAmt.textContent = Doc.formatCoinValue(maxOrder.value || 0, fromAsset.unitInfo)\n    page.maxFromTicker.textContent = fromAsset.symbol.toUpperCase()\n    // Could subtract the maxOrder.redemptionFees here.\n    // The qty conversion doesn't fit well with the new design.\n    // TODO: Make this work somehow?\n    // const toConversion = sell ? this.adjustedRate() / OrderUtil.RateEncodingFactor : OrderUtil.RateEncodingFactor / this.adjustedRate()\n    // page.maxToAmt.textContent = Doc.formatCoinValue((maxOrder.value || 0) * toConversion, toAsset.unitInfo)\n    // page.maxToTicker.textContent = toAsset.symbol.toUpperCase()\n  }\n\n  /*\n   * validateOrder performs some basic order sanity checks, returning boolean\n   * true if the order appears valid.\n   */\n  validateOrder (order: TradeForm) {\n    const page = this.page\n    if (order.isLimit && !order.rate) {\n      Doc.show(page.orderErr)\n      page.orderErr.textContent = intl.prep(intl.ID_NO_ZERO_RATE)\n      return false\n    }\n    if (!order.qty) {\n      Doc.show(page.orderErr)\n      page.orderErr.textContent = intl.prep(intl.ID_NO_ZERO_QUANTITY)\n      return false\n    }\n    return true\n  }\n\n  /* handleBook accepts the data sent in the 'book' notification. */\n  handleBook (data: MarketOrderBook) {\n    const { cfg, baseUnitInfo, quoteUnitInfo, baseCfg, quoteCfg } = this.market\n    this.book = new OrderBook(data, baseCfg.symbol, quoteCfg.symbol)\n    this.loadTable()\n    for (const order of (data.book.epoch || [])) {\n      if (order.rate > 0) this.book.add(order)\n      this.addTableOrder(order)\n    }\n    if (!this.book) {\n      this.depthChart.clear()\n      Doc.empty(this.page.buyRows)\n      Doc.empty(this.page.sellRows)\n      return\n    }\n    Doc.show(this.page.epochLine)\n    if (this.loadingAnimations.depth) this.loadingAnimations.depth.stop()\n    this.depthChart.canvas.classList.remove('invisible')\n    this.depthChart.set(this.book, cfg.lotsize, cfg.ratestep, baseUnitInfo, quoteUnitInfo)\n    this.recentMatches = data.book.recentMatches ?? []\n    this.refreshRecentMatchesTable()\n  }\n\n  /*\n   * midGapConventional is the same as midGap, but returns the mid-gap rate as\n   * the conventional ratio. This is used to convert from a conventional\n   * quantity from base to quote or vice-versa.\n   */\n  midGapConventional () {\n    const gap = this.midGap()\n    if (!gap) return gap\n    const { baseUnitInfo: b, quoteUnitInfo: q } = this.market\n    return gap * b.conventional.conversionFactor / q.conventional.conversionFactor\n  }\n\n  /*\n   * midGap returns the value in the middle of the best buy and best sell. If\n   * either one of the buy or sell sides are empty, midGap returns the best rate\n   * from the other side. If both sides are empty, midGap returns the value\n   * null. The rate returned is the atomic ratio.\n   */\n  midGap () {\n    const book = this.book\n    if (!book) return\n    if (book.buys && book.buys.length) {\n      if (book.sells && book.sells.length) {\n        return (book.buys[0].msgRate + book.sells[0].msgRate) / 2 / OrderUtil.RateEncodingFactor\n      }\n      return book.buys[0].msgRate / OrderUtil.RateEncodingFactor\n    }\n    if (book.sells && book.sells.length) {\n      return book.sells[0].msgRate / OrderUtil.RateEncodingFactor\n    }\n    return null\n  }\n\n  /*\n   * setMarketBuyOrderEstimate sets the \"min. buy\" display for the current\n   * market.\n   */\n  setMarketBuyOrderEstimate () {\n    const market = this.market\n    const lotSize = market.cfg.lotsize\n    const xc = app().user.exchanges[market.dex.host]\n    const buffer = xc.markets[market.sid].buybuffer\n    const gap = this.midGapConventional()\n    if (gap) {\n      this.page.minMktBuy.textContent = Doc.formatCoinValue(lotSize * buffer * gap, market.baseUnitInfo)\n    }\n  }\n\n  /* refreshActiveOrders refreshes the user's active order list. */\n  refreshActiveOrders () {\n    const page = this.page\n    const metaOrders = this.metaOrders\n    const market = this.market\n    for (const oid in metaOrders) delete metaOrders[oid]\n    const orders = app().orders(market.dex.host, marketID(market.baseCfg.symbol, market.quoteCfg.symbol))\n    // Sort orders by sort key.\n    orders.sort((a: Order, b: Order) => b.submitTime - a.submitTime)\n\n    Doc.empty(page.userOrders)\n    Doc.setVis(orders?.length, page.userOrders)\n    Doc.setVis(!orders?.length, page.userNoOrders)\n\n    let unreadyOrders = false\n    for (const ord of orders) {\n      const div = page.userOrderTmpl.cloneNode(true) as HTMLElement\n      page.userOrders.appendChild(div)\n\n      const headerEl = Doc.tmplElement(div, 'header')\n      const header = Doc.parseTemplate(headerEl)\n      const detailsDiv = Doc.tmplElement(div, 'details')\n      const details = Doc.parseTemplate(detailsDiv)\n\n      const mord: MetaOrder = {\n        div: div,\n        header: header,\n        details: details,\n        ord: ord\n      }\n\n      // No need to track in-flight orders here. We've already added it to\n      // display.\n      if (ord.id) metaOrders[ord.id] = mord\n\n      if (!ord.readyToTick) {\n        headerEl.classList.add('unready-user-order')\n        unreadyOrders = true\n      }\n      header.sideLight.classList.add(ord.sell ? 'sell' : 'buy')\n      details.side.textContent = header.side.textContent = OrderUtil.sellString(ord)\n      details.side.classList.add(ord.sell ? 'sellcolor' : 'buycolor')\n      header.side.classList.add(ord.sell ? 'sellcolor' : 'buycolor')\n      details.qty.textContent = header.qty.textContent = fourSigFigs(ord.qty / this.market.baseUnitInfo.conventional.conversionFactor)\n      details.rate.textContent = header.rate.textContent = fourSigFigs(ord.rate / this.market.rateConversionFactor)\n      header.baseSymbol.textContent = ord.baseSymbol.toUpperCase()\n      details.type.textContent = OrderUtil.typeString(ord)\n      this.updateMetaOrder(mord)\n\n      Doc.bind(div, 'mouseenter', () => {\n        this.activeMarkerRate = ord.rate\n        this.setDepthMarkers()\n      })\n\n      if (!ord.id) {\n        Doc.hide(details.accelerateBttn)\n        Doc.hide(details.cancelBttn)\n        Doc.hide(details.link)\n      } else {\n        if (ord.type === OrderUtil.Limit && (ord.tif === OrderUtil.StandingTiF && ord.status < OrderUtil.StatusExecuted)) {\n          Doc.show(details.cancelBttn)\n          bind(details.cancelBttn, 'click', e => {\n            e.stopPropagation()\n            this.showCancel(div, ord.id)\n          })\n        }\n\n        bind(details.accelerateBttn, 'click', e => {\n          e.stopPropagation()\n          this.showAccelerate(ord)\n        })\n        if (app().canAccelerateOrder(ord)) {\n          Doc.show(details.accelerateBttn)\n        }\n        details.link.href = `order/${ord.id}`\n        app().bindInternalNavigation(div)\n      }\n\n      Doc.bind(headerEl, 'click', () => {\n        if (Doc.isDisplayed(detailsDiv)) {\n          Doc.hide(detailsDiv)\n          header.expander.classList.add('ico-arrowdown')\n          header.expander.classList.remove('ico-arrowup')\n          return\n        }\n        Doc.show(detailsDiv)\n        header.expander.classList.remove('ico-arrowdown')\n        header.expander.classList.add('ico-arrowup')\n      })\n      app().bindTooltips(div)\n    }\n    Doc.setVis(unreadyOrders, page.unreadyOrdersMsg)\n    this.setDepthMarkers()\n  }\n\n  /*\n  * updateMetaOrder sets the td contents of the user's order table row.\n  */\n  updateMetaOrder (mord: MetaOrder) {\n    const { header, details, ord } = mord\n    if (ord.status <= OrderUtil.StatusBooked || OrderUtil.hasActiveMatches(ord)) header.activeLight.classList.add('active')\n    else header.activeLight.classList.remove('active')\n    details.status.textContent = header.status.textContent = OrderUtil.statusString(ord)\n    details.age.textContent = Doc.timeSince(ord.submitTime)\n    details.filled.textContent = `${(OrderUtil.filled(ord) / ord.qty * 100).toFixed(1)}%`\n    details.settled.textContent = `${(OrderUtil.settled(ord) / ord.qty * 100).toFixed(1)}%`\n  }\n\n  /* setMarkers sets the depth chart markers for booked orders. */\n  setDepthMarkers () {\n    const markers: Record<string, DepthMarker[]> = {\n      buys: [],\n      sells: []\n    }\n    const rateFactor = this.market.rateConversionFactor\n    for (const { ord } of Object.values(this.metaOrders)) {\n      if (ord.rate && ord.status === OrderUtil.StatusBooked) {\n        if (ord.sell) {\n          markers.sells.push({\n            rate: ord.rate / rateFactor,\n            active: ord.rate === this.activeMarkerRate\n          })\n        } else {\n          markers.buys.push({\n            rate: ord.rate / rateFactor,\n            active: ord.rate === this.activeMarkerRate\n          })\n        }\n      }\n    }\n    this.depthChart.setMarkers(markers)\n    if (this.book) this.depthChart.draw()\n  }\n\n  /* updateTitle update the browser title based on the midgap value and the\n   * selected assets.\n   */\n  updateTitle () {\n    // gets first price value from buy or from sell, so we can show it on\n    // title.\n    const midGapValue = this.midGapConventional()\n    if (!midGapValue) return\n\n    const { baseCfg: b, quoteCfg: q } = this.market\n    const baseSymb = b.symbol.toUpperCase()\n    const quoteSymb = q.symbol.toUpperCase()\n    // more than 6 numbers it gets too big for the title.\n    document.title = `${Doc.formatCoinValue(midGapValue)} | ${baseSymb}${quoteSymb} | ${this.ogTitle}`\n  }\n\n  /* handleBookRoute is the handler for the 'book' notification, which is sent\n   * in response to a new market subscription. The data received will contain\n   * the entire order book.\n   */\n  handleBookRoute (note: BookUpdate) {\n    app().log('book', 'handleBookRoute:', note)\n    const mktBook = note.payload\n    const market = this.market\n    const page = this.page\n    const host = market.dex.host\n    const [b, q] = [market.baseCfg, market.quoteCfg]\n    if (mktBook.base !== b.id || mktBook.quote !== q.id) return\n    this.refreshActiveOrders()\n    this.handleBook(mktBook)\n    this.updateTitle()\n    this.marketList.select(host, b.id, q.id)\n\n    State.storeLocal(State.lastMarketLK, {\n      host: note.host,\n      base: mktBook.base,\n      quote: mktBook.quote\n    })\n\n    page.lotSize.textContent = Doc.formatCoinValue(market.cfg.lotsize, market.baseUnitInfo)\n    page.rateStep.textContent = Doc.formatCoinValue(market.cfg.ratestep / market.rateConversionFactor)\n    this.baseUnits.forEach(el => {\n      Doc.empty(el)\n      el.appendChild(Doc.symbolize(b.symbol))\n    })\n    this.quoteUnits.forEach(el => {\n      Doc.empty(el)\n      el.appendChild(Doc.symbolize(q.symbol))\n    })\n    this.balanceWgt.setWallets(host, b.id, q.id)\n    this.setMarketBuyOrderEstimate()\n    this.refreshActiveOrders()\n  }\n\n  /* handleBookOrderRoute is the handler for 'book_order' notifications. */\n  handleBookOrderRoute (data: BookUpdate) {\n    app().log('book', 'handleBookOrderRoute:', data)\n    if (data.host !== this.market.dex.host || data.marketID !== this.market.sid) return\n    const order = data.payload as MiniOrder\n    if (order.rate > 0) this.book.add(order)\n    this.addTableOrder(order)\n    this.updateTitle()\n    this.depthChart.draw()\n  }\n\n  /* handleUnbookOrderRoute is the handler for 'unbook_order' notifications. */\n  handleUnbookOrderRoute (data: BookUpdate) {\n    app().log('book', 'handleUnbookOrderRoute:', data)\n    if (data.host !== this.market.dex.host || data.marketID !== this.market.sid) return\n    const order = data.payload\n    this.book.remove(order.token)\n    this.removeTableOrder(order)\n    this.updateTitle()\n    this.depthChart.draw()\n  }\n\n  /*\n   * handleUpdateRemainingRoute is the handler for 'update_remaining'\n   * notifications.\n   */\n  handleUpdateRemainingRoute (data: BookUpdate) {\n    app().log('book', 'handleUpdateRemainingRoute:', data)\n    if (data.host !== this.market.dex.host || data.marketID !== this.market.sid) return\n    const update = data.payload\n    this.book.updateRemaining(update.token, update.qty, update.qtyAtomic)\n    this.updateTableOrder(update)\n    this.depthChart.draw()\n  }\n\n  /* handleEpochOrderRoute is the handler for 'epoch_order' notifications. */\n  handleEpochOrderRoute (data: BookUpdate) {\n    app().log('book', 'handleEpochOrderRoute:', data)\n    if (data.host !== this.market.dex.host || data.marketID !== this.market.sid) return\n    const order = data.payload\n    if (order.msgRate > 0) this.book.add(order) // No cancels or market orders\n    if (order.qtyAtomic > 0) this.addTableOrder(order) // No cancel orders\n    this.depthChart.draw()\n  }\n\n  /* handleCandlesRoute is the handler for 'candles' notifications. */\n  handleCandlesRoute (data: BookUpdate) {\n    if (this.candlesLoading) {\n      clearTimeout(this.candlesLoading.timer)\n      this.candlesLoading.loaded()\n      this.candlesLoading = null\n    }\n    if (data.host !== this.market.dex.host || data.marketID !== this.market.cfg.name) return\n    const dur = data.payload.dur\n    this.market.candleCaches[dur] = data.payload\n    this.setHighLow()\n    if (this.candleDur !== dur) return\n    if (this.loadingAnimations.candles) this.loadingAnimations.candles.stop()\n    this.candleChart.canvas.classList.remove('invisible')\n    this.candleChart.setCandles(data.payload, this.market.cfg, this.market.baseUnitInfo, this.market.quoteUnitInfo)\n  }\n\n  handleEpochMatchSummary (data: BookUpdate) {\n    this.addRecentMatches(data.payload)\n    this.refreshRecentMatchesTable()\n  }\n\n  /* handleCandleUpdateRoute is the handler for 'candle_update' notifications. */\n  handleCandleUpdateRoute (data: BookUpdate) {\n    if (data.host !== this.market.dex.host) return\n    const { dur, candle } = data.payload\n    const cache = this.market.candleCaches[dur]\n    if (!cache) return // must not have seen the 'candles' notification yet?\n    const candles = cache.candles\n    if (candles.length === 0) candles.push(candle)\n    else {\n      const last = candles[candles.length - 1]\n      if (last.startStamp === candle.startStamp) candles[candles.length - 1] = candle\n      else candles.push(candle)\n    }\n    if (this.candleDur !== dur) return\n    this.candleChart.draw()\n  }\n\n  /* showForm shows a modal form with a little animation. */\n  async showForm (form: HTMLElement) {\n    this.currentForm = form\n    const page = this.page\n    Doc.hide(...Array.from(page.forms.children))\n    form.style.right = '10000px'\n    Doc.show(page.forms, form)\n    const shift = (page.forms.offsetWidth + form.offsetWidth) / 2\n    await Doc.animate(animationLength, progress => {\n      form.style.right = `${(1 - progress) * shift}px`\n    }, 'easeOutHard')\n    form.style.right = '0'\n  }\n\n  /* showOpen shows the form to unlock a wallet. */\n  async showOpen (asset: SupportedAsset, f: () => void) {\n    const page = this.page\n    this.openAsset = asset\n    this.openFunc = f\n    this.unlockForm.refresh(app().assets[asset.id])\n    this.showForm(page.unlockWalletForm)\n    page.uwAppPass.focus()\n  }\n\n  /*\n   * showToggleWalletStatus displays the toggleWalletStatusConfirm form to\n   * enable a wallet.\n   */\n  showToggleWalletStatus (asset: SupportedAsset) {\n    const page = this.page\n    this.openAsset = asset\n    Doc.hide(page.toggleWalletStatusErr, page.walletStatusDisable, page.disableWalletMsg)\n    Doc.show(page.walletStatusEnable, page.enableWalletMsg)\n    this.showForm(page.toggleWalletStatusConfirm)\n  }\n\n  /*\n   * toggleWalletStatus toggle wallets status to enabled.\n   */\n  async toggleWalletStatus () {\n    const page = this.page\n    Doc.hide(page.toggleWalletStatusErr)\n\n    const url = '/api/togglewalletstatus'\n    const req = {\n      assetID: this.openAsset.id,\n      disable: false\n    }\n\n    const loaded = app().loading(page.toggleWalletStatusConfirm)\n    const res = await postJSON(url, req)\n    loaded()\n    if (!app().checkResponse(res)) {\n      page.toggleWalletStatusErr.textContent = res.msg\n      Doc.show(page.toggleWalletStatusErr)\n      return\n    }\n\n    Doc.hide(this.page.forms)\n    this.balanceWgt.updateAsset(this.openAsset.id)\n  }\n\n  /* showVerify shows the form to accept the currently parsed order information\n   * and confirm submission of the order to the dex.\n   */\n  showVerify () {\n    this.preorderCache = {}\n    const page = this.page\n    const order = this.currentOrder = this.parseOrder()\n    const isSell = order.sell\n    const baseAsset = app().assets[order.base]\n    const quoteAsset = app().assets[order.quote]\n    const toAsset = isSell ? quoteAsset : baseAsset\n    const fromAsset = isSell ? baseAsset : quoteAsset\n\n    const setIcon = (icon: PageElement) => {\n      switch (icon.dataset.icon) {\n        case 'from':\n          if (fromAsset.token) {\n            const parentAsset = app().assets[fromAsset.token.parentID]\n            icon.src = Doc.logoPath(parentAsset.symbol)\n          } else {\n            icon.src = Doc.logoPath(fromAsset.symbol)\n          }\n          break\n        case 'to':\n          if (toAsset.token) {\n            const parentAsset = app().assets[toAsset.token.parentID]\n            icon.src = Doc.logoPath(parentAsset.symbol)\n          } else {\n            icon.src = Doc.logoPath(toAsset.symbol)\n          }\n      }\n    }\n\n    // Set the to and from icons in the fee details pane.\n    for (const icon of Doc.applySelector(page.vDetailPane, '[data-icon]')) {\n      setIcon(icon)\n    }\n\n    // Set the to and from icons in the fee summary pane.\n    for (const icon of Doc.applySelector(page.vFeeSummary, '[data-icon]')) {\n      setIcon(icon)\n    }\n\n    Doc.hide(page.vUnlockPreorder, page.vPreorderErr)\n    Doc.show(page.vPreorder)\n\n    page.vBuySell.textContent = isSell ? intl.prep(intl.ID_SELLING) : intl.prep(intl.ID_BUYING)\n    const buySellStr = isSell ? intl.prep(intl.ID_SELL) : intl.prep(intl.ID_BUY)\n    page.vSideSubmit.textContent = buySellStr\n    page.vOrderHost.textContent = order.host\n    if (order.isLimit) {\n      Doc.show(page.verifyLimit)\n      Doc.hide(page.verifyMarket)\n      const orderDesc = `Limit ${buySellStr} Order`\n      page.vOrderType.textContent = order.tifnow ? orderDesc + ' (immediate)' : orderDesc\n      page.vRate.textContent = Doc.formatCoinValue(order.rate / this.market.rateConversionFactor)\n      page.vQty.textContent = Doc.formatCoinValue(order.qty, baseAsset.unitInfo)\n      const total = order.rate / OrderUtil.RateEncodingFactor * order.qty\n      page.vTotal.textContent = Doc.formatCoinValue(total, quoteAsset.unitInfo)\n      // Format total fiat value.\n      this.showFiatValue(quoteAsset.id, total, page.vFiatTotal)\n    } else {\n      Doc.hide(page.verifyLimit)\n      Doc.show(page.verifyMarket)\n      page.vOrderType.textContent = `Market ${buySellStr} Order`\n      const ui = order.sell ? this.market.baseUnitInfo : this.market.quoteUnitInfo\n      page.vmFromTotal.textContent = Doc.formatCoinValue(order.qty, ui)\n      page.vmFromAsset.textContent = fromAsset.symbol.toUpperCase()\n      // Format fromAsset fiat value.\n      this.showFiatValue(fromAsset.id, order.qty, page.vmFromTotalFiat)\n      const gap = this.midGap()\n      if (gap) {\n        Doc.show(page.vMarketEstimate)\n        const received = order.sell ? order.qty * gap : order.qty / gap\n        page.vmToTotal.textContent = Doc.formatCoinValue(received, toAsset.unitInfo)\n        page.vmToAsset.textContent = toAsset.symbol.toUpperCase()\n        // Format received value to fiat equivalent.\n        this.showFiatValue(toAsset.id, received, page.vmTotalFiat)\n      } else {\n        Doc.hide(page.vMarketEstimate)\n      }\n    }\n    // Visually differentiate between buy/sell orders.\n    if (isSell) {\n      page.vHeader.classList.add(sellBtnClass)\n      page.vHeader.classList.remove(buyBtnClass)\n      page.vSubmit.classList.add(sellBtnClass)\n      page.vSubmit.classList.remove(buyBtnClass)\n    } else {\n      page.vHeader.classList.add(buyBtnClass)\n      page.vHeader.classList.remove(sellBtnClass)\n      page.vSubmit.classList.add(buyBtnClass)\n      page.vSubmit.classList.remove(sellBtnClass)\n    }\n    this.showVerifyForm()\n    page.vPass.focus()\n\n    if (baseAsset.wallet.open && quoteAsset.wallet.open) this.preOrder(order)\n    else {\n      Doc.hide(page.vPreorder)\n      if (State.passwordIsCached()) this.unlockWalletsForEstimates('')\n      else Doc.show(page.vUnlockPreorder)\n    }\n  }\n\n  // showFiatValue displays the fiat equivalent for an order quantity.\n  showFiatValue (assetID: number, qty: number, display: PageElement) {\n    if (display) {\n      const rate = app().fiatRatesMap[assetID]\n      display.textContent = Doc.formatFiatConversion(qty, rate, app().unitInfo(assetID))\n      if (rate) Doc.show(display.parentElement as Element)\n      else Doc.hide(display.parentElement as Element)\n    }\n  }\n\n  /* showVerifyForm displays form to verify an order */\n  async showVerifyForm () {\n    const page = this.page\n    Doc.hide(page.vErr)\n    this.showForm(page.verifyForm)\n  }\n\n  /*\n   * submitEstimateUnlock reads the current vUnlockPass and unlocks any locked\n   * wallets.\n   */\n  async submitEstimateUnlock () {\n    const pw = this.page.vUnlockPass.value || ''\n    return await this.unlockWalletsForEstimates(pw)\n  }\n\n  /*\n   * unlockWalletsForEstimates unlocks any locked wallets with the provided\n   * password.\n   */\n  async unlockWalletsForEstimates (pw: string) {\n    const page = this.page\n    const loaded = app().loading(page.verifyForm)\n    const err = await this.attemptWalletUnlock(pw)\n    loaded()\n    if (err) return this.setPreorderErr(err)\n    Doc.show(page.vPreorder)\n    Doc.hide(page.vUnlockPreorder)\n    this.preOrder(this.parseOrder())\n  }\n\n  /*\n   * attemptWalletUnlock unlocks both the base and quote wallets for the current\n   * market, if locked.\n   */\n  async attemptWalletUnlock (pw: string) {\n    const { base, quote } = this.market\n    const assetIDs = []\n    if (!base.wallet.open) assetIDs.push(base.id)\n    if (!quote.wallet.open) assetIDs.push(quote.id)\n    const req = {\n      pass: pw,\n      assetID: -1\n    }\n    for (const assetID of assetIDs) {\n      req.assetID = assetID\n      const res = await postJSON('/api/openwallet', req)\n      if (!app().checkResponse(res)) {\n        return res.msg\n      }\n    }\n  }\n\n  /* fetchPreorder fetches the pre-order estimates and options. */\n  async fetchPreorder (order: TradeForm) {\n    const page = this.page\n    const cacheKey = JSON.stringify(order.options)\n    const cached = this.preorderCache[cacheKey]\n    if (cached) return cached\n\n    Doc.hide(page.vPreorderErr)\n    const loaded = app().loading(page.verifyForm)\n    const res = await postJSON('/api/preorder', wireOrder(order))\n    loaded()\n    if (!app().checkResponse(res)) return { err: res.msg }\n    this.preorderCache[cacheKey] = res.estimate\n    return res.estimate\n  }\n\n  /*\n   * setPreorderErr sets and displays the pre-order error message and hides the\n   * pre-order details box.\n   */\n  setPreorderErr (msg: string) {\n    const page = this.page\n    Doc.hide(page.vPreorder)\n    Doc.show(page.vPreorderErr)\n    page.vPreorderErrTip.dataset.tooltip = msg\n  }\n\n  showPreOrderAdvancedOptions () {\n    const page = this.page\n    Doc.hide(page.showAdvancedOptions)\n    Doc.show(page.hideAdvancedOptions, page.vOtherOrderOpts)\n  }\n\n  hidePreOrderAdvancedOptions () {\n    const page = this.page\n    Doc.hide(page.hideAdvancedOptions, page.vOtherOrderOpts)\n    Doc.show(page.showAdvancedOptions)\n  }\n\n  reloadOrderOpts (order: TradeForm, swap: PreSwap, redeem: PreRedeem, changed: ()=>void) {\n    const page = this.page\n    Doc.empty(page.vDefaultOrderOpts, page.vOtherOrderOpts)\n    const addOption = (opt: OrderOption, isSwap: boolean) => {\n      const el = OrderUtil.optionElement(opt, order, changed, isSwap)\n      if (opt.showByDefault) page.vDefaultOrderOpts.appendChild(el)\n      else page.vOtherOrderOpts.appendChild(el)\n    }\n    for (const opt of swap.options || []) addOption(opt, true)\n    for (const opt of redeem.options || []) addOption(opt, false)\n    app().bindTooltips(page.vDefaultOrderOpts)\n    app().bindTooltips(page.vOtherOrderOpts)\n  }\n\n  /* preOrder loads the options and fetches pre-order estimates */\n  async preOrder (order: TradeForm) {\n    const page = this.page\n\n    // Add swap options.\n    const refreshPreorder = async () => {\n      const res: APIResponse = await this.fetchPreorder(order)\n      if (res.err) return this.setPreorderErr(res.err)\n      const est = (res as any) as OrderEstimate\n      Doc.hide(page.vPreorderErr)\n      Doc.show(page.vPreorder)\n      const { swap, redeem } = est\n      swap.options = swap.options || []\n      redeem.options = redeem.options || []\n      this.setFeeEstimates(swap, redeem, order)\n\n      const changed = async () => {\n        await refreshPreorder()\n        Doc.animate(400, progress => {\n          page.vFeeSummary.style.backgroundColor = `rgba(128, 128, 128, ${0.5 - 0.5 * progress})`\n        })\n      }\n      // bind show or hide advanced pre order options.\n      Doc.bind(page.showAdvancedOptions, 'click', () => { this.showPreOrderAdvancedOptions() })\n      Doc.bind(page.hideAdvancedOptions, 'click', () => { this.hidePreOrderAdvancedOptions() })\n      this.reloadOrderOpts(order, swap, redeem, changed)\n    }\n\n    refreshPreorder()\n  }\n\n  /* setFeeEstimates sets all of the pre-order estimate fields */\n  setFeeEstimates (swap: PreSwap, redeem: PreRedeem, order: TradeForm) {\n    const { page, market } = this\n    if (!swap.estimate || !redeem.estimate) {\n      Doc.hide(page.vPreorderEstimates)\n      return // preOrder may return just options, no fee estimates\n    }\n    Doc.show(page.vPreorderEstimates)\n    const { baseUnitInfo, quoteUnitInfo, rateConversionFactor } = market\n    const fmtPct = (value: number) => {\n      if (value < 0.05) return '< 0.1'\n      return percentFormatter.format(value)\n    }\n\n    // If the asset is a token, in order to calculate the fee as a percentage\n    // of the total order, we try to  use the fiat rates to find out the\n    // exchange rate between the token and parent assets.\n    // Initially these are set to 1, which we would use if the asset is not a\n    // token and no conversion is needed.\n    let baseExchangeRate = 1\n    let quoteExchangeRate = 1\n    let baseFeeAssetUI = baseUnitInfo\n    let quoteFeeAssetUI = quoteUnitInfo\n\n    if (market.base.token) {\n      const parent = app().assets[market.base.token.parentID]\n      baseFeeAssetUI = parent.unitInfo\n      const tokenFiatRate = app().fiatRatesMap[market.base.id]\n      const parentFiatRate = app().fiatRatesMap[parent.id]\n      if (tokenFiatRate && parentFiatRate) {\n        const conventionalRate = parentFiatRate / tokenFiatRate\n        baseExchangeRate = conventionalRate * baseUnitInfo.conventional.conversionFactor / parent.unitInfo.conventional.conversionFactor\n      } else {\n        baseExchangeRate = 0\n      }\n    }\n\n    if (market.quote.token) {\n      const parent = app().assets[market.quote.token.parentID]\n      quoteFeeAssetUI = parent.unitInfo\n      const tokenFiatRate = app().fiatRatesMap[market.quote.id]\n      const parentFiatRate = app().fiatRatesMap[parent.id]\n      if (tokenFiatRate && parentFiatRate) {\n        const conventionalRate = parentFiatRate / tokenFiatRate\n        quoteExchangeRate = conventionalRate * quoteUnitInfo.conventional.conversionFactor / parent.unitInfo.conventional.conversionFactor\n      } else {\n        quoteExchangeRate = 0\n      }\n    }\n\n    let [toFeeAssetUI, fromFeeAssetUI] = [baseFeeAssetUI, quoteFeeAssetUI]\n    let [toExchangeRate, fromExchangeRate] = [baseExchangeRate, quoteExchangeRate]\n    if (this.currentOrder.sell) {\n      [fromFeeAssetUI, toFeeAssetUI] = [toFeeAssetUI, fromFeeAssetUI];\n      [fromExchangeRate, toExchangeRate] = [toExchangeRate, fromExchangeRate]\n    }\n\n    const swapped = swap.estimate.value || 0\n    const swappedInParentUnits = fromExchangeRate > 0 ? swapped / fromExchangeRate : swapped\n\n    // Set swap fee estimates in the details pane.\n    const bestSwapPct = swap.estimate.realisticBestCase / swappedInParentUnits * 100\n    page.vSwapFeesLowPct.textContent = fromExchangeRate <= 0 ? '' : `(${fmtPct(bestSwapPct)}%)`\n    page.vSwapFeesLow.textContent = Doc.formatCoinValue(swap.estimate.realisticBestCase, fromFeeAssetUI)\n\n    const worstSwapPct = swap.estimate.realisticWorstCase / swappedInParentUnits * 100\n    page.vSwapFeesHighPct.textContent = fromExchangeRate <= 0 ? '' : `(${fmtPct(worstSwapPct)}%)`\n    page.vSwapFeesHigh.textContent = Doc.formatCoinValue(swap.estimate.realisticWorstCase, fromFeeAssetUI)\n\n    const swapFeesMaxPct = swap.estimate.maxFees / swappedInParentUnits * 100\n    page.vSwapFeesMaxPct.textContent = fromExchangeRate <= 0 ? '' : `(${fmtPct(swapFeesMaxPct)}%)`\n    page.vSwapFeesMax.textContent = Doc.formatCoinValue(swap.estimate.maxFees, fromFeeAssetUI)\n\n    // Set redemption fee estimates in the details pane.\n    const midGap = this.midGap()\n    const estRate = midGap || order.rate / rateConversionFactor\n    const received = order.sell ? swapped * estRate : swapped / estRate\n    const receivedInParentUnits = toExchangeRate > 0 ? received / toExchangeRate : received\n\n    const bestRedeemPct = redeem.estimate.realisticBestCase / receivedInParentUnits * 100\n    page.vRedeemFeesLowPct.textContent = toExchangeRate <= 0 ? '' : `(${fmtPct(bestRedeemPct)}%)`\n    page.vRedeemFeesLow.textContent = Doc.formatCoinValue(redeem.estimate.realisticBestCase, toFeeAssetUI)\n\n    const worstRedeemPct = redeem.estimate.realisticWorstCase / receivedInParentUnits * 100\n    page.vRedeemFeesHighPct.textContent = toExchangeRate <= 0 ? '' : `(${fmtPct(worstRedeemPct)}%)`\n    page.vRedeemFeesHigh.textContent = Doc.formatCoinValue(redeem.estimate.realisticWorstCase, toFeeAssetUI)\n\n    if (baseExchangeRate && quoteExchangeRate) {\n      Doc.show(page.vFeeSummaryPct)\n      Doc.hide(page.vFeeSummary)\n      page.vFeeSummaryLow.textContent = fmtPct(bestSwapPct + bestRedeemPct)\n      page.vFeeSummaryHigh.textContent = fmtPct(worstSwapPct + worstRedeemPct)\n    } else {\n      Doc.hide(page.vFeeSummaryPct)\n      Doc.show(page.vFeeSummary)\n      page.summarySwapFeesLow.textContent = page.vSwapFeesLow.textContent\n      page.summarySwapFeesHigh.textContent = page.vSwapFeesHigh.textContent\n      page.summaryRedeemFeesLow.textContent = page.vRedeemFeesLow.textContent\n      page.summaryRedeemFeesHigh.textContent = page.vRedeemFeesHigh.textContent\n    }\n  }\n\n  async submitCancel () {\n    // this will be the page.cancelSubmit button (evt.currentTarget)\n    const page = this.page\n    const cancelData = this.cancelData\n    const order = cancelData.order\n    const req = {\n      orderID: order.id,\n      pw: page.cancelPass.value\n    }\n    page.cancelPass.value = ''\n    // Toggle the loader and submit button.\n    const loaded = app().loading(page.cancelSubmit)\n    const res = await postJSON('/api/cancel', req)\n    loaded()\n    // Display error on confirmation modal.\n    if (!app().checkResponse(res)) {\n      page.cancelErr.textContent = res.msg\n      Doc.show(page.cancelErr)\n      return\n    }\n    // Hide confirmation modal only on success.\n    Doc.hide(cancelData.bttn, page.forms)\n    order.cancelling = true\n  }\n\n  /* showCancel shows a form to confirm submission of a cancel order. */\n  showCancel (row: HTMLElement, orderID: string) {\n    const ord = this.metaOrders[orderID].ord\n    const page = this.page\n    const remaining = ord.qty - ord.filled\n    const asset = OrderUtil.isMarketBuy(ord) ? this.market.quote : this.market.base\n    page.cancelRemain.textContent = Doc.formatCoinValue(remaining, asset.unitInfo)\n    page.cancelUnit.textContent = asset.symbol.toUpperCase()\n    Doc.hide(page.cancelErr)\n    this.showForm(page.cancelForm)\n    page.cancelPass.focus()\n    this.cancelData = {\n      bttn: Doc.tmplElement(row, 'cancelBttn'),\n      order: ord\n    }\n  }\n\n  /* showAccelerate shows the accelerate order form. */\n  showAccelerate (order: Order) {\n    const loaded = app().loading(this.main)\n    this.accelerateOrderForm.refresh(order)\n    loaded()\n    this.showForm(this.page.accelerateForm)\n  }\n\n  /* showCreate shows the new wallet creation form. */\n  showCreate (asset: SupportedAsset) {\n    const page = this.page\n    this.currentCreate = asset\n    this.newWalletForm.setAsset(asset.id)\n    this.showForm(page.newWalletForm)\n  }\n\n  /*\n   * stepSubmit will examine the current state of wallets and step the user\n   * through the process of order submission.\n   * NOTE: I expect this process will be streamlined soon such that the wallets\n   * will attempt to be unlocked in the order submission process, negating the\n   * need to unlock ahead of time.\n   */\n  stepSubmit () {\n    const page = this.page\n    const market = this.market\n    Doc.hide(page.orderErr)\n    if (!this.validateOrder(this.parseOrder())) return\n    const baseWallet = app().walletMap[market.base.id]\n    const quoteWallet = app().walletMap[market.quote.id]\n    if (!baseWallet) {\n      page.orderErr.textContent = intl.prep(intl.ID_NO_ASSET_WALLET, { asset: market.base.symbol })\n      Doc.show(page.orderErr)\n      return\n    }\n    if (!quoteWallet) {\n      page.orderErr.textContent = intl.prep(intl.ID_NO_ASSET_WALLET, { asset: market.quote.symbol })\n      Doc.show(page.orderErr)\n      return\n    }\n    this.showVerify()\n  }\n\n  /* Display a deposit address. */\n  async showDeposit (assetID: number) {\n    this.depositAddrForm.setAsset(assetID)\n    this.showForm(this.page.deposit)\n  }\n\n  /*\n   * handlePriceUpdate is the handler for the 'spots' notification.\n   */\n  handlePriceUpdate (note: SpotPriceNote) {\n    if (note.host === this.market.dex.host && note.spots[this.market.cfg.name]) {\n      this.setCurrMarketPrice()\n    }\n    this.marketList.updateSpots(note)\n  }\n\n  /*\n   * handleBondUpdate is the handler for the 'bondpost' notification type.\n   * This is used to update the registration status of the current exchange.\n   */\n  async handleBondUpdate (note: BondNote) {\n    const dexAddr = note.dex\n    if (dexAddr !== this.market.dex.host) return\n    // If we just finished legacy registration, we need to update the Exchange.\n    // TODO: Use tier change notification once available.\n    if (note.topic === 'AccountRegistered') await app().fetchUser()\n    // Update local copy of Exchange.\n    this.market.dex = app().exchanges[dexAddr]\n    this.setRegistrationStatusVisibility()\n  }\n\n  handleMatchNote (note: MatchNote) {\n    const mord = this.metaOrders[note.orderID]\n    if (!mord) return this.refreshActiveOrders()\n    if (app().canAccelerateOrder(mord.ord)) Doc.show(mord.details.accelerateBttn)\n    else Doc.hide(mord.details.accelerateBttn)\n  }\n\n  /*\n   * handleOrderNote is the handler for the 'order'-type notification, which are\n   * used to update a user's order's status.\n   */\n  handleOrderNote (note: OrderNote) {\n    const order = note.order\n    const mord = this.metaOrders[order.id]\n    // - If metaOrder doesn't exist for the given order it means it was created\n    //  via dexcctl and the GUI isn't aware of it or it was an inflight order.\n    //  refreshActiveOrders must be called to grab this order.\n    // - If an OrderLoaded notification is recieved, it means an order that was\n    //   previously not \"ready to tick\" (due to its wallets not being connected\n    //   and unlocked) has now become ready to tick. The active orders section\n    //   needs to be refreshed.\n    if (!mord || note.topic === 'AsyncOrderFailure' || (note.topic === 'OrderLoaded' && order.readyToTick)) {\n      return this.refreshActiveOrders()\n    }\n    const oldStatus = mord.status\n    mord.ord = order\n    if (note.topic === 'MissedCancel') Doc.show(mord.details.cancelBttn)\n    if (order.filled === order.qty) Doc.hide(mord.details.cancelBttn)\n    if (app().canAccelerateOrder(order)) Doc.show(mord.details.accelerateBttn)\n    else Doc.hide(mord.details.accelerateBttn)\n    this.updateMetaOrder(mord)\n    // Only reset markers if there is a change, since the chart is redrawn.\n    if ((oldStatus === OrderUtil.StatusEpoch && order.status === OrderUtil.StatusBooked) ||\n      (oldStatus === OrderUtil.StatusBooked && order.status > OrderUtil.StatusBooked)) this.setDepthMarkers()\n  }\n\n  /*\n   * handleEpochNote handles notifications signalling the start of a new epoch.\n   */\n  handleEpochNote (note: EpochNote) {\n    app().log('book', 'handleEpochNote:', note)\n    if (note.host !== this.market.dex.host || note.marketID !== this.market.sid) return\n    if (this.book) {\n      this.book.setEpoch(note.epoch)\n      this.depthChart.draw()\n    }\n\n    this.clearOrderTableEpochs()\n    for (const { ord, details, header } of Object.values(this.metaOrders)) {\n      const alreadyMatched = note.epoch > ord.epoch\n      switch (true) {\n        case ord.type === OrderUtil.Limit && ord.status === OrderUtil.StatusEpoch && alreadyMatched: {\n          const status = ord.tif === OrderUtil.ImmediateTiF ? intl.prep(intl.ID_EXECUTED) : intl.prep(intl.ID_BOOKED)\n          details.status.textContent = header.status.textContent = status\n          ord.status = ord.tif === OrderUtil.ImmediateTiF ? OrderUtil.StatusExecuted : OrderUtil.StatusBooked\n          break\n        }\n        case ord.type === OrderUtil.Market && ord.status === OrderUtil.StatusEpoch:\n          // Technically don't know if this should be 'executed' or 'settling'.\n          details.status.textContent = header.status.textContent = intl.prep(intl.ID_EXECUTED)\n          ord.status = OrderUtil.StatusExecuted\n          break\n      }\n    }\n  }\n\n  /*\n   * recentMatchesSortCompare returns sort compare function according to the active\n   * sort key and direction.\n   */\n  recentMatchesSortCompare () {\n    switch (this.recentMatchesSortKey) {\n      case 'rate':\n        return (a: RecentMatch, b: RecentMatch) => this.recentMatchesSortDirection * (a.rate - b.rate)\n      case 'qty':\n        return (a: RecentMatch, b: RecentMatch) => this.recentMatchesSortDirection * (a.qty - b.qty)\n      case 'age':\n        return (a: RecentMatch, b:RecentMatch) => this.recentMatchesSortDirection * (a.stamp - b.stamp)\n    }\n  }\n\n  refreshRecentMatchesTable () {\n    const page = this.page\n    const recentMatches = this.recentMatches\n    Doc.empty(page.recentMatchesLiveList)\n    if (!recentMatches) return\n    const compare = this.recentMatchesSortCompare()\n    recentMatches.sort(compare)\n    for (const match of recentMatches) {\n      const row = page.recentMatchesTemplate.cloneNode(true) as HTMLElement\n      const tmpl = Doc.parseTemplate(row)\n      app().bindTooltips(row)\n      tmpl.rate.textContent = Doc.formatCoinValue(match.rate / this.market.rateConversionFactor)\n      tmpl.qty.textContent = Doc.formatCoinValue(match.qty, this.market.baseUnitInfo)\n      tmpl.age.textContent = Doc.timeSince(match.stamp)\n      tmpl.age.dataset.sinceStamp = String(match.stamp)\n      row.classList.add(match.sell ? 'sellcolor' : 'buycolor')\n      page.recentMatchesLiveList.append(row)\n    }\n  }\n\n  addRecentMatches (matches: RecentMatch[]) {\n    this.recentMatches = [...matches, ...this.recentMatches].slice(0, 100)\n  }\n\n  setBalanceVisibility () {\n    const mkt = this.market\n    if (!mkt || !mkt.dex) return\n    this.balanceWgt.setBalanceVisibility(mkt.dex.connectionStatus === ConnectionStatus.Connected)\n  }\n\n  /* handleBalanceNote handles notifications updating a wallet's balance. */\n  handleBalanceNote (note: BalanceNote) {\n    this.setBalanceVisibility()\n    this.preorderCache = {} // invalidate previous preorder results\n    // if connection to dex server fails, it is not possible to retrieve\n    // markets.\n    const mkt = this.market\n    if (!mkt || !mkt.dex || mkt.dex.connectionStatus !== ConnectionStatus.Connected) return\n    // If there's a balance update, refresh the max order section.\n    const avail = note.balance.available\n    switch (note.assetID) {\n      case mkt.baseCfg.id:\n        // If we're not showing the max order panel yet, don't do anything.\n        if (!mkt.maxSell) break\n        if (typeof mkt.sellBalance === 'number' && mkt.sellBalance !== avail) mkt.maxSell = null\n        if (this.isSell()) this.preSell()\n        break\n      case mkt.quoteCfg.id:\n        if (!Object.keys(mkt.maxBuys).length) break\n        if (typeof mkt.buyBalance === 'number' && mkt.buyBalance !== avail) mkt.maxBuys = {}\n        if (!this.isSell()) this.preBuy()\n    }\n  }\n\n  /*\n   * submitOrder is attached to the affirmative button on the order validation\n   * form. Clicking the button is the last step in the order submission process.\n   */\n  async submitOrder () {\n    const page = this.page\n    Doc.hide(page.orderErr, page.vErr)\n    const order = this.currentOrder\n    const pw = page.vPass.value\n    page.vPass.value = ''\n    const req = {\n      order: wireOrder(order),\n      pw: pw\n    }\n    if (!this.validateOrder(order)) return\n    // Show loader and hide submit button.\n    page.vSubmit.classList.add('d-hide')\n    page.vLoader.classList.remove('d-hide')\n    const res = await postJSON('/api/tradeasync', req)\n    // Hide loader and show submit button.\n    page.vSubmit.classList.remove('d-hide')\n    page.vLoader.classList.add('d-hide')\n    // If error, display error on confirmation modal.\n    if (!app().checkResponse(res)) {\n      page.vErr.textContent = res.msg\n      Doc.show(page.vErr)\n      return\n    }\n    // Hide confirmation modal only on success.\n    Doc.hide(page.forms)\n    this.refreshActiveOrders()\n  }\n\n  /*\n   * createWallet is attached to successful submission of the wallet creation\n   * form. createWallet is only called once the form is submitted and a success\n   * response is received from the client.\n   */\n  async createWallet () {\n    const user = await app().fetchUser()\n    if (!user) return\n    const asset = user.assets[this.currentCreate.id]\n    Doc.hide(this.page.forms)\n    this.balanceWgt.updateAsset(asset.id)\n    Doc.setVis(!(this.market.base.wallet && this.market.quote.wallet), this.page.noWallet)\n    this.resolveOrderFormVisibility()\n  }\n\n  /*\n   * walletUnlocked is attached to successful submission of the wallet unlock\n   * form. walletUnlocked is only called once the form is submitted and a\n   * success response is received from the client.\n   */\n  async walletUnlocked () {\n    Doc.hide(this.page.forms)\n    this.balanceWgt.updateAsset(this.openAsset.id)\n  }\n\n  /* lotChanged is attached to the keyup and change events of the lots input. */\n  lotChanged () {\n    const page = this.page\n    const lots = parseInt(page.lotField.value || '0')\n    if (lots <= 0) {\n      page.lotField.value = '0'\n      page.qtyField.value = ''\n      this.previewQuoteAmt(false)\n      return\n    }\n    const lotSize = this.market.cfg.lotsize\n    page.lotField.value = String(lots)\n    // Conversion factor must be a multiple of 10.\n    page.qtyField.value = String(lots * lotSize / this.market.baseUnitInfo.conventional.conversionFactor)\n    this.previewQuoteAmt(true)\n  }\n\n  /*\n   * quantityChanged is attached to the keyup and change events of the quantity\n   * input.\n   */\n  quantityChanged (finalize: boolean) {\n    const page = this.page\n    const order = this.parseOrder()\n    if (order.qty < 0) {\n      page.lotField.value = '0'\n      page.qtyField.value = ''\n      this.previewQuoteAmt(false)\n      return\n    }\n    const lotSize = this.market.cfg.lotsize\n    const lots = Math.floor(order.qty / lotSize)\n    const adjusted = lots * lotSize\n    page.lotField.value = String(lots)\n    if (!order.isLimit && !order.sell) return\n    // Conversion factor must be a multiple of 10.\n    if (finalize) page.qtyField.value = String(adjusted / this.market.baseUnitInfo.conventional.conversionFactor)\n    this.previewQuoteAmt(true)\n  }\n\n  /*\n   * marketBuyChanged is attached to the keyup and change events of the quantity\n   * input for the market-buy form.\n   */\n  marketBuyChanged () {\n    const page = this.page\n    const qty = convertToAtoms(page.mktBuyField.value || '', this.market.quoteUnitInfo.conventional.conversionFactor)\n    const gap = this.midGap()\n    if (!gap || !qty) {\n      page.mktBuyLots.textContent = '0'\n      page.mktBuyScore.textContent = '0'\n      return\n    }\n    const lotSize = this.market.cfg.lotsize\n    const received = qty / gap\n    page.mktBuyLots.textContent = (received / lotSize).toFixed(1)\n    page.mktBuyScore.textContent = Doc.formatCoinValue(received, this.market.baseUnitInfo)\n  }\n\n  /*\n   * rateFieldChanged is attached to the keyup and change events of the rate\n   * input.\n   */\n  rateFieldChanged () {\n    // Truncate to rate step. If it is a market buy order, do not adjust.\n    const adjusted = this.adjustedRate()\n    if (adjusted <= 0) {\n      this.depthLines.input = []\n      this.drawChartLines()\n      this.page.rateField.value = '0'\n      return\n    }\n    const order = this.parseOrder()\n    const r = adjusted / this.market.rateConversionFactor\n    this.page.rateField.value = String(r)\n    this.depthLines.input = [{\n      rate: r,\n      color: order.sell ? this.depthChart.theme.sellLine : this.depthChart.theme.buyLine\n    }]\n    this.drawChartLines()\n    this.previewQuoteAmt(true)\n  }\n\n  /*\n   * adjustedRate is the current rate field rate, rounded down to a\n   * multiple of rateStep.\n   */\n  adjustedRate (): number {\n    const v = this.page.rateField.value\n    if (!v) return NaN\n    const rate = convertToAtoms(v, this.market.rateConversionFactor)\n    const rateStep = this.market.cfg.ratestep\n    return rate - (rate % rateStep)\n  }\n\n  /* loadTable reloads the table from the current order book information. */\n  loadTable () {\n    this.loadTableSide(true)\n    this.loadTableSide(false)\n  }\n\n  /* binOrdersByRateAndEpoch takes a list of sorted orders and returns the\n     same orders grouped into arrays. The orders are grouped by their rate\n     and whether or not they are epoch queue orders. Epoch queue orders\n     will come after non epoch queue orders with the same rate. */\n  binOrdersByRateAndEpoch (orders: MiniOrder[]) {\n    if (!orders || !orders.length) return []\n    const bins = []\n    let currEpochBin = []\n    let currNonEpochBin = []\n    let currRate = orders[0].msgRate\n    if (orders[0].epoch) currEpochBin.push(orders[0])\n    else currNonEpochBin.push(orders[0])\n    for (let i = 1; i < orders.length; i++) {\n      if (orders[i].msgRate !== currRate) {\n        bins.push(currNonEpochBin)\n        bins.push(currEpochBin)\n        currEpochBin = []\n        currNonEpochBin = []\n        currRate = orders[i].msgRate\n      }\n      if (orders[i].epoch) currEpochBin.push(orders[i])\n      else currNonEpochBin.push(orders[i])\n    }\n    bins.push(currNonEpochBin)\n    bins.push(currEpochBin)\n    return bins.filter(bin => bin.length > 0)\n  }\n\n  /* loadTables loads the order book side into its table. */\n  loadTableSide (sell: boolean) {\n    const bookSide = sell ? this.book.sells : this.book.buys\n    const tbody = sell ? this.page.sellRows : this.page.buyRows\n    Doc.empty(tbody)\n    if (!bookSide || !bookSide.length) return\n    const orderBins = this.binOrdersByRateAndEpoch(bookSide)\n    orderBins.forEach(bin => { tbody.appendChild(this.orderTableRow(bin)) })\n  }\n\n  /* addTableOrder adds a single order to the appropriate table. */\n  addTableOrder (order: MiniOrder) {\n    const tbody = order.sell ? this.page.sellRows : this.page.buyRows\n    let row = tbody.firstChild as OrderRow\n    // Handle market order differently.\n    if (order.rate === 0) {\n      if (order.qtyAtomic === 0) return // a cancel order. TODO: maybe make an indicator on the target order, maybe gray out\n      // This is a market order.\n      if (row && row.manager.getRate() === 0) {\n        row.manager.insertOrder(order)\n      } else {\n        row = this.orderTableRow([order])\n        tbody.insertBefore(row, tbody.firstChild)\n      }\n      return\n    }\n    // Must be a limit order. Sort by rate. Skip the market order row.\n    if (row && row.manager.getRate() === 0) row = row.nextSibling as OrderRow\n    while (row) {\n      if (row.manager.compare(order) === 0) {\n        row.manager.insertOrder(order)\n        return\n      } else if (row.manager.compare(order) > 0) {\n        const tr = this.orderTableRow([order])\n        tbody.insertBefore(tr, row)\n        return\n      }\n      row = row.nextSibling as OrderRow\n    }\n    const tr = this.orderTableRow([order])\n    tbody.appendChild(tr)\n  }\n\n  /* removeTableOrder removes a single order from its table. */\n  removeTableOrder (order: MiniOrder) {\n    const token = order.token\n    for (const tbody of [this.page.sellRows, this.page.buyRows]) {\n      for (const tr of (Array.from(tbody.children) as OrderRow[])) {\n        if (tr.manager.removeOrder(token)) {\n          return\n        }\n      }\n    }\n  }\n\n  /* updateTableOrder looks for the order in the table and updates the qty */\n  updateTableOrder (u: RemainderUpdate) {\n    for (const tbody of [this.page.sellRows, this.page.buyRows]) {\n      for (const tr of (Array.from(tbody.children) as OrderRow[])) {\n        if (tr.manager.updateOrderQty(u)) {\n          return\n        }\n      }\n    }\n  }\n\n  /*\n   * clearOrderTableEpochs removes immediate-tif orders whose epoch has expired.\n   */\n  clearOrderTableEpochs () {\n    this.clearOrderTableEpochSide(this.page.sellRows)\n    this.clearOrderTableEpochSide(this.page.buyRows)\n  }\n\n  /*\n   * clearOrderTableEpochs removes immediate-tif orders whose epoch has expired\n   * for a single side.\n   */\n  clearOrderTableEpochSide (tbody: HTMLElement) {\n    for (const tr of (Array.from(tbody.children)) as OrderRow[]) {\n      tr.manager.removeEpochOrders()\n    }\n  }\n\n  /*\n   * orderTableRow creates a new <tr> element to insert into an order table.\n     Takes a bin of orders with the same rate, and displays the total quantity.\n   */\n  orderTableRow (orderBin: MiniOrder[]): OrderRow {\n    const tr = this.page.rowTemplate.cloneNode(true) as OrderRow\n    const { baseUnitInfo, rateConversionFactor } = this.market\n    const manager = new OrderTableRowManager(tr, orderBin, baseUnitInfo, rateConversionFactor)\n    tr.manager = manager\n    bind(tr, 'click', () => {\n      this.reportDepthClick(tr.manager.getRate() / rateConversionFactor)\n    })\n    if (tr.manager.getRate() !== 0) {\n      Doc.bind(tr, 'mouseenter', () => {\n        const chart = this.depthChart\n        this.depthLines.hover = [{\n          rate: tr.manager.getRate() / rateConversionFactor,\n          color: tr.manager.isSell() ? chart.theme.sellLine : chart.theme.buyLine\n        }]\n        this.drawChartLines()\n      })\n    }\n    return tr\n  }\n\n  /* handleConnNote handles the 'conn' notification.\n   */\n  async handleConnNote (note: ConnEventNote) {\n    this.marketList.setConnectionStatus(note)\n    if (note.connectionStatus === ConnectionStatus.Connected) {\n      // Having been disconnected from a DEX server, anything may have changed,\n      // or this may be the first opportunity to get the server's config, so\n      // fetch it all before reloading the markets page.\n      await app().fetchUser()\n      await app().loadPage('markets')\n    }\n  }\n\n  /*\n   * filterMarkets sets the display of markets in the markets list based on the\n   * value of the search input.\n   */\n  filterMarkets () {\n    const filterTxt = this.page.marketSearchV1.value?.toLowerCase()\n    const filter = filterTxt ? (mkt: MarketRow) => mkt.name.includes(filterTxt) : () => true\n    this.marketList.setFilter(filter)\n  }\n\n  /* drawChartLines draws the hover and input lines on the chart. */\n  drawChartLines () {\n    this.depthChart.setLines([...this.depthLines.hover, ...this.depthLines.input])\n    this.depthChart.draw()\n  }\n\n  /* candleDurationSelected sets the candleDur and loads the candles. It will\n  default to the oneHrBinKey if dur is not valid. */\n  candleDurationSelected (dur: string) {\n    if (!this.market?.dex?.candleDurs.includes(dur)) dur = oneHrBinKey\n    this.candleDur = dur\n    this.loadCandles()\n    State.storeLocal(State.lastCandleDurationLK, dur)\n  }\n\n  /*\n   * loadCandles loads the candles for the current candleDur. If a cache is already\n   * active, the cache will be used without a loadcandles request.\n   */\n  loadCandles () {\n    for (const bttn of Doc.kids(this.page.durBttnBox)) {\n      if (bttn.textContent === this.candleDur) bttn.classList.add('selected')\n      else bttn.classList.remove('selected')\n    }\n    const { candleCaches, cfg, baseUnitInfo, quoteUnitInfo } = this.market\n    const cache = candleCaches[this.candleDur]\n    if (cache) {\n      // this.depthChart.hide()\n      // this.candleChart.show()\n      this.candleChart.setCandles(cache, cfg, baseUnitInfo, quoteUnitInfo)\n      return\n    }\n    this.requestCandles()\n  }\n\n  /* requestCandles sends the loadcandles request. It accepts an optional candle\n   * duration which will be requested if it is provided.\n   */\n  requestCandles (candleDur?: string) {\n    this.candlesLoading = {\n      loaded: () => { /* pass */ },\n      timer: window.setTimeout(() => {\n        if (this.candlesLoading) {\n          this.candlesLoading = null\n          console.error('candles not received')\n        }\n      }, 10000)\n    }\n    const { dex, baseCfg, quoteCfg } = this.market\n    ws.request('loadcandles', { host: dex.host, base: baseCfg.id, quote: quoteCfg.id, dur: candleDur || this.candleDur })\n  }\n\n  /*\n   * unload is called by the Application when the user navigates away from\n   * the /markets page.\n   */\n  unload () {\n    ws.request(unmarketRoute, {})\n    ws.deregisterRoute(bookRoute)\n    ws.deregisterRoute(bookOrderRoute)\n    ws.deregisterRoute(unbookOrderRoute)\n    ws.deregisterRoute(updateRemainingRoute)\n    ws.deregisterRoute(epochOrderRoute)\n    ws.deregisterRoute(candlesRoute)\n    ws.deregisterRoute(candleUpdateRoute)\n    this.depthChart.unattach()\n    this.candleChart.unattach()\n    Doc.unbind(document, 'keyup', this.keyup)\n    clearInterval(this.secondTicker)\n  }\n}\n\n/*\n *  MarketList represents the list of exchanges and markets on the left side of\n * markets view. The MarketList provides utilities for adjusting the visibility\n * and sort order of markets.\n */\nclass MarketList {\n  // xcSections: ExchangeSection[]\n  div: PageElement\n  rowTmpl: PageElement\n  markets: MarketRow[]\n  selected: MarketRow\n\n  constructor (div: HTMLElement) {\n    this.div = div\n    this.rowTmpl = Doc.idel(div, 'marketTmplV1')\n    Doc.cleanTemplates(this.rowTmpl)\n    this.reloadMarketsPane()\n  }\n\n  updateSpots (note: SpotPriceNote) {\n    for (const row of this.markets) {\n      if (row.mkt.xc.host !== note.host) continue\n      const spot = note.spots[row.mkt.name]\n      if (!spot) return\n      const xc = app().exchanges[row.mkt.xc.host]\n      const mkt = xc.markets[row.mkt.name]\n      setPriceAndChange(row.tmpl, xc, mkt)\n    }\n  }\n\n  reloadMarketsPane (): void {\n    Doc.empty(this.div)\n    this.markets = []\n\n    const addMarket = (mkt: ExchangeMarket) => {\n      const bui = app().unitInfo(mkt.baseid, mkt.xc)\n      const qui = app().unitInfo(mkt.quoteid, mkt.xc)\n      const rateConversionFactor = OrderUtil.RateEncodingFactor / bui.conventional.conversionFactor * qui.conventional.conversionFactor\n      const row = new MarketRow(this.rowTmpl, mkt, rateConversionFactor)\n      this.div.appendChild(row.node)\n      return row\n    }\n\n    for (const mkt of sortedMarkets()) this.markets.push(addMarket(mkt))\n    app().bindTooltips(this.div)\n  }\n\n  find (host: string, baseID: number, quoteID: number): MarketRow | null {\n    for (const row of this.markets) {\n      if (row.mkt.xc.host === host && row.mkt.baseid === baseID && row.mkt.quoteid === quoteID) return row\n    }\n    return null\n  }\n\n  /* exists will be true if the specified market exists. */\n  exists (host: string, baseID: number, quoteID: number): boolean {\n    return this.find(host, baseID, quoteID) !== null\n  }\n\n  /* first gets the first market from the first exchange, alphabetically. */\n  first (): MarketRow {\n    return this.markets[0]\n  }\n\n  /* select sets the specified market as selected. */\n  select (host: string, baseID: number, quoteID: number) {\n    const row = this.find(host, baseID, quoteID)\n    if (!row) return console.error(`select: no market row for ${host}, ${baseID}-${quoteID}`)\n    for (const mkt of this.markets) mkt.node.classList.remove('selected')\n    this.selected = row\n    this.selected.node.classList.add('selected')\n  }\n\n  /* setConnectionStatus sets the visibility of the disconnected icon based\n   * on the core.ConnEventNote.\n   */\n  setConnectionStatus (note: ConnEventNote) {\n    for (const row of this.markets) {\n      if (row.mkt.xc.host !== note.host) continue\n      if (note.connectionStatus === ConnectionStatus.Connected) Doc.hide(row.tmpl.disconnectedIco)\n      else Doc.show(row.tmpl.disconnectedIco)\n    }\n  }\n\n  /*\n   * setFilter sets the visibility of market rows based on the provided filter.\n   */\n  setFilter (filter: (mkt: MarketRow) => boolean) {\n    for (const row of this.markets) {\n      if (filter(row)) Doc.show(row.node)\n      else Doc.hide(row.node)\n    }\n  }\n}\n\n/*\n * MarketRow represents one row in the MarketList. A MarketRow is a subsection\n * of the ExchangeSection.\n */\nclass MarketRow {\n  node: HTMLElement\n  mkt: ExchangeMarket\n  name: string\n  baseID: number\n  quoteID: number\n  lotSize: number\n  rateStep: number\n  tmpl: Record<string, PageElement>\n  rateConversionFactor: number\n\n  constructor (template: HTMLElement, mkt: ExchangeMarket, rateConversionFactor: number) {\n    this.mkt = mkt\n    this.name = mkt.name\n    this.baseID = mkt.baseid\n    this.quoteID = mkt.quoteid\n    this.lotSize = mkt.lotsize\n    this.rateStep = mkt.ratestep\n    this.rateConversionFactor = rateConversionFactor\n    this.node = template.cloneNode(true) as HTMLElement\n    const tmpl = this.tmpl = Doc.parseTemplate(this.node)\n    tmpl.baseIcon.src = Doc.logoPath(mkt.basesymbol)\n    tmpl.quoteIcon.src = Doc.logoPath(mkt.quotesymbol)\n    tmpl.baseSymbol.appendChild(Doc.symbolize(mkt.basesymbol))\n    tmpl.quoteSymbol.appendChild(Doc.symbolize(mkt.quotesymbol))\n    tmpl.baseName.textContent = mkt.baseName\n    tmpl.host.textContent = mkt.xc.host\n    tmpl.host.style.color = hostColor(mkt.xc.host)\n    tmpl.host.dataset.tooltip = mkt.xc.host\n    setPriceAndChange(tmpl, mkt.xc, mkt)\n    if (this.mkt.xc.connectionStatus !== ConnectionStatus.Connected) Doc.show(tmpl.disconnectedIco)\n  }\n}\n\ninterface BalanceWidgetElement {\n  id: number\n  parentID: number\n  cfg: Asset | null\n  node: PageElement\n  tmpl: Record<string, PageElement>\n  iconBox: PageElement\n  stateIcons: WalletIcons\n  parentBal?: PageElement\n}\n\n/*\n * BalanceWidget is a display of balance information. Because the wallet can be\n * in any number of states, and because every exchange has different funding\n * coin confirmation requirements, the BalanceWidget displays a number of state\n * indicators and buttons, as well as tabulated balance data with rows for\n * locked and immature balance.\n */\nclass BalanceWidget {\n  base: BalanceWidgetElement\n  quote: BalanceWidgetElement\n  // parentRow: PageElement\n  dex: Exchange\n\n  constructor (base: HTMLElement, quote: HTMLElement) {\n    Doc.hide(base, quote)\n    const btmpl = Doc.parseTemplate(base)\n    this.base = {\n      id: 0,\n      parentID: parentIDNone,\n      cfg: null,\n      node: base,\n      tmpl: btmpl,\n      iconBox: btmpl.walletState,\n      stateIcons: new WalletIcons(btmpl.walletState)\n    }\n    btmpl.balanceRowTmpl.remove()\n\n    const qtmpl = Doc.parseTemplate(quote)\n    this.quote = {\n      id: 0,\n      parentID: parentIDNone,\n      cfg: null,\n      node: quote,\n      tmpl: qtmpl,\n      iconBox: qtmpl.walletState,\n      stateIcons: new WalletIcons(qtmpl.walletState)\n    }\n    qtmpl.balanceRowTmpl.remove()\n\n    app().registerNoteFeeder({\n      balance: (note: BalanceNote) => { this.updateAsset(note.assetID) },\n      walletstate: (note: WalletStateNote) => { this.updateAsset(note.wallet.assetID) },\n      createwallet: (note: WalletCreationNote) => { this.updateAsset(note.assetID) }\n    })\n  }\n\n  setBalanceVisibility (connected: boolean) {\n    if (connected) Doc.show(this.base.node, this.quote.node)\n    else Doc.hide(this.base.node, this.quote.node)\n  }\n\n  /*\n   * setWallet sets the balance widget to display data for specified market.\n   */\n  setWallets (host: string, baseID: number, quoteID: number) {\n    const parentID = (assetID: number) => {\n      const asset = app().assets[assetID]\n      if (asset?.token) return asset.token.parentID\n      return parentIDNone\n    }\n    this.dex = app().user.exchanges[host]\n    this.base.id = baseID\n    this.base.parentID = parentID(baseID)\n    this.base.cfg = this.dex.assets[baseID]\n    this.quote.id = quoteID\n    this.quote.parentID = parentID(quoteID)\n    this.quote.cfg = this.dex.assets[quoteID]\n    this.updateWallet(this.base)\n    this.updateWallet(this.quote)\n  }\n\n  /*\n   * updateWallet updates the displayed wallet information based on the\n   * core.Wallet state.\n   */\n  updateWallet (side: BalanceWidgetElement) {\n    const { cfg, tmpl, iconBox, stateIcons, id: assetID } = side\n    if (!cfg) return // no wallet set yet\n    const asset = app().assets[assetID]\n    // Just hide everything to start.\n    Doc.hide(\n      tmpl.newWalletRow, tmpl.expired, tmpl.unsupported, tmpl.connect, tmpl.spinner,\n      tmpl.walletState, tmpl.balanceRows, tmpl.walletAddr\n    )\n    tmpl.logo.src = Doc.logoPath(cfg.symbol)\n    tmpl.addWalletSymbol.textContent = cfg.symbol.toUpperCase()\n    Doc.empty(tmpl.symbol)\n    tmpl.symbol.appendChild(Doc.symbolize(cfg.symbol))\n    // Handle an unsupported asset.\n    if (!asset) {\n      Doc.show(tmpl.unsupported)\n      return\n    }\n    Doc.show(iconBox)\n    const wallet = asset.wallet\n    stateIcons.readWallet(wallet)\n    // Handle no wallet configured.\n    if (!wallet) {\n      if (asset.walletCreationPending) {\n        Doc.show(tmpl.spinner)\n        return\n      }\n      Doc.show(tmpl.newWalletRow)\n      return\n    }\n    Doc.show(tmpl.walletAddr)\n    // Parent asset\n    const bal = wallet.balance\n    // Handle not connected and no balance known for the DEX.\n    if (!bal && !wallet.running && !wallet.disabled) {\n      Doc.show(tmpl.connect)\n      return\n    }\n    // If there is no balance, but the wallet is connected, show the loading\n    // icon while we fetch an update.\n    if (!bal) {\n      app().fetchBalance(assetID)\n      Doc.show(tmpl.spinner)\n      return\n    }\n\n    // We have a wallet and a DEX-specific balance. Set all of the fields.\n    Doc.show(tmpl.balanceRows)\n    Doc.empty(tmpl.balanceRows)\n    const addRow = (title: string, bal: number, ui: UnitInfo, icon?: PageElement) => {\n      const row = tmpl.balanceRowTmpl.cloneNode(true) as PageElement\n      tmpl.balanceRows.appendChild(row)\n      const balTmpl = Doc.parseTemplate(row)\n      balTmpl.title.textContent = title\n      balTmpl.bal.textContent = Doc.formatCoinValue(bal, ui)\n      if (icon) {\n        balTmpl.bal.append(icon)\n        side.parentBal = balTmpl.bal\n      }\n    }\n\n    addRow(intl.prep(intl.ID_AVAILABLE), bal.available, asset.unitInfo)\n    addRow(intl.prep(intl.ID_LOCKED), bal.locked + bal.contractlocked + bal.bondlocked, asset.unitInfo)\n    addRow(intl.prep(intl.ID_IMMATURE), bal.immature, asset.unitInfo)\n    if (asset.token) {\n      const { wallet: { balance }, unitInfo, symbol } = app().assets[asset.token.parentID]\n      const icon = document.createElement('img')\n      icon.src = Doc.logoPath(symbol)\n      icon.classList.add('micro-icon')\n      addRow(intl.prep(intl.ID_FEE_BALANCE), balance.available, unitInfo, icon)\n    }\n\n    // If the current balance update time is older than an hour, show the\n    // expiration icon. Request a balance update, if possible.\n    const expired = new Date().getTime() - new Date(bal.stamp).getTime() > anHour\n    if (expired && !wallet.disabled) {\n      Doc.show(tmpl.expired)\n      if (wallet.running) app().fetchBalance(assetID)\n    } else Doc.hide(tmpl.expired)\n  }\n\n  /* updateParent updates the side's parent asset balance. */\n  updateParent (side: BalanceWidgetElement) {\n    const { wallet: { balance }, unitInfo } = app().assets[side.parentID]\n    // firstChild is the text node set before the img child node in addRow.\n    if (side.parentBal?.firstChild) side.parentBal.firstChild.textContent = Doc.formatCoinValue(balance.available, unitInfo)\n  }\n\n  /*\n   * updateAsset updates the info for one side of the existing market. If the\n   * specified asset ID is not one of the current market's base or quote assets,\n   * it is silently ignored.\n   */\n  updateAsset (assetID: number) {\n    if (assetID === this.base.id) this.updateWallet(this.base)\n    else if (assetID === this.quote.id) this.updateWallet(this.quote)\n    if (assetID === this.base.parentID) this.updateParent(this.base)\n    if (assetID === this.quote.parentID) this.updateParent(this.quote)\n  }\n}\n\n/* makeMarket creates a market object that specifies basic market details. */\nfunction makeMarket (host: string, base?: number, quote?: number) {\n  return {\n    host: host,\n    base: base,\n    quote: quote\n  }\n}\n\n/* marketID creates a DEX-compatible market name from the ticker symbols. */\nexport function marketID (b: string, q: string) { return `${b}_${q}` }\n\n/* convertToAtoms converts the float string to the basic unit of a coin. */\nfunction convertToAtoms (s: string, conversionFactor: number) {\n  if (!s) return 0\n  return Math.round(parseFloat(s) * conversionFactor)\n}\n\n/* swapBttns changes the 'selected' class of the buttons. */\nfunction swapBttns (before: HTMLElement, now: HTMLElement) {\n  before.classList.remove('selected')\n  now.classList.add('selected')\n}\n\n/*\n * wireOrder prepares a copy of the order with the options field converted to a\n * string -> string map.\n */\nfunction wireOrder (order: TradeForm) {\n  const stringyOptions: Record<string, string> = {}\n  for (const [k, v] of Object.entries(order.options)) stringyOptions[k] = JSON.stringify(v)\n  return Object.assign({}, order, { options: stringyOptions })\n}\n\n// OrderTableRowManager manages the data within a row in an order table. Each row\n// represents all the orders in the order book with the same rate, but orders that\n// are booked or still in the epoch queue are displayed in separate rows.\nclass OrderTableRowManager {\n  tableRow: HTMLElement\n  orderBin: MiniOrder[]\n  sell: boolean\n  msgRate: number\n  epoch: boolean\n  baseUnitInfo: UnitInfo\n  rateConversionFactor: number\n\n  constructor (tableRow: HTMLElement, orderBin: MiniOrder[], baseUnitInfo: UnitInfo, rateConversionFactor: number) {\n    this.tableRow = tableRow\n    this.orderBin = orderBin\n    this.sell = orderBin[0].sell\n    this.msgRate = orderBin[0].msgRate\n    this.epoch = !!orderBin[0].epoch\n    this.baseUnitInfo = baseUnitInfo\n    this.rateConversionFactor = rateConversionFactor\n    this.setRateEl()\n    this.setEpochEl()\n    this.updateQtyNumOrdersEl()\n  }\n\n  // setEpochEl displays a checkmark in the row if the orders represented by\n  // this row are in the epoch queue.\n  setEpochEl () {\n    const epochEl = Doc.tmplElement(this.tableRow, 'epoch')\n    if (this.isEpoch()) epochEl.appendChild(check.cloneNode())\n  }\n\n  // setRateEl popuplates the rate element in the row.\n  setRateEl () {\n    const rateEl = Doc.tmplElement(this.tableRow, 'rate')\n    if (this.msgRate === 0) {\n      rateEl.innerText = 'market'\n    } else {\n      const cssClass = this.isSell() ? 'sellcolor' : 'buycolor'\n      rateEl.innerText = Doc.formatFullPrecision(this.msgRate / this.rateConversionFactor)\n      rateEl.classList.add(cssClass)\n    }\n  }\n\n  // updateQtyNumOrdersEl populates the quantity element in the row, and also\n  // displays the number of orders if there is more than one order in the order\n  // bin.\n  updateQtyNumOrdersEl () {\n    const qty = this.orderBin.reduce((total, curr) => total + curr.qtyAtomic, 0)\n    const numOrders = this.orderBin.length\n    const qtyEl = Doc.tmplElement(this.tableRow, 'qty')\n    const numOrdersEl = Doc.tmplElement(this.tableRow, 'numorders')\n    qtyEl.innerText = Doc.formatFullPrecision(qty, this.baseUnitInfo)\n    if (numOrders > 1) {\n      numOrdersEl.removeAttribute('hidden')\n      numOrdersEl.innerText = String(numOrders)\n      numOrdersEl.title = `quantity is comprised of ${numOrders} orders`\n    } else {\n      numOrdersEl.setAttribute('hidden', 'true')\n    }\n  }\n\n  // insertOrder adds an order to the order bin and updates the row elements\n  // accordingly.\n  insertOrder (order: MiniOrder) {\n    this.orderBin.push(order)\n    this.updateQtyNumOrdersEl()\n  }\n\n  // updateOrderQuantity updates the quantity of the order identified by a token,\n  // if it exists in the row, and updates the row elements accordingly. The function\n  // returns true if the order is in the bin, and false otherwise.\n  updateOrderQty (update: RemainderUpdate) {\n    const { token, qty, qtyAtomic } = update\n    for (let i = 0; i < this.orderBin.length; i++) {\n      if (this.orderBin[i].token === token) {\n        this.orderBin[i].qty = qty\n        this.orderBin[i].qtyAtomic = qtyAtomic\n        this.updateQtyNumOrdersEl()\n        return true\n      }\n    }\n    return false\n  }\n\n  // removeOrder removes the order identified by the token, if it exists in the row,\n  // and updates the row elements accordingly. If the order bin is empty, the row is\n  // removed from the screen. The function returns true if an order was removed, and\n  // false otherwise.\n  removeOrder (token: string) {\n    const index = this.orderBin.findIndex(order => order.token === token)\n    if (index < 0) return false\n    this.orderBin.splice(index, 1)\n    if (!this.orderBin.length) this.tableRow.remove()\n    else this.updateQtyNumOrdersEl()\n    return true\n  }\n\n  // removeEpochOrders removes all the orders from the row that are not in the\n  // new epoch's epoch queue and updates the elements accordingly.\n  removeEpochOrders (newEpoch?: number) {\n    this.orderBin = this.orderBin.filter((order) => {\n      return !(order.epoch && order.epoch !== newEpoch)\n    })\n    if (!this.orderBin.length) this.tableRow.remove()\n    else this.updateQtyNumOrdersEl()\n  }\n\n  // getRate returns the rate of the orders in the row.\n  getRate () {\n    return this.msgRate\n  }\n\n  // isEpoch returns whether the orders in this row are in the epoch queue.\n  isEpoch () {\n    return this.epoch\n  }\n\n  // isSell returns whether the orders in this row are sell orders.\n  isSell () {\n    return this.sell\n  }\n\n  // compare takes an order and returns 0 if the order belongs in this row,\n  // 1 if the order should go after this row in the table, and -1 if it should\n  // be before this row in the table. Sell orders are displayed in ascending order,\n  // buy orders are displayed in descending order, and epoch orders always come\n  // after booked orders.\n  compare (order: MiniOrder) {\n    if (this.getRate() === order.msgRate && this.isEpoch() === !!order.epoch) {\n      return 0\n    } else if (this.getRate() !== order.msgRate) {\n      return (this.getRate() > order.msgRate) === order.sell ? 1 : -1\n    } else {\n      return this.isEpoch() ? 1 : -1\n    }\n  }\n}\n\ninterface ExchangeMarket extends Market {\n  xc: Exchange\n  baseName: string\n  bui: UnitInfo\n}\n\nfunction sortedMarkets (): ExchangeMarket[] {\n  const mkts: ExchangeMarket[] = []\n  const assets = app().assets\n  const convertMarkets = (xc: Exchange, mkts: Market[]) => {\n    return mkts.map((mkt: Market) => {\n      const a = assets[mkt.baseid]\n      const baseName = a ? a.name : mkt.basesymbol\n      const bui = app().unitInfo(mkt.baseid, xc)\n      return Object.assign({ xc, baseName, bui }, mkt)\n    })\n  }\n  for (const xc of Object.values(app().exchanges)) mkts.push(...convertMarkets(xc, Object.values(xc.markets || {})))\n  mkts.sort((a: ExchangeMarket, b: ExchangeMarket): number => {\n    if (!a.spot) {\n      if (b.spot) return 1 // put b first, since we have the spot\n      // no spots. compare market name then host name\n      if (a.name === b.name) return a.xc.host.localeCompare(b.xc.host)\n      return a.name.localeCompare(b.name)\n    } else if (!b.spot) return -1 // put a first, since we have the spot\n    const [aLots, bLots] = [a.spot.vol24 / a.lotsize, b.spot.vol24 / b.lotsize]\n    return bLots - aLots // whoever has more volume by lot count\n  })\n  return mkts\n}\n\nconst FourSigFigs = new Intl.NumberFormat((navigator.languages as string[]), {\n  maximumSignificantDigits: 4\n})\n\nconst OneFractionalDigit = new Intl.NumberFormat((navigator.languages as string[]), {\n  minimumFractionDigits: 1,\n  maximumFractionDigits: 1\n})\n\nfunction fourSigFigs (v: number) {\n  if (v >= 1000 || Math.round(v) === v) return OneFractionalDigit.format(v)\n  return FourSigFigs.format(v)\n}\n\nfunction setPriceAndChange (tmpl: Record<string, PageElement>, xc: Exchange, mkt: Market) {\n  if (!mkt.spot) return\n  tmpl.price.textContent = fourSigFigs(app().conventionalRate(mkt.baseid, mkt.quoteid, mkt.spot.rate, xc))\n  const sign = mkt.spot.change24 > 0 ? '+' : ''\n  tmpl.change.classList.remove('buycolor', 'sellcolor')\n  tmpl.change.classList.add(mkt.spot.change24 >= 0 ? 'buycolor' : 'sellcolor')\n  tmpl.change.textContent = `${sign}${(mkt.spot.change24 * 100).toFixed(1)}%`\n}\n\nconst hues = [1 / 2, 1 / 4, 3 / 4, 1 / 8, 5 / 8, 3 / 8, 7 / 8]\n\nfunction generateHue (idx: number): string {\n  const h = hues[idx % hues.length]\n  return `hsl(${h * 360}, 35%, 50%)`\n}\n\nfunction hostColor (host: string): string {\n  const hosts = Object.keys(app().exchanges)\n  hosts.sort()\n  return generateHue(hosts.indexOf(host))\n}\n","import Doc from './doc'\nimport BasePage from './basepage'\nimport * as OrderUtil from './orderutil'\nimport * as intl from './locales'\nimport { postJSON } from './http'\nimport {\n  app,\n  PageElement,\n  OrderFilter,\n  Order\n} from './registry'\n\nconst orderBatchSize = 50\nconst animationLength = 500\n\nexport default class OrdersPage extends BasePage {\n  main: HTMLElement\n  offset: string\n  loading: boolean\n  currentForm: PageElement\n  orderTmpl: PageElement\n  filterState: OrderFilter\n  page: Record<string, PageElement>\n\n  constructor (main: HTMLElement) {\n    super()\n    this.main = main\n    // if offset is '', there are no more orders available to auto-load for\n    // never-ending scrolling.\n    this.offset = ''\n    this.loading = false\n    const page = this.page = Doc.idDescendants(main)\n    this.orderTmpl = page.rowTmpl\n    this.orderTmpl.remove()\n\n    // filterState will store arrays of strings. The assets and statuses\n    // sub-filters will need to be converted to ints for JSON encoding.\n    const filterState: OrderFilter = this.filterState = {\n      hosts: [],\n      assets: [],\n      statuses: []\n    }\n\n    const search = new URLSearchParams(window.location.search)\n    const readFilter = (form: HTMLElement, filterKey: string) => {\n      const v = search.get(filterKey)\n      if (!v || v.length === 0) return\n      const subFilter = v.split(',')\n      if (v) {\n        (filterState as any)[filterKey] = subFilter // Kinda janky\n      }\n      form.querySelectorAll('input').forEach(bttn => {\n        if (subFilter.indexOf(bttn.value) >= 0) bttn.checked = true\n      })\n    }\n    readFilter(page.hostFilter, 'hosts')\n    readFilter(page.assetFilter, 'assets')\n    readFilter(page.statusFilter, 'statuses')\n\n    const applyButtons: HTMLElement[] = []\n    const monitorFilter = (form: HTMLElement, filterKey: string) => {\n      const applyBttn = form.querySelector('.apply-bttn') as HTMLElement\n      applyButtons.push(applyBttn)\n      Doc.bind(applyBttn, 'click', () => {\n        this.submitFilter()\n        applyButtons.forEach(bttn => Doc.hide(bttn))\n      })\n      form.querySelectorAll('input').forEach(bttn => {\n        Doc.bind(bttn, 'change', () => {\n          const subFilter = parseSubFilter(form)\n          if (compareSubFilter(subFilter, (filterState as any)[filterKey])) {\n            // Same as currently loaded. Hide the apply button.\n            Doc.hide(applyBttn)\n          } else {\n            Doc.show(applyBttn)\n          }\n        })\n      })\n    }\n\n    monitorFilter(page.hostFilter, 'hosts')\n    monitorFilter(page.assetFilter, 'assets')\n    monitorFilter(page.statusFilter, 'statuses')\n\n    Doc.bind(this.main, 'scroll', () => {\n      if (this.loading) return\n      const belowBottom = page.ordersTable.offsetHeight - this.main.offsetHeight - this.main.scrollTop\n      if (belowBottom < 0) {\n        this.nextPage()\n      }\n    })\n\n    page.forms.querySelectorAll('.form-closer').forEach(el => {\n      Doc.bind(el, 'click', () => {\n        Doc.hide(page.forms)\n      })\n    })\n\n    // If the user clicks outside of a form, it should close the page overlay.\n    Doc.bind(page.forms, 'mousedown', (e: MouseEvent) => {\n      if (!Doc.mouseInElement(e, this.currentForm)) {\n        Doc.hide(page.forms)\n      }\n    })\n\n    Doc.bind(page.exportOrders, 'click', () => {\n      this.exportOrders()\n    })\n\n    page.showArchivedDateField.addEventListener('change', () => {\n      if (page.showArchivedDateField.checked) Doc.show(page.archivedDateField)\n      else Doc.hide(page.archivedDateField, page.deleteArchivedRecordsErr)\n    })\n\n    Doc.bind(page.deleteArchivedRecords, 'click', () => {\n      const page = this.page\n      page.showArchivedDateField.checked = false\n      page.saveMatchesToFile.checked = false\n      page.saveOrdersToFile.checked = false\n      page.deleteArchivedRecordsErr.textContent = ''\n      page.archivedRecordsLocation.textContent = ''\n      page.deleteArchivedRecordsMsg.textContent = ''\n      Doc.hide(page.deleteArchivedResult, page.deleteArchivedRecordsErr,\n        page.deleteArchivedRecordsMsg, page.archivedRecordsLocation, page.archivedDateField)\n      this.showForm(page.deleteArchivedRecordsForm)\n    })\n\n    Doc.bind(page.deleteArchivedRecordsSubmit, 'click', () => {\n      let date = 0\n      if (page.showArchivedDateField.checked) {\n        date = Date.parse(page.olderThan.value || '')\n        if (isNaN(date) || date <= 0) {\n          Doc.showFormError(page.deleteArchivedRecordsErr, intl.prep(intl.ID_INVALID_DATE_ERR_MSG))\n          return\n        }\n      }\n      this.deleteArchivedRecords(date)\n    })\n\n    this.submitFilter()\n  }\n\n  /* showForm shows a modal form with a little animation. */\n  async showForm (form: HTMLElement) {\n    this.currentForm = form\n    const page = this.page\n    Doc.hide(page.deleteArchivedRecordsForm)\n    form.style.right = '10000px'\n    Doc.show(page.forms, form)\n    const shift = (page.forms.offsetWidth + form.offsetWidth) / 2\n    await Doc.animate(animationLength, progress => {\n      form.style.right = `${(1 - progress) * shift}px`\n    }, 'easeOutHard')\n    form.style.right = '0px'\n  }\n\n  /* setOrders empties the order table and appends the specified orders. */\n  setOrders (orders: Order[]) {\n    Doc.empty(this.page.tableBody)\n    this.appendOrders(orders)\n  }\n\n  /* appendOrders appends orders to the orders table. */\n  appendOrders (orders: Order[]) {\n    const tbody = this.page.tableBody\n    for (const ord of orders) {\n      const tr = this.orderTmpl.cloneNode(true) as HTMLElement\n      const set = (tmplID: string, s: string) => { Doc.tmplElement(tr, tmplID).textContent = s }\n      const mktID = `${ord.baseSymbol.toUpperCase()}-${ord.quoteSymbol.toUpperCase()}`\n      set('host', `${mktID} @ ${ord.host}`)\n      let from, to, fromQty\n      let toQty = ''\n      const [baseUnitInfo, quoteUnitInfo] = [app().unitInfo(ord.baseID), app().unitInfo(ord.quoteID)]\n      if (ord.sell) {\n        [from, to] = [ord.baseSymbol, ord.quoteSymbol]\n        fromQty = Doc.formatCoinValue(ord.qty, baseUnitInfo)\n        if (ord.type === OrderUtil.Limit) {\n          toQty = Doc.formatCoinValue(ord.qty / OrderUtil.RateEncodingFactor * ord.rate, quoteUnitInfo)\n        }\n      } else {\n        [from, to] = [ord.quoteSymbol, ord.baseSymbol]\n        if (ord.type === OrderUtil.Market) {\n          fromQty = Doc.formatCoinValue(ord.qty, baseUnitInfo)\n        } else {\n          fromQty = Doc.formatCoinValue(ord.qty / OrderUtil.RateEncodingFactor * ord.rate, quoteUnitInfo)\n          toQty = Doc.formatCoinValue(ord.qty, baseUnitInfo)\n        }\n      }\n\n      set('fromQty', fromQty)\n      Doc.tmplElement(tr, 'fromLogo').src = Doc.logoPath(from)\n      set('fromSymbol', from)\n      set('toQty', toQty)\n      Doc.tmplElement(tr, 'toLogo').src = Doc.logoPath(to)\n      set('toSymbol', to)\n      set('type', `${OrderUtil.typeString(ord)} ${OrderUtil.sellString(ord)}`)\n      set('rate', Doc.formatCoinValue(app().conventionalRate(ord.baseID, ord.quoteID, ord.rate)))\n      set('status', OrderUtil.statusString(ord))\n      set('filled', `${(OrderUtil.filled(ord) / ord.qty * 100).toFixed(1)}%`)\n      set('settled', `${(OrderUtil.settled(ord) / ord.qty * 100).toFixed(1)}%`)\n      const dateTime = new Date(ord.submitTime).toLocaleString()\n      set('time', `${Doc.timeSince(ord.submitTime)} ago, ${dateTime}`)\n      const link = Doc.tmplElement(tr, 'link')\n      link.href = `order/${ord.id}`\n      app().bindInternalNavigation(tr)\n      tbody.appendChild(tr)\n    }\n    if (orders.length === orderBatchSize) {\n      this.offset = orders[orders.length - 1].id\n    } else {\n      this.offset = ''\n    }\n  }\n\n  /* submitFilter submits the current filter and reloads the order table. */\n  async submitFilter () {\n    const page = this.page\n    this.offset = ''\n    const filterState = this.filterState\n    filterState.hosts = parseSubFilter(page.hostFilter)\n    filterState.assets = parseSubFilter(page.assetFilter).map((s: string) => parseInt(s))\n    filterState.statuses = parseSubFilter(page.statusFilter).map((s: string) => parseInt(s))\n    this.setOrders(await this.fetchOrders())\n  }\n\n  /* fetchOrders fetches orders using the current filter. */\n  async fetchOrders () {\n    const loaded = app().loading(this.main)\n    const res = await postJSON('/api/orders', this.currentFilter())\n    loaded()\n    return res.orders\n  }\n\n  /* exportOrders downloads a csv of the user's orders based on the current filter. */\n  exportOrders () {\n    this.offset = ''\n    const filterState = this.currentFilter()\n    const url = new URL(window.location.href)\n    const search = new URLSearchParams('')\n    const setQuery = (k: string) => {\n      const subFilter = (filterState as any)[k]\n      subFilter.forEach((v: any) => {\n        search.append(k, v)\n      })\n    }\n    setQuery('hosts')\n    setQuery('assets')\n    setQuery('statuses')\n    url.search = search.toString()\n    url.pathname = '/orders/export'\n    window.open(url.toString())\n  }\n\n  /* deleteArchivedRecords removes the user's archived orders and matches\n   * created before user specified date time in millisecond. Deleted archived\n   * records are saved to a CSV file if the user specify so.\n   */\n  async deleteArchivedRecords (olderThanMs?: number) {\n    const page = this.page\n    const saveMatchesToFIle = page.saveMatchesToFile.checked || false\n    const saveOrdersToFile = page.saveOrdersToFile.checked || false\n    const reqBody = {\n      olderThanMs: olderThanMs,\n      saveMatchesToFile: saveMatchesToFIle,\n      saveOrdersToFile: saveOrdersToFile\n    }\n    const loaded = app().loading(this.main)\n    const res = await postJSON('/api/deletearchivedrecords', reqBody)\n    loaded()\n    if (!app().checkResponse(res)) {\n      return Doc.showFormError(page.deleteArchivedRecordsErr, res.msg)\n    }\n\n    if (res.archivedRecordsDeleted > 0) {\n      page.deleteArchivedRecordsMsg.textContent = intl.prep(intl.ID_DELETE_ARCHIVED_RECORDS_RESULT, { nRecords: res.archivedRecordsDeleted })\n      if (saveMatchesToFIle || saveOrdersToFile) {\n        page.archivedRecordsLocation.textContent = intl.prep(intl.ID_ARCHIVED_RECORDS_PATH, { path: res.archivedRecordsPath })\n        Doc.show(page.archivedRecordsLocation)\n      }\n      // Update the order page.\n      this.submitFilter()\n    } else {\n      page.deleteArchivedRecordsMsg.textContent = intl.prep(intl.ID_NO_ARCHIVED_RECORDS)\n    }\n    Doc.show(page.deleteArchivedResult, page.deleteArchivedRecordsMsg)\n  }\n\n  /*\n   * currentFilter converts the local filter type (which is all strings) to the\n   * server's filter type.\n   */\n  currentFilter (): OrderFilter {\n    const filterState = this.filterState\n    return {\n      hosts: filterState.hosts,\n      assets: filterState.assets.map((s: any) => parseInt(s)),\n      statuses: filterState.statuses.map((s: any) => parseInt(s)),\n      n: orderBatchSize,\n      offset: this.offset\n    }\n  }\n\n  /*\n   * nextPage resubmits the filter with the offset set to the last loaded order.\n   */\n  async nextPage () {\n    if (this.offset === '' || this.loading) return\n    this.loading = true\n    Doc.show(this.page.orderLoader)\n    const orders = await this.fetchOrders()\n    this.loading = false\n    Doc.hide(this.page.orderLoader)\n    this.appendOrders(orders)\n  }\n}\n\n/*\n * parseSubFilter parses a bool-map from the checkbox inputs in the specified\n * ancestor element.\n */\nfunction parseSubFilter (form: HTMLElement): string[] {\n  const entries: string[] = []\n  form.querySelectorAll('input').forEach(box => {\n    if (box.checked) entries.push(box.value)\n  })\n  return entries\n}\n\n/* compareSubFilter compares the two filter arrays for unordered equivalence. */\nfunction compareSubFilter (filter1: any[], filter2: any[]): boolean {\n  if (filter1.length !== filter2.length) return false\n  for (const entry of filter1) {\n    if (filter2.indexOf(entry) === -1) return false\n  }\n  return true\n}\n","import Doc from './doc'\nimport BasePage from './basepage'\nimport * as OrderUtil from './orderutil'\nimport { bind as bindForm, AccelerateOrderForm } from './forms'\nimport { postJSON } from './http'\nimport * as intl from './locales'\nimport {\n  app,\n  Order,\n  PageElement,\n  OrderNote,\n  MatchNote,\n  Match,\n  Coin\n} from './registry'\nimport { setOptionTemplates } from './opts'\n\nconst Mainnet = 0\nconst Testnet = 1\n// const Regtest = 3\n\nconst coinIDTakerFoundMakerRedemption = 'TakerFoundMakerRedemption:'\n\nconst animationLength = 500\n\nlet net: number\n\nexport default class OrderPage extends BasePage {\n  orderID: string\n  order: Order\n  page: Record<string, PageElement>\n  currentForm: HTMLElement\n  secondTicker: number\n  refreshOnPopupClose: boolean\n  accelerateOrderForm: AccelerateOrderForm\n  stampers: PageElement[]\n\n  constructor (main: HTMLElement) {\n    super()\n    const page = this.page = Doc.idDescendants(main)\n    this.stampers = Doc.applySelector(main, '[data-stamp]')\n    net = parseInt(main.dataset.net || '')\n    // Find the order\n    this.orderID = main.dataset.oid || ''\n\n    Doc.cleanTemplates(page.matchCardTmpl)\n\n    const setStamp = () => {\n      for (const span of this.stampers) {\n        span.textContent = Doc.timeSince(parseInt(span.dataset.stamp || ''))\n      }\n    }\n    setStamp()\n\n    page.forms.querySelectorAll('.form-closer').forEach(el => {\n      Doc.bind(el, 'click', () => {\n        if (this.refreshOnPopupClose) {\n          window.location.replace(window.location.href)\n          return\n        }\n        Doc.hide(page.forms)\n      })\n    })\n\n    // Some static elements on this page contain assets that can be linked\n    // to blockchain explorers (such as Etherscan) so users can easily\n    // examine funding/acceleration coins data there. We'd need to set up\n    // such hyperlinks here.\n    main.querySelectorAll('[data-explorer-id]').forEach((link: PageElement) => {\n      const assetID = parseInt(link.dataset.explorerId || '')\n      setCoinHref(assetID, link)\n    })\n\n    if (page.cancelBttn) {\n      Doc.bind(page.cancelBttn, 'click', () => {\n        this.showForm(page.cancelForm)\n      })\n    }\n\n    Doc.bind(page.accelerateBttn, 'click', () => {\n      this.showAccelerateForm()\n    })\n\n    const success = () => {\n      this.refreshOnPopupClose = true\n    }\n    // Do not call cleanTemplates before creating the AccelerateOrderForm\n    setOptionTemplates(page)\n    this.accelerateOrderForm = new AccelerateOrderForm(page.accelerateForm, success)\n    Doc.cleanTemplates(page.booleanOptTmpl, page.rangeOptTmpl, page.orderOptTmpl)\n\n    // If the user clicks outside of a form, it should close the page overlay.\n    Doc.bind(page.forms, 'mousedown', (e: MouseEvent) => {\n      if (!Doc.mouseInElement(e, this.currentForm)) {\n        if (this.refreshOnPopupClose) {\n          window.location.reload()\n          return\n        }\n        Doc.hide(page.forms)\n        page.cancelPass.value = ''\n      }\n    })\n\n    // Cancel order form\n    bindForm(page.cancelForm, page.cancelSubmit, async () => { this.submitCancel() })\n\n    this.secondTicker = window.setInterval(() => {\n      setStamp()\n    }, 10000) // update every 10 seconds\n\n    app().registerNoteFeeder({\n      order: (note: OrderNote) => { this.handleOrderNote(note) },\n      match: (note: MatchNote) => { this.handleMatchNote(note) }\n    })\n\n    this.start()\n  }\n\n  async start () {\n    let ord = app().order(this.orderID)\n    // app().order can only access active orders. If the order is not active,\n    // we'll need to get the data from the database.\n    if (ord) this.order = ord\n    else {\n      ord = await this.fetchOrder()\n    }\n\n    // Swap out the dot-notation symbols with token-aware symbols.\n    this.page.mktBaseSymbol.replaceWith(Doc.symbolize(ord.baseSymbol))\n    this.page.mktQuoteSymbol.replaceWith(Doc.symbolize(ord.quoteSymbol))\n\n    this.setAccelerationButtonVis()\n    this.showMatchCards()\n  }\n\n  unload () {\n    clearInterval(this.secondTicker)\n  }\n\n  /* fetchOrder fetches the order from the client. */\n  async fetchOrder (): Promise<Order> {\n    const res = await postJSON('/api/order', this.orderID)\n    if (!app().checkResponse(res)) throw res.msg\n    this.order = res.order\n    return this.order\n  }\n\n  /*\n   * setImmutableMatchCardElements sets the match card elements that are never\n   * changed.\n   */\n  setImmutableMatchCardElements (matchCard: HTMLElement, match: Match) {\n    const tmpl = Doc.parseTemplate(matchCard)\n\n    tmpl.matchID.textContent = match.matchID\n\n    const time = new Date(match.stamp)\n    tmpl.matchTime.textContent = time.toLocaleTimeString('en-GB', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    })\n\n    tmpl.matchTimeAgo.dataset.stamp = match.stamp.toString()\n    tmpl.matchTimeAgo.textContent = Doc.timeSince(match.stamp)\n    this.stampers.push(tmpl.matchTimeAgo)\n\n    const orderPortion = OrderUtil.orderPortion(this.order, match)\n    const baseSymbol = Doc.bipSymbol(this.order.baseID)\n    const quoteSymbol = Doc.bipSymbol(this.order.quoteID)\n    const baseUnitInfo = app().unitInfo(this.order.baseID)\n    const quoteUnitInfo = app().unitInfo(this.order.quoteID)\n    const quoteAmount = OrderUtil.baseToQuote(match.rate, match.qty)\n\n    if (match.isCancel) {\n      Doc.show(tmpl.cancelInfoDiv)\n      Doc.hide(tmpl.infoDiv, tmpl.status, tmpl.statusHdr)\n\n      if (this.order.sell) {\n        tmpl.cancelAmount.textContent = Doc.formatCoinValue(match.qty, baseUnitInfo)\n        tmpl.cancelIcon.src = Doc.logoPathFromID(this.order.baseID)\n      } else {\n        tmpl.cancelAmount.textContent = Doc.formatCoinValue(quoteAmount, quoteUnitInfo)\n        tmpl.cancelIcon.src = Doc.logoPathFromID(this.order.quoteID)\n      }\n\n      tmpl.cancelOrderPortion.textContent = orderPortion\n\n      return\n    }\n\n    Doc.show(tmpl.infoDiv)\n    Doc.hide(tmpl.cancelInfoDiv)\n\n    tmpl.orderPortion.textContent = orderPortion\n\n    if (match.side === OrderUtil.Maker) {\n      tmpl.side.textContent = intl.prep(intl.ID_MAKER)\n      Doc.show(\n        tmpl.makerSwapYou,\n        tmpl.makerRedeemYou,\n        tmpl.takerSwapThem,\n        tmpl.takerRedeemThem\n      )\n      Doc.hide(\n        tmpl.takerSwapYou,\n        tmpl.takerRedeemYou,\n        tmpl.makerSwapThem,\n        tmpl.makerRedeemThem\n      )\n    } else {\n      tmpl.side.textContent = intl.prep(intl.ID_TAKER)\n      Doc.hide(\n        tmpl.makerSwapYou,\n        tmpl.makerRedeemYou,\n        tmpl.takerSwapThem,\n        tmpl.takerRedeemThem\n      )\n      Doc.show(\n        tmpl.takerSwapYou,\n        tmpl.takerRedeemYou,\n        tmpl.makerSwapThem,\n        tmpl.makerRedeemThem\n      )\n    }\n\n    if ((match.side === OrderUtil.Maker && this.order.sell) ||\n          (match.side === OrderUtil.Taker && !this.order.sell)) {\n      tmpl.makerSwapAsset.textContent = baseSymbol\n      tmpl.takerSwapAsset.textContent = quoteSymbol\n      tmpl.makerRedeemAsset.textContent = quoteSymbol\n      tmpl.takerRedeemAsset.textContent = baseSymbol\n    } else {\n      tmpl.makerSwapAsset.textContent = quoteSymbol\n      tmpl.takerSwapAsset.textContent = baseSymbol\n      tmpl.makerRedeemAsset.textContent = baseSymbol\n      tmpl.takerRedeemAsset.textContent = quoteSymbol\n    }\n\n    const rate = app().conventionalRate(this.order.baseID, this.order.quoteID, match.rate)\n    tmpl.rate.textContent = `${rate} ${baseSymbol}/${quoteSymbol}`\n\n    if (this.order.sell) {\n      tmpl.refundAsset.textContent = baseSymbol\n      tmpl.fromAmount.textContent = Doc.formatCoinValue(match.qty, baseUnitInfo)\n      tmpl.toAmount.textContent = Doc.formatCoinValue(quoteAmount, quoteUnitInfo)\n      tmpl.fromIcon.src = Doc.logoPathFromID(this.order.baseID)\n      tmpl.toIcon.src = Doc.logoPathFromID(this.order.quoteID)\n    } else {\n      tmpl.refundAsset.textContent = quoteSymbol\n      tmpl.fromAmount.textContent = Doc.formatCoinValue(quoteAmount, quoteUnitInfo)\n      tmpl.toAmount.textContent = Doc.formatCoinValue(match.qty, baseUnitInfo)\n      tmpl.fromIcon.src = Doc.logoPathFromID(this.order.quoteID)\n      tmpl.toIcon.src = Doc.logoPathFromID(this.order.baseID)\n    }\n  }\n\n  /*\n   * setMutableMatchCardElements sets the match card elements which may get\n   * updated on each update to the match.\n   */\n  setMutableMatchCardElements (matchCard: HTMLElement, m: Match) {\n    if (m.isCancel) {\n      return\n    }\n\n    const tmpl = Doc.parseTemplate(matchCard)\n    tmpl.status.textContent = OrderUtil.matchStatusString(m)\n\n    const setCoin = (pendingName: string, linkName: string, coin: Coin) => {\n      const formatCoinID = (cid: string) => {\n        if (cid.startsWith(coinIDTakerFoundMakerRedemption)) {\n          const makerAddr = cid.substring(coinIDTakerFoundMakerRedemption.length)\n          return intl.prep(intl.ID_TAKER_FOUND_MAKER_REDEMPTION, { makerAddr: makerAddr })\n        }\n        return cid\n      }\n      const coinLink = tmpl[linkName]\n      const pendingSpan = tmpl[pendingName]\n      if (!coin) {\n        Doc.show(tmpl[pendingName])\n        Doc.hide(tmpl[linkName])\n        return\n      }\n      coinLink.textContent = formatCoinID(coin.stringID)\n      coinLink.dataset.explorerCoin = coin.stringID\n      setCoinHref(coin.assetID, coinLink)\n      Doc.hide(pendingSpan)\n      Doc.show(coinLink)\n    }\n\n    setCoin('makerSwapPending', 'makerSwapCoin', makerSwapCoin(m))\n    setCoin('takerSwapPending', 'takerSwapCoin', takerSwapCoin(m))\n    setCoin('makerRedeemPending', 'makerRedeemCoin', makerRedeemCoin(m))\n    setCoin('takerRedeemPending', 'takerRedeemCoin', takerRedeemCoin(m))\n    setCoin('refundPending', 'refundCoin', m.refund)\n\n    if (m.status === OrderUtil.MakerSwapCast && !m.revoked && !m.refund) {\n      const c = makerSwapCoin(m)\n      tmpl.makerSwapMsg.textContent = confirmationString(c)\n      Doc.hide(tmpl.takerSwapMsg, tmpl.makerRedeemMsg, tmpl.takerRedeemMsg)\n      Doc.show(tmpl.makerSwapMsg)\n    } else if (m.status === OrderUtil.TakerSwapCast && !m.revoked && !m.refund) {\n      const c = takerSwapCoin(m)\n      tmpl.takerSwapMsg.textContent = confirmationString(c)\n      Doc.hide(tmpl.makerSwapMsg, tmpl.makerRedeemMsg, tmpl.takerRedeemMsg)\n      Doc.show(tmpl.takerSwapMsg)\n    } else if (inConfirmingMakerRedeem(m) && !m.revoked && !m.refund) {\n      tmpl.makerRedeemMsg.textContent = confirmationString(m.redeem)\n      Doc.hide(tmpl.makerSwapMsg, tmpl.takerSwapMsg, tmpl.takerRedeemMsg)\n      Doc.show(tmpl.makerRedeemMsg)\n    } else if (inConfirmingTakerRedeem(m) && !m.revoked && !m.refund) {\n      tmpl.takerRedeemMsg.textContent = confirmationString(m.redeem)\n      Doc.hide(tmpl.makerSwapMsg, tmpl.takerSwapMsg, tmpl.makerRedeemMsg)\n      Doc.show(tmpl.takerRedeemMsg)\n    } else {\n      Doc.hide(tmpl.makerSwapMsg, tmpl.takerSwapMsg, tmpl.makerRedeemMsg, tmpl.takerRedeemMsg)\n    }\n\n    Doc.setVis(!m.isCancel && (makerSwapCoin(m) || !m.revoked), tmpl.makerSwap)\n    Doc.setVis(!m.isCancel && (takerSwapCoin(m) || !m.revoked), tmpl.takerSwap)\n    Doc.setVis(!m.isCancel && (makerRedeemCoin(m) || !m.revoked), tmpl.makerRedeem)\n    // When revoked, there is uncertainty about the taker redeem coin. The taker\n    // redeem may be needed if maker redeems while taker is waiting to refund.\n    Doc.setVis(!m.isCancel && (takerRedeemCoin(m) || (!m.revoked && m.active) || ((m.side === OrderUtil.Taker) && m.active && (m.counterRedeem || !m.refund))), tmpl.takerRedeem)\n    // The refund placeholder should not be shown if there is a counter redeem.\n    Doc.setVis(!m.isCancel && (m.refund || (m.revoked && m.active && !m.counterRedeem)), tmpl.refund)\n  }\n\n  /*\n   * addNewMatchCard adds a new card to the list of match cards.\n   */\n  addNewMatchCard (match: Match) {\n    const page = this.page\n    const matchCard = page.matchCardTmpl.cloneNode(true) as HTMLElement\n    matchCard.dataset.matchID = match.matchID\n    this.setImmutableMatchCardElements(matchCard, match)\n    this.setMutableMatchCardElements(matchCard, match)\n    page.matchBox.appendChild(matchCard)\n  }\n\n  /*\n   * showMatchCards creates cards for each match in the order.\n   */\n  showMatchCards () {\n    const order = this.order\n    if (!order) return\n    if (!order.matches) return\n    order.matches.sort((a, b) => a.stamp - b.stamp)\n    order.matches.forEach((match) => this.addNewMatchCard(match))\n  }\n\n  /* showCancel shows a form to confirm submission of a cancel order. */\n  showCancel () {\n    const order = this.order\n    const page = this.page\n    const remaining = order.qty - order.filled\n    const asset = OrderUtil.isMarketBuy(order) ? app().assets[order.quoteID] : app().assets[order.baseID]\n    page.cancelRemain.textContent = Doc.formatCoinValue(remaining, asset.unitInfo)\n    page.cancelUnit.textContent = asset.unitInfo.conventional.unit.toUpperCase()\n    this.showForm(page.cancelForm)\n  }\n\n  /* showForm shows a modal form with a little animation. */\n  async showForm (form: HTMLElement) {\n    this.currentForm = form\n    const page = this.page\n    Doc.hide(page.cancelForm, page.accelerateForm)\n    form.style.right = '10000px'\n    Doc.show(page.forms, form)\n    const shift = (page.forms.offsetWidth + form.offsetWidth) / 2\n    await Doc.animate(animationLength, progress => {\n      form.style.right = `${(1 - progress) * shift}px`\n    }, 'easeOutHard')\n    form.style.right = '0px'\n  }\n\n  /* submitCancel submits a cancellation for the order. */\n  async submitCancel () {\n    // this will be the page.cancelSubmit button (evt.currentTarget)\n    const page = this.page\n    const order = this.order\n    const req = {\n      orderID: order.id,\n      pw: page.cancelPass.value\n    }\n    page.cancelPass.value = ''\n    const loaded = app().loading(page.cancelForm)\n    const res = await postJSON('/api/cancel', req)\n    loaded()\n    if (!app().checkResponse(res)) return\n    page.status.textContent = intl.prep(intl.ID_CANCELING)\n    Doc.hide(page.forms)\n    order.cancelling = true\n  }\n\n  /*\n   * setAccelerationButtonVis shows the acceleration button if the order can\n   * be accelerated.\n   */\n  setAccelerationButtonVis () {\n    const order = this.order\n    if (!order) return\n    const page = this.page\n    Doc.setVis(app().canAccelerateOrder(order), page.accelerateBttn, page.actionsLabel)\n  }\n\n  /* showAccelerateForm shows a form to accelerate an order */\n  async showAccelerateForm () {\n    const loaded = app().loading(this.page.accelerateBttn)\n    this.accelerateOrderForm.refresh(this.order)\n    loaded()\n    this.showForm(this.page.accelerateForm)\n  }\n\n  /*\n   * handleOrderNote is the handler for the 'order'-type notification, which are\n   * used to update an order's status.\n   */\n  handleOrderNote (note: OrderNote) {\n    const page = this.page\n    const order = note.order\n    if (order.id !== this.orderID) return\n    this.order = order\n    const bttn = page.cancelBttn\n    if (bttn && order.status > OrderUtil.StatusBooked) Doc.hide(bttn)\n    page.status.textContent = OrderUtil.statusString(order)\n    for (const m of order.matches || []) this.processMatch(m)\n    this.setAccelerationButtonVis()\n  }\n\n  /* handleMatchNote handles a 'match' notification. */\n  handleMatchNote (note: MatchNote) {\n    if (note.orderID !== this.orderID) return\n    this.processMatch(note.match)\n    this.setAccelerationButtonVis()\n  }\n\n  /*\n   * processMatch synchronizes a match's card with a match received in a\n   * 'order' or 'match' notification.\n   */\n  processMatch (m: Match) {\n    let card: HTMLElement | null = null\n    for (const div of Doc.applySelector(this.page.matchBox, '.match-card')) {\n      if (div.dataset.matchID === m.matchID) {\n        card = div\n        break\n      }\n    }\n    if (card) {\n      this.setMutableMatchCardElements(card, m)\n    } else {\n      this.addNewMatchCard(m)\n    }\n  }\n}\n\n/*\n * confirmationString is a string describing the state of confirmations for a\n * coin\n * */\nfunction confirmationString (coin: Coin) {\n  if (!coin.confs || coin.confs.required === 0) return ''\n  return `${coin.confs.count} / ${coin.confs.required} ${intl.prep(intl.ID_CONFIRMATIONS)}`\n}\n\n// makerSwapCoin return's the maker's swap coin.\nfunction makerSwapCoin (m: Match) : Coin {\n  return (m.side === OrderUtil.Maker) ? m.swap : m.counterSwap\n}\n\n// takerSwapCoin return's the taker's swap coin.\nfunction takerSwapCoin (m: Match) {\n  return (m.side === OrderUtil.Maker) ? m.counterSwap : m.swap\n}\n\n// makerRedeemCoin return's the maker's redeem coin.\nfunction makerRedeemCoin (m: Match) {\n  return (m.side === OrderUtil.Maker) ? m.redeem : m.counterRedeem\n}\n\n// takerRedeemCoin return's the taker's redeem coin.\nfunction takerRedeemCoin (m: Match) {\n  return (m.side === OrderUtil.Maker) ? m.counterRedeem : m.redeem\n}\n\n/*\n* inConfirmingMakerRedeem will be true if we are the maker, and we are waiting\n* on confirmations for our own redeem.\n*/\nfunction inConfirmingMakerRedeem (m: Match) {\n  return m.status < OrderUtil.MatchConfirmed && m.side === OrderUtil.Maker && m.status >= OrderUtil.MakerRedeemed\n}\n\n/*\n* inConfirmingTakerRedeem will be true if we are the taker, and we are waiting\n* on confirmations for our own redeem.\n*/\nfunction inConfirmingTakerRedeem (m: Match) {\n  return m.status < OrderUtil.MatchConfirmed && m.side === OrderUtil.Taker && m.status >= OrderUtil.MatchComplete\n}\n\n/*\n * setCoinHref sets the hyperlink element's href attribute based on provided\n * assetID and data-explorer-coin value present on supplied link element.\n */\nfunction setCoinHref (assetID: number, link: PageElement) {\n  const assetExplorer = CoinExplorers[assetID]\n  if (!assetExplorer) return\n  const formatter = assetExplorer[net]\n  if (!formatter) return\n  link.classList.remove('plainlink')\n  link.classList.add('subtlelink')\n  link.href = formatter(link.dataset.explorerCoin || '')\n}\n\nconst ethExplorers: Record<number, (cid: string) => string> = {\n  [Mainnet]: (cid: string) => {\n    if (cid.startsWith(coinIDTakerFoundMakerRedemption)) {\n      const makerAddr = cid.substring(coinIDTakerFoundMakerRedemption.length)\n      return `https://etherscan.io/address/${makerAddr}`\n    }\n    if (cid.length === 42) {\n      return `https://etherscan.io/address/${cid}`\n    }\n    return `https://etherscan.io/tx/${cid}`\n  },\n  [Testnet]: (cid: string) => {\n    if (cid.startsWith(coinIDTakerFoundMakerRedemption)) {\n      const makerAddr = cid.substring(coinIDTakerFoundMakerRedemption.length)\n      return `https://goerli.etherscan.io/address/${makerAddr}`\n    }\n    if (cid.length === 42) {\n      return `https://goerli.etherscan.io/address/${cid}`\n    }\n    return `https://goerli.etherscan.io/tx/${cid}`\n  }\n}\n\nconst CoinExplorers: Record<number, Record<number, (cid: string) => string>> = {\n  42: { // dcr\n    [Mainnet]: (cid: string) => {\n      const [txid, vout] = cid.split(':')\n      return `https://explorer.dcrdata.org/tx/${txid}/out/${vout}`\n    },\n    [Testnet]: (cid: string) => {\n      const [txid, vout] = cid.split(':')\n      return `https://testnet.dcrdata.org/tx/${txid}/out/${vout}`\n    }\n  },\n  0: { // btc\n    [Mainnet]: (cid: string) => `https://mempool.space/tx/${cid.split(':')[0]}`,\n    [Testnet]: (cid: string) => `https://mempool.space/testnet/tx/${cid.split(':')[0]}`\n  },\n  2: { // ltc\n    [Mainnet]: (cid: string) => `https://ltc.bitaps.com/${cid.split(':')[0]}`,\n    [Testnet]: (cid: string) => `https://sochain.com/tx/LTCTEST/${cid.split(':')[0]}`\n  },\n  20: {\n    [Mainnet]: (cid: string) => `https://digiexplorer.info/tx/${cid.split(':')[0]}`,\n    [Testnet]: (cid: string) => `https://testnetexplorer.digibyteservers.io/tx/${cid.split(':')[0]}`\n  },\n  60: ethExplorers,\n  60001: ethExplorers,\n  3: { // doge\n    [Mainnet]: (cid: string) => `https://dogeblocks.com/tx/${cid.split(':')[0]}`,\n    [Testnet]: (cid: string) => `https://blockexplorer.one/dogecoin/testnet/tx/${cid.split(':')[0]}`\n  },\n  133: { // zec\n    [Mainnet]: (cid: string) => `https://zcashblockexplorer.com/transactions/${cid.split(':')[0]}`,\n    [Testnet]: (cid: string) => `https://blockexplorer.one/zcash/testnet/tx/${cid.split(':')[0]}`\n  },\n  145: { // bch\n    [Mainnet]: (cid: string) => `https://bch.loping.net/tx/${cid.split(':')[0]}`,\n    [Testnet]: (cid: string) => `https://tbch4.loping.net/tx/${cid.split(':')[0]}`\n  }\n}\n","import Doc from './doc'\nimport BasePage from './basepage'\nimport State from './state'\nimport { postJSON } from './http'\nimport * as forms from './forms'\nimport * as intl from './locales'\n\nimport {\n  app,\n  PageElement,\n  ConnectionStatus,\n  Exchange\n} from './registry'\n\nconst animationLength = 300\n\nexport default class DexSettingsPage extends BasePage {\n  body: HTMLElement\n  forms: PageElement[]\n  currentForm: PageElement\n  page: Record<string, PageElement>\n  host: string\n  keyup: (e: KeyboardEvent) => void\n  dexAddrForm: forms.DEXAddressForm\n\n  constructor (body: HTMLElement) {\n    super()\n    this.body = body\n    this.host = body.dataset.host ? body.dataset.host : ''\n    const page = this.page = Doc.idDescendants(body)\n    this.forms = Doc.applySelector(page.forms, ':scope > form')\n\n    Doc.bind(page.exportDexBtn, 'click', () => this.prepareAccountExport(page.authorizeAccountExportForm))\n    Doc.bind(page.disableAcctBtn, 'click', () => this.prepareAccountDisable(page.disableAccountForm))\n    Doc.bind(page.updateBondOptionsBtn, 'click', () => this.prepareUpdateBondOptions())\n    Doc.bind(page.updateCertBtn, 'click', () => page.certFileInput.click())\n    Doc.bind(page.updateHostBtn, 'click', () => this.prepareUpdateHost())\n    Doc.bind(page.certFileInput, 'change', () => this.onCertFileChange())\n\n    this.dexAddrForm = new forms.DEXAddressForm(page.dexAddrForm, async (xc: Exchange) => {\n      window.location.assign(`/dexsettings/${xc.host}`)\n    }, undefined, this.host)\n\n    forms.bind(page.updateBondOptionsForm, page.updateBondOptionsConfirm, () => this.updateBondOptions())\n    forms.bind(page.authorizeAccountExportForm, page.authorizeExportAccountConfirm, () => this.exportAccount())\n    forms.bind(page.disableAccountForm, page.disableAccountConfirm, () => this.disableAccount())\n\n    const closePopups = () => {\n      Doc.hide(page.forms)\n    }\n\n    Doc.bind(page.forms, 'mousedown', (e: MouseEvent) => {\n      if (!Doc.mouseInElement(e, this.currentForm)) { closePopups() }\n    })\n\n    this.keyup = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        closePopups()\n      }\n    }\n    Doc.bind(document, 'keyup', this.keyup)\n\n    page.forms.querySelectorAll('.form-closer').forEach(el => {\n      Doc.bind(el, 'click', () => { closePopups() })\n    })\n\n    app().registerNoteFeeder({\n      conn: () => { this.setConnectionStatus() }\n    })\n\n    this.setConnectionStatus()\n  }\n\n  unload () {\n    Doc.unbind(document, 'keyup', this.keyup)\n  }\n\n  /* showForm shows a modal form with a little animation. */\n  async showForm (form: HTMLElement) {\n    const page = this.page\n    this.currentForm = form\n    this.forms.forEach(form => Doc.hide(form))\n    form.style.right = '10000px'\n    Doc.show(page.forms, form)\n    const shift = (page.forms.offsetWidth + form.offsetWidth) / 2\n    await Doc.animate(animationLength, progress => {\n      form.style.right = `${(1 - progress) * shift}px`\n    }, 'easeOutHard')\n    form.style.right = '0'\n  }\n\n  // exportAccount exports and downloads the account info.\n  async exportAccount () {\n    const page = this.page\n    const pw = page.exportAccountAppPass.value\n    const host = page.exportAccountHost.textContent\n    page.exportAccountAppPass.value = ''\n    const req = {\n      pw,\n      host\n    }\n    const loaded = app().loading(this.body)\n    const res = await postJSON('/api/exportaccount', req)\n    loaded()\n    if (!app().checkResponse(res)) {\n      page.exportAccountErr.textContent = res.msg\n      Doc.show(page.exportAccountErr)\n      return\n    }\n    res.account.bonds = res.bonds // maintain backward compat of JSON file\n    const accountForExport = JSON.parse(JSON.stringify(res.account))\n    const a = document.createElement('a')\n    a.setAttribute('download', 'dcrAccount-' + host + '.json')\n    a.setAttribute('href', 'data:text/json,' + JSON.stringify(accountForExport, null, 2))\n    a.click()\n    Doc.hide(page.forms)\n  }\n\n  // disableAccount disables the account associated with the provided host.\n  async disableAccount () {\n    const page = this.page\n    const pw = page.disableAccountAppPW.value\n    const host = page.disableAccountHost.textContent\n    page.disableAccountAppPW.value = ''\n    const req = {\n      pw,\n      host\n    }\n    const loaded = app().loading(this.body)\n    const res = await postJSON('/api/disableaccount', req)\n    loaded()\n    if (!app().checkResponse(res)) {\n      page.disableAccountErr.textContent = res.msg\n      Doc.show(page.disableAccountErr)\n      return\n    }\n    Doc.hide(page.forms)\n    window.location.assign('/settings')\n  }\n\n  async prepareAccountExport (authorizeAccountExportForm: HTMLElement) {\n    const page = this.page\n    page.exportAccountHost.textContent = this.host\n    page.exportAccountErr.textContent = ''\n    if (State.passwordIsCached()) {\n      this.exportAccount()\n    } else {\n      this.showForm(authorizeAccountExportForm)\n    }\n  }\n\n  async prepareAccountDisable (disableAccountForm: HTMLElement) {\n    const page = this.page\n    page.disableAccountHost.textContent = this.host\n    page.disableAccountErr.textContent = ''\n    this.showForm(disableAccountForm)\n  }\n\n  // prepareUpdateBondOptions resets and prepares the Update Bond Options form.\n  async prepareUpdateBondOptions () {\n    const page = this.page\n    const xc = app().user.exchanges[this.host]\n    page.bondTargetTier.setAttribute('placeholder', xc.bondOptions.targetTier.toString())\n    Doc.empty(page.bondAssetSelect)\n    for (const [assetSymbol, bondAsset] of Object.entries(xc.bondAssets)) {\n      const option = document.createElement('option') as HTMLOptionElement\n      option.value = bondAsset.id.toString()\n      option.textContent = assetSymbol.toUpperCase()\n      if (bondAsset.id === xc.bondOptions.bondAsset) option.selected = true\n      page.bondAssetSelect.appendChild(option)\n    }\n    page.bondOptionsErr.textContent = ''\n    Doc.hide(page.bondOptionsErr)\n    this.showForm(page.updateBondOptionsForm)\n  }\n\n  async prepareUpdateHost () {\n    const page = this.page\n    this.dexAddrForm.refresh()\n    this.showForm(page.dexAddrForm)\n  }\n\n  async onCertFileChange () {\n    const page = this.page\n    Doc.hide(page.errMsg)\n    const files = page.certFileInput.files\n    let cert\n    if (files && files.length) cert = await files[0].text()\n    if (!cert) return\n    const req = { host: this.host, cert: cert }\n    const loaded = app().loading(this.body)\n    const res = await postJSON('/api/updatecert', req)\n    loaded()\n    if (!app().checkResponse(res)) {\n      page.errMsg.textContent = res.msg\n      Doc.show(page.errMsg)\n    } else {\n      Doc.show(page.updateCertMsg)\n      setTimeout(() => { Doc.hide(page.updateCertMsg) }, 5000)\n    }\n  }\n\n  setConnectionStatus () {\n    const page = this.page\n    const exchange = app().user.exchanges[this.host]\n    const displayIcons = (connected: boolean) => {\n      if (connected) {\n        Doc.hide(page.disconnectedIcon)\n        Doc.show(page.connectedIcon)\n      } else {\n        Doc.show(page.disconnectedIcon)\n        Doc.hide(page.connectedIcon)\n      }\n    }\n    if (exchange) {\n      switch (exchange.connectionStatus) {\n        case ConnectionStatus.Connected:\n          displayIcons(true)\n          page.connectionStatus.textContent = intl.prep(intl.ID_CONNECTED)\n          break\n        case ConnectionStatus.Disconnected:\n          displayIcons(false)\n          page.connectionStatus.textContent = intl.prep(intl.ID_DISCONNECTED)\n          break\n        case ConnectionStatus.InvalidCert:\n          displayIcons(false)\n          page.connectionStatus.textContent = `${intl.prep(intl.ID_DISCONNECTED)} - ${intl.prep(intl.ID_INVALID_CERTIFICATE)}`\n      }\n    }\n  }\n\n  /*\n   * updateBondOptions is called when the form to update bond options is\n   * submitted.\n   */\n  async updateBondOptions () {\n    const page = this.page\n    const targetTier = parseInt(page.bondTargetTier.value ?? '')\n    const bondAsset = parseInt(page.bondAssetSelect.value ?? '')\n\n    const bondOptions = {\n      host: this.host,\n      targetTier: targetTier,\n      bondAsset: bondAsset\n    }\n\n    const loaded = app().loading(this.body)\n    const res = await postJSON('/api/updatebondoptions', bondOptions)\n    loaded()\n    if (!app().checkResponse(res)) {\n      page.bondOptionsErr.textContent = res.msg\n      Doc.show(page.bondOptionsErr)\n    } else {\n      Doc.hide(page.bondOptionsErr)\n      Doc.show(page.bondOptionsMsg)\n      setTimeout(() => {\n        Doc.hide(page.bondOptionsMsg)\n        Doc.hide(page.forms)\n      }, 5000)\n      // update the in-memory values.\n      const xc = app().user.exchanges[this.host]\n      xc.bondOptions.bondAsset = bondAsset\n      xc.bondOptions.targetTier = targetTier\n    }\n  }\n}\n","import {\n  app,\n  PageElement,\n  Market,\n  Exchange,\n  OrderOption,\n  XYRange,\n  BotReport,\n  BotNote,\n  MaxSell,\n  MaxBuy,\n  MarketReport,\n  SupportedAsset\n} from './registry'\nimport Doc from './doc'\nimport BasePage from './basepage'\nimport { postJSON } from './http'\nimport { setOptionTemplates, XYRangeOption } from './opts'\nimport State from './state'\nimport { bind as bindForm, NewWalletForm } from './forms'\nimport { RateEncodingFactor } from './orderutil'\n\nconst GapStrategyMultiplier = 'multiplier'\nconst GapStrategyAbsolute = 'absolute'\nconst GapStrategyAbsolutePlus = 'absolute-plus'\nconst GapStrategyPercent = 'percent'\nconst GapStrategyPercentPlus = 'percent-plus'\n\ninterface HostedMarket extends Market {\n  host: string\n}\n\ninterface LiveProgram extends BotReport {\n  tmpl: Record<string, PageElement>\n  div: PageElement\n}\n\ninterface BaseOption {\n  key: string\n  displayname: string\n  description: string\n  default: number\n  min: number\n  max: number\n}\n\n// Oracle Weighting\nconst oracleWeightBaseOption: BaseOption = {\n  key: 'oracleWeighting',\n  displayname: 'Oracle Weight',\n  description: 'Enable the oracle and set its weight in calculating our target price.',\n  default: 0.1,\n  max: 1.0,\n  min: 0.0\n}\nconst oracleWeightRange: XYRange = {\n  start: {\n    label: '0%',\n    x: 0,\n    y: 0\n  },\n  end: {\n    label: '100%',\n    x: 1,\n    y: 100\n  },\n  xUnit: '',\n  yUnit: '%'\n}\nconst oracleWeightOption: OrderOption = createXYRange(oracleWeightBaseOption, oracleWeightRange)\n\nconst oracleBiasBaseOption: BaseOption = {\n  key: 'oracleBias',\n  displayname: 'Oracle Bias',\n  description: 'Apply an adjustment to the oracles rate, up to +/-1%.',\n  default: 0.0,\n  max: 0.01,\n  min: -0.01\n}\nconst oracleBiasRange: XYRange = {\n  start: {\n    label: '-1%',\n    x: -0.01,\n    y: -1\n  },\n  end: {\n    label: '1%',\n    x: 0.01,\n    y: 1\n  },\n  xUnit: '',\n  yUnit: '%'\n}\nconst oracleBiasOption: OrderOption = createXYRange(oracleBiasBaseOption, oracleBiasRange)\n\nconst driftToleranceBaseOption: BaseOption = {\n  key: 'driftTolerance',\n  displayname: 'Drift Tolerance',\n  description: 'How far from the ideal price will we allow orders to drift. Typically a fraction of a percent.',\n  default: 0.001,\n  max: 0.01,\n  min: 0\n}\nconst driftToleranceRange: XYRange = {\n  start: {\n    label: '0%',\n    x: 0,\n    y: 0\n  },\n  end: {\n    label: '1%',\n    x: 0.01,\n    y: 1\n  },\n  xUnit: '',\n  yUnit: '%'\n}\nconst driftToleranceOption: OrderOption = createXYRange(driftToleranceBaseOption, driftToleranceRange)\n\nconst gapMultiplierBaseOption: BaseOption = {\n  key: 'gapMultiplier',\n  displayname: 'Spread Multiplier',\n  description: 'Increase the spread for reduced risk and higher potential profits, but with a lower fill rate. ' +\n    'The baseline value, 1, is the break-even value, where tx fees and profits are equivalent in an otherwise static market.',\n  default: 2,\n  max: 10,\n  min: 1\n}\nconst gapMultiplierRange: XYRange = {\n  start: {\n    label: '1x',\n    x: 1,\n    y: 100\n  },\n  end: {\n    label: '100x',\n    x: 100,\n    y: 10000\n  },\n  xUnit: 'X',\n  yUnit: '%'\n}\nconst gapMultiplierOption: OrderOption = createXYRange(gapMultiplierBaseOption, gapMultiplierRange)\n\nconst gapPercentBaseOption: BaseOption = {\n  key: 'gapPercent',\n  displayname: 'Percent Spread',\n  description: 'The spread is set as a percent of current spot price.',\n  default: 0.005,\n  max: 1,\n  min: 0\n}\nconst gapPercentRange: XYRange = {\n  start: {\n    label: '0%',\n    x: 0,\n    y: 0\n  },\n  end: {\n    label: '10%',\n    x: 0.1,\n    y: 10\n  },\n  xUnit: 'X',\n  yUnit: '%'\n}\nconst gapPercentOption: OrderOption = createXYRange(gapPercentBaseOption, gapPercentRange)\n\nconst animationLength = 300\n\nexport default class MarketMakerPage extends BasePage {\n  page: Record<string, PageElement>\n  data: any\n  createOpts: Record<string, number>\n  gapRanges: Record<string, number>\n  currentMarket: HostedMarket\n  currentForm: PageElement\n  keyup: (e: KeyboardEvent) => void\n  programs: Record<number, LiveProgram>\n  editProgram: BotReport | null\n  gapMultiplierOpt: XYRangeOption\n  gapPercentOpt: XYRangeOption\n  driftToleranceOpt: XYRangeOption\n  biasOpt: XYRangeOption\n  weightOpt: XYRangeOption\n  pwHandler: ((pw: string) => Promise<void>) | null\n  newWalletForm: NewWalletForm\n  specifiedPrice: number\n  currentReport: MarketReport | null\n\n  constructor (main: HTMLElement, data: any) {\n    super()\n    const page = this.page = Doc.idDescendants(main)\n    this.data = data\n    this.programs = {}\n    this.editProgram = null\n    this.pwHandler = null\n    this.createOpts = {\n      [oracleBiasBaseOption.key]: oracleBiasBaseOption.default,\n      [oracleWeightBaseOption.key]: oracleWeightBaseOption.default,\n      [driftToleranceOption.key]: driftToleranceOption.default\n    }\n    this.gapRanges = {\n      [gapMultiplierBaseOption.key]: gapMultiplierBaseOption.default,\n      [gapPercentBaseOption.key]: gapPercentBaseOption.default\n    }\n\n    page.forms.querySelectorAll('.form-closer').forEach(el => {\n      Doc.bind(el, 'click', () => { this.closePopups() })\n    })\n\n    setOptionTemplates(page)\n\n    Doc.cleanTemplates(page.assetRowTmpl, page.booleanOptTmpl, page.rangeOptTmpl,\n      page.orderOptTmpl, page.runningProgramTmpl, page.oracleTmpl)\n\n    const selectClicked = (e: MouseEvent, isBase: boolean): void => {\n      e.stopPropagation()\n      const select = isBase ? page.baseSelect : page.quoteSelect\n      const m = Doc.descendentMetrics(main, select)\n      page.assetDropdown.style.left = `${m.bodyLeft}px`\n      page.assetDropdown.style.top = `${m.bodyTop}px`\n\n      const counterAsset = isBase ? this.currentMarket.quoteid : this.currentMarket.baseid\n      const clickedSymbol = isBase ? this.currentMarket.basesymbol : this.currentMarket.quotesymbol\n\n      // Look through markets for other base assets for the counter asset.\n      const matches: Set<string> = new Set()\n      const otherAssets: Set<string> = new Set()\n\n      for (const mkt of sortedMarkets()) {\n        otherAssets.add(mkt.basesymbol)\n        otherAssets.add(mkt.quotesymbol)\n        const [firstID, secondID] = isBase ? [mkt.quoteid, mkt.baseid] : [mkt.baseid, mkt.quoteid]\n        const [firstSymbol, secondSymbol] = isBase ? [mkt.quotesymbol, mkt.basesymbol] : [mkt.basesymbol, mkt.quotesymbol]\n        if (firstID === counterAsset) matches.add(secondSymbol)\n        else if (secondID === counterAsset) matches.add(firstSymbol)\n      }\n\n      const options = Array.from(matches)\n      options.sort((a: string, b: string) => a.localeCompare(b))\n      for (const symbol of options) otherAssets.delete(symbol)\n      const nonOptions = Array.from(otherAssets)\n      nonOptions.sort((a: string, b: string) => a.localeCompare(b))\n\n      Doc.empty(page.assetDropdown)\n      const addOptions = (symbols: string[], avail: boolean): void => {\n        for (const symbol of symbols) {\n          const row = this.assetRow(symbol)\n          Doc.bind(row, 'click', (e: MouseEvent) => {\n            e.stopPropagation()\n            if (symbol === clickedSymbol) return this.hideAssetDropdown() // no change\n            this.leaveEditMode()\n            if (isBase) this.setCreationBase(symbol)\n            else this.setCreationQuote(symbol)\n          })\n          if (!avail) row.classList.add('ghost')\n          page.assetDropdown.appendChild(row)\n        }\n      }\n      addOptions(options, true)\n      addOptions(nonOptions, false)\n      Doc.show(page.assetDropdown)\n      const clicker = (e: MouseEvent): void => {\n        if (Doc.mouseInElement(e, page.assetDropdown)) return\n        this.hideAssetDropdown()\n        Doc.unbind(document, 'click', clicker)\n      }\n      Doc.bind(document, 'click', clicker)\n    }\n\n    Doc.bind(page.baseSelect, 'click', (e: MouseEvent) => selectClicked(e, true))\n    Doc.bind(page.quoteSelect, 'click', (e: MouseEvent) => selectClicked(e, false))\n\n    Doc.bind(page.marketSelect, 'change', () => {\n      const [host, name] = page.marketSelect.value?.split(' ') as string[]\n      this.setMarketSubchoice(host, name)\n    })\n\n    this.gapMultiplierOpt = new XYRangeOption(gapMultiplierOption, '', this.gapRanges, () => this.createOptsUpdated())\n    this.gapPercentOpt = new XYRangeOption(gapPercentOption, '', this.gapRanges, () => this.createOptsUpdated())\n    this.driftToleranceOpt = new XYRangeOption(driftToleranceOption, '', this.createOpts, () => this.createOptsUpdated())\n    this.biasOpt = new XYRangeOption(oracleBiasOption, '', this.createOpts, () => this.createOptsUpdated())\n    this.weightOpt = new XYRangeOption(oracleWeightOption, '', this.createOpts, () => this.createOptsUpdated())\n\n    page.options.appendChild(this.gapMultiplierOpt.node)\n    Doc.hide(this.gapMultiplierOpt.node) // Default is GapStrategyPercentPlus\n    page.options.appendChild(this.gapPercentOpt.node)\n    page.options.appendChild(this.driftToleranceOpt.node)\n    page.options.appendChild(this.weightOpt.node)\n    page.options.appendChild(this.biasOpt.node)\n\n    Doc.bind(page.showAdvanced, 'click', () => {\n      State.storeLocal(State.optionsExpansionLK, true)\n      Doc.hide(page.showAdvanced)\n      Doc.show(page.hideAdvanced, page.options)\n    })\n\n    Doc.bind(page.hideAdvanced, 'click', () => {\n      State.storeLocal(State.optionsExpansionLK, false)\n      Doc.hide(page.hideAdvanced, page.options)\n      Doc.show(page.showAdvanced)\n    })\n\n    Doc.bind(page.runBttn, 'click', this.authedRoute(async (pw: string): Promise<void> => this.createBot(pw)))\n\n    Doc.bind(page.lotsInput, 'change', () => {\n      page.lotsInput.value = String(Math.round(parseFloat(page.lotsInput.value ?? '0')))\n    })\n\n    Doc.bind(page.exitEditMode, 'click', () => this.leaveEditMode())\n\n    Doc.bind(page.manualPriceBttn, 'click', () => {\n      Doc.hide(page.basisPrice, page.manualPriceBttn)\n      Doc.show(page.manualPriceInput)\n      page.manualPriceInput.focus()\n    })\n\n    const setManualPrice = () => {\n      const v = parseFloat(page.manualPriceInput.value ?? '0')\n      page.basisPrice.textContent = Doc.formatFiveSigFigs(v)\n      this.specifiedPrice = v\n      this.setCurrentBasisPrice(v)\n      Doc.show(page.basisPrice, page.manualPriceBttn)\n      Doc.hide(page.manualPriceInput, page.noFiatBox)\n    }\n\n    const hideManualPrice = () => {\n      page.manualPriceInput.value = ''\n      Doc.show(page.basisPrice, page.manualPriceBttn)\n      Doc.hide(page.manualPriceInput)\n    }\n\n    // Doc.bind(page.manualPriceInput, 'change', () => { setManualPrice() })\n\n    Doc.bind(page.manualPriceInput, 'keyup', (e: KeyboardEvent) => {\n      switch (e.key) {\n        case 'Escape':\n          hideManualPrice()\n          break\n        case 'Enter':\n        case 'NumpadEnter':\n          setManualPrice()\n      }\n    })\n\n    Doc.bind(page.manualPriceInput, 'blur', () => {\n      if (Doc.isHidden(page.basisPrice)) hideManualPrice()\n    })\n\n    Doc.bind(page.gapStrategySelect, 'change', () => this.updateGapStrategyInputs(this.currentReport))\n\n    const submitPasswordForm = async () => {\n      const pw = page.pwInput.value ?? ''\n      if (pw === '') return\n      const handler = this.pwHandler\n      if (handler === null) return\n      this.pwHandler = null\n      await handler(pw)\n      if (this.currentForm === page.pwForm) this.closePopups()\n    }\n\n    bindForm(page.pwForm, page.pwSubmit, () => submitPasswordForm())\n\n    Doc.bind(page.pwInput, 'keyup', (e: KeyboardEvent) => {\n      if (e.key !== 'Enter' && e.key !== 'NumpadEnter') return\n      submitPasswordForm()\n    })\n\n    this.newWalletForm = new NewWalletForm(\n      page.newWalletForm,\n      assetID => this.newWalletCreated(assetID)\n    )\n\n    Doc.bind(page.createBaseWallet, 'click', () => {\n      this.newWalletForm.setAsset(this.currentMarket.baseid)\n      this.showForm(page.newWalletForm)\n    })\n\n    Doc.bind(page.createQuoteWallet, 'click', () => {\n      this.newWalletForm.setAsset(this.currentMarket.quoteid)\n      this.showForm(page.newWalletForm)\n    })\n\n    Doc.bind(page.forms, 'mousedown', (e: MouseEvent) => {\n      if (!Doc.mouseInElement(e, this.currentForm)) { this.closePopups() }\n    })\n\n    this.keyup = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        this.closePopups()\n      }\n    }\n\n    const lastMkt = State.fetchLocal(State.lastMMMarketLK) as HostedMarket\n    let mkt: HostedMarket | null = null\n    if (lastMkt && lastMkt.host) {\n      const xc = app().exchanges[lastMkt.host]\n      if (xc) {\n        const mktID = lastMkt.basesymbol + '_' + lastMkt.quotesymbol\n        const xcMkt = xc.markets[mktID]\n        if (xcMkt) mkt = Object.assign({ host: xc.host }, xcMkt)\n      }\n    }\n\n    if (State.fetchLocal(State.optionsExpansionLK)) {\n      Doc.show(page.hideAdvanced, page.options)\n      Doc.hide(page.showAdvanced)\n    }\n\n    app().registerNoteFeeder({\n      bot: (n: BotNote) => { this.handleBotNote(n) }\n    })\n\n    this.setMarket([mkt ?? sortedMarkets()[0]])\n    this.populateRunningPrograms()\n    page.createBox.classList.remove('invisible')\n    page.programsBox.classList.remove('invisible')\n  }\n\n  unload (): void {\n    Doc.unbind(document, 'keyup', this.keyup)\n  }\n\n  /* showForm shows a modal form with a little animation. */\n  async showForm (form: HTMLElement): Promise<void> {\n    this.currentForm = form\n    const page = this.page\n    Doc.hide(page.pwForm, page.newWalletForm)\n    form.style.right = '10000px'\n    Doc.show(page.forms, form)\n    const shift = (page.forms.offsetWidth + form.offsetWidth) / 2\n    await Doc.animate(animationLength, progress => {\n      form.style.right = `${(1 - progress) * shift}px`\n    }, 'easeOutHard')\n    form.style.right = '0'\n  }\n\n  closePopups (): void {\n    this.pwHandler = null\n    this.page.pwInput.value = ''\n    Doc.hide(this.page.forms)\n  }\n\n  hideAssetDropdown (): void {\n    const page = this.page\n    page.assetDropdown.scrollTop = 0\n    Doc.hide(page.assetDropdown)\n  }\n\n  assetRow (symbol: string): PageElement {\n    const row = this.page.assetRowTmpl.cloneNode(true) as PageElement\n    const tmpl = Doc.parseTemplate(row)\n    tmpl.logo.src = Doc.logoPath(symbol)\n    Doc.empty(tmpl.symbol)\n    tmpl.symbol.appendChild(Doc.symbolize(symbol))\n    return row\n  }\n\n  setCurrentReport (r: MarketReport | null) {\n    this.currentReport = r\n    this.setCurrentBasisPrice(r ? r.basisPrice : 0)\n    this.updateGapStrategyInputs(r)\n\n    // Set max value for absolute input\n    const page = this.page\n    if (r && r.basisPrice > 0) {\n      this.fetchMaxBuy(Math.round(r.basisPrice / this.currentMarket.atomToConv * RateEncodingFactor))\n      page.basisPrice.textContent = Doc.formatFiveSigFigs(r.basisPrice)\n      Doc.show(page.absMaxBox, page.basisPrice)\n      Doc.hide(page.manualPriceInput, page.noFiatBox)\n      this.page.gapFactorMax.textContent = Doc.formatFiveSigFigs(r.basisPrice)\n    } else {\n      page.lotEstQuoteLots.textContent = '[no rate]'\n      page.basisPrice.textContent = 'must set manually'\n      Doc.hide(page.basisPrice, page.absMaxBox)\n      Doc.show(page.manualPriceInput)\n      page.manualPriceInput.focus()\n      const u = app().user\n      if (Object.keys(u.fiatRates).length === 0) Doc.show(page.noFiatBox)\n    }\n\n    if (r && r.breakEvenSpread > 0) {\n      Doc.show(page.breakEvenGapBox)\n      page.breakEvenGap.textContent = Doc.formatFiveSigFigs(r.breakEvenSpread)\n    } else Doc.hide(page.breakEvenGapBox)\n  }\n\n  updateGapStrategyInputVisibility () {\n    const page = this.page\n    const gapStrategy = page.gapStrategySelect.value\n    switch (gapStrategy) {\n      case GapStrategyMultiplier:\n        Doc.show(this.gapMultiplierOpt.node)\n        Doc.hide(page.absInputBox, page.absMaxBox, this.gapPercentOpt.node)\n        break\n      case GapStrategyPercent:\n      case GapStrategyPercentPlus:\n        Doc.show(this.gapPercentOpt.node)\n        Doc.hide(page.absInputBox, page.absMaxBox, this.gapMultiplierOpt.node)\n        break\n      case GapStrategyAbsolute:\n      case GapStrategyAbsolutePlus:\n        Doc.hide(this.gapMultiplierOpt.node, this.gapPercentOpt.node)\n        Doc.show(page.absInputBox, page.absMaxBox)\n    }\n  }\n\n  updateGapStrategyInputs (r: MarketReport | null) {\n    this.updateGapStrategyInputVisibility()\n    switch (this.page.gapStrategySelect.value) {\n      case GapStrategyMultiplier: {\n        if (r && r.breakEvenSpread > 0) {\n          gapMultiplierRange.start.y = r.breakEvenSpread\n          gapMultiplierRange.end.y = r.breakEvenSpread * 100\n          gapMultiplierRange.yUnit = this.rateUnit()\n        } else {\n          gapMultiplierRange.start.y = 100\n          gapMultiplierRange.end.y = 10000\n          gapMultiplierRange.yUnit = '%'\n        }\n        this.gapMultiplierOpt.handler.setConfig(gapMultiplierRange)\n        break\n      }\n      case GapStrategyPercent:\n      case GapStrategyPercentPlus: {\n        if (r && r.breakEvenSpread > 0) {\n          gapPercentRange.end.y = r.basisPrice\n          gapPercentRange.yUnit = this.rateUnit()\n          this.gapPercentOpt.handler.setConfig(gapPercentRange)\n        } else {\n          gapPercentRange.end.y = 10\n          gapPercentRange.yUnit = '%'\n        }\n      }\n    }\n  }\n\n  setCurrentBasisPrice (p: number) {\n    if (p > 0) {\n      const rateUnit = this.rateUnit()\n      oracleBiasRange.start.y = -0.01 * p\n      oracleBiasRange.end.y = 0.01 * p\n      oracleBiasRange.yUnit = rateUnit\n      driftToleranceRange.start.y = 0\n      driftToleranceRange.end.y = p * 0.01\n      driftToleranceRange.yUnit = rateUnit\n    } else {\n      oracleBiasRange.start.y = -1\n      oracleBiasRange.end.y = 1\n      oracleBiasRange.yUnit = '%'\n      driftToleranceRange.start.y = 0\n      driftToleranceRange.end.y = 1\n      driftToleranceRange.yUnit = '%'\n    }\n    this.biasOpt.handler.setConfig(oracleBiasRange)\n    this.driftToleranceOpt.handler.setConfig(driftToleranceRange)\n  }\n\n  rateUnit (): string {\n    const quoteSymbol = this.currentMarket.quotesymbol.split('.')[0]\n    const baseSymbol = this.currentMarket.basesymbol.split('.')[0]\n    return `${quoteSymbol}/${baseSymbol}`\n  }\n\n  async setMarket (mkts: HostedMarket[], skipMarketUpdate?: boolean): Promise<void> {\n    const page = this.page\n\n    const mkt = mkts[0]\n    this.currentMarket = mkt\n    this.specifiedPrice = 0\n    this.setCurrentReport(null)\n    page.manualPriceInput.value = ''\n\n    State.storeLocal(State.lastMMMarketLK, mkt)\n\n    Doc.empty(page.baseSelect, page.quoteSelect)\n    page.baseSelect.appendChild(this.assetRow(mkt.basesymbol))\n    page.quoteSelect.appendChild(this.assetRow(mkt.quotesymbol))\n    this.hideAssetDropdown()\n\n    const addMarketSelect = (mkt: HostedMarket, el: PageElement) => {\n      Doc.setContent(el,\n        Doc.symbolize(mkt.basesymbol),\n        new Text('-') as any,\n        Doc.symbolize(mkt.quotesymbol),\n        new Text(' @ ') as any,\n        new Text(mkt.host) as any\n      )\n    }\n\n    Doc.hide(page.marketSelect, page.marketOneChoice)\n    if (mkts.length === 1) {\n      Doc.show(page.marketOneChoice)\n      addMarketSelect(mkt, page.marketOneChoice)\n    } else {\n      Doc.show(page.marketSelect)\n      Doc.empty(page.marketSelect)\n      for (const mkt of mkts) {\n        const opt = document.createElement('option')\n        page.marketSelect.appendChild(opt)\n        opt.value = `${mkt.host} ${mkt.name}`\n        addMarketSelect(mkt, opt)\n      }\n    }\n\n    if (skipMarketUpdate) return\n\n    Doc.setContent(page.lotEstBaseSymbol, Doc.symbolize(mkt.basesymbol))\n    Doc.setContent(page.lotEstQuoteSymbol, Doc.symbolize(mkt.quotesymbol))\n\n    const setNoWallet = (a: SupportedAsset, noWalletBox: PageElement): boolean => {\n      Doc.show(noWalletBox)\n      const tmpl = Doc.parseTemplate(noWalletBox)\n      tmpl.assetLogo.src = Doc.logoPath(a.symbol)\n      tmpl.assetName.textContent = a.name\n      return false\n    }\n\n    Doc.hide(\n      page.lotEstQuoteBox, page.lotEstQuoteNoWallet, page.lotEstBaseBox, page.lotEstBaseNoWallet, page.availHeader,\n      page.lotEstimateBox, page.marketInfo, page.oraclesBox, page.lotsBox, page.options, page.advancedBox\n    )\n    const [b, q] = [app().assets[mkt.baseid], app().assets[mkt.quoteid]]\n    if (b.wallet && q.wallet) {\n      Doc.show(\n        page.lotEstQuoteBox, page.lotEstBaseBox, page.availHeader, page.fetchingMarkets,\n        page.lotsBox, page.advancedBox\n      )\n      if (State.fetchLocal(State.optionsExpansionLK)) Doc.show(page.options)\n      const loaded = app().loading(page.options)\n      const buy = this.fetchOracleAndMaxBuy()\n      const sell = this.fetchMaxSell()\n      await buy\n      await sell\n      loaded()\n      Doc.show(page.lotEstimateBox, page.marketInfo, page.oraclesBox)\n      Doc.hide(page.fetchingMarkets)\n      return\n    }\n    Doc.show(page.lotEstimateBox)\n    if (q.wallet) {\n      page.lotEstQuoteLots.textContent = '0'\n    } else setNoWallet(q, page.lotEstQuoteNoWallet)\n\n    if (b.wallet) {\n      page.lotEstBaseLots.textContent = '0'\n    } else setNoWallet(b, page.lotEstBaseNoWallet)\n  }\n\n  async fetchMaxSell (): Promise<void> {\n    const { currentMarket: mkt, page } = this\n    const res = await postJSON('/api/maxsell', {\n      host: mkt.host,\n      base: mkt.baseid,\n      quote: mkt.quoteid\n    }) as MaxSell\n    if (this.currentMarket !== mkt) return\n    if (!app().checkResponse(res as any)) {\n      page.lotEstBaseLots.textContent = '0'\n      console.error(res)\n      return\n    }\n    page.lotEstBaseLots.textContent = String(res.maxSell.swap.lots)\n  }\n\n  async fetchOracleAndMaxBuy (): Promise<void> {\n    const { currentMarket: mkt, page } = this\n    const res = await postJSON('/api/marketreport', { host: mkt.host, baseID: mkt.baseid, quoteID: mkt.quoteid })\n    if (!app().checkResponse(res)) {\n      page.lotEstQuoteLots.textContent = '0'\n      console.error(res)\n      return\n    }\n    const r = res.report as MarketReport\n    Doc.hide(page.manualPriceBttn)\n    this.setCurrentReport(r)\n\n    if (!r.oracles || r.oracles.length === 0) return\n\n    Doc.empty(page.oracles)\n    let weight = 0\n    let weightedSum = 0\n    for (const o of r.oracles ?? []) {\n      const tr = page.oracleTmpl.cloneNode(true) as PageElement\n      page.oracles.appendChild(tr)\n      const tmpl = Doc.parseTemplate(tr)\n      tmpl.logo.src = 'img/' + o.host + '.png'\n      tmpl.host.textContent = ExchangeNames[o.host]\n      tmpl.volume.textContent = Doc.formatThreeSigFigs(o.usdVol)\n      const price = (o.bestBuy + o.bestSell) / 2\n      weightedSum += o.usdVol * price\n      weight += o.usdVol\n      tmpl.price.textContent = Doc.formatThreeSigFigs((o.bestBuy + o.bestSell) / 2)\n    }\n    page.avgPrice.textContent = Doc.formatFiveSigFigs(weightedSum / weight)\n  }\n\n  async fetchMaxBuy (rate: number): Promise<void> {\n    const { currentMarket: mkt, page } = this\n    const res = await postJSON('/api/maxbuy', {\n      host: mkt.host,\n      base: mkt.baseid,\n      quote: mkt.quoteid,\n      rate: rate ?? 0\n    }) as MaxBuy\n    if (this.currentMarket !== mkt) return\n    page.lotEstQuoteLots.textContent = String(res.maxBuy.swap.lots)\n  }\n\n  setEditProgram (report: BotReport): void {\n    const { createOpts, page } = this\n    const pgm = report.program\n    const [b, q] = [app().assets[pgm.baseID], app().assets[pgm.quoteID]]\n    const mkt = app().exchanges[pgm.host].markets[`${b.symbol}_${q.symbol}`]\n    this.setMarket([{\n      host: pgm.host,\n      ...mkt\n    }], true)\n    for (const p of Object.values(this.programs)) {\n      if (p.programID !== report.programID) Doc.hide(p.div)\n    }\n    this.editProgram = report\n    page.createBox.classList.add('edit')\n    page.programsBox.classList.add('edit')\n    page.lotsInput.value = String(pgm.lots)\n    createOpts.oracleWeighting = pgm.oracleWeighting\n    this.weightOpt.setValue(pgm.oracleWeighting)\n    createOpts.oracleBias = pgm.oracleBias\n    this.biasOpt.setValue(pgm.oracleBias)\n    createOpts.driftTolerance = pgm.driftTolerance\n    this.driftToleranceOpt.setValue(pgm.driftTolerance)\n    page.gapStrategySelect.value = pgm.gapStrategy\n    this.updateGapStrategyInputVisibility()\n    this.createOptsUpdated()\n\n    switch (pgm.gapStrategy) {\n      case GapStrategyPercent:\n      case GapStrategyPercentPlus:\n        this.gapPercentOpt.setValue(pgm.gapFactor)\n        break\n      case GapStrategyMultiplier:\n        this.gapMultiplierOpt.setValue(pgm.gapFactor)\n    }\n\n    Doc.bind(page.programsBox, 'click', () => this.leaveEditMode())\n  }\n\n  leaveEditMode (): void {\n    const page = this.page\n    Doc.unbind(page.programsBox, 'click', () => this.leaveEditMode())\n    for (const p of Object.values(this.programs)) Doc.show(p.div)\n    page.createBox.classList.remove('edit')\n    page.programsBox.classList.remove('edit')\n    this.editProgram = null\n    this.setMarket([this.currentMarket])\n  }\n\n  populateRunningPrograms (): void {\n    const page = this.page\n    const bots = app().user.bots\n    Doc.empty(page.runningPrograms)\n    this.programs = {}\n    for (const report of bots) page.runningPrograms.appendChild(this.programDiv(report))\n    this.setProgramsHeader()\n  }\n\n  setProgramsHeader (): void {\n    const page = this.page\n    if (page.runningPrograms.children.length > 0) {\n      Doc.show(page.programsHeader)\n      Doc.hide(page.noProgramsMessage)\n    } else {\n      Doc.hide(page.programsHeader)\n      Doc.show(page.noProgramsMessage)\n    }\n  }\n\n  programDiv (report: BotReport): PageElement {\n    const page = this.page\n    const div = page.runningProgramTmpl.cloneNode(true) as PageElement\n    const tmpl = Doc.parseTemplate(div)\n    const startStop = async (endpoint: string, pw?: string): Promise<void> => {\n      Doc.hide(tmpl.startErr)\n      const loaded = app().loading(div)\n      const res = await postJSON(endpoint, { programID: report.programID, appPW: pw })\n      loaded()\n      if (!app().checkResponse(res)) {\n        tmpl.startErr.textContent = res.msg\n        Doc.show(tmpl.startErr)\n      }\n    }\n    Doc.bind(tmpl.pauseBttn, 'click', () => startStop('/api/stopbot'))\n    Doc.bind(tmpl.startBttn, 'click', this.authedRoute(async (pw: string) => startStop('/api/startbot', pw)))\n    Doc.bind(tmpl.retireBttn, 'click', () => startStop('/api/retirebot'))\n    Doc.bind(tmpl.configureBttn, 'click', (e: MouseEvent) => {\n      e.stopPropagation()\n      this.setEditProgram(this.programs[report.programID])\n    })\n    const [b, q] = [app().assets[report.program.baseID], app().assets[report.program.quoteID]]\n    tmpl.base.appendChild(this.assetRow(b.symbol))\n    tmpl.quote.appendChild(this.assetRow(q.symbol))\n    tmpl.baseSymbol.textContent = b.symbol.toUpperCase()\n    tmpl.quoteSymbol.textContent = q.symbol.toUpperCase()\n    tmpl.host.textContent = report.program.host\n    this.updateProgramDiv(tmpl, report)\n    this.programs[report.programID] = Object.assign({ tmpl, div }, report)\n    return div\n  }\n\n  authedRoute (handler: (pw: string) => Promise<void>): () => void {\n    return async () => {\n      if (State.passwordIsCached()) return await handler('')\n      this.pwHandler = handler\n      await this.showForm(this.page.pwForm)\n    }\n  }\n\n  updateProgramDiv (tmpl: Record<string, PageElement>, report: BotReport): void {\n    const pgm = report.program\n    Doc.hide(tmpl.programRunning, tmpl.programPaused)\n    if (report.running) Doc.show(tmpl.programRunning)\n    else Doc.show(tmpl.programPaused)\n    tmpl.lots.textContent = String(pgm.lots)\n    tmpl.boost.textContent = `${(pgm.gapFactor * 100).toFixed(1)}%`\n    tmpl.driftTolerance.textContent = `${(pgm.driftTolerance * 100).toFixed(2)}%`\n    tmpl.oracleWeight.textContent = `${(pgm.oracleWeighting * 100).toFixed(0)}%`\n    tmpl.oracleBias.textContent = `${(pgm.oracleBias * 100).toFixed(1)}%`\n  }\n\n  setMarketSubchoice (host: string, name: string): void {\n    if (host !== this.currentMarket.host || name !== this.currentMarket.name) this.leaveEditMode()\n    this.currentMarket = Object.assign({ host }, app().exchanges[host].markets[name])\n  }\n\n  createOptsUpdated (): void {\n    const opts = this.createOpts\n    if (opts.oracleWeighting) Doc.show(this.biasOpt.node)\n    else Doc.hide(this.biasOpt.node)\n  }\n\n  handleBotNote (n: BotNote): void {\n    const page = this.page\n    const r = n.report\n    switch (n.topic) {\n      case 'BotCreated':\n        page.runningPrograms.prepend(this.programDiv(r))\n        this.setProgramsHeader()\n        break\n      case 'BotRetired':\n        this.programs[r.programID].div.remove()\n        delete this.programs[r.programID]\n        this.setProgramsHeader()\n        break\n      default: {\n        const p = this.programs[r.programID]\n        Object.assign(p, r)\n        this.updateProgramDiv(p.tmpl, r)\n      }\n    }\n  }\n\n  setCreationBase (symbol: string) {\n    const counterAsset = this.currentMarket.quotesymbol\n    const markets = sortedMarkets()\n    const options: HostedMarket[] = []\n    // Best option: find an exact match.\n    for (const mkt of markets) if (mkt.basesymbol === symbol && mkt.quotesymbol === counterAsset) options.push(mkt)\n    // Next best option: same assets, reversed order.\n    for (const mkt of markets) if (mkt.quotesymbol === symbol && mkt.basesymbol === counterAsset) options.push(mkt)\n    // If we have exact matches, we're done.\n    if (options.length > 0) return this.setMarket(options)\n    // No exact matches. Must have selected a ghost-class market. Next best\n    // option will be the first market where the selected asset is a base asset.\n    for (const mkt of markets) if (mkt.basesymbol === symbol) return this.setMarket([mkt])\n    // Last option: Market where this is the quote asset.\n    for (const mkt of markets) if (mkt.quotesymbol === symbol) return this.setMarket([mkt])\n  }\n\n  setCreationQuote (symbol: string) {\n    const counterAsset = this.currentMarket.basesymbol\n    const markets = sortedMarkets()\n    const options: HostedMarket[] = []\n    for (const mkt of markets) if (mkt.quotesymbol === symbol && mkt.basesymbol === counterAsset) options.push(mkt)\n    for (const mkt of markets) if (mkt.basesymbol === symbol && mkt.quotesymbol === counterAsset) options.push(mkt)\n    if (options.length > 0) return this.setMarket(options)\n    for (const mkt of markets) if (mkt.quotesymbol === symbol) return this.setMarket([mkt])\n    for (const mkt of markets) if (mkt.basesymbol === symbol) return this.setMarket([mkt])\n  }\n\n  async createBot (appPW: string): Promise<void> {\n    const { page, currentMarket, currentReport } = this\n\n    Doc.hide(page.createErr)\n    const setError = (s: string) => {\n      page.createErr.textContent = s\n      Doc.show(page.createErr)\n    }\n\n    const lots = parseInt(page.lotsInput.value || '0')\n    if (lots === 0) return setError('must specify > 0 lots')\n    const makerProgram = Object.assign({\n      host: currentMarket.host,\n      baseID: currentMarket.baseid,\n      quoteID: currentMarket.quoteid\n    }, this.createOpts, { lots, gapStrategy: '' })\n\n    const strategy = page.gapStrategySelect.value\n    makerProgram.gapStrategy = strategy ?? ''\n\n    const req = {\n      botType: 'MakerV0',\n      program: makerProgram,\n      programID: 0,\n      appPW: appPW,\n      manualRate: 0\n    }\n\n    switch (strategy) {\n      case GapStrategyAbsolute:\n      case GapStrategyAbsolutePlus: {\n        const r = parseFloat(page.absInput.value || '0')\n        if (r === 0) return setError('gap must be specified for strategy = absolute')\n        else if (currentReport?.basisPrice && r >= currentReport.basisPrice) return setError('gap width cannot be > current spot price')\n        makerProgram.gapFactor = r\n        break\n      }\n      case GapStrategyPercent:\n      case GapStrategyPercentPlus:\n        makerProgram.gapFactor = this.gapRanges.gapPercent\n        break\n      default:\n        makerProgram.gapFactor = this.gapRanges.gapMultiplier\n    }\n\n    let endpoint = '/api/createbot'\n\n    if (this.editProgram !== null) {\n      req.programID = this.editProgram.programID\n      endpoint = '/api/updatebotprogram'\n    } else {\n      if (!this.currentReport || this.currentReport.basisPrice === 0) {\n        if (this.specifiedPrice === 0) {\n          setError('price must be set manually')\n          return\n        }\n        req.program.manualRate = this.specifiedPrice\n      }\n    }\n\n    const loaded = app().loading(page.botCreator)\n    const res = await postJSON(endpoint, req)\n    loaded()\n\n    if (!app().checkResponse(res)) {\n      page.createErr.textContent = res.msg\n      Doc.show(page.createErr)\n      return\n    }\n\n    this.leaveEditMode()\n\n    page.lotsInput.value = ''\n  }\n\n  newWalletCreated (assetID: number) {\n    const m = this.currentMarket\n    if (assetID === m.baseid) this.setCreationBase(m.basesymbol)\n    else if (assetID === m.quoteid) this.setCreationQuote(m.quotesymbol)\n    else return\n    this.closePopups()\n  }\n}\n\nfunction sortedMarkets (): HostedMarket[] {\n  const mkts: HostedMarket[] = []\n  const convertMarkets = (xc: Exchange): HostedMarket[] => {\n    return Object.values(xc.markets).map((mkt: Market) => Object.assign({ host: xc.host }, mkt))\n  }\n  for (const xc of Object.values(app().user.exchanges)) mkts.push(...convertMarkets(xc))\n  mkts.sort((a: Market, b: Market) => {\n    if (!a.spot) {\n      if (!b.spot) return a.name.localeCompare(b.name)\n      return -1\n    }\n    if (!b.spot) return 1\n    // Sort by lots.\n    return b.spot.vol24 / b.lotsize - a.spot.vol24 / a.lotsize\n  })\n  return mkts\n}\n\nfunction createOption (opt: BaseOption): OrderOption {\n  return {\n    key: opt.key,\n    displayname: opt.displayname,\n    description: opt.description,\n    default: opt.default,\n    max: opt.max,\n    min: opt.min,\n    noecho: false,\n    isboolean: false,\n    isdate: false,\n    disablewhenactive: false,\n    isBirthdayConfig: false,\n    noauth: false\n  }\n}\n\nfunction createXYRange (baseOpt: BaseOption, xyRange: XYRange): OrderOption {\n  const opt = createOption(baseOpt)\n  opt.xyRange = xyRange\n  return opt\n}\n\nconst ExchangeNames: Record<string, string> = {\n  'binance.com': 'Binance',\n  'coinbase.com': 'Coinbase',\n  'bittrex.com': 'Bittrex',\n  'hitbtc.com': 'HitBTC',\n  'exmo.com': 'EXMO'\n}\n","import Doc from './doc'\nimport State from './state'\nimport RegistrationPage from './register'\nimport LoginPage from './login'\nimport WalletsPage from './wallets'\nimport SettingsPage from './settings'\nimport MarketsPage from './markets'\nimport OrdersPage from './orders'\nimport OrderPage from './order'\nimport DexSettingsPage from './dexsettings'\nimport MarketMakerPage from './mm'\nimport { RateEncodingFactor, StatusExecuted, hasActiveMatches } from './orderutil'\nimport { getJSON, postJSON, Errors } from './http'\nimport * as ntfn from './notifications'\nimport ws from './ws'\nimport * as intl from './locales'\nimport {\n  User,\n  SupportedAsset,\n  Exchange,\n  WalletState,\n  BondNote,\n  CoreNote,\n  OrderNote,\n  Market,\n  Order,\n  Match,\n  BalanceNote,\n  WalletConfigNote,\n  MatchNote,\n  ConnEventNote,\n  SpotPriceNote,\n  BotNote,\n  UnitInfo,\n  WalletDefinition,\n  WalletBalance,\n  LogMessage,\n  NoteElement,\n  BalanceResponse,\n  APIResponse,\n  RateNote,\n  BotReport,\n  InFlightOrder\n} from './registry'\n\nconst idel = Doc.idel // = element by id\nconst bind = Doc.bind\nconst unbind = Doc.unbind\n\nconst notificationRoute = 'notify'\nconst noteCacheSize = 100\n\ninterface Page {\n  unload (): void\n}\n\ninterface PageClass {\n  new (main: HTMLElement, data: any): Page;\n}\n\ninterface CoreNotePlus extends CoreNote {\n  el: HTMLElement // Added in app\n}\n\n/* constructors is a map to page constructors. */\nconst constructors: Record<string, PageClass> = {\n  login: LoginPage,\n  register: RegistrationPage,\n  markets: MarketsPage,\n  wallets: WalletsPage,\n  settings: SettingsPage,\n  orders: OrdersPage,\n  order: OrderPage,\n  dexsettings: DexSettingsPage,\n  mm: MarketMakerPage\n}\n\n// Application is the main javascript web application for the Decred DEX client.\nexport default class Application {\n  notes: CoreNotePlus[]\n  pokes: CoreNotePlus[]\n  user: User\n  seedGenTime: number\n  commitHash: string\n  showPopups: boolean\n  loggers: Record<string, boolean>\n  recorders: Record<string, LogMessage[]>\n  main: HTMLElement\n  header: HTMLElement\n  headerSpace: HTMLElement\n  assets: Record<number, SupportedAsset>\n  exchanges: Record<string, Exchange>\n  walletMap: Record<number, WalletState>\n  fiatRatesMap: Record<number, number>\n  tooltip: HTMLElement\n  page: Record<string, HTMLElement>\n  loadedPage: Page | null\n  popupNotes: HTMLElement\n  popupTmpl: HTMLElement\n  noteReceivers: Record<string, (n: CoreNote) => void>[]\n\n  constructor () {\n    this.notes = []\n    this.pokes = []\n    this.seedGenTime = 0\n    this.commitHash = process.env.COMMITHASH || ''\n    this.noteReceivers = []\n    this.fiatRatesMap = {}\n    this.showPopups = State.fetchLocal(State.popupsLK) === '1'\n\n    console.log('Decred DEX Client App, Build', this.commitHash.substring(0, 7))\n\n    // Loggers can be enabled by setting a truthy value to the loggerID using\n    // enableLogger. Settings are stored across sessions. See docstring for the\n    // log method for more info.\n    this.loggers = State.fetchLocal(State.loggersLK) || {}\n    window.enableLogger = (loggerID, state) => {\n      if (state) this.loggers[loggerID] = true\n      else delete this.loggers[loggerID]\n      State.storeLocal(State.loggersLK, this.loggers)\n      return `${loggerID} logger ${state ? 'enabled' : 'disabled'}`\n    }\n    // Enable logging from anywhere.\n    window.log = (loggerID, ...a) => { this.log(loggerID, ...a) }\n\n    // Recorders can record log messages, and then save them to file on request.\n    const recorderKeys = State.fetchLocal(State.recordersLK) || []\n    this.recorders = {}\n    for (const loggerID of recorderKeys) {\n      console.log('recording', loggerID)\n      this.recorders[loggerID] = []\n    }\n    window.recordLogger = (loggerID, on) => {\n      if (on) this.recorders[loggerID] = []\n      else delete this.recorders[loggerID]\n      State.storeLocal(State.recordersLK, Object.keys(this.recorders))\n      return `${loggerID} recorder ${on ? 'enabled' : 'disabled'}`\n    }\n    window.dumpLogger = loggerID => {\n      const record = this.recorders[loggerID]\n      if (!record) return `no recorder for logger ${loggerID}`\n      const a = document.createElement('a')\n      a.href = `data:application/octet-stream;base64,${window.btoa(JSON.stringify(record, null, 4))}`\n      a.download = `${loggerID}.json`\n      document.body.appendChild(a)\n      a.click()\n      setTimeout(() => {\n        document.body.removeChild(a)\n      }, 0)\n    }\n\n    // use user current locale set by backend\n    intl.setLocale()\n  }\n\n  /**\n   * Start the application. This is the only thing done from the index.js entry\n   * point. Read the id = main element and attach handlers.\n   */\n  async start () {\n    // Handle back navigation from the browser.\n    bind(window, 'popstate', (e: PopStateEvent) => {\n      const page = e.state.page\n      if (!page && page !== '') return\n      this.loadPage(page, e.state.data, true)\n    })\n    // The main element is the interchangeable part of the page that doesn't\n    // include the header. Main should define a data-handler attribute\n    // associated with one of the available constructors.\n    this.main = idel(document, 'main')\n    const handler = this.main.dataset.handler\n    // Don't fetch the user until we know what page we're on.\n    await this.fetchUser()\n    // The application is free to respond with a page that differs from the\n    // one requested in the omnibox, e.g. routing though a login page. Set the\n    // current URL state based on the actual page.\n    const url = new URL(window.location.href)\n    if (handlerFromPath(url.pathname) !== handler) {\n      url.pathname = `/${handler}`\n      url.search = ''\n      window.history.replaceState({ page: handler }, '', url)\n    }\n    // Attach stuff.\n    this.attachHeader()\n    this.attachCommon(this.header)\n    this.attach({})\n    // Load recent notifications from Window.localStorage.\n    const notes = State.fetchLocal(State.notificationsLK)\n    this.setNotes(notes || [])\n    // Connect the websocket and register the notification route.\n    ws.connect(getSocketURI(), this.reconnected)\n    ws.registerRoute(notificationRoute, (note: CoreNote) => {\n      this.notify(note)\n    })\n  }\n\n  /*\n   * reconnected is called by the websocket client when a reconnection is made.\n   */\n  reconnected () {\n    window.location.reload() // This triggers another websocket disconnect/connect (!)\n    // a fetchUser() and loadPage(window.history.state.page) might work\n  }\n\n  /*\n   * Fetch and save the user, which is the primary core state that must be\n   * maintained by the Application.\n   */\n  async fetchUser (): Promise<User | void> {\n    const resp: APIResponse = await getJSON('/api/user')\n    if (!this.checkResponse(resp)) return\n    const user = (resp as any) as User\n    this.seedGenTime = user.seedgentime\n    this.user = user\n    this.assets = user.assets\n    this.exchanges = user.exchanges\n    this.walletMap = {}\n    this.fiatRatesMap = user.fiatRates\n    for (const [assetID, asset] of (Object.entries(user.assets) as [any, SupportedAsset][])) {\n      if (asset.wallet) {\n        this.walletMap[assetID] = asset.wallet\n      }\n    }\n\n    this.updateMenuItemsDisplay()\n    return user\n  }\n\n  authed () {\n    return this.user && this.user.authed\n  }\n\n  /* Load the page from the server. Insert and bind the DOM. */\n  async loadPage (page: string, data?: any, skipPush?: boolean): Promise<boolean> {\n    // Close some menus and tooltips.\n    this.tooltip.style.left = '-10000px'\n    Doc.hide(this.page.noteBox, this.page.profileBox)\n    // Parse the request.\n    const url = new URL(`/${page}`, window.location.origin)\n    const requestedHandler = handlerFromPath(page)\n    // Fetch and parse the page.\n    const response = await window.fetch(url.toString())\n    if (!response.ok) return false\n    const html = await response.text()\n    const doc = Doc.noderize(html)\n    const main = idel(doc, 'main')\n    const delivered = main.dataset.handler\n    // Append the request to the page history.\n    if (!skipPush) {\n      const path = delivered === requestedHandler ? url.toString() : `/${delivered}`\n      window.history.pushState({ page: page, data: data }, '', path)\n    }\n    // Insert page and attach handlers.\n    document.title = doc.title\n    this.main.replaceWith(main)\n    this.main = main\n    this.noteReceivers = []\n    Doc.empty(this.headerSpace)\n    this.attach(data)\n    return true\n  }\n\n  /* attach binds the common handlers and calls the page constructor. */\n  attach (data: any) {\n    const handlerID = this.main.dataset.handler\n    if (!handlerID) {\n      console.error('cannot attach to content with no specified handler')\n      return\n    }\n    this.attachCommon(this.main)\n    if (this.loadedPage) this.loadedPage.unload()\n    const constructor = constructors[handlerID]\n    if (constructor) this.loadedPage = new constructor(this.main, data)\n    else this.loadedPage = null\n\n    // Bind the tooltips.\n    this.bindTooltips(this.main)\n  }\n\n  bindTooltips (ancestor: HTMLElement) {\n    ancestor.querySelectorAll('[data-tooltip]').forEach((el: HTMLElement) => {\n      bind(el, 'mouseenter', () => {\n        this.tooltip.textContent = el.dataset.tooltip || ''\n        const lyt = Doc.layoutMetrics(el)\n        let left = lyt.centerX - this.tooltip.offsetWidth / 2\n        if (left < 0) left = 5\n        if (left + this.tooltip.offsetWidth > document.body.offsetWidth) {\n          left = document.body.offsetWidth - this.tooltip.offsetWidth - 5\n        }\n        this.tooltip.style.left = `${left}px`\n        this.tooltip.style.top = `${lyt.bodyTop - this.tooltip.offsetHeight - 5}px`\n      })\n      bind(el, 'mouseleave', () => {\n        this.tooltip.style.left = '-10000px'\n      })\n    })\n  }\n\n  /* attachHeader attaches the header element, which unlike the main element,\n   * isn't replaced during page navigation.\n   */\n  attachHeader () {\n    this.header = idel(document.body, 'header')\n    this.headerSpace = Doc.idel(this.header, 'headerSpace')\n    this.popupNotes = idel(document.body, 'popupNotes')\n    this.popupTmpl = Doc.tmplElement(this.popupNotes, 'note')\n    if (this.popupTmpl) this.popupTmpl.remove()\n    else console.error('popupTmpl element not found')\n    this.tooltip = idel(document.body, 'tooltip')\n    const page = this.page = Doc.idDescendants(this.header)\n    page.noteTmpl.removeAttribute('id')\n    page.noteTmpl.remove()\n    page.pokeTmpl.removeAttribute('id')\n    page.pokeTmpl.remove()\n    page.loader.remove()\n    Doc.show(page.loader)\n\n    bind(page.noteBell, 'click', async () => {\n      Doc.hide(page.pokeList)\n      Doc.show(page.noteList)\n      this.ackNotes()\n      page.noteCat.classList.add('active')\n      page.pokeCat.classList.remove('active')\n      this.showDropdown(page.noteBell, page.noteBox)\n      Doc.hide(page.noteIndicator)\n      for (const note of this.notes) {\n        if (note.acked) {\n          note.el.classList.remove('firstview')\n        }\n      }\n      this.setNoteTimes(page.noteList)\n      this.setNoteTimes(page.pokeList)\n      this.storeNotes()\n    })\n\n    bind(page.burgerIcon, 'click', () => {\n      Doc.hide(page.logoutErr)\n      this.showDropdown(page.burgerIcon, page.profileBox)\n    })\n\n    bind(page.innerNoteIcon, 'click', () => { Doc.hide(page.noteBox) })\n    bind(page.innerBurgerIcon, 'click', () => { Doc.hide(page.profileBox) })\n\n    bind(page.profileSignout, 'click', async () => await this.signOut())\n\n    bind(page.pokeCat, 'click', () => {\n      this.setNoteTimes(page.pokeList)\n      page.pokeCat.classList.add('active')\n      page.noteCat.classList.remove('active')\n      Doc.hide(page.noteList)\n      Doc.show(page.pokeList)\n      this.ackNotes()\n    })\n\n    bind(page.noteCat, 'click', () => {\n      this.setNoteTimes(page.noteList)\n      page.noteCat.classList.add('active')\n      page.pokeCat.classList.remove('active')\n      Doc.hide(page.pokeList)\n      Doc.show(page.noteList)\n      this.ackNotes()\n    })\n  }\n\n  /*\n   * showDropdown sets the position and visibility of the specified dropdown\n   * dialog according to the position of its icon button.\n   */\n  showDropdown (icon: HTMLElement, dialog: HTMLElement) {\n    const ico = icon.getBoundingClientRect()\n    Doc.hide(this.page.noteBox, this.page.profileBox)\n    Doc.show(dialog)\n    dialog.style.right = `${window.innerWidth - ico.left - ico.width + 5}px`\n    dialog.style.top = `${ico.top - 4}px`\n\n    const hide = (e: MouseEvent) => {\n      if (!Doc.mouseInElement(e, dialog)) {\n        Doc.hide(dialog)\n        unbind(document, 'click', hide)\n        if (dialog === this.page.noteBox && Doc.isDisplayed(this.page.noteList)) {\n          this.ackNotes()\n        }\n      }\n    }\n    bind(document, 'click', hide)\n  }\n\n  ackNotes () {\n    const acks = []\n    for (const note of this.notes) {\n      if (note.acked) {\n        note.el.classList.remove('firstview')\n      } else {\n        note.acked = true\n        if (note.id && note.severity > ntfn.POKE) acks.push(note.id)\n      }\n    }\n    if (acks.length) ws.request('acknotes', acks)\n    Doc.hide(this.page.noteIndicator)\n  }\n\n  setNoteTimes (noteList: HTMLElement) {\n    for (const el of (Array.from(noteList.children) as NoteElement[])) {\n      Doc.safeSelector(el, 'span.note-time').textContent = Doc.timeSince(el.note.stamp)\n    }\n  }\n\n  /*\n   * bindInternalNavigation hijacks navigation by click on any local links that\n   * are descendants of ancestor.\n   */\n  bindInternalNavigation (ancestor: HTMLElement) {\n    const pageURL = new URL(window.location.href)\n    ancestor.querySelectorAll('a').forEach(a => {\n      if (!a.href) return\n      const url = new URL(a.href)\n      if (url.origin === pageURL.origin) {\n        const token = url.pathname.substring(1)\n        const params: Record<string, string> = {}\n        if (url.search) {\n          url.searchParams.forEach((v, k) => {\n            params[k] = v\n          })\n        }\n        Doc.bind(a, 'click', (e: Event) => {\n          e.preventDefault()\n          this.loadPage(token, params)\n        })\n      }\n    })\n  }\n\n  /*\n   * storeNotes stores the list of notifications in Window.localStorage. The\n   * actual stored list is stripped of information not necessary for display.\n   */\n  storeNotes () {\n    State.storeLocal(State.notificationsLK, this.notes.map(n => {\n      return {\n        subject: n.subject,\n        details: n.details,\n        severity: n.severity,\n        stamp: n.stamp,\n        id: n.id,\n        acked: n.acked\n      }\n    }))\n  }\n\n  /*\n   * updateMenuItemsDisplay should be called when the user has signed in or out,\n   * and when the user registers a DEX.\n   */\n  updateMenuItemsDisplay () {\n    const { page, user } = this\n    if (!page) {\n      // initial page load, header elements not yet attached but menu items\n      // would already be hidden/displayed as appropriate.\n      return\n    }\n    const authed = user && user.authed\n    if (authed) page.profileBox.classList.add('authed')\n    else {\n      page.profileBox.classList.remove('authed')\n      Doc.hide(page.noteBell, page.walletsMenuEntry, page.marketsMenuEntry)\n      return\n    }\n    Doc.show(page.noteBell, page.walletsMenuEntry)\n    if (Object.keys(user.exchanges).length > 0) {\n      Doc.show(page.marketsMenuEntry)\n    } else {\n      Doc.hide(page.marketsMenuEntry)\n    }\n  }\n\n  /* attachCommon scans the provided node and handles some common bindings. */\n  attachCommon (node: HTMLElement) {\n    this.bindInternalNavigation(node)\n  }\n\n  /*\n   * updateBondConfs updates the information for a pending bond.\n   */\n  updateBondConfs (dexAddr: string, coinID: string, confs: number, assetID: number) {\n    const dex = this.exchanges[dexAddr]\n    const symbol = this.assets[assetID].symbol\n    dex.pendingBonds[coinID] = { confs, assetID, symbol }\n  }\n\n  updateTier (host: string, tier: number) {\n    this.exchanges[host].tier = tier\n  }\n\n  /*\n   * handleBondNote is the handler for the 'bondpost'-type notification, which\n   * is used to update the dex tier and registration status.\n   */\n  handleBondNote (note: BondNote) {\n    switch (note.topic) {\n      case 'RegUpdate':\n        if (note.coinID !== null) { // should never be null for RegUpdate\n          this.updateBondConfs(note.dex, note.coinID, note.confirmations, note.asset)\n        }\n        break\n      case 'BondConfirmed':\n        if (note.tier !== null) { // should never be null for BondConfirmed\n          this.updateTier(note.dex, note.tier)\n        }\n        break\n      default:\n        break\n    }\n  }\n\n  /*\n   * setNotes sets the current notification cache and populates the notification\n   * display.\n   */\n  setNotes (notes: CoreNote[]) {\n    this.log('notes', 'setNotes', notes)\n    this.notes = []\n    Doc.empty(this.page.noteList)\n    for (let i = 0; i < notes.length; i++) {\n      this.prependNoteElement(notes[i], true)\n    }\n    this.storeNotes()\n  }\n\n  updateUser (note: CoreNote) {\n    const { user, assets, walletMap } = this\n    if (note.type === 'fiatrateupdate') {\n      this.fiatRatesMap = (note as RateNote).fiatRates\n      return\n    }\n    // Some notes can be received before we get a User during login.\n    if (!user) return\n    switch (note.type) {\n      case 'order': {\n        const orderNote = note as OrderNote\n        const order = orderNote.order\n        const mkt = user.exchanges[order.host].markets[order.market]\n        const tempID = orderNote.tempID\n\n        // Ensure market's inflight orders list is updated.\n        if (note.topic === 'AsyncOrderSubmitted') {\n          const inFlight = order as InFlightOrder\n          inFlight.tempID = tempID\n          if (!mkt.inflight) mkt.inflight = [inFlight]\n          else mkt.inflight.push(inFlight)\n          break\n        } else if (note.topic === 'AsyncOrderFailure') {\n          mkt.inflight = mkt.inflight.filter(ord => ord.tempID !== tempID)\n          break\n        } else {\n          for (const i in mkt.inflight || []) {\n            if (!(mkt.inflight[i].tempID === tempID)) continue\n            mkt.inflight = mkt.inflight.filter(ord => ord.tempID !== tempID)\n            break\n          }\n        }\n\n        // Updates given order in market's orders list if it finds it.\n        // Returns a bool which indicates if order was found.\n        const updateOrder = (mkt: Market, ord: Order) => {\n          for (const i in mkt.orders || []) {\n            if (mkt.orders[i].id === ord.id) {\n              mkt.orders[i] = ord\n              return true\n            }\n          }\n          return false\n        }\n        // If the notification order already exists we update it.\n        // In case market's orders list is empty or the notification order isn't\n        // part of it we add it manually as this means the order was\n        // just placed.\n        if (!mkt.orders) mkt.orders = [order]\n        else if (!updateOrder(mkt, order)) mkt.orders.push(order)\n        break\n      }\n      case 'balance': {\n        const n: BalanceNote = note as BalanceNote\n        const asset = user.assets[n.assetID]\n        // Balance updates can come before the user is fetched after login.\n        if (!asset) break\n        const w = asset.wallet\n        if (w) w.balance = n.balance\n        break\n      }\n      case 'bondpost':\n        this.handleBondNote(note as BondNote)\n        break\n      case 'walletstate':\n      case 'walletconfig': {\n        // assets can be null if failed to connect to dex server.\n        if (!assets) return\n        const wallet = (note as WalletConfigNote).wallet\n        const asset = assets[wallet.assetID]\n        asset.wallet = wallet\n        walletMap[wallet.assetID] = wallet\n        break\n      }\n      case 'match': {\n        const n = note as MatchNote\n        const ord = this.order(n.orderID)\n        if (ord) updateMatch(ord, n.match)\n        break\n      }\n      case 'conn': {\n        const n = note as ConnEventNote\n        const xc = user.exchanges[n.host]\n        if (xc) xc.connectionStatus = n.connectionStatus\n        break\n      }\n      case 'spots': {\n        const n = note as SpotPriceNote\n        const xc = user.exchanges[n.host]\n        // Spots can come before the user is fetched after login and before/while the\n        // markets page reload when it receives a dex conn note.\n        if (!xc || !xc.markets) break\n        for (const [mktName, spot] of Object.entries(n.spots)) xc.markets[mktName].spot = spot\n        break\n      }\n      case 'fiatrateupdate': {\n        this.fiatRatesMap = (note as RateNote).fiatRates\n        break\n      }\n      case 'bot': {\n        const n = note as BotNote\n        const [r, bots] = [n.report, this.user.bots]\n        const idx = bots.findIndex((report: BotReport) => report.programID === r.programID)\n        switch (n.topic) {\n          case 'BotRetired':\n            if (idx >= 0) bots.splice(idx, 1)\n            break\n          default:\n            if (idx >= 0) bots[idx] = n.report\n            else bots.push(n.report)\n        }\n      }\n    }\n  }\n\n  /*\n   * notify is the top-level handler for notifications received from the client.\n   * Notifications are propagated to the loadedPage.\n   */\n  notify (note: CoreNote) {\n    // Handle type-specific updates.\n    this.log('notes', 'notify', note)\n    this.updateUser(note)\n    // Inform the page.\n    for (const feeder of this.noteReceivers) {\n      const f = feeder[note.type]\n      if (!f) continue\n      try {\n        f(note)\n      } catch (error) {\n        console.error('note feeder error:', error.message ? error.message : error)\n        console.log(note)\n        console.log(error.stack)\n      }\n    }\n    // Discard data notifications.\n    if (note.severity < ntfn.POKE) return\n    // Poke notifications have their own display.\n    const { popupTmpl, popupNotes, showPopups } = this\n    if (showPopups) {\n      const span = popupTmpl.cloneNode(true) as HTMLElement\n      Doc.tmplElement(span, 'text').textContent = `${note.subject}: ${note.details}`\n      const indicator = Doc.tmplElement(span, 'indicator')\n      if (note.severity === ntfn.POKE) {\n        Doc.hide(indicator)\n      } else setSeverityClass(indicator, note.severity)\n      popupNotes.appendChild(span)\n      // These take up screen space. Only show max 5 at a time.\n      while (popupNotes.children.length > 5) popupNotes.removeChild(popupNotes.firstChild as Node)\n      setTimeout(async () => {\n        await Doc.animate(500, (progress: number) => {\n          span.style.opacity = String(1 - progress)\n        })\n        span.remove()\n      }, 6000)\n    }\n    // Success and higher severity go to the bell dropdown.\n    if (note.severity === ntfn.POKE) this.prependPokeElement(note)\n    else this.prependNoteElement(note)\n  }\n\n  /*\n   * registerNoteFeeder registers a feeder for core notifications. The feeder\n   * will be de-registered when a new page is loaded.\n   */\n  registerNoteFeeder (receivers: Record<string, (n: CoreNote) => void>) {\n    this.noteReceivers.push(receivers)\n  }\n\n  /*\n   * log prints to the console if a logger has been enabled. Loggers are created\n   * implicitly by passing a loggerID to log. i.e. you don't create a logger,\n   * you just log to it. Loggers are enabled by invoking a global function,\n   * enableLogger(loggerID, onOffBoolean), from the browser's js console. Your\n   * choices are stored across sessions. Some common and useful loggers are\n   * listed below, but this list is not meant to be comprehensive.\n   *\n   * LoggerID   Description\n   * --------   -----------\n   * notes      Notifications of all levels.\n   * book       Order book feed.\n   * ws.........Websocket connection status changes.\n   */\n  log (loggerID: string, ...msg: any) {\n    if (this.loggers[loggerID]) console.log(`${nowString()}[${loggerID}]:`, ...msg)\n    if (this.recorders[loggerID]) {\n      this.recorders[loggerID].push({\n        time: nowString(),\n        msg: msg\n      })\n    }\n  }\n\n  prependPokeElement (cn: CoreNote) {\n    const [el, note] = this.makePoke(cn)\n    this.pokes.push(note)\n    while (this.pokes.length > noteCacheSize) this.pokes.shift()\n    this.prependListElement(this.page.pokeList, note, el)\n  }\n\n  prependNoteElement (cn: CoreNote, skipSave?: boolean) {\n    const [el, note] = this.makeNote(cn)\n    this.notes.push(note)\n    while (this.notes.length > noteCacheSize) this.notes.shift()\n    const noteList = this.page.noteList\n    this.prependListElement(noteList, note, el)\n    if (!skipSave) this.storeNotes()\n    // Set the indicator color.\n    if (this.notes.length === 0 || (Doc.isDisplayed(this.page.noteBox) && Doc.isDisplayed(noteList))) return\n    let unacked = 0\n    const severity = this.notes.reduce((s, note) => {\n      if (!note.acked) unacked++\n      if (!note.acked && note.severity > s) return note.severity\n      return s\n    }, ntfn.IGNORE)\n    const ni = this.page.noteIndicator\n    setSeverityClass(ni, severity)\n    if (unacked) {\n      ni.textContent = String((unacked > noteCacheSize - 1) ? `${noteCacheSize - 1}+` : unacked)\n      Doc.show(ni)\n    } else Doc.hide(ni)\n  }\n\n  prependListElement (noteList: HTMLElement, note: CoreNotePlus, el: NoteElement) {\n    el.note = note\n    noteList.prepend(el)\n    while (noteList.children.length > noteCacheSize) noteList.removeChild(noteList.lastChild as Node)\n    this.setNoteTimes(noteList)\n  }\n\n  /*\n   * makeNote constructs a single notification element for the drop-down\n   * notification list.\n   */\n  makeNote (note: CoreNote): [NoteElement, CoreNotePlus] {\n    const el = this.page.noteTmpl.cloneNode(true) as NoteElement\n    if (note.severity > ntfn.POKE) {\n      const cls = note.severity === ntfn.SUCCESS ? 'good' : note.severity === ntfn.WARNING ? 'warn' : 'bad'\n      Doc.safeSelector(el, 'div.note-indicator').classList.add(cls)\n    }\n\n    Doc.safeSelector(el, 'div.note-subject').textContent = note.subject\n    Doc.safeSelector(el, 'div.note-details').textContent = note.details\n    const np: CoreNotePlus = { el, ...note }\n    return [el, np]\n  }\n\n  makePoke (note: CoreNote): [NoteElement, CoreNotePlus] {\n    const el = this.page.pokeTmpl.cloneNode(true) as NoteElement\n    const d = new Date(note.stamp)\n    Doc.tmplElement(el, 'dateTime').textContent = `${d.toLocaleDateString()}, ${d.toLocaleTimeString()}`\n    Doc.tmplElement(el, 'details').textContent = `${note.subject}: ${note.details}`\n    const np: CoreNotePlus = { el, ...note }\n    return [el, np]\n  }\n\n  /*\n   * loading appends the loader to the specified element and displays the\n   * loading icon. The loader will block all interaction with the specified\n   * element until Application.loaded is called.\n   */\n  loading (el: HTMLElement): () => void {\n    const loader = this.page.loader.cloneNode(true) as HTMLElement\n    el.appendChild(loader)\n    return () => { loader.remove() }\n  }\n\n  /* orders retrieves a list of orders for the specified dex and market\n   * including inflight orders.\n   */\n  orders (host: string, mktID: string): Order[] {\n    let orders: Order[] = []\n    const mkt = this.user.exchanges[host].markets[mktID]\n    if (mkt.orders) orders = orders.concat(mkt.orders)\n    if (mkt.inflight) orders = orders.concat(mkt.inflight)\n    return orders\n  }\n\n  /*\n   * haveActiveOrders returns whether or not there are active orders involving a\n   * certain asset.\n   */\n  haveActiveOrders (assetID: number): boolean {\n    for (const xc of Object.values(this.user.exchanges)) {\n      if (!xc.markets) continue\n      for (const market of Object.values(xc.markets)) {\n        if (!market.orders) continue\n        for (const ord of market.orders) {\n          if ((ord.baseID === assetID || ord.quoteID === assetID) &&\n            (ord.status < StatusExecuted || hasActiveMatches(ord))) return true\n        }\n      }\n    }\n    return false\n  }\n\n  /* order attempts to locate an order by order ID. */\n  order (oid: string): Order | null {\n    for (const xc of Object.values(this.user.exchanges)) {\n      if (!xc || !xc.markets) continue\n      for (const market of Object.values(xc.markets)) {\n        if (!market.orders) continue\n        for (const ord of market.orders) {\n          if (ord.id === oid) return ord\n        }\n      }\n    }\n    return null\n  }\n\n  /*\n   * canAccelerateOrder returns true if the \"from\" wallet of the order\n   * supports acceleration, and if the order has unconfirmed swap\n   * transactions.\n   */\n  canAccelerateOrder (order: Order): boolean {\n    const walletTraitAccelerator = 1 << 4\n    let fromAssetID\n    if (order.sell) fromAssetID = order.baseID\n    else fromAssetID = order.quoteID\n    const wallet = this.walletMap[fromAssetID]\n    if (!wallet || !(wallet.traits & walletTraitAccelerator)) return false\n    if (order.matches) {\n      for (let i = 0; i < order.matches.length; i++) {\n        const match = order.matches[i]\n        if (match.swap && match.swap.confs && match.swap.confs.count === 0) {\n          return true\n        }\n      }\n    }\n    return false\n  }\n\n  /*\n   * unitInfo fetches unit info [dex.UnitInfo] for the asset. If xc\n   * [core.Exchange] is provided, and this is not a SupportedAsset, the UnitInfo\n   * sent from the exchange's assets map [dex.Asset] will be used.\n   */\n  unitInfo (assetID: number, xc?: Exchange): UnitInfo {\n    const supportedAsset = this.assets[assetID]\n    if (supportedAsset) return supportedAsset.unitInfo\n    if (!xc || !xc.assets) {\n      throw Error(intl.prep(intl.ID_UNSUPPORTED_ASSET_INFO_ERR_MSG, { assetID: `${assetID}` }))\n    }\n    return xc.assets[assetID].unitInfo\n  }\n\n  /* conventionalRate converts the encoded atomic rate to a conventional rate */\n  conventionalRate (baseID: number, quoteID: number, encRate: number, xc?: Exchange): number {\n    const [b, q] = [this.unitInfo(baseID, xc), this.unitInfo(quoteID, xc)]\n\n    const r = b.conventional.conversionFactor / q.conventional.conversionFactor\n    return encRate * r / RateEncodingFactor\n  }\n\n  walletDefinition (assetID: number, walletType: string): WalletDefinition {\n    const asset = this.assets[assetID]\n    if (asset.token) return asset.token.definition\n    if (!asset.info) throw Error('where\\'s the wallet info?')\n    if (walletType === '') return asset.info.availablewallets[asset.info.emptyidx]\n    return asset.info.availablewallets.filter(def => def.type === walletType)[0]\n  }\n\n  currentWalletDefinition (assetID: number): WalletDefinition {\n    const asset = this.assets[assetID]\n    if (asset.token) {\n      return asset.token.definition\n    }\n    return this.walletDefinition(assetID, this.assets[assetID].wallet.type)\n  }\n\n  /*\n   * fetchBalance requests a balance update from the API. The API response does\n   * include the balance, but we're ignoring it, since a balance update\n   * notification is received via the Application anyways.\n   */\n  async fetchBalance (assetID: number): Promise<WalletBalance> {\n    const res: BalanceResponse = await postJSON('/api/balance', { assetID: assetID })\n    if (!this.checkResponse(res)) {\n      throw new Error(`failed to fetch balance for asset ID ${assetID}`)\n    }\n    return res.balance\n  }\n\n  /*\n   * checkResponse checks the response object as returned from the functions in\n   * the http module. If the response indicates that the request failed, it\n   * returns false, otherwise, true.\n   */\n  checkResponse (resp: APIResponse): boolean {\n    return (resp.requestSuccessful && resp.ok)\n  }\n\n  /**\n   * signOut call to /api/logout, if response with no errors occurred remove auth\n   * and other privacy-critical cookies/locals and reload the page, otherwise\n   * show a notification.\n   */\n  async signOut () {\n    const res = await postJSON('/api/logout')\n    if (!this.checkResponse(res)) {\n      if (res.code === Errors.activeOrdersErr) {\n        this.page.logoutErr.textContent = intl.prep(intl.ID_ACTIVE_ORDERS_LOGOUT_ERR_MSG)\n      } else {\n        this.page.logoutErr.textContent = res.msg\n      }\n      Doc.show(this.page.logoutErr)\n      return\n    }\n    State.removeCookie(State.authCK)\n    State.removeCookie(State.pwKeyCK)\n    State.removeLocal(State.notificationsLK)\n    window.location.href = '/login'\n  }\n}\n\n/* getSocketURI returns the websocket URI for the client. */\nfunction getSocketURI (): string {\n  const protocol = (window.location.protocol === 'https:') ? 'wss' : 'ws'\n  return `${protocol}://${window.location.host}/ws`\n}\n\n/*\n * severityClassMap maps a notification severity level to a CSS class that\n * assigns a background color.\n */\nconst severityClassMap: Record<number, string> = {\n  [ntfn.SUCCESS]: 'good',\n  [ntfn.ERROR]: 'bad',\n  [ntfn.WARNING]: 'warn'\n}\n\n/* handlerFromPath parses the handler name from the path. */\nfunction handlerFromPath (path: string): string {\n  return path.replace(/^\\//, '').split('/')[0].split('?')[0].split('#')[0]\n}\n\n/* nowString creates a string formatted like HH:MM:SS.xxx */\nfunction nowString (): string {\n  const stamp = new Date()\n  const h = stamp.getHours().toString().padStart(2, '0')\n  const m = stamp.getMinutes().toString().padStart(2, '0')\n  const s = stamp.getSeconds().toString().padStart(2, '0')\n  const ms = stamp.getMilliseconds().toString().padStart(3, '0')\n  return `${h}:${m}:${s}.${ms}`\n}\n\nfunction setSeverityClass (el: HTMLElement, severity: number) {\n  el.classList.remove('bad', 'warn', 'good')\n  el.classList.add(severityClassMap[severity])\n}\n\n/* updateMatch updates the match in or adds the match to the order. */\nfunction updateMatch (order: Order, match: Match) {\n  for (const i in order.matches) {\n    const m = order.matches[i]\n    if (m.matchID === match.matchID) {\n      order.matches[i] = match\n      return\n    }\n  }\n  order.matches = order.matches || []\n  order.matches.push(match)\n}\n","import { CoreNote } from './registry'\n\nexport const IGNORE = 0\nexport const DATA = 1\nexport const POKE = 2\nexport const SUCCESS = 3\nexport const WARNING = 4\nexport const ERROR = 5\n\n/*\n * make constructs a new notification. The notification structure is a mirror of\n * the structure of notifications sent from the web server.\n * NOTE: I'm hoping to make this function obsolete, since errors generated in\n * javascript should usually be displayed/cached somewhere better. For example,\n * if the error is generated during submission of a form, the error should be\n * displayed on or near the form itself, not in the notifications.\n */\nexport function make (subject: string, details: string, severity: number): CoreNote {\n  return {\n    subject: subject,\n    details: details,\n    severity: severity,\n    stamp: new Date().getTime(),\n    acked: false,\n    type: 'internal',\n    topic: 'internal',\n    id: ''\n  }\n}\n","import Application from './js/app'\nimport { registerApplication } from './js/registry'\nimport './css/application.scss'\n\nconst app = new Application()\nregisterApplication(app)\napp.start()\n"],"names":["_typeof","_regeneratorRuntime","module","exports","__esModule","Op","Object","prototype","hasOwn","hasOwnProperty","defineProperty","obj","key","desc","value","$Symbol","Symbol","iteratorSymbol","iterator","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","enumerable","configurable","writable","err","wrap","innerFn","outerFn","self","tryLocsList","protoGenerator","Generator","generator","create","context","Context","makeInvokeMethod","tryCatch","fn","arg","type","call","ContinueSentinel","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","this","getProto","getPrototypeOf","NativeIteratorPrototype","values","Gp","defineIteratorMethods","forEach","method","_invoke","AsyncIterator","PromiseImpl","invoke","resolve","reject","record","result","__await","then","unwrapped","error","previousPromise","callInvokeWithMethodAndArg","state","Error","undefined","done","delegate","delegateResult","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","methodName","TypeError","info","resultName","next","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","iterable","iteratorMethod","isNaN","length","i","doneResult","displayName","isGeneratorFunction","genFun","ctor","constructor","name","mark","setPrototypeOf","__proto__","awrap","async","Promise","iter","keys","val","object","reverse","pop","skipTempReset","prev","charAt","slice","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","runtime","regeneratorRuntime","accidentalStrictMode","globalThis","Function","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","d","a","definition","o","get","prop","_arrayLikeToArray","arr","len","arr2","Array","_unsupportedIterableToArray","minLen","toString","from","test","_slicedToArray","isArray","_i","_s","_e","_x","_r","_arr","_n","_d","asyncGeneratorStep","gen","_next","_throw","_asyncToGenerator","args","arguments","apply","_classCallCheck","instance","Constructor","_toPropertyKey","input","hint","prim","toPrimitive","res","String","_defineProperties","target","props","descriptor","_createClass","protoProps","staticProps","_defineProperty","locale","ID_NO_PASS_ERROR_MSG","ID_NO_APP_PASS_ERROR_MSG","ID_SET_BUTTON_BUY","ID_SET_BUTTON_SELL","ID_OFF","ID_READY","ID_NO_WALLET","ID_DISABLED_MSG","ID_WALLET_SYNC_PROGRESS","ID_HIDE_ADDITIONAL_SETTINGS","ID_SHOW_ADDITIONAL_SETTINGS","ID_BUY","ID_SELL","ID_NOT_SUPPORTED","ID_VERSION_NOT_SUPPORTED","ID_CONNECTION_FAILED","ID_ORDER_PREVIEW","ID_CALCULATING","ID_ESTIMATE_UNAVAILABLE","ID_NO_ZERO_RATE","ID_NO_ZERO_QUANTITY","ID_TRADE","ID_NO_ASSET_WALLET","ID_EXECUTED","ID_BOOKED","ID_CANCELING","ID_PASSWORD_NOT_MATCH","ID_ACCT_UNDEFINED","ID_KEEP_WALLET_PASS","ID_NEW_WALLET_PASS","ID_LOT","ID_LOTS","ID_UNKNOWN","ID_EPOCH","ID_ORDER_SUBMITTING","ID_SETTLING","ID_NO_MATCH","ID_CANCELED","ID_REVOKED","ID_WAITING_FOR_CONFS","ID_NONE_SELECTED","ID_REGISTRATION_FEE_SUCCESS","ID_API_ERROR","ID_ADD","ID_CREATE","ID_SETUP_WALLET","ID_WALLET_READY","ID_CHANGE_WALLET_TYPE","ID_KEEP_WALLET_TYPE","WALLET_READY","WALLET_PENDING","SETUP_NEEDED","ID_SEND_SUCCESS","ID_RECONFIG_SUCCESS","ID_RESCAN_STARTED","ID_NEW_WALLET_SUCCESS","ID_WALLET_UNLOCKED","ID_SELLING","ID_BUYING","ID_WALLET_DISABLED_MSG","ID_WALLET_ENABLED_MSG","ID_ACTIVE_ORDERS_ERR_MSG","ID_AVAILABLE","ID_LOCKED","ID_IMMATURE","ID_FEE_BALANCE","ID_CANDLES_LOADING","ID_DEPTH_LOADING","ID_INVALID_ADDRESS_MSG","ID_TXFEE_ERR_MSG","ID_ACTIVE_ORDERS_LOGOUT_ERR_MSG","ID_INVALID_DATE_ERR_MSG","ID_NO_ARCHIVED_RECORDS","ID_DELETE_ARCHIVED_RECORDS_RESULT","ID_ARCHIVED_RECORDS_PATH","ID_DEFAULT","ID_ADDED","ID_DISCOVERED","ID_UNSUPPORTED_ASSET_INFO_ERR_MSG","ID_LIMIT_ORDER","ID_LIMIT_ORDER_IMMEDIATE_TIF","ID_MARKET_ORDER","ID_MATCH_STATUS_NEWLY_MATCHED","ID_MATCH_STATUS_MAKER_SWAP_CAST","ID_MATCH_STATUS_TAKER_SWAP_CAST","ID_MATCH_STATUS_MAKER_REDEEMED","ID_MATCH_STATUS_REDEMPTION_SENT","ID_MATCH_STATUS_REDEMPTION_CONFIRMED","ID_MATCH_STATUS_REVOKED","ID_MATCH_STATUS_REFUNDED","ID_MATCH_STATUS_REFUND_PENDING","ID_MATCH_STATUS_REDEEM_PENDING","ID_MATCH_STATUS_COMPLETE","ID_TAKER_FOUND_MAKER_REDEMPTION","ID_OPEN_WALLET_ERR_MSG","ID_ORDER_ACCELERATION_FEE_ERR_MSG","ID_ORDER_ACCELERATION_ERR_MSG","ID_CONNECTED","ID_DISCONNECTED","ID_INVALID_CERTIFICATE","ID_CONFIRMATIONS","ID_TAKER","ID_MAKER","ID_EMPTY_DEX_ADDRESS_MSG","ID_SELECT_WALLET_FOR_FEE_PAYMENT","ID_UNAVAILABLE","ID_WALLET_SYNC_FINISHING_UP","ID_CONNECT_WALLET_ERR_MSG","enUS","ptBR","zhCN","plPL","deDE","ar","localesMap","defaultLocale","prep","k","expression","replace","_","stringTemplateParser","window","localeDiscrepancies","ref","entries","lang","dict","s","console","log","parser","DOMParser","BipIDs","BipSymbols","intFormatter","Intl","NumberFormat","navigator","languages","threeSigFigs","minimumSignificantDigits","maximumSignificantDigits","fiveSigFigs","decimalFormatters","fullPrecisionFormatters","fullPrecisionFormatter","prec","formatter","formatters","min","max","fmt","minimumFractionDigits","maximumFractionDigits","convertToConventional","v","unitInfo","f","conventional","conversionFactor","Math","round","log10","Doc","el","id","querySelector","ev","addEventListener","removeEventListener","html","parseFromString","e","contains","rect","getBoundingClientRect","pageX","left","right","pageY","top","bottom","box","docEl","document","documentElement","scrollTop","scrollLeft","w","offsetWidth","h","offsetHeight","bodyTop","bodyLeft","width","height","centerX","centerY","parent","kid","parentMetrics","layoutMetrics","kidMetrics","els","firstChild","removeChild","ancestor","empty","kids","appendChild","classList","add","remove","vis","show","hide","duration","easingAlgo","Animation","wait","querySelectorAll","children","warn","createElement","applySelector","vAtomic","Number","isInteger","format","decimalFormatter","rate","intl","symbol","indexOf","substring","assetID","logoPath","parts","split","assetSymbol","textContent","toUpperCase","span","tmpls","tmpl","removeAttribute","dataset","t","formatDuration","Date","getTime","dur","y","mo","m","seconds","floor","count","timeMod","aYear","aMonth","aDay","anHour","aMinute","inputFields","inputField","preventDefault","msg","thread","run","easer","Easing","linear","start","end","Forever","MAX_SAFE_INTEGER","range","frameDuration","now","endAnimation","runCompletionFunction","sleep","easeIn","easeOut","easeInHard","easeOutHard","easeOutElastic","c4","PI","pow","sin","WalletIcons","stateElement","icons","sleeping","locked","unlocked","nowallet","syncing","nopeers","disabled","status","tooltip","wallet","syncIcon","running","peerCount","synced","syncProgress","toFixed","setSyncing","open","ms","setTimeout","State","cname","cvalue","setTime","expires","toUTCString","cookie","trim","cKey","filter","item","includes","darkModeCK","getCookie","pwKeyCK","localStorage","setItem","JSON","stringify","getItem","parse","removeItem","_assertThisInitialized","ReferenceError","_setPrototypeOf","p","bind","_inherits","subClass","superClass","_possibleConstructorReturn","_getPrototypeOf","setCookie","fetchLocal","popupsLK","storeLocal","leftMarketDockLK","Errors","ConnectionStatus","PeerSource","application","orderOptTmpl","booleanOptTmpl","rangeOptTmpl","BasePage","requestJSON","addr","reqBody","fetch","headers","Headers","body","response","json","requestSuccessful","text","postJSON","data","getJSON","_toConsumableArray","app","setOptionTemplates","page","Option","opt","report","node","cloneNode","parseTemplate","optName","displayname","description","chainIcon","src","on","enable","toggle","stopPropagation","disable","BooleanOption","changed","cfg","control","controls","reason","store","XYRangeOption","xyRange","setVal","x","handler","XYRangeHandler","setValue","initVal","updated","selected","roundY","Boolean","slider","rangeX","rangeY","normalizeX","setConfig","newCfg","rangeLblStart","label","rangeLblEnd","xUnit","yUnit","r","scrollingX","accept","clickOutX","xInput","xx","parseFloat","clamp","unbind","focus","clickOutY","yInput","yy","button","startX","clientWidth","startLeft","trackMouse","ee","mouseUp","skipUpdate","style","RateEncodingFactor","sellString","ord","sell","toLowerCase","toLocaleLowerCase","typeString","tif","isMarketBuy","hasActiveMatches","order","matches","active","statusString","isLive","cancelling","filled","qty","reduce","match","isCancel","settled","side","baseToQuote","base","revokedMatchStatus","matchStatus","PIPI","plusChar","fromCharCode","minusChar","darkTheme","axisLabel","gridBorder","gridLines","gapLine","zoom","zoomHover","sellLine","buyLine","sellFill","buyFill","crosshairs","legendFill","legendText","lightTheme","Chart","reporters","theme","isDark","canvas","visible","ctx","getContext","textAlign","textBaseline","mousePos","clientX","clientY","draw","ResizeObserver","resize","observe","wheelLimiter","wheel","click","setVis","visibilityState","renderScheduled","unattachers","clearRect","render","deltaY","clientHeight","plotExtents","Extents","xLblExtents","yLblExtents","plotRegion","Region","xRegion","yRegion","requestAnimationFrame","bigger","u","fontSize","font","fillStyle","labels","minX","maxX","unitLines","extents","plot","tools","applyLabelStyle","lastX","unitCenter","lbls","lbl","fillText","txt","lineWidth","strokeStyle","line","region","minY","maxY","unit","lastY","step","valFmt","yLabels","makeLabels","dataExtents","yAxisWidth","widest","plotYLabels","beginPath","dataCoords","moveTo","lineTo","stroke","DepthChart","resized","clicked","zoomed","zoomLevel","lines","markers","buys","sells","setZoomBttns","zoomInBttn","zoomOutBttn","book","wheeled","translator","unx","lotSize","rateStep","baseUnitInfo","quoteUnitInfo","qFactor","bFactor","baseUnit","quoteUnit","gap","midGap","gapWidth","minZoom","clear","halfWindow","high","low","buyMarkers","sellMarkers","sort","b","buyDepth","buyEpoch","sellDepth","sellEpoch","volumeReport","buyBase","buyQuote","sellBase","sellQuote","sum","epochSum","epoch","floatCompare","shift","buySum","last","epochBuySum","sellSum","epochSellSum","growthFactor","doYLabels","xLabels","plotXLabels","mouseData","drawFrame","formatLabelValue","topCenterX","midX","topCenterY","zoomPct","xRange","zoomText","measureText","bttnLeft","bttnTop","bttnSize","setExtents","hover","midY","drawLine","color","save","setLineDash","restore","tolerance","hoverMarkers","marker","hovered","withinTolerance","size","tip","sqrt","closePath","fill","dataX","evalSide","trigger","ptX","dotColor","bestDepth","pt","depth","drawDepth","radius","arc","dot","volume","mouse","firstPt","globalAlpha","bestGapBuy","bestGapSell","CandleChart","numToShow","ext","candleExtents","yRange","candleRegion","volumeExtents","volumeRegion","resizeTimer","clearTimeout","idx","zoomLevels","candles","candleWidth","allCandles","c","truncate","endStamp","paddedStart","paddedWidth","first","highRate","lowRate","matchVolume","highVol","market","ratestep","rFactor","rateConversionFactor","quotesymbol","screenW","spacingGuess","diff","tick","zoneOffset","getTimezoneOffset","dayStamp","lastDay","lastYear","pts","months","getMonth","getDate","getHours","getMinutes","padStart","year","getFullYear","makeCandleTimeLabels","mouseCandle","selectedStartStamp","fillRect","yExt","rangeTxt","toLocaleString","rangeWidth","xExt","rectArgs","rangeHeight","strokeRect","volDataExtents","startRate","endRate","cx","maxCandles","Wave","opts","zIndex","random","colorShift","amplitudes","ks","speeds","phases","single","angularX","angularTime","cos","ani","drawValues","cw","ch","l","message","ypad","halfH","msgRegion","hsl","bg","backgroundColor","getComputedStyle","getPropertyValue","lineCap","grad","createLinearGradient","addColorStop","prog","xMin","xMax","yMin","yMax","screenMinX","screenMaxY","screenH","xFactor","yFactor","uny","drawFunc","skipMask","clip","tx","ty","transform","tickGuess","absMax","abs","sigFigs","toPrecision","unitW","x0","y0","x1","y1","skipStroke","labelSpecs","NewWalletForm","form","success","pwCache","backFunc","pwHiders","refresh","goBack","walletTabTmpl","subform","WalletConfigForm","walletSettings","walletCfgGuide","tmplElement","submitAdd","submit","oneBttn","registerNoteFeeder","walletstate","note","reportWalletState","createwallet","reportCreationUpdate","parentSyncer","createUpdater","passwordIsCached","pw","walletType","parentForm","createForm","pass","newWalletPass","config","map","appPass","mainForm","newWalletErr","current","asset","parentAsset","selectedDef","createWallet","checkResponse","setError","runParentSync","parentSyncPct","parentName","parentLogo","childName","childLogo","parentSyncing","syncParent","assets","topic","subject","details","parseAsset","tabs","walletTypeTabs","winfo","assetName","header","assetLogo","pinfo","walletDefs","availablewallets","wDef","tab","update","bindTooltips","walletCreationPending","token","user","parentID","walletDef","appPwCached","auth","oneBttnBox","newWalletPassBox","guideLink","guidelink","configOpts","configopts","isBirthdayConfig","seedGenTime","toUnixDate","containsRequired","required","displayCreateBtn","seeded","noauth","parentAndTokenOpts","regAsset","tokenOpts","tokenOptsCopy","setGuideLink","dynamicOpts","defaultSettings","walletSettingsHeader","fileSelector","loadDefaults","href","errMsg","configpath","configID","loaded","loading","setLoadedConfig","dynamicInputCounter","sectionize","idDescendants","configElements","allSettings","textInputTmpl","dateInputTmpl","checkboxTmpl","repeatableTmpl","fileInput","showOther","showIcon","hideIcon","showHideMsg","otherSettings","loadedSettingsMsg","loadedSettings","defaultSettingsMsg","fileInputChanged","setOtherSettingsViz","files","configtext","append","reorder","defaultOpts","loadedOpts","insertAfter","skipRepeatN","isboolean","isdate","repeatable","addOpt","repeatN","extensionModeConfig","restrictedWallets","baseChainSymbol","hiddenFields","configKey","elID","safeSelector","htmlFor","prepend","logo","Image","logoPathFromID","after","noecho","autocomplete","checked","getMinMaxVal","minMax","dateToString","date","disablewhenactive","assetHasActiveOrders","activeOrders","defaultedOpts","finds","handledRepeatables","removes","vals","firstVal","parentElement","newEl","parseInt","splice","minDate","MIN_SAFE_INTEGER","maxDate","inputs","ConfirmRegistrationForm","certFile","bondStrengthField","bondAssetID","ui","bondAsset","xc","bondAssets","bondAmt","formatCoinValue","totalBondAmount","amount","submitForm","passBox","host","bondUnit","singleBondAmount","animate","opacity","offset","regErr","innerText","cert","dexAddr","postBondForm","bond","FeeAssetSelectionForm","cleanTemplates","marketTmpl","assetTmpl","walletCreated","assetTmpls","allMarkets","cFactor","marketNode","mkt","excludeIcon","baseAsset","baseid","quoteAsset","quoteid","excludeBase","otherSymbol","otherLogo","parentNode","insertBefore","nextSibling","baseSymbol","quoteSymbol","baseName","replaceWith","symbolize","quoteName","lotsize","lotSizeSymbol","spot","quoteLotSize","quoteLot","OrderUtil","assetNode","fee","feeAmt","feeSymbol","confs","setReadyMessage","ready","markets","fader","setExchange","how","regAssetElements","allmkts","marginTop","paddingTop","WalletWaitForm","progressCache","progressed","funded","balance","reportBalance","bondFeeBuffer","parentAssetSynced","depoAddr","address","syncUncheck","syncCheck","balUncheck","balCheck","syncRemainBox","balanceBox","totalForBond","sendEnough","txFeeBox","sendEnoughForToken","txFeeBalanceBox","sendEnoughWithEst","txFee","parentFees","tokenFees","txFeeUnit","parentUnit","parentBalUnit","parentBal","available","syncSpinner","progress","reportProgress","avail","parentAvail","syncRemaining","syncFinishingUp","cache","stamp","progDelta","progRate","toGoTime","syncRemain","UnlockWalletForm","submitUnlock","currentAsset","uwAssetLogo","uwAssetName","uwAppPass","unlockErr","uwAppPassBox","submitUnlockDiv","AccelerateOrderForm","accelerateSubmit","submitEarlyConfirm","sendAccelerateRequest","earlyAcceleration","recentAccelerationTime","timePast","recentSwapTime","wasAcceleration","recentAccelerationMsg","recentSwapMsg","configureAccelerationDiv","accelerateErr","earlyAccelerationDiv","req","acceleratePass","orderID","newRate","acceleratedRate","accelerateMainDiv","accelerateTxID","txID","preAccelerateErr","accelerateMsgDiv","accelerateSuccess","displayEarlyAccelerationMsg","feeEstimateDiv","preAccelerate","currencyUnit","suggestedRange","accelerateAvgFeeRate","swapRate","accelerateCurrentFeeRate","suggestedRate","updateRate","newY","rangeHandler","updateAccelerationEstimate","sliderContainer","feeRateEstimate","baseID","quoteID","feeEstimate","DEXAddressForm","dexToUpdate","selectedCert","skipRegistration","showOrHidePWBox","onCertFileChange","removeCert","clearCertFile","addCert","showCustom","customBox","knownExchanges","knownXCs","div","checkDEX","appPW","addDexHdr","skipRegistrationBox","updateDexHdr","pickServerMsg","addCustomMsg","passwordRequired","appPWBox","isDisplayed","endpoint","newHost","oldHost","needCert","paid","pendingBonds","fetchUser","loadPage","DiscoverAccountForm","dexHost","LoginForm","headerTxt","login","handleLoginNote","loginMsg","idel","rememberPass","notes","setNotes","DepositAddress","newDepAddrBttn","newDepositAddress","copyAddressBtn","copyAddress","depositErr","depositLogo","walletMap","depositName","depositAddress","qrcode","traits","clipboard","writeText","copyAlert","animationLength","slideSwap","form1","form2","submitBttn","wrapper","dateApplyOffset","toISOString","RegistrationPage","dexAddrForm","discoverAcctForm","bindForm","appPWForm","appPWSubmit","setAppPass","showSeedRestore","seedRestore","loginForm","newWalletForm","newWalletCreated","animateRegAsset","requestFeepayment","regAssetForm","confirmRegisterForm","setAsset","currentDEX","getBondsFeeBuffer","bondsFeeBuffer","animateConfirmForm","walletWaitForm","setWallet","walletWait","confirmRegForm","registerDEXSuccess","currentForm","forms","authed","oldForm","feeBuffer","appPWErrMsg","pwAgain","appPWAgain","seed","seedInput","updateMenuItemsDisplay","LoginPage","loggedIn","WalletsPage","restoreInfoCard","connectedIconTmpl","disconnectedIconTmpl","removeIconTmpl","closePopups","cancelForce","selectedAssetID","iconSelectTmpl","balanceDetailRow","recentOrderTmpl","showNewWallet","connectBttn","doConnect","send","showSendForm","receive","showDeposit","unlockBttn","openWallet","lockBttn","lock","reconfigureBttn","showReconfig","rescanWallet","fmtParams","assetUpdated","sortAssetButtons","reconfigForm","reconfigInputs","unlockForm","unlockWalletForm","openWalletSuccess","sendForm","submitSendForm","stepSend","vSendForm","vSend","vCancelSend","cancelSend","submitReconfig","reconfig","mouseInElement","keyup","downloadLogs","exportWallet","displayExportWalletAuth","recoverWallet","showRecoverWallet","exportWalletAuth","exportWalletAuthSubmit","recoverWalletConfirm","recoverWalletSubmit","confirmForce","confirmForceSubmit","disableWallet","showToggleWalletStatus","enableWallet","toggleWalletStatusConfirm","toggleWalletStatusSubmit","toggleWalletStatus","managePeers","showManagePeersForm","addPeerSubmit","submitAddPeer","depositAddrForm","deposit","walletBal","populateMaxSend","sendAmt","amt","showFiatValue","sendValue","maxSend","sendAddr","validAddr","validateSendAddress","showChangePW","changeWalletPW","setPWSettingViz","changeWalletTypeSelect","changeWalletType","showChangeType","isHidden","changeTypeHideIcon","changeTypeShowIcon","changeTypeMsg","fiatrateupdate","handleRatesNote","handleBalanceNote","handleWalletStateNote","walletconfig","handleCreateWalletNote","selectedAsset","assetIDStr","selectedAssetLK","setSelectedAsset","animation","vSendErr","sendErr","vSendEstimates","txFeeNotAvailable","subtract","subtractCheckBox","showFormError","txfee","ok","validaddress","vSendSymbol","vSendLogo","feeUI","vSendFee","formatFullPrecision","vSendFeeFiat","vSendDestinationAmt","vTotalSend","vTotalSendFiat","vSendAddr","bal","balanceAfterSend","balanceAfterSendFiat","approxSign","totalSend","showForm","resp","changePW","switchPWMsg","peerSpinner","managePeersErr","peersTableBody","peers","source","defaultText","addedText","discoveredText","peer","connectionIcon","row","peerTableRow","WalletDefault","UserAdded","Discovered","connected","removeIcon","spinUntilPeersUpdate","updateWalletPeersTable","managePeersForm","addPeerInput","toggleWalletStatusErr","walletStatusDisable","disableWalletMsg","walletStatusEnable","enableWalletMsg","code","activeOrdersErr","successMsg","focuser","displayed","successMessage","checkmarkForm","checkmark","startR","startG","startB","diffR","diffG","diffB","defaultsLoaded","assetButtons","assetSelect","sortedAssets","localeCompare","bttn","updateAssetButton","fiat","noWallet","img","totalBalance","immature","fiatRatesMap","formatFiatConversion","updateDisplayedAsset","showAvailableMarkets","showRecentActivity","fiatBalanceBox","createWalletBox","walletDetails","sendReceive","connectBttnBox","statusLocked","statusReady","statusOff","unlockBttnBox","lockBttnBox","peerCountBox","syncProgressBox","statusDisabled","updateDisplayedAssetBalance","walletDefinition","defs","zerothOpts","assetIsConfigurable","passwordWrapper","haveActiveOrders","encrypted","walletDetailsBox","totalLocked","contractlocked","bondlocked","balanceUnit","fiatBalance","firstOther","balanceDetailBox","addSubBalance","category","subBalance","sortedCats","other","exchanges","spotVolume","vol24","hostA","mktA","hostB","mktB","availableMarkets","basesymbol","marketRow","baseLogo","quoteLogo","convRate","conventionalRate","price","fourSigFigs","priceQuoteUnit","priceBaseUnit","volumeUnit","priceBox","volumeBox","quote","marketsOverviewBox","orderActivityBox","hosts","statuses","noActivity","orderActivity","orders","recentOrders","to","fromQty","toQty","fromLogo","fromSymbol","toSymbol","toLogo","age","timeSince","submitTime","link","bindInternalNavigation","reconfigErr","url","forceUrl","forceReq","showConfirmForce","confirmForceErr","recoverWalletErr","showOpen","errorMsg","showErrorOnly","skipAnimation","currentDef","currentWalletDefinition","disableWalletType","option","traitLogFiler","otherActionsLabel","recfgAssetLogo","recfgAssetName","updateDisplayedReconfigFields","disablePassword","toggleSubtract","isWithdrawer","maxSendDisplay","sendLogo","sendName","feeReq","canSend","maxSendFiat","maxSendFee","maxSendFeeFiat","errorModalMsg","errorModal","is","showSuccess","vSendPw","newWalletPW","newPW","search","URLSearchParams","URL","location","pathname","exportWalletErr","exportWalletPW","displayRestoreWalletInfo","restorationinfo","restoreInfoCardsList","wr","card","seedName","instructions","restoreWalletInfo","recoverWalletPW","force","fiatRates","display","FourSigFigs","OneFractionalDigit","_objectWithoutProperties","excluded","sourceKeys","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","SettingsPage","fiatRateSources","darkMode","showPokes","showPopups","commitHash","addADex","importAccount","prepareAccountImport","authorizeAccountImportForm","authorizeImportAccountConfirm","changeAppPW","changeAppPWForm","submitNewPW","accountFile","onAccountFileChange","removeAccount","clearAccountFile","addAccount","exportSeed","exportSeedAuth","exportSeedSubmit","submitExportSeedReq","exportSeedPW","seedDiv","selectedAccount","importAccountErr","importAccountAppPass","accountString","account","bonds","acctInf","importResponse","reload","exportAccountErr","exportSeedE","authorizeSeedDisplay","changePWErrMsg","clearValues","newAppPW","confirmNewPW","OrderBook","mktBook","qtyAtomic","less","findIdx","removeFromSide","findOrder","updateRemainingSide","epochIdx","approve","best","bestGapOrder","forward","route","payload","handlers","queue","maxQlength","connection","readyState","WebSocket","OPEN","close","uri","reloader","retrys","go","conn","timeout","onmessage","evt","onclose","delay","onopen","request","onerror","bookRoute","bookOrderRoute","unbookOrderRoute","updateRemainingRoute","epochOrderRoute","candlesRoute","candleUpdateRoute","check","buyBtnClass","sellBtnClass","fiveMinBinKey","percentFormatter","parentIDNone","MarketsPage","main","maxOrderUpdateCounter","metaOrders","recentMatches","preorderCache","depthLines","hovers","recentMatchesSortKey","recentMatchesSortDirection","ogTitle","title","depthReporters","reportDepthClick","reportDepthVolume","reportDepthMouse","z","reportDepthZoom","depthChart","depthZoomLK","candleReporters","reportMouseCandle","candleChart","candlesChart","accelerateOrderForm","accelerateForm","candleDur","lastCandleDurationLK","registerBttn","notRegistered","dex","walletInfoTmpl","bWidget","qWidget","wgt","balanceWgt","BalanceWidget","baseIcons","stateIcons","quoteIcons","connect","walletUnlocked","expired","newWalletBttn","showCreate","walletAddr","rowTemplate","durBttnTemplate","userOrderTmpl","quoteUnits","baseUnits","buyBttn","swapBttns","sellBttn","maxLbl","setOrderBttnText","setOrderVisibility","drawChartLines","limitBttn","marketBttn","rateField","isSell","setMarketBuyOrderEstimate","maxOrd","maxSell","lotField","swap","lots","maxBuys","adjustedRate","lotChanged","disableMouseWheel","qtyField","mktBuyField","ws","handleBookRoute","handleBookOrderRoute","handleUnbookOrderRoute","handleUpdateRemainingRoute","handleEpochOrderRoute","handleCandlesRoute","handleCandleUpdateRoute","handleEpochMatchSummary","openFunc","orderForm","stepSubmit","verifyForm","vSubmit","submitOrder","vUnlockSubmit","submitEstimateUnlock","cancelForm","cancelSubmit","submitCancel","vFeeDetails","vDetailPane","closeDetailPane","showVerifyForm","recentMatchesTable","th","setRecentMatchesSortCol","ordercol","unsetRecentMatchesSortColClasses","refreshRecentMatchesTable","setRecentMatchesSortColClasses","sortCls","vPass","cancelPass","quantityChanged","marketBuyChanged","rateFieldChanged","previewQuoteAmt","marketSearchV1","filterMarkets","setDisclaimerAckViz","acked","disclaimer","disclaimerAck","showDisclaimer","orderDisclaimerAckedLK","clearChartLines","buyRows","sellRows","userOrders","activeMarkerRate","setDepthMarkers","stats0","marketStatsV1","stats1","headerSpace","stats","closeMarketsList","leftMarketDock","openMarketsList","leftHider","marketReopener","marketSelect","marketList","MarketList","marketListV1","startLoadingAnimations","setMarket","handleOrderNote","handleMatchNote","handleEpochNote","handleConnNote","bondpost","handleBondUpdate","spots","handlePriceUpdate","loadingAnimations","secondTicker","setInterval","mord","recentMatchesLiveList","td","sinceStamp","init","makeMarket","lastMarketLK","exists","setRegistrationStatusVisibility","setBalanceVisibility","anis","bconv","setPriceAndChange","obPrice","change24","obUp","obDown","baseIcon","quoteIcon","low24","high24","candleCaches","requestCandles","aDayAgo","qconv","baseCfg","quoteCfg","isSupported","bVers","versions","qVers","version","isLimit","tifBox","qtyBox","maxBox","mktBuyBox","orderTypeBttns","assetsAreSupported","tier","loaderMsg","titleContent","confStatusMsg","titleClass","regStatusTitle","regStatusConfsDisplay","registrationStatus","regStatusDex","setRegistrationStatusView","pending","confirmationsRequired","join","connectionStatus","Connected","updateRegistrationStatusView","bondRequired","resolveOrderFormVisibility","viewOnly","unregisteredDex","hasPendingBonds","acctTier","dexSettingsLink","shortSymbol","durBttnBox","candleDurs","candleDurationSelected","loadCandles","chartErrMsg","qui","bui","maxEstimateTimer","mktId","marketID","sid","maxSellRequested","sellBalance","buyBalance","setMarketDetails","setCurrMarketPrice","setLoaderMsgVisibility","setCandleDurBttns","q","sellBookedBase","sellBookedQuote","buyBookedBase","buyBookedQuote","hoverData","depthHoverData","hoverPrice","hoverVolume","candle","candleHoverData","candleStart","candleEnd","candleHigh","candleLow","candleVol","limit","qtyConv","convertToAtoms","tifnow","tifNow","options","parseOrder","adjusted","orderErr","preSell","preBuy","orderPreview","quoteQty","total","baseWallet","setMaxOrder","scheduleMaxEstimate","quoteWallet","aLot","maxBuy","path","maxLoaded","bid","qid","bWallet","qWallet","maxLotBox","maxAboveZero","maxFromLots","maxFromLotsLbl","counter","maxOrder","fromAsset","maxFromAmt","maxFromTicker","loadTable","addTableOrder","epochLine","set","msgRate","buffer","buybuffer","midGapConventional","minMktBuy","oid","userNoOrders","unreadyOrders","headerEl","detailsDiv","readyToTick","sideLight","updateMetaOrder","cancelBttn","showCancel","accelerateBttn","showAccelerate","canAccelerateOrder","expander","unreadyOrdersMsg","activeLight","rateFactor","setMarkers","midGapValue","baseSymb","quoteSymb","refreshActiveOrders","handleBook","updateTitle","select","setWallets","removeTableOrder","updateRemaining","updateTableOrder","candlesLoading","timer","setHighLow","setCandles","addRecentMatches","startStamp","openAsset","updateAsset","currentOrder","toAsset","setIcon","icon","vFeeSummary","vUnlockPreorder","vPreorderErr","vPreorder","vBuySell","buySellStr","vSideSubmit","vOrderHost","verifyLimit","verifyMarket","orderDesc","vOrderType","vRate","vQty","vTotal","vFiatTotal","vmFromTotal","vmFromAsset","vmFromTotalFiat","vMarketEstimate","received","vmToTotal","vmToAsset","vmTotalFiat","vHeader","preOrder","unlockWalletsForEstimates","vErr","vUnlockPass","attemptWalletUnlock","setPreorderErr","assetIDs","cacheKey","cached","wireOrder","estimate","vPreorderErrTip","showAdvancedOptions","hideAdvancedOptions","vOtherOrderOpts","redeem","vDefaultOrderOpts","addOption","isSwap","change","isBaseChain","showByDefault","refreshPreorder","fetchPreorder","est","setFeeEstimates","showPreOrderAdvancedOptions","hidePreOrderAdvancedOptions","reloadOrderOpts","vPreorderEstimates","fmtPct","baseExchangeRate","quoteExchangeRate","baseFeeAssetUI","quoteFeeAssetUI","tokenFiatRate","parentFiatRate","toFeeAssetUI","fromFeeAssetUI","toExchangeRate","fromExchangeRate","swapped","swappedInParentUnits","bestSwapPct","realisticBestCase","vSwapFeesLowPct","vSwapFeesLow","worstSwapPct","realisticWorstCase","vSwapFeesHighPct","vSwapFeesHigh","swapFeesMaxPct","maxFees","vSwapFeesMaxPct","vSwapFeesMax","estRate","receivedInParentUnits","bestRedeemPct","vRedeemFeesLowPct","vRedeemFeesLow","worstRedeemPct","vRedeemFeesHighPct","vRedeemFeesHigh","vFeeSummaryPct","vFeeSummaryLow","vFeeSummaryHigh","summarySwapFeesLow","summarySwapFeesHigh","summaryRedeemFeesLow","summaryRedeemFeesHigh","cancelData","cancelErr","remaining","cancelRemain","cancelUnit","currentCreate","validateOrder","showVerify","updateSpots","oldStatus","setEpoch","clearOrderTableEpochs","alreadyMatched","compare","recentMatchesSortCompare","recentMatchesTemplate","vLoader","finalize","mktBuyLots","mktBuyScore","NaN","loadTableSide","bins","currEpochBin","currNonEpochBin","currRate","bin","bookSide","tbody","binOrdersByRateAndEpoch","orderTableRow","manager","getRate","insertOrder","tr","removeOrder","updateOrderQty","clearOrderTableEpochSide","removeEpochOrders","orderBin","OrderTableRowManager","chart","setConnectionStatus","filterTxt","setFilter","setLines","unattach","clearInterval","rowTmpl","reloadMarketsPane","mkts","convertMarkets","assign","aLots","sortedMarkets","MarketRow","find","disconnectedIco","template","hues","btmpl","iconBox","walletState","balanceRowTmpl","qtmpl","updateWallet","newWalletRow","unsupported","spinner","balanceRows","addWalletSymbol","readWallet","fetchBalance","addRow","balTmpl","updateParent","before","stringyOptions","tableRow","setRateEl","setEpochEl","updateQtyNumOrdersEl","epochEl","isEpoch","rateEl","cssClass","curr","numOrders","qtyEl","numOrdersEl","setAttribute","index","findIndex","newEpoch","sign","OrdersPage","orderTmpl","filterState","readFilter","filterKey","subFilter","hostFilter","assetFilter","statusFilter","applyButtons","monitorFilter","applyBttn","submitFilter","filter1","filter2","compareSubFilter","parseSubFilter","ordersTable","nextPage","exportOrders","showArchivedDateField","archivedDateField","deleteArchivedRecordsErr","deleteArchivedRecords","saveMatchesToFile","saveOrdersToFile","archivedRecordsLocation","deleteArchivedRecordsMsg","deleteArchivedResult","deleteArchivedRecordsForm","deleteArchivedRecordsSubmit","olderThan","tableBody","appendOrders","tmplID","mktID","dateTime","fetchOrders","setOrders","currentFilter","setQuery","olderThanMs","saveMatchesToFIle","archivedRecordsDeleted","nRecords","archivedRecordsPath","orderLoader","net","coinIDTakerFoundMakerRedemption","OrderPage","stampers","matchCardTmpl","setStamp","refreshOnPopupClose","setCoinHref","explorerId","showAccelerateForm","fetchOrder","mktBaseSymbol","mktQuoteSymbol","setAccelerationButtonVis","showMatchCards","matchCard","matchID","time","matchTime","toLocaleTimeString","month","day","matchTimeAgo","orderPortion","matchQty","bipSymbol","quoteAmount","cancelInfoDiv","infoDiv","statusHdr","cancelAmount","cancelIcon","cancelOrderPortion","makerSwapYou","makerRedeemYou","takerSwapThem","takerRedeemThem","takerSwapYou","takerRedeemYou","makerSwapThem","makerRedeemThem","makerSwapAsset","takerSwapAsset","makerRedeemAsset","takerRedeemAsset","refundAsset","fromAmount","toAmount","fromIcon","toIcon","revoked","counterRedeem","refund","setCoin","pendingName","linkName","coin","coinLink","pendingSpan","cid","startsWith","makerAddr","formatCoinID","stringID","explorerCoin","makerSwapCoin","takerSwapCoin","makerRedeemCoin","takerRedeemCoin","inConfirmingMakerRedeem","inConfirmingTakerRedeem","makerSwapMsg","takerSwapMsg","makerRedeemMsg","takerRedeemMsg","confirmationString","makerSwap","takerSwap","makerRedeem","takerRedeem","setImmutableMatchCardElements","setMutableMatchCardElements","matchBox","addNewMatchCard","actionsLabel","processMatch","counterSwap","assetExplorer","CoinExplorers","ethExplorers","txid","vout","DexSettingsPage","exportDexBtn","prepareAccountExport","authorizeAccountExportForm","disableAcctBtn","prepareAccountDisable","disableAccountForm","updateBondOptionsBtn","prepareUpdateBondOptions","updateCertBtn","certFileInput","updateHostBtn","prepareUpdateHost","updateBondOptionsForm","updateBondOptionsConfirm","updateBondOptions","authorizeExportAccountConfirm","exportAccount","disableAccountConfirm","disableAccount","exportAccountAppPass","exportAccountHost","accountForExport","disableAccountAppPW","disableAccountHost","disableAccountErr","bondTargetTier","bondOptions","targetTier","bondAssetSelect","bondOptionsErr","updateCertMsg","exchange","displayIcons","disconnectedIcon","connectedIcon","Disconnected","InvalidCert","bondOptionsMsg","GapStrategyMultiplier","GapStrategyAbsolute","GapStrategyAbsolutePlus","GapStrategyPercent","GapStrategyPercentPlus","oracleWeightBaseOption","default","oracleWeightOption","createXYRange","oracleBiasBaseOption","oracleBiasRange","oracleBiasOption","driftToleranceRange","driftToleranceOption","gapMultiplierBaseOption","gapMultiplierRange","gapMultiplierOption","gapPercentBaseOption","gapPercentRange","gapPercentOption","MarketMakerPage","programs","editProgram","pwHandler","createOpts","gapRanges","assetRowTmpl","runningProgramTmpl","oracleTmpl","selectClicked","isBase","baseSelect","quoteSelect","descendentMetrics","assetDropdown","counterAsset","currentMarket","clickedSymbol","Set","otherAssets","firstID","secondID","firstSymbol","secondSymbol","nonOptions","addOptions","symbols","assetRow","hideAssetDropdown","leaveEditMode","setCreationBase","setCreationQuote","clicker","setMarketSubchoice","gapMultiplierOpt","createOptsUpdated","gapPercentOpt","driftToleranceOpt","biasOpt","weightOpt","showAdvanced","optionsExpansionLK","hideAdvanced","runBttn","authedRoute","createBot","lotsInput","exitEditMode","manualPriceBttn","basisPrice","manualPriceInput","hideManualPrice","formatFiveSigFigs","specifiedPrice","setCurrentBasisPrice","noFiatBox","gapStrategySelect","updateGapStrategyInputs","currentReport","submitPasswordForm","pwInput","pwForm","pwSubmit","createBaseWallet","createQuoteWallet","lastMkt","lastMMMarketLK","xcMkt","bot","handleBotNote","populateRunningPrograms","createBox","programsBox","fetchMaxBuy","atomToConv","absMaxBox","gapFactorMax","lotEstQuoteLots","breakEvenSpread","breakEvenGapBox","breakEvenGap","absInputBox","updateGapStrategyInputVisibility","rateUnit","skipMarketUpdate","setCurrentReport","addMarketSelect","setContent","Text","marketOneChoice","lotEstBaseSymbol","lotEstQuoteSymbol","setNoWallet","noWalletBox","lotEstQuoteBox","lotEstQuoteNoWallet","lotEstBaseBox","lotEstBaseNoWallet","availHeader","lotEstimateBox","marketInfo","oraclesBox","lotsBox","advancedBox","fetchingMarkets","buy","fetchOracleAndMaxBuy","fetchMaxSell","lotEstBaseLots","oracles","weight","weightedSum","ExchangeNames","formatThreeSigFigs","usdVol","bestBuy","bestSell","avgPrice","pgm","program","programID","oracleWeighting","oracleBias","driftTolerance","gapStrategy","gapFactor","bots","runningPrograms","programDiv","setProgramsHeader","programsHeader","noProgramsMessage","startStop","startErr","pauseBttn","startBttn","retireBttn","configureBttn","setEditProgram","updateProgramDiv","programRunning","programPaused","boost","oracleWeight","createErr","makerProgram","strategy","botType","manualRate","absInput","gapPercent","gapMultiplier","botCreator","baseOpt","createOption","constructors","register","wallets","settings","dexsettings","mm","Application","pokes","process","noteReceivers","loggers","loggersLK","enableLogger","loggerID","recorderKeys","recordersLK","recorders","recordLogger","dumpLogger","btoa","download","handlerFromPath","history","replaceState","attachHeader","attachCommon","attach","notificationsLK","protocol","reconnected","notify","seedgentime","skipPush","noteBox","profileBox","origin","requestedHandler","doc","noderize","delivered","pushState","handlerID","loadedPage","unload","lyt","popupNotes","popupTmpl","noteTmpl","pokeTmpl","loader","noteBell","pokeList","noteList","ackNotes","noteCat","pokeCat","showDropdown","noteIndicator","setNoteTimes","storeNotes","burgerIcon","logoutErr","innerNoteIcon","innerBurgerIcon","profileSignout","signOut","dialog","ico","innerWidth","acks","severity","pageURL","params","searchParams","walletsMenuEntry","marketsMenuEntry","coinID","updateBondConfs","confirmations","updateTier","prependNoteElement","orderNote","tempID","inFlight","inflight","updateOrder","handleBondNote","updateMatch","mktName","updateUser","stack","indicator","setSeverityClass","prependPokeElement","receivers","nowString","cn","makePoke","prependListElement","skipSave","makeNote","unacked","ni","noteCacheSize","lastChild","cls","toLocaleDateString","concat","fromAssetID","supportedAsset","encRate","emptyidx","def","removeCookie","authCK","removeLocal","severityClassMap","getSeconds","getMilliseconds"],"sourceRoot":""}