/*! For license information please see entry.js.LICENSE.txt */
(()=>{var e={61:(e,t,n)=>{var r=n(698).default;function a(){"use strict";e.exports=a=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,o=n.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",l=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var a=t&&t.prototype instanceof v?t:v,o=Object.create(a.prototype),i=new I(r||[]);return s(o,"_invoke",{value:S(e,n,i)}),o}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var f={};function v(){}function m(){}function g(){}var y={};d(y,c,(function(){return this}));var b=Object.getPrototypeOf,x=b&&b(b(A([])));x&&x!==n&&o.call(x,c)&&(y=x);var k=g.prototype=v.prototype=Object.create(y);function w(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(a,s,i,c){var l=p(e[a],e,s);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==r(d)&&o.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return n("throw",e,i,c)}))}c(l.arg)}var a;s(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,a){n(e,r,t,a)}))}return a=a?a.then(o,o):o()}})}function S(e,t,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return{value:void 0,done:!0}}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var i=F(s,n);if(i){if(i===f)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=p(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function F(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,F(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var a=p(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,f;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function D(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(D,this),this.reset(!0)}function A(e){if(e){var t=e[c];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:R}}function R(){return{value:void 0,done:!0}}return m.prototype=g,s(k,"constructor",{value:g,configurable:!0}),s(g,"constructor",{value:m,configurable:!0}),m.displayName=d(g,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,d(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},w(C.prototype),d(C.prototype,l,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var s=new C(h(e,n,r,a),o);return t.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},w(k),d(k,u,"Generator"),d(k,c,(function(){return this})),d(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=A,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var i=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(i&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(i){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;T(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:A(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},698:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},687:(e,t,n)=>{var r=n(61)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function t(t,n){if(t){if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}function r(n){return function(t){if(Array.isArray(t))return e(t)}(n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||t(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,s,i=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);c=!0);}catch(e){l=!0,a=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw a}}return i}}(e,n)||t(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t,n,r,a,o,s){try{var i=e[o](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,a)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function i(e){o(s,r,a,i,c,"next",e)}function c(e){o(s,r,a,i,c,"throw",e)}i(void 0)}))}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(e){var t=function(e,t){if("object"!==c(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===c(t)?t:String(t)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function d(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e,t,n){return(t=l(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=n(687),f=n.n(p);function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}function y(e,t){if(t&&("object"===c(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return v(e)}function b(e){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},b(e)}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var k=function(){function e(){i(this,e)}return d(e,null,[{key:"setCookie",value:function(e,t){var n=new Date;n.setTime(n.getTime()+31536e7);var r="expires="+n.toUTCString();document.cookie=e+"="+t+";"+r+";path=/"}},{key:"getCookie",value:function(e){var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}(document.cookie.split(";"));try{for(n.s();!(t=n.n()).done;){var r=a(t.value.split("="),2),o=r[0],s=r[1];if(o.trim()===e)return s}}catch(e){n.e(e)}finally{n.f()}return null}},{key:"removeCookie",value:function(e){document.cookie="".concat(e,"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;")}},{key:"isDark",value:function(){return"1"===e.fetchLocal(e.darkModeLK)}},{key:"storeLocal",value:function(e,t){window.localStorage.setItem(e,JSON.stringify(t))}},{key:"fetchLocal",value:function(e){var t=window.localStorage.getItem(e);return null!==t?JSON.parse(t):null}},{key:"removeLocal",value:function(e){window.localStorage.removeItem(e)}}]),e}();function w(e,t,n){return C.apply(this,arguments)}function C(){return(C=s(f().mark((function e(t,n,r){var a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.fetch(n,{method:t,headers:new window.Headers({"content-type":"application/json"}),body:r});case 3:if(200===(a=e.sent).status){e.next=6;break}throw a;case 6:return e.next=8,a.json();case 8:return(o=e.sent).requestSuccessful=!0,e.abrupt("return",o);case 13:return e.prev=13,e.t0=e.catch(0),e.t0.requestSuccessful=!1,e.next=18,e.t0.text();case 18:return e.t0.msg=e.sent,e.abrupt("return",e.t0);case 20:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function S(e,t){return F.apply(this,arguments)}function F(){return(F=s(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w("POST",t,JSON.stringify(n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return T.apply(this,arguments)}function T(){return(T=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w("GET",t));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}h(k,"darkModeLK","darkMode"),h(k,"authCK","dexauth"),h(k,"pwKeyCK","sessionkey"),h(k,"popupsLK","popups"),h(k,"loggersLK","loggers"),h(k,"recordersLK","recorders"),h(k,"lastMarketLK","selectedMarket"),h(k,"depthZoomLK","depthZoom"),h(k,"lastMMMarketLK","mmMarket"),h(k,"optionsExpansionLK","mmOptsExpand"),h(k,"leftMarketDockLK","leftmarketdock"),h(k,"selectedAssetLK","selectedasset"),h(k,"notificationsLK","notifications"),h(k,"orderDisclaimerAckedLK","ordAck"),h(k,"lastCandleDurationLK","lastCandleDuration"),h(k,"localeSpecsKey","localeSpecsLK"),h(k,"localeKey","localeLK"),null===k.fetchLocal(k.darkModeLK)&&k.storeLocal(k.darkModeLK,"1"),null===k.fetchLocal(k.popupsLK)&&k.storeLocal(k.popupsLK,"1"),null===k.fetchLocal(k.leftMarketDockLK)&&k.storeLocal(k.leftMarketDockLK,"1");var I,A=function(e){return e[e.walletErr=0]="walletErr",e[e.walletAuthErr=1]="walletAuthErr",e[e.walletBalanceErr=2]="walletBalanceErr",e[e.dupeDEXErr=3]="dupeDEXErr",e[e.assetSupportErr=4]="assetSupportErr",e[e.registerErr=5]="registerErr",e[e.signatureErr=6]="signatureErr",e[e.zeroFeeErr=7]="zeroFeeErr",e[e.feeMismatchErr=8]="feeMismatchErr",e[e.feeSendErr=9]="feeSendErr",e[e.passwordErr=10]="passwordErr",e[e.emptyHostErr=11]="emptyHostErr",e[e.connectionErr=12]="connectionErr",e[e.acctKeyErr=13]="acctKeyErr",e[e.unknownOrderErr=14]="unknownOrderErr",e[e.orderParamsErr=15]="orderParamsErr",e[e.dbErr=16]="dbErr",e[e.authErr=17]="authErr",e[e.connectWalletErr=18]="connectWalletErr",e[e.missingWalletErr=19]="missingWalletErr",e[e.encryptionErr=20]="encryptionErr",e[e.decodeErr=21]="decodeErr",e[e.accountVerificationErr=22]="accountVerificationErr",e[e.accountProofErr=23]="accountProofErr",e[e.parseKeyErr=24]="parseKeyErr",e[e.marketErr=25]="marketErr",e[e.addressParseErr=26]="addressParseErr",e[e.addrErr=27]="addrErr",e[e.fileReadErr=28]="fileReadErr",e[e.unknownDEXErr=29]="unknownDEXErr",e[e.accountRetrieveErr=30]="accountRetrieveErr",e[e.accountDisableErr=31]="accountDisableErr",e[e.suspendedAcctErr=32]="suspendedAcctErr",e[e.existenceCheckErr=33]="existenceCheckErr",e[e.createWalletErr=34]="createWalletErr",e[e.activeOrdersErr=35]="activeOrdersErr",e[e.newAddrErr=36]="newAddrErr",e}({}),R="NO_PASS_ERROR_MSG",E="BUY",B="SELL",P="VERSION_NOT_SUPPORTED",L="NO_ASSET_WALLET",O="EXECUTED",M="BOOKED",q="CANCELING",N="PASSWORD_NOT_MATCH",W="UNKNOWN",V="SETTLING",U="CANCELED",_="REVOKED",j="NONE_SELECTED",H="API_ERROR",z="LOCKED",G="INVALID_ADDRESS_MSG",X="LIMIT_ORDER",K="MARKET_ORDER",Q="MATCH_STATUS_REDEMPTION_SENT",Y="MATCH_REDEMPTION_CONFIRMED",J="MATCH_STATUS_REFUND_PENDING",Z="ORDER_ACCELERATION_ERR_MSG",$="DISCONNECTED",ee="BROWSER_NTFN_ENABLED",te="ORDER_BUTTON_BUY_BALANCE_ERROR",ne="ORDER_BUTTON_SELL_BALANCE_ERROR",re="ORDER_BUTTON_QTY_ERROR",ae="ORDER_BUTTON_QTY_RATE_ERROR",oe="CREATE_ASSET_WALLET_MSG",se="TRADING_TIER_UPDATED",ie="INVALID_TIER_VALUE",ce="MATCH_BUFFER",le="NO_PLACEMENTS",ue="INVALID_VALUE",de="NO_ZERO",he="BOTTYPE_BASIC_MM",pe="BOTTYPE_ARB_MM",fe="BOTTYPE_SIMPLE_ARB",ve="CEXBALANCE_ERR",me="PENDING",ge="COMPLETE";function ye(e,t,n){return be.apply(this,arguments)}function be(){return(be=s(f().mark((function e(t,n,r){var a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=5;break}if(!(a=k.fetchLocal(k.localeSpecsKey))||a.lang!==t||a.commitHash!==n){e.next=5;break}return I=k.fetchLocal(k.localeKey),e.abrupt("return");case 5:return e.next=7,S("/api/locale",t);case 7:I=e.sent,k.storeLocal(k.localeSpecsKey,{lang:t,commitHash:n}),k.storeLocal(k.localeKey,I);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e,t){return function(e,t){return e.replace(/{{\s?([^{}\s]*)\s?}}/g,(function(e,n){return t[n]}))}(I[e],t||{})}function ke(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return we(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?we(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){i=!0,o=e})),f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function we(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}window.clearLocale=function(){k.removeLocal(k.localeSpecsKey),k.removeLocal(k.localeKey)};var Ce=new window.DOMParser,Se={0:"btc",42:"dcr",2:"ltc",5:"dash",20:"dgb",22:"mona",28:"vtc",3:"doge",145:"bch",60:"eth",60001:"usdc.eth",60002:"usdt.eth",60003:"matic.eth",136:"firo",133:"zec",966:"polygon",966001:"usdc.polygon",966002:"weth.polygon",966003:"wbtc.polygon",966004:"usdt.polygon",147:"zcl"},Fe={};!function(){for(var e=0,t=Object.keys(Se);e<t.length;e++){var n=t[e];Fe[Se[parseInt(n)]]=parseInt(n)}}();var De=Object.values(Se),Te=1e8,Ie=Math.round(Math.log10(Te)),Ae=navigator.languages.filter((function(e){return"c"!==e})),Re=new Intl.NumberFormat(Ae,{maximumFractionDigits:0}),Ee=new Intl.NumberFormat(Ae,{minimumSignificantDigits:4,maximumSignificantDigits:4}),Be={},Pe={};function Le(e,t){return Oe(Pe,e,e,t)}function Oe(e,t,n,r){var a="".concat(t,"-").concat(n),o=e[a];return o||(o=new Intl.NumberFormat(null!=r?r:Ae,{minimumFractionDigits:t,maximumFractionDigits:n}),e[a]=o),o}function Me(e,t){var n=8;if(t){var r=t.conventional.conversionFactor;e/=r,n=Math.round(Math.log10(r))}return[e,n]}var qe=function(){function e(){i(this,e)}var t,n;return d(e,null,[{key:"idel",value:function(e,t){return e.querySelector("#".concat(t))}},{key:"bind",value:function(e,t,n,r){var a,o=ke(Array.isArray(t)?t:[t]);try{for(o.s();!(a=o.n()).done;){var s=a.value;e.addEventListener(s,n,r)}}catch(e){o.e(e)}finally{o.f()}}},{key:"unbind",value:function(e,t,n){e.removeEventListener(t,n)}},{key:"noderize",value:function(e){return Ce.parseFromString(e,"text/html")}},{key:"mouseInElement",value:function(e,t){if(t.contains(e.target))return!0;var n=t.getBoundingClientRect();return e.pageX>=n.left&&e.pageX<=n.right&&e.pageY>=n.top&&e.pageY<=n.bottom}},{key:"layoutMetrics",value:function(e){var t=e.getBoundingClientRect(),n=document.documentElement,r=t.top+n.scrollTop,a=t.left+n.scrollLeft,o=e.offsetWidth,s=e.offsetHeight;return{bodyTop:r,bodyLeft:a,width:o,height:s,centerX:a+o/2,centerY:r+s/2}}},{key:"descendentMetrics",value:function(t,n){var r=e.layoutMetrics(t),a=e.layoutMetrics(n);return{bodyTop:a.bodyTop-r.bodyTop,bodyLeft:a.bodyLeft-r.bodyLeft,width:a.width,height:a.height,centerX:a.centerX-r.bodyLeft,centerY:a.centerY-r.bodyTop}}},{key:"empty",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,a=t;r<a.length;r++)for(var o=a[r];o.firstChild;)o.removeChild(o.firstChild)}},{key:"setContent",value:function(t){e.empty(t);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];for(var o=0,s=r;o<s.length;o++){var i=s[o];t.appendChild(i)}}},{key:"hide",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,a=t;r<a.length;r++)a[r].classList.add("d-hide")}},{key:"show",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,a=t;r<a.length;r++)a[r].classList.remove("d-hide")}},{key:"setVis",value:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];t?e.show.apply(e,r):e.hide.apply(e,r)}},{key:"isHidden",value:function(e){return e.classList.contains("d-hide")}},{key:"isDisplayed",value:function(e){return!e.classList.contains("d-hide")}},{key:"animate",value:(n=s(f().mark((function e(t,n,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Ne(t,n,r).wait();case 2:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"blink",value:(t=s(f().mark((function t(n){var r,o,s,i,c;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=k.isDark()?[255,255,255]:[0,0,0],o=a(r,3),s=o[0],i=o[1],c=o[2],e.animate(1e3,(function(e){n.style.outline="2px solid rgba(".concat(s,", ").concat(i,", ").concat(c,", ").concat((2-2*e)%1,")")}));case 3:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})},{key:"applySelector",value:function(e,t){return Array.from(e.querySelectorAll(t))}},{key:"kids",value:function(e){return Array.from(e.children)}},{key:"safeSelector",value:function(e,t){return e.querySelector(t)||(console.warn("no element found for selector '".concat(t,"' on element ->"),e),document.createElement("div"))}},{key:"idDescendants",value:function(t){var n,r={},a=ke(e.applySelector(t,"[id]"));try{for(a.s();!(n=a.n()).done;){var o=n.value;r[o.id]=o}}catch(e){a.e(e)}finally{a.f()}return r}},{key:"formatCoinValue",value:function(e,t){var n=a(Me(e,t),2),r=n[0],o=n[1];return Number.isInteger(r)?Re.format(r):function(e){return Oe(Be,2,e)}(o).format(r)}},{key:"conventionalCoinValue",value:function(e,t){return a(Me(e,t),1)[0]}},{key:"formatRateFullPrecision",value:function(e,t,n,r){var a=e*(t.conventional.conversionFactor/n.conventional.conversionFactor)/Te,o=Ie-Math.floor(Math.log10(r))-Math.floor(Math.log10(t.conventional.conversionFactor)-Math.log10(n.conventional.conversionFactor));return o<=0?Re.format(a):Le(o).format(a)}},{key:"formatFourSigFigs",value:function(e,t){return function(e,t,n,r,a){var o,s;if(n>=1e3)return e.format(n);var i=t.format(n);return"number"!=typeof r||(null!==(o=null===(s=t.formatToParts(n).filter((function(e){return"fraction"===e.type}))[0])||void 0===s?void 0:s.value)&&void 0!==o?o:"").length<=r?i:Le(r,void 0).format(n)}(Re,Ee,e,t)}},{key:"formatInt",value:function(e){return Re.format(e)}},{key:"formatFullPrecision",value:function(e,t){var n=a(Me(e,t),2),r=n[0];return Le(n[1]).format(r)}},{key:"formatFiatConversion",value:function(e,t,n){if(!t||0===t)return xe("UNAVAILABLE");var r=a(Me(e,n),1)[0]*t;return Le(2).format(r)}},{key:"languages",value:function(){return Ae}},{key:"formatFiatValue",value:function(e){return Le(2).format(e)}},{key:"bestConversion",value:function(e,t,n){for(var r=function(e,t){var n,r=(h(n={},e.atomicUnit,1),h(n,e.conventional.unit,e.conventional.conversionFactor),n);if(e.denominations&&t){var a,o=ke(e.denominations);try{for(o.s();!(a=o.n()).done;){var s=a.value;t[s.unit]&&(r[s.unit]=s.conversionFactor)}}catch(e){o.e(e)}finally{o.f()}}return r}(t,n),a=[],o=function(t){return Math.abs(Math.log10(e/t[1])-1)},s=0,i=Object.entries(r);s<i.length;s++){var c=i[s];a.push([c[0],o(c)])}var l=a.reduce((function(e,t){return t[1]<e[1]?t:e})),u=l[0],d=r[u];return[e/d,Math.round(Math.log10(d)),u]}},{key:"formatBestUnitsFullPrecision",value:function(e,t,n){var r=a(this.bestConversion(e,t,n),3),o=r[0],s=r[1],i=r[2];return Number.isInteger(o)?[Re.format(o),i]:[Le(s).format(o),i]}},{key:"formatBestUnitsFourSigFigs",value:function(t,n,r){var o=a(this.bestConversion(t,n,r),3),s=o[0],i=o[1],c=o[2];return[e.formatFourSigFigs(s,i),c]}},{key:"formatBestRateElement",value:function(t,n,r,a,o){e.formatBestValueElement(t,n,r,a,o),e.setText(t,"[data-denom]",a.feeRateDenom)}},{key:"formatBestValueElement",value:function(t,n,r,o,s){var i=a(this.formatBestUnitsFourSigFigs(r,o,s),2),c=i[0],l=i[1];e.setText(t,"[data-value]",c),e.setText(t,"[data-unit]",l);var u=e.safeSelector(t,"[data-unit-box]");u.dataset.atoms=String(r),u.dataset.assetID=String(n)}},{key:"conventionalRateStep",value:function(e,t,n){var r=[n.conventional.conversionFactor,t.conventional.conversionFactor];return e/Te*(r[1]/r[0])}},{key:"logoPath",value:function(e){return-1===De.indexOf(e)&&(e=e.substring(0,1)),e=e.split(".")[0],"/img/coins/".concat(e,".png")}},{key:"bipSymbol",value:function(e){return Se[e]}},{key:"bipIDFromSymbol",value:function(e){return Fe[e]}},{key:"bipCEXSymbol",value:function(e){var t=Se[e];if(!t||""===t)return"";var n=t.split(".");return"weth"===n[0]?"eth":n[0]}},{key:"logoPathFromID",value:function(t){return e.logoPath(Se[t])}},{key:"symbolize",value:function(t,n){var r=t.unitInfo.conventional.unit,a=document.createElement("span");a.textContent=r.toUpperCase();var o=t.symbol.split(".");if(2!==o.length)return a;var s=o[1],i=document.createElement("span");if(i.appendChild(a),n){var c=document.createElement("img");return c.src=e.logoPath(s),c.classList.add("token-parent"),i.appendChild(c),i}var l=document.createElement("sup");return l.textContent=s.toUpperCase(),l.classList.add("token-parent"),i.appendChild(l),i}},{key:"shortSymbol",value:function(e){return e.split(".")[0].toUpperCase()}},{key:"setText",value:function(t,n,r){var a,o=ke(e.applySelector(t,n));try{for(o.s();!(a=o.n()).done;)a.value.textContent=r}catch(e){o.e(e)}finally{o.f()}}},{key:"setSrc",value:function(t,n,r){var a,o=ke(e.applySelector(t,n));try{for(o.s();!(a=o.n()).done;)a.value.src=r}catch(e){o.e(e)}finally{o.f()}}},{key:"cleanTemplates",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((function(e){e.remove(),e.removeAttribute("id")}))}},{key:"tmplElement",value:function(e,t){return e.querySelector('[data-tmpl="'.concat(t,'"]'))||document.createElement("div")}},{key:"parseTemplate",value:function(t){var n,r={},a=ke(e.applySelector(t,"[data-tmpl]"));try{for(a.s();!(n=a.n()).done;){var o=n.value;r[o.dataset.tmpl||""]=o}}catch(e){a.e(e)}finally{a.f()}return r}},{key:"timeSince",value:function(t){return e.formatDuration((new Date).getTime()-t)}},{key:"hmsSince",value:function(e){var t=(new Date).getTime()/1e3-e,n=String(Math.floor(t/3600));t%=3600;var r=String(Math.floor(t/60)),a=String(Math.floor(t%60));return"".concat(n.padStart(2,"0"),":").concat(r.padStart(2,"0"),":").concat(a.padStart(2,"0"))}},{key:"formatDuration",value:function(e){var t,n,r,o,s,i,c=Math.floor(e),l="",u=0,d=function(e,t){return(e>0||u>0)&&u++,e>0&&(l+="".concat(e," ").concat(t," ")),u>=2},h=a(Ke(c,je),2);if(t=h[0],c=h[1],d(t,"y"))return l;var p=a(Ke(c,He),2);if(n=p[0],c=p[1],d(n,"mo"))return l;var f=a(Ke(c,ze),2);if(r=f[0],c=f[1],d(r,"d"))return l;var v=a(Ke(c,Ge),2);if(o=v[0],c=v[1],d(o,"h"))return l;var m=a(Ke(c,Xe),2);if(s=m[0],c=m[1],d(s,"m"))return l;var g=a(Ke(c,1e3),2);return i=g[0],c=g[1],d(i,"s"),l||"0 s"}},{key:"disableMouseWheel",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,o=n;a<o.length;a++){var s=o[a];e.bind(s,"wheel",(function(){}),{passive:!0})}}},{key:"showFormError",value:function(t,n){t.textContent=n,e.show(t)}},{key:"showFiatValue",value:function(t,n,r,a){r?(t.textContent=e.formatFiatConversion(n,r,a),e.show(t.parentElement)):e.hide(t.parentElement)}}]),e}(),Ne=function(){function e(t,n,r,a){i(this,e),h(this,"done",void 0),h(this,"endAnimation",void 0),h(this,"thread",void 0),this.done=a,this.thread=this.run(t,n,r)}var t,n,r;return d(e,[{key:"run",value:(r=s(f().mark((function t(n,r,a){var o,s,i,c,l,u;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=n>=0?n:31536e7,o=a?We[a]:We.linear,s=(new Date).getTime(),i=n===e.Forever?Number.MAX_SAFE_INTEGER:s+n,c=i-s,l=1e3/30,u=s,this.endAnimation=!1;case 8:if(!(u<i)){t.next=17;break}if(!this.endAnimation){t.next=11;break}return t.abrupt("return",this.runCompletionFunction());case 11:return r(o((u-s)/c)),t.next=14,_e(l);case 14:u=(new Date).getTime(),t.next=8;break;case 17:r(1),this.runCompletionFunction();case 19:case"end":return t.stop()}}),t,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"wait",value:(n=s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.thread;case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"stop",value:function(){this.endAnimation=!0}},{key:"stopAndWait",value:(t=s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stop(),e.next=3,this.wait();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"runCompletionFunction",value:function(){this.done&&this.done()}}]),e}();h(Ne,"Forever",void 0),Ne.Forever=-1;var We={linear:function(e){return e},easeIn:function(e){return e*e},easeOut:function(e){return e*(2-e)},easeInHard:function(e){return e*e*e},easeOutHard:function(e){return--e*e*e+1},easeOutElastic:function(e){var t=2*Math.PI/3;return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*t)+1}},Ve=function(){function e(t){i(this,e),h(this,"icons",void 0),h(this,"status",void 0);var n=function(e){return t.querySelector("[data-state=".concat(e,"]"))};this.icons={},this.icons.sleeping=n("sleeping"),this.icons.locked=n("locked"),this.icons.unlocked=n("unlocked"),this.icons.nowallet=n("nowallet"),this.icons.syncing=n("syncing"),this.icons.nopeers=n("nopeers"),this.icons.disabled=n("disabled"),this.status=n("status")}return d(e,[{key:"sleeping",value:function(){var e=this.icons;qe.hide(e.locked,e.unlocked,e.nowallet,e.syncing,e.disabled),qe.show(e.sleeping),this.status&&(this.status.textContent=xe("OFF"))}},{key:"locked",value:function(){var e=this.icons;qe.hide(e.unlocked,e.nowallet,e.sleeping,e.disabled),qe.show(e.locked),this.status&&(this.status.textContent=xe(z))}},{key:"unlocked",value:function(){var e=this.icons;qe.hide(e.locked,e.nowallet,e.sleeping,e.disabled),qe.show(e.unlocked),this.status&&(this.status.textContent=xe("READY"))}},{key:"nowallet",value:function(){var e=this.icons;qe.hide(e.locked,e.unlocked,e.sleeping,e.syncing,e.disabled),qe.show(e.nowallet),this.status&&(this.status.textContent=xe("NO_WALLET"))}},{key:"disabled",value:function(){var e=this.icons;qe.hide(e.locked,e.unlocked,e.sleeping,e.syncing,e.nowallet,e.nopeers),qe.show(e.disabled),e.disabled.dataset.tooltip=xe("DISABLED_MSG")}},{key:"setSyncing",value:function(e){var t=this.icons.syncing;if(e&&e.running&&!e.disabled){if(0===e.peerCount)return qe.show(this.icons.nopeers),void qe.hide(t);if(qe.hide(this.icons.nopeers),!e.synced)return qe.show(t),void(t.dataset.tooltip=xe("WALLET_SYNC_PROGRESS",{syncProgress:(100*e.syncProgress).toFixed(1)}));qe.hide(t)}else qe.hide(t)}},{key:"readWallet",value:function(e){if(this.setSyncing(e),!e)return this.nowallet();switch(!0){case e.disabled:this.disabled();break;case!e.running:this.sleeping();break;case!e.open:this.locked();break;case e.open:this.unlocked();break;default:console.error("wallet in unknown state",e)}}}]),e}(),Ue=function(){function e(t,n,r,a){var o=this;i(this,e),h(this,"toggle",void 0),h(this,"toggling",void 0),this.toggle=t,0===t.children.length&&t.appendChild(document.createElement("div")),qe.bind(t,"click",function(){var e=s(f().mark((function e(r){var s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.stopPropagation(),qe.hide(n),s=!t.classList.contains("on"),o.toggling=!0,e.prev=4,e.next=7,a(s);case 7:e.next=15;break;case 9:return e.prev=9,e.t0=e.catch(4),o.toggling=!1,qe.show(n),n.textContent=xe(H,{msg:e.t0.msg||String(e.t0)}),e.abrupt("return");case 15:o.toggling=!1;case 16:case"end":return e.stop()}}),e,null,[[4,9]])})));return function(t){return e.apply(this,arguments)}}()),this.setState(r)}return d(e,[{key:"setState",value:function(e){e?this.toggle.classList.add("on"):this.toggle.classList.remove("on")}}]),e}();function _e(e){return new Promise((function(t){return setTimeout(t,e)}))}var je=31536e6,He=2592e6,ze=864e5,Ge=36e5,Xe=6e4;function Ke(e,t){var n=Math.floor(e/t);return[n,e-n*t]}var Qe=function(){function e(t,n){var r,a,o,s=this;i(this,e),h(this,"input",void 0),h(this,"prec",void 0),h(this,"fmt",void 0),h(this,"changed",void 0),h(this,"set",void 0),h(this,"min",void 0),this.input=t,this.prec=null!==(r=n.prec)&&void 0!==r?r:0,this.fmt=n.sigFigs?$e:Ze,this.changed=null!==(a=n.changed)&&void 0!==a?a:function(){},this.set=n.set,this.min=null!==(o=n.min)&&void 0!==o?o:0,qe.bind(t,"change",(function(){s.inputChanged()}))}return d(e,[{key:"inputChanged",value:function(){var e=this.changed;e&&e(this.value())}},{key:"setValue",value:function(e){this.input.value=String(e),e=this.value(),this.set&&this.set(e,this.input.value)}},{key:"value",value:function(){var e=this.input,t=this.min,n=this.prec,r=a((0,this.fmt)(Math.max(et(e.value,null!=t?t:0),null!=t?t:0),null!=n?n:0),2),o=r[0],s=r[1];return e.value=s,o}}]),e}(),Ye=function(e){g(a,e);var t,n,r=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=b(t);if(n){var a=b(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return y(this,e)});function a(e,t){var n,o;i(this,a),h(v(o=r.call(this,qe.safeSelector(e,"input"),t)),"inc",void 0),h(v(o),"opts",void 0),o.opts=t,o.inc=null!==(n=t.inc)&&void 0!==n?n:1;var s=qe.safeSelector(e,".ico-arrowup"),c=qe.safeSelector(e,".ico-arrowdown");return qe.bind(s,"click",(function(){o.increment(1)})),qe.bind(c,"click",(function(){o.increment(-1)})),o}return d(a,[{key:"setIncrementAndMinimum",value:function(e,t){this.inc=e,this.min=t}},{key:"increment",value:function(e){var t=this.inc,n=this.min;this.input.value=String(Math.max(this.value()+e*t,n)),this.inputChanged()}}]),a}(Qe),Je=function(){function e(t,n){var r=this;i(this,e),h(this,"track",void 0),h(this,"ball",void 0),h(this,"r",void 0),h(this,"changed",void 0),this.changed=n,this.r=0;var a=document.createElement("div");a.dataset.tmpl="color",t.appendChild(a);var o=this.track=document.createElement("div");o.dataset.tmpl="track",a.appendChild(o);var s=this.ball=document.createElement("div");s.dataset.tmpl="ball",o.appendChild(s),qe.bind(t,"mousedown",(function(e){if(0===e.button){e.preventDefault(),e.stopPropagation();var t=e.pageX,n=o.clientWidth,a=r.r*n,i=function(e){e.preventDefault();var o=function(e){return Math.max(Math.min(a+(e.pageX-t),n),0)}(e);r.r=o/n,s.style.left="".concat(100*r.r,"%"),r.changed(r.r)};qe.bind(document,"mousemove",i),qe.bind(document,"mouseup",(function e(t){i(t),qe.unbind(document,"mousemove",i),qe.unbind(document,"mouseup",e)}))}})),qe.bind(t,"click",(function(e){if(0===e.button){var t=e.pageX,n=qe.layoutMetrics(o);r.r=tt((t-n.bodyLeft)/n.width,0,1),s.style.left="".concat(r.r*n.width,"px"),r.changed(r.r)}}))}return d(e,[{key:"setValue",value:function(e){this.r=tt(e,0,1),this.ball.style.left="".concat(100*this.r,"%")}}]),e}();function Ze(e,t){var n=Math.pow(10,null!=t?t:0),r=(e=Math.round(e*n)/n).toFixed(t);if(t>0){for(;r.endsWith("0");)r=r.substring(0,r.length-1);r.endsWith(".")&&(r=r.substring(0,r.length-1))}return[e,r]}function $e(e,t){var n=Math.floor(Math.log10(Math.abs(e)));return n>=3?[Math.round(e),e.toFixed(0)]:Ze(e,Math.min(4-n,t))}function et(e,t){var n=parseFloat((null!=e?e:"").replace(/,/g,""));return isNaN(n)?null!=t?t:0:n}function tt(e,t,n){return e<t?t:e>n?n:e}function nt(e,t,n,r){return rt.apply(this,arguments)}function rt(){return(rt=s(f().mark((function e(t,n,r,a){var o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Unable to copy: ",e.t0);case 8:o=n.style.color,s=r.style.color,n.style.color=a,r.style.color=a,setTimeout((function(){n.style.color=o,r.style.color=s}),350);case 13:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}var at,ot,st,it,ct=function(){function e(){i(this,e)}return d(e,[{key:"unload",value:function(){}}]),e}(),lt=function(e){return e[e.Disconnected=0]="Disconnected",e[e.Connected=1]="Connected",e[e.InvalidCert=2]="InvalidCert",e}({}),ut=function(e){return e[e.Approved=0]="Approved",e[e.Pending=1]="Pending",e[e.NotApproved=2]="NotApproved",e}({}),dt=function(e){return e[e.WalletDefault=0]="WalletDefault",e[e.UserAdded=1]="UserAdded",e[e.Discovered=2]="Discovered",e}({}),ht=2147483647;function pt(){return at}function ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b(e);if(t){var a=b(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return y(this,n)}}function vt(e){var t=[e.booleanOptTmpl,e.rangeOptTmpl,e.orderOptTmpl];st=t[0],it=t[1],ot=t[2]}var mt=new Intl.NumberFormat(qe.languages(),{minimumSignificantDigits:3,maximumSignificantDigits:3}),gt=d((function e(t,n,r){var a=this;i(this,e),h(this,"opt",void 0),h(this,"node",void 0),h(this,"tmpl",void 0),h(this,"on",void 0),this.opt=t;var o=this.node=ot.cloneNode(!0),s=this.tmpl=qe.parseTemplate(o);s.optName.textContent=t.displayname,s.tooltip.dataset.tooltip=t.description,n?s.chainIcon.src=qe.logoPath(n):qe.hide(s.chainIcon),this.on=!1,qe.bind(o,"click",(function(){a.on||(a.on=!0,o.classList.add("selected"),r.enable())})),qe.bind(s.toggle,"click",(function(e){a.on&&(e.stopPropagation(),a.on=!1,o.classList.remove("selected"),r.disable())}))})),yt=function(e){g(n,e);var t=ft(n);function n(e,r,a,o){var s;if(i(this,n),h(v(s=t.call(this,e,r,{enable:function(){return s.enable()},disable:function(){return s.disable()}})),"control",void 0),h(v(s),"changed",void 0),h(v(s),"dict",void 0),s.dict=a,s.changed=function(){return o()},void 0===e.boolean)throw Error("not a boolean opt");var c=e.boolean,l=s.control=st.cloneNode(!0);return s.tmpl.controls.appendChild(l),qe.parseTemplate(l).reason.textContent=c.reason,s.on=void 0!==a[e.key]?a[e.key]:e.default,s.on&&s.node.classList.add("selected"),s}return d(n,[{key:"store",value:function(){this.on===this.opt.default?delete this.dict[this.opt.key]:this.dict[this.opt.key]=this.on,this.changed()}},{key:"enable",value:function(){this.store()}},{key:"disable",value:function(){this.store()}}]),n}(gt),bt=function(e){g(n,e);var t=ft(n);function n(e,r,a,o){var s;if(i(this,n),h(v(s=t.call(this,e,r,{enable:function(){return s.enable()},disable:function(){return s.disable()}})),"handler",void 0),h(v(s),"x",void 0),h(v(s),"changed",void 0),h(v(s),"dict",void 0),s.dict=a,s.changed=o,void 0===e.xyRange)throw Error("not an xy range opt");var c=e.xyRange,l=a[e.key];return s.on=void 0!==l,s.on?(s.node.classList.add("selected"),s.x=l):s.x=e.default,s.handler=new xt(c,s.x,{changed:o,selected:function(){s.node.classList.add("selected")},settingsDict:a,settingsKey:e.key}),s.tmpl.controls.appendChild(s.handler.control),s}return d(n,[{key:"enable",value:function(){this.dict[this.opt.key]=this.x,this.changed()}},{key:"disable",value:function(){delete this.dict[this.opt.key],this.changed()}},{key:"setValue",value:function(e){this.handler.setValue(e),this.on=!0,this.node.classList.add("selected")}}]),n}(gt),xt=function(){function e(t,n,r){var a,o,s,c,l=this;i(this,e),h(this,"control",void 0),h(this,"range",void 0),h(this,"tmpl",void 0),h(this,"initVal",void 0),h(this,"settingsDict",void 0),h(this,"settingsKey",void 0),h(this,"x",void 0),h(this,"scrollingX",void 0),h(this,"y",void 0),h(this,"r",void 0),h(this,"roundX",void 0),h(this,"roundY",void 0),h(this,"disabled",void 0),h(this,"updated",void 0),h(this,"changed",void 0),h(this,"selected",void 0),h(this,"convert",void 0);var u=this.control=it.cloneNode(!0),d=this.tmpl=qe.parseTemplate(u);d.rangeLblStart.textContent=t.start.label,d.rangeLblEnd.textContent=t.end.label,d.xUnit.textContent=t.xUnit,d.yUnit.textContent=t.yUnit,this.range=t,this.initVal=n,this.settingsDict=r.settingsDict,this.settingsKey=null!==(a=r.settingsKey)&&void 0!==a?a:"",this.roundX=Boolean(r.roundX),this.roundY=Boolean(r.roundY),this.setDisabled(Boolean(r.disabled)),this.changed=null!==(o=r.changed)&&void 0!==o?o:function(){},this.selected=null!==(s=r.selected)&&void 0!==s?s:function(){},this.updated=null!==(c=r.updated)&&void 0!==c?c:function(){},this.convert=r.convert||function(e){return e};var p=d.slider,f=d.handle,v=t.end.x-t.start.x,m=t.end.y-t.start.y,g=function(e){return(e-t.start.x)/v};this.r=g(n),this.scrollingX=this.x=n,this.y=this.r*m+t.start.y,this.accept(this.scrollingX,{skipUpdate:!0});var y=function e(n){if(!l.disabled&&("change"===n.type||n.target!==d.xInput)){var r=d.xInput.value;if(r){var a=parseFloat(r);isNaN(a)||(l.scrollingX=kt(a,t.start.x,t.end.x),l.r=g(l.scrollingX),l.y=l.r*m+t.start.y,l.accept(l.scrollingX))}qe.hide(d.xInput),qe.show(d.x),qe.unbind(document,"click",e),l.changed()}};qe.bind(d.x,"click",(function(e){l.disabled||(qe.hide(d.x),qe.show(d.xInput),d.xInput.focus(),d.xInput.value=mt.format(l.scrollingX),qe.bind(document,"click",y),e.stopPropagation())})),qe.bind(d.xInput,"change",y);var b=function e(n){if(!l.disabled&&("change"===n.type||n.target!==d.yInput)){var r=d.yInput.value;if(r){var a=parseFloat(r);isNaN(a)||(l.y=kt(a,t.start.y,t.end.y),l.r=(l.y-t.start.y)/m,l.scrollingX=t.start.x+l.r*v,l.accept(l.scrollingX))}qe.hide(d.yInput),qe.show(d.y),qe.unbind(document,"click",e),l.changed()}};qe.bind(d.y,"click",(function(e){l.disabled||(qe.hide(d.y),qe.show(d.yInput),d.yInput.focus(),d.yInput.value=mt.format(l.y),qe.bind(document,"click",b),e.stopPropagation())})),qe.bind(d.yInput,"change",b),qe.bind(f,"mousedown",(function(e){if(!l.disabled&&0===e.button){e.preventDefault(),e.stopPropagation(),l.selected();var n=e.pageX,r=p.clientWidth-f.offsetWidth,a=g(l.scrollingX)*r,o=function(e,o){e.preventDefault(),l.r=function(e){return Math.max(Math.min(a+(e.pageX-n),r),0)}(e)/r,l.scrollingX=l.r*v+t.start.x,l.y=l.r*m+t.start.y,l.accept(l.scrollingX,{skipChange:!o})};qe.bind(document,"mousemove",o),qe.bind(document,"mouseup",(function e(t){o(t,!0),qe.unbind(document,"mousemove",o),qe.unbind(document,"mouseup",e),l.changed()}))}})),qe.bind(d.sliderBox,"click",(function(e){if(!l.disabled&&0===e.button){var n=e.pageX,r=qe.layoutMetrics(d.slider);l.r=kt((n-r.bodyLeft)/r.width,0,1),l.scrollingX=l.r*v+t.start.x,l.y=l.r*m+t.start.y,l.accept(l.scrollingX)}}))}return d(e,[{key:"setDisabled",value:function(e){this.control.classList.toggle("disabled",e),this.disabled=e}},{key:"setXLabel",value:function(e){this.tmpl.x.textContent=e}},{key:"setYLabel",value:function(e){this.tmpl.y.textContent=e}},{key:"accept",value:function(e,t){var n,r=this.tmpl;this.roundX&&(e=Math.round(e)),this.roundY&&(this.y=Math.round(this.y)),r.x.textContent=mt.format(e),r.y.textContent=mt.format(this.y),this.roundY&&(r.y.textContent="".concat(this.y));var a=kt(this.r,0,1);r.handle.style.left="calc(".concat(100*a,"% - ").concat(14*a,"px)"),this.x=e,this.scrollingX=e,t=null!==(n=t)&&void 0!==n?n:{},this.settingsDict&&(this.settingsDict[this.settingsKey]=this.convert(this.x,this.y)),t.skipUpdate||(this.updated(e,this.y),t.skipChange||this.changed())}},{key:"setValue",value:function(e,t){var n=this.range;this.r=(e-n.start.x)/(n.end.x-n.start.x),this.y=n.start.y+this.r*(n.end.y-n.start.y),this.accept(e,{skipUpdate:t})}},{key:"modified",value:function(){return this.x!==this.initVal}},{key:"reset",value:function(){this.setValue(this.initVal,!0)}}]),e}(),kt=function(e,t,n){return e<t?t:e>n?n:e};function wt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ct(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ct(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function Ct(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var St=1,Ft=2,Dt=2,Tt=0,It=1,At=2,Rt=3,Et=2,Bt=3,Pt=4,Lt=0,Ot=1,Mt=0,qt=1e8;function Nt(e){var t=e.sell?B:E,n=document.documentElement.lang.toLowerCase();return xe(t).toLocaleLowerCase(n)}function Wt(e){return e.type===St?e.tif===Tt?xe("LIMIT_ORDER_IMMEDIATE_TIF"):xe(X):xe(K)}function Vt(e){return e.type===Ft&&!e.sell}function Ut(e){if(!e.matches)return!1;var t,n=wt(e.matches);try{for(n.s();!(t=n.n()).done;)if(t.value.active)return!0}catch(e){n.e(e)}finally{n.f()}return!1}function _t(e){if(!e.id)return xe("ORDER_SUBMITTING");var t=Ut(e);switch(e.status){case 0:return xe(W);case It:return xe("EPOCH");case At:return e.cancelling?xe(q):t?"".concat(xe(M),"/").concat(xe(V)):xe(M);case Rt:return t?xe(V):0===e.filled&&3!==e.type?xe("NO_MATCH"):xe(O);case 4:return t?"".concat(xe(U),"/").concat(xe(V)):xe(U);case 5:return t?"".concat(xe(_),"/").concat(xe(V)):xe(_)}return xe(W)}function jt(e){if(!e.matches)return 0;var t=Vt(e)?function(e){return e.qty*e.rate/qt}:function(e){return e.qty};return e.matches.reduce((function(e,n){return n.isCancel?e:e+t(n)}),0)}function Ht(e){if(!e.matches)return 0;var t=Vt(e)?function(e){return e.qty*e.rate/qt}:function(e){return e.qty};return e.matches.reduce((function(e,n){return n.isCancel?e:n.side===Lt&&n.status>=Bt||n.side===Ot&&n.status>=Pt?e+t(n):e}),0)}function zt(e){var t;if(null===(t=e.matches)||void 0===t||!t.length)return xe(K);var n=qe.formatCoinValue(pt().conventionalRate(e.baseID,e.quoteID,Gt(e)));return e.matches.length>1&&(n="~ "+n),n}function Gt(e){var t;if(null===(t=e.matches)||void 0===t||!t.length)return 0;var n,r=0,a=0,o=wt(e.matches);try{for(o.s();!(n=o.n()).done;){var s=n.value;a+=s.qty,r+=s.rate*s.qty}}catch(e){o.e(e)}finally{o.f()}return r/a}function Xt(e,t){return e*t/qt}function Kt(e){return xe("MATCH_STATUS_REVOKED",{status:xe(e)})}function Qt(e){return e.type===St&&1===e.tif&&e.status<Rt}function Yt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b(e);if(t){var a=b(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return y(this,n)}}function Jt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Zt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){i=!0,o=e})),f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function Zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var $t=qe.bind,en=2*Math.PI,tn=String.fromCharCode(59914),nn=String.fromCharCode(59915),rn={body:"#0b2031",axisLabel:"#b1b1b1",gridBorder:"#383f4b",gridLines:"#383f4b",gapLine:"#6b6b6b",value:"#9a9a9a",zoom:"#5b5b5b",zoomHover:"#aaa",sellLine:"#ae3333",buyLine:"#05a35a",sellFill:"#591a1a",buyFill:"#02572f",crosshairs:"#888",legendFill:"black",legendText:"#d5d5d5"},an={body:"#f4f4f4",axisLabel:"#1b1b1b",gridBorder:"#ddd",gridLines:"#ddd",gapLine:"#595959",value:"#4d4d4d",zoom:"#777",zoomHover:"#333",sellLine:"#99302b",buyLine:"#207a46",sellFill:"#bd5959",buyFill:"#4cad75",crosshairs:"#595959",legendFill:"#e6e6e6",legendText:"#1b1b1b"},on=function(){function e(t,n){var r=this;i(this,e),h(this,"parent",void 0),h(this,"report",void 0),h(this,"theme",void 0),h(this,"canvas",void 0),h(this,"visible",void 0),h(this,"renderScheduled",void 0),h(this,"ctx",void 0),h(this,"mousePos",void 0),h(this,"rect",void 0),h(this,"wheelLimiter",void 0),h(this,"boundResizer",void 0),h(this,"plotRegion",void 0),h(this,"xRegion",void 0),h(this,"yRegion",void 0),h(this,"dataExtents",void 0),h(this,"unattachers",void 0),this.parent=t,this.report=n,this.theme=k.isDark()?rn:an,this.canvas=document.createElement("canvas"),this.visible=!0,t.appendChild(this.canvas);var a=this.canvas.getContext("2d");if(a){this.ctx=a,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.mousePos=null,$t(this.canvas,"mousemove",(function(e){r.rect&&(r.mousePos={x:e.clientX-r.rect.left,y:e.clientY-r.rect.y},r.draw())})),$t(this.canvas,"mouseleave",(function(){r.mousePos=null,r.draw()})),new ResizeObserver((function(){return r.resize()})).observe(this.parent),this.wheelLimiter=null,$t(this.canvas,"wheel",(function(e){r.wheel(e)}),{passive:!0}),$t(this.canvas,"click",(function(e){r.click(e)}));var o=function(){r.visible="hidden"!==document.visibilityState,r.visible&&r.renderScheduled&&(r.renderScheduled=!1,r.draw())};$t(document,"visibilitychange",o),this.unattachers=[function(){qe.unbind(document,"visibilitychange",o)}]}else console.error("error getting canvas context")}return d(e,[{key:"wheeled",value:function(){var e=this;this.wheelLimiter=window.setTimeout((function(){e.wheelLimiter=null}),100)}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"draw",value:function(){this.render()}},{key:"click",value:function(e){this.report.click(e)}},{key:"wheel",value:function(e){this.zoom(e.deltaY<0)}},{key:"resize",value:function(){var e=this;this.canvas.width=this.parent.clientWidth,this.canvas.height=this.parent.clientHeight;var t=new un(0,this.canvas.width,0,this.canvas.height-30),n=new un(0,this.canvas.width,this.canvas.height-30,this.canvas.height),r=new un(0,40,0,this.canvas.height-30);this.plotRegion=new dn(this.ctx,t),this.xRegion=new dn(this.ctx,n),this.yRegion=new dn(this.ctx,r),window.requestAnimationFrame((function(){e.rect=e.canvas.getBoundingClientRect(),e.report.resize()}))}},{key:"zoom",value:function(e){this.wheelLimiter||this.report.zoom(e)}},{key:"unattach",value:function(){var e,t=Jt(this.unattachers);try{for(t.s();!(e=t.n()).done;)(0,e.value)()}catch(e){t.e(e)}finally{t.f()}this.unattachers=[]}},{key:"render",value:function(){console.error("child class must override render method")}},{key:"applyLabelStyle",value:function(e){this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.font="".concat(null!=e?e:"14","px 'sans', sans-serif"),this.ctx.fillStyle=this.theme.axisLabel}},{key:"plotXLabels",value:function(e,t,n,r){var a=this,o=new un(t,n,0,1);this.xRegion.plot(o,(function(o,s){a.applyLabelStyle();var i=(n+t)/2,c=t,l=i,u=[s.x(t),s.x(n)],d=u[0],h=u[1],p=s.y(.5);e.lbls.forEach((function(e){var t=o.measureText(e.txt),n=s.x(e.val);n-t.width/2<d||n+t.width/2>h||(o.fillText(e.txt,n,p),i>=c&&i<e.val&&(l=(c+e.val)/2),c=e.val)})),o.font="11px 'sans', sans-serif",2===r.length?(o.fillText(r[0],s.x(l),s.y(.63)),o.fillText(r[1],s.x(l),s.y(.23))):1===r.length&&o.fillText(r[0],s.x(l),p)}),!0)}},{key:"plotXGrid",value:function(e,t,n){var r=this,a=new un(t,n,0,1);this.plotRegion.plot(a,(function(t,n){t.lineWidth=1,t.strokeStyle=r.theme.gridLines,e.lbls.forEach((function(e){vn(t,n.x(e.val),n.y(0),n.x(e.val),n.y(1))}))}),!0)}},{key:"plotYLabels",value:function(e,t,n,r){var a=this,o=new un(0,1,t,n),s=function(e,t,n,r,o,s){e.save(),e.fillStyle=a.theme.body,e.beginPath(),e.roundRect?e.roundRect(t,n,r,o,s):e.rect(t,n,r,o),e.fill(),e.restore()};this.yRegion.plot(o,(function(o,i){a.applyLabelStyle(),a.ctx.textAlign="left";var c=n/2,l=0,u=c,d=i.x(0);e.lbls.forEach((function(e){var r=i.y(e.val);if(!(r<i.y(n)+3+7||r>i.y(t)-3-7)){var a=o.measureText(e.txt);s(o,d,r-7-3,a.width+6,23,3),o.fillText(e.txt,d+3,r+2),c>=l&&c<e.val&&(u=(l+e.val)/2),l=e.val}}));var h=o.measureText(r),p=i.y(u);s(o,d,p-3-7,h.width+6,20,3),o.fillText(r,d+3,i.y(u))}),!0)}},{key:"plotYGrid",value:function(e,t,n,r){var a=this,o=new un(0,1,n,r);e.plot(o,(function(e,n){e.lineWidth=1,e.strokeStyle=a.theme.gridLines,t.lbls.forEach((function(t){vn(e,n.x(0),n.y(t.val),n.x(1),n.y(t.val))}))}),!0)}},{key:"makeYLabels",value:function(e,t,n,r){this.applyLabelStyle();var a=hn(this.ctx,e.height(),this.dataExtents.y.min,this.dataExtents.y.max,50,t,n,r),o=(a.widest||0)+20;return this.yRegion.extents.x.max=o,this.yRegion.extents.y.max=e.extents.y.max,a}},{key:"line",value:function(e,t,n,r,a){vn(this.ctx,e,t,n,r,a)}},{key:"dot",value:function(e,t,n,r){mn(this.ctx,e,t,n,r)}}]),e}(),sn=function(e){g(n,e);var t=Yt(n);function n(e,r,a){var o;return i(this,n),h(v(o=t.call(this,e,{resize:function(){return o.resized()},click:function(e){return o.clicked(e)},zoom:function(e){return o.zoomed(e)}})),"reporters",void 0),h(v(o),"book",void 0),h(v(o),"zoomLevel",void 0),h(v(o),"lotSize",void 0),h(v(o),"conventionalRateStep",void 0),h(v(o),"lines",void 0),h(v(o),"markers",void 0),h(v(o),"zoomInBttn",void 0),h(v(o),"zoomOutBttn",void 0),h(v(o),"baseUnit",void 0),h(v(o),"quoteUnit",void 0),o.reporters=r,o.zoomLevel=a,o.lines=[],o.markers={buys:[],sells:[]},o.setZoomBttns(),o.resize(),o}return d(n,[{key:"setZoomBttns",value:function(){this.zoomInBttn=new dn(this.ctx,new un(0,0,0,0)),this.zoomOutBttn=new dn(this.ctx,new un(0,0,0,0))}},{key:"resized",value:function(){this.setZoomBttns(),this.book&&this.draw()}},{key:"zoomed",value:function(e){this.zoomLevel&&this.book.buys&&this.book.sells&&(this.wheeled(),this.zoomLevel*=e?2/3:1.5,this.zoomLevel=tt(this.zoomLevel,.005,2),this.draw(),this.reporters.zoom(this.zoomLevel))}},{key:"clicked",value:function(e){if(this.dataExtents){var t=e.clientX-this.rect.left,n=e.clientY-this.rect.y;if(this.zoomInBttn.contains(t,n))this.zoom(!0);else if(this.zoomOutBttn.contains(t,n))this.zoom(!1);else{var r=this.plotRegion.translator(this.dataExtents);this.reporters.click(r.unx(t))}}}},{key:"set",value:function(e,t,n,r,o){if(this.book=e,this.lotSize=t/r.conventional.conversionFactor,this.conventionalRateStep=qe.conventionalRateStep(n,r,o),this.baseUnit=r.conventional.unit,this.quoteUnit=o.conventional.unit,!this.zoomLevel){var s=a(this.gap(),2),i=s[0],c=s[1],l=Math.max(c/i*5,.05);this.zoomLevel=Math.min(l,2)}this.draw()}},{key:"render",value:function(){var e=this;if(this.book&&this.visible&&0!==this.canvas.width){this.clear();var t=this.ctx,n=this.mousePos,o=this.book.buys,s=this.book.sells,i=a(this.gap(),2),c=i[0],l=i[1],u=this.zoomLevel*c/2,d=c+u,h=c-u,p=r(this.markers.buys),f=r(this.markers.sells);p.sort((function(e,t){return t.rate-e.rate})),f.sort((function(e,t){return e.rate-t.rate}));for(var v=[],m=[],g=[],y=[],b=[],x={buyBase:0,buyQuote:0,sellBase:0,sellQuote:0},k=0,w=0,C=0;C<o.length;C++){var S=o[C];if(w+=S.qty,S.rate>=h&&g.push([S.rate,w]),!S.epoch)for(k+=S.qty,m.push([S.rate,k]),x.buyBase+=S.qty,x.buyQuote+=S.qty*S.rate;p.length&&gn(p[0].rate,S.rate);){var F=p.shift();F&&v.push({rate:F.rate,qty:S.epoch?w:k,sell:S.sell,active:F.active})}}var D=m.length?fn(m)[1]:0;m.push([h,D]);var T=g.length?fn(g)[1]:0;g.push([h,T]),w=k=0;for(var I=0;I<s.length;I++){var A=s[I];if(w+=A.qty,A.rate<=d&&b.push([A.rate,w]),!A.epoch)for(k+=A.qty,y.push([A.rate,k]),x.sellBase+=A.qty,x.sellQuote+=A.qty*A.rate;f.length&&gn(f[0].rate,A.rate);){var R=f.shift();R&&v.push({rate:R.rate,qty:A.epoch?w:k,sell:A.sell,active:R.active})}}var E=y.length?fn(y)[1]:0;y.push([d,E]);var B=b.length?fn(b)[1]:0;b.push([d,B]);var P=this.xRegion.extents.y.min,L=(P+40)/P,O=(B&&T?Math.max(T,B):B||T||1)*L,M=new un(h,d,0,O);this.dataExtents=M;var q=null,N=hn(t,this.plotRegion.width(),M.x.min,M.x.max,100,this.conventionalRateStep,"");this.plotXGrid(N,h,d);var W=this.makeYLabels(this.plotRegion,this.lotSize,this.baseUnit);this.plotYGrid(this.plotRegion,W,this.dataExtents.y.min,this.dataExtents.y.max),this.plotRegion.plot(M,(function(t,r){t.lineWidth=1,t.strokeStyle=e.theme.gridBorder,t.lineWidth=2.5,t.strokeStyle=e.theme.gapLine,vn(t,r.x(c),r.y(0),r.x(c),r.y(.3*M.y.max)),t.font="30px 'demi-sans', sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillStyle=e.theme.value;var a=.5*M.y.max;t.fillText(qe.formatFourSigFigs(c),r.x(c),r.y(a)),t.font="12px 'sans', sans-serif",t.fillText("".concat((l/c*100).toFixed(2),"% spread"),r.x(c),r.y(a)+24),t.textAlign="center",t.textBaseline="middle";var o=e.plotRegion.extents.midX,s=r.y(.9*O),i=M.xRange/c*100,u="".concat(i.toFixed(1),"%"),p=t.measureText(u).width;t.font="13px 'sans', sans-serif",t.fillText(u,o,s+1);var f=o-p/2-10-20,g=s-10;e.zoomOutBttn.setExtents(f,f+20,g,g+20);var b=n&&e.zoomOutBttn.contains(n.x,n.y);e.zoomOutBttn.plot(new un(0,1,0,1),(function(t){t.font="12px 'icomoon'",t.fillStyle=e.theme.zoom,b&&(t.fillStyle=e.theme.zoomHover,t.font="13px 'icomoon'"),t.fillText(nn,e.zoomOutBttn.extents.midX,e.zoomOutBttn.extents.midY)})),f=o+p/2+10,e.zoomInBttn.setExtents(f,f+20,g,g+20),b=n&&e.zoomInBttn.contains(n.x,n.y),e.zoomInBttn.plot(new un(0,1,0,1),(function(t){t.font="12px 'icomoon'",t.fillStyle=e.theme.zoom,b&&(t.fillStyle=e.theme.zoomHover,t.font="14px 'icomoon'"),t.fillText(tn,e.zoomInBttn.extents.midX,e.zoomInBttn.extents.midY)}));for(var x=.005*(d-h),k=[],w=0,C=v||[];w<C.length;w++){var S=C[w],F=n&&yn(S.rate,r.unx(n.x),x);F&&k.push(S.rate),t.save(),t.lineWidth=F||S.active?5:3,t.strokeStyle=S.sell?e.theme.sellLine:e.theme.buyLine,t.fillStyle=S.sell?e.theme.sellFill:e.theme.buyFill;var D=F||S.active?10:8;t.beginPath();var T={x:r.x(S.rate),y:r.y(S.qty)-8},I=T.y-Math.sqrt(3)*D/2;t.moveTo(T.x,T.y),t.lineTo(T.x-D/2,I),t.lineTo(T.x+D/2,I),t.closePath(),t.stroke(),t.fill(),t.restore()}if(n&&e.plotRegion.contains(n.x,n.y)){var A=r.unx(n.x),R=y,E=function(e){return e>=A},B=e.theme.sellLine;A<c&&(R=m,E=function(e){return e<=A},B=e.theme.buyLine);for(var P,L,N=R[0],W=0;W<R.length;W++){var V=R[W];if(E(V[0]))break;N=V}P=A,L=e.theme.crosshairs,P>d||P<h||(t.save(),t.setLineDash([3,5]),t.lineWidth=1.5,t.strokeStyle=L,vn(t,r.x(P),r.y(0),r.x(P),r.y(O)),t.restore()),q={rate:A,depth:N[1],dotColor:B,hoverMarkers:k}}})),t.lineWidth=1.5,t.setLineDash([3,3]),t.fillStyle=this.theme.sellFill,t.strokeStyle=this.theme.sellLine,this.drawDepth(b),t.fillStyle=this.theme.buyFill,t.strokeStyle=this.theme.buyLine,this.drawDepth(g),t.lineWidth=2.5,t.setLineDash([]),t.fillStyle=this.theme.sellFill,t.strokeStyle=this.theme.sellLine,this.drawDepth(y),t.fillStyle=this.theme.buyFill,t.strokeStyle=this.theme.buyLine,this.drawDepth(m),this.plotYLabels(W,this.dataExtents.y.min,this.dataExtents.y.max,this.baseUnit),this.plotXLabels(N,h,d,["".concat(this.quoteUnit,"/"),this.baseUnit]),q&&this.plotRegion.plot(M,(function(e,t){q&&mn(e,t.x(q.rate),t.y(q.depth),q.dotColor,5)})),this.reporters.volume(x),this.reporters.mouse(q)}else this.renderScheduled=!0}},{key:"drawDepth",value:function(e){var t,n=e[0];this.plotRegion.plot(this.dataExtents,(function(r,a){var o=a.y(0),s=a.y(n[1]);r.beginPath(),r.moveTo(a.x(n[0]),a.y(n[1]));for(var i=0;i<e.length;i++)t=a.x(e[i][0]),r.lineTo(t,s),s=a.y(e[i][1]),r.lineTo(t,s);r.stroke(),r.lineTo(t,o),r.lineTo(a.x(n[0]),o),r.closePath(),r.globalAlpha=.25,r.fill()}))}},{key:"gap",value:function(){var e=[this.book.bestGapBuy(),this.book.bestGapSell()],t=e[0],n=e[1];return t?n?[(n.rate+t.rate)/2,n.rate-t.rate]:[t.rate,0]:n?[n.rate,0]:[1,0]}},{key:"setLines",value:function(e){this.lines=e}},{key:"setMarkers",value:function(e){this.markers=e}}]),n}(on),cn=function(e){g(n,e);var t=Yt(n);function n(e,r){var a;return i(this,n),h(v(a=t.call(this,e,{resize:function(){return a.resized()},click:function(){a.clicked()},zoom:function(e){return a.zoomed(e)}})),"reporters",void 0),h(v(a),"data",void 0),h(v(a),"zoomLevel",void 0),h(v(a),"numToShow",void 0),h(v(a),"candleRegion",void 0),h(v(a),"volumeRegion",void 0),h(v(a),"resizeTimer",void 0),h(v(a),"zoomLevels",void 0),h(v(a),"market",void 0),h(v(a),"rateConversionFactor",void 0),a.reporters=r,a.zoomLevel=1,a.numToShow=100,a.resize(),a}return d(n,[{key:"resized",value:function(){var e=this,t=this.plotRegion.extents,n=new un(t.x.min,t.x.max,t.y.min,t.y.min+.85*t.yRange);this.candleRegion=new dn(this.ctx,n);var r=new un(t.x.min,t.x.max,t.y.min+.85*t.yRange,t.y.max);this.volumeRegion=new dn(this.ctx,r),this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout((function(){return e.draw()}),100)}},{key:"clicked",value:function(){}},{key:"zoomed",value:function(e){var t=this.zoomLevels.indexOf(this.numToShow);if(e){if(0===t)return;this.numToShow=this.zoomLevels[t-1]}else{if(this.zoomLevels.length<=t+1||this.numToShow>this.data.candles.length)return;this.numToShow=this.zoomLevels[t+1]}this.draw()}},{key:"render",value:function(){var e,t=this,n=this.data;if(n&&this.visible&&0!==this.canvas.width){var r=n.ms,a=this.mousePos,o=n.candles||[],s=Math.min(this.numToShow,o.length),i=o.slice(o.length-s);if(this.clear(),0!==s){var c,l=function(e){return bn(e.endStamp,r)},u=function(e){return l(e)+r},d=function(e){return l(e)+.2*r},h=.6*r,p=i[0],f=i[s-1],v=[p.highRate,p.lowRate,p.matchVolume],m=v[0],g=v[1],y=v[2],b=Jt(i);try{for(b.s();!(c=b.n()).done;){var x=c.value;x.highRate>m&&(m=x.highRate),x.lowRate<g&&(g=x.lowRate),x.matchVolume>y&&(y=x.matchVolume)}}catch(e){b.e(e)}finally{b.f()}m+=.1*(m-g);var k=l(p),w=u(f);w+=.05*(w-k);var C=this.market.ratestep,S=new un(k,w,g,m);g===m&&(S.y.min-=C,S.y.max+=C),this.dataExtents=S;var F=null;a&&this.plotRegion.plot(new un(S.x.min,S.x.max,0,1),(function(e,n){var o,s=bn(n.unx(a.x),r),c=Jt(i);try{for(c.s();!(o=c.n()).done;){var u=o.value;if(l(u)===s){F=u,e.fillStyle=t.theme.gridLines,e.fillRect(n.x(l(u)),n.y(0),n.w(r),n.h(1));break}}}catch(e){c.e(e)}finally{c.f()}}));var D=this.rateConversionFactor,T=(null===(e=pt().assets[this.market.baseid])||void 0===e?void 0:e.unitInfo.conventional.unit)||this.market.basesymbol.toUpperCase(),I=function(e,t,n,r){var a=e[0],o=e[e.length-1],s=bn(a.endStamp,t),i=bn(o.endStamp,t)+t,c=i-s,l=Math.min(e.length,n/100),u=bn(c/l,t);if(0===u)return console.error("zero tick",t,c,l),{lbls:[]};var d=s,h=(new Date).getTimezoneOffset(),p=function(e){return(e-=6e4*h)-e%864e5},f=p(s),v=0;p(a.endStamp)===p(o.endStamp)&&(f=0);var m,g=[];for(m=t<864e5?function(e,t){return p(t)!==f?"".concat(pn[e.getMonth()]).concat(e.getDate()," ").concat(e.getHours(),":").concat(String(e.getMinutes()).padStart(2,"0")):"".concat(e.getHours(),":").concat(String(e.getMinutes()).padStart(2,"0"))}:function(e){var t=e.getFullYear();return t!==v?"".concat(pn[e.getMonth()]).concat(e.getDate()," '").concat(String(t).slice(2,4)):"".concat(pn[e.getMonth()]).concat(e.getDate())};d<=i;){var y=new Date(d);g.push({val:d,txt:m(y,d)}),f=p(d),v=y.getFullYear(),d+=u}return{lbls:g}}(i,r,this.plotRegion.width());this.plotXGrid(I,k,w);var A=this.makeYLabels(this.candleRegion,C,T,(function(e){return qe.formatFourSigFigs(e/D)}));this.plotYGrid(this.candleRegion,A,this.dataExtents.y.min,this.dataExtents.y.max);var R=new un(k,w,0,y);if(this.volumeRegion.plot(R,(function(e,n){e.fillStyle=t.theme.gridBorder;var r,a=Jt(i);try{for(a.s();!(r=a.n()).done;){var o=r.value;e.fillRect(n.x(d(o)),n.y(0),n.w(h),n.h(o.matchVolume))}}catch(e){a.e(e)}finally{a.f()}})),this.candleRegion.plot(S,(function(e,n){e.lineWidth=1;var r,a=Jt(i);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.startRate>o.endRate,c=[n.x(d(o)),n.y(o.startRate),n.w(h),n.h(o.endRate-o.startRate)],l=c[0],u=c[1],p=c[2],f=c[3],v=[n.y(o.highRate),n.y(o.lowRate),p/2+l],m=v[0],g=v[1],y=v[2];e.strokeStyle=s?t.theme.sellLine:t.theme.buyLine,e.fillStyle=s?t.theme.sellFill:t.theme.buyFill,e.beginPath(),e.moveTo(y,m),e.lineTo(y,g),e.stroke(),e.fillRect(l,u,p,f),e.strokeRect(l,u,p,f)}}catch(e){a.e(e)}finally{a.f()}})),this.plotXLabels(I,k,w,[]),this.plotYLabels(A,this.dataExtents.y.min,this.dataExtents.y.max,T),F){var E=this.xRegion.extents.y;this.xRegion.plot(new un(S.x.min,S.x.max,E.min,E.max),(function(e,n){if(F){t.applyLabelStyle();var r="".concat(new Date(l(F)).toLocaleString()," - ").concat(new Date(u(F)).toLocaleString()),a=e.measureText(r).width+50,o=n.x((l(F)+u(F))/2),s=o-a/2,i=t.xRegion.extents.x;s<i.min?s=i.min:s+a>i.max&&(s=i.max-a),o=s+a/2;var c=E.min+(t.xRegion.height()-16)/2;e.fillStyle=t.theme.legendFill,e.strokeStyle=t.theme.gridBorder;var d=[s-25,c-2,a+50,20];e.fillRect.apply(e,d),e.strokeRect.apply(e,d),t.applyLabelStyle(),e.fillText(r,o,t.xRegion.extents.midY,a)}}))}this.reporters.mouse(F)}}else this.renderScheduled=!0}},{key:"setCandles",value:function(e,t,n,r){if(this.data=e,e.candles){this.market=t;var a=[r.conventional.conversionFactor,n.conventional.conversionFactor],o=a[0],s=a[1];this.rateConversionFactor=qt*o/s;var i=25;this.zoomLevels=[];for(var c=Math.max(e.candles.length,1e3);i<c;)this.zoomLevels.push(i),i*=2;this.numToShow=100,this.draw()}}}]),n}(on),ln=function(e){g(n,e);var t=Yt(n);function n(e,r){var a;i(this,n),h(v(a=t.call(this,e,{resize:function(){return a.resized()},click:function(){},zoom:function(){}})),"ani",void 0),h(v(a),"size",void 0),h(v(a),"region",void 0),h(v(a),"colorShift",void 0),h(v(a),"opts",void 0),h(v(a),"msgRegion",void 0),h(v(a),"fontSize",void 0),a.canvas.classList.add("fill-abs"),a.canvas.style.zIndex="5",a.opts=null!=r?r:{};var o=1500*Math.random();a.colorShift=360*Math.random();var s=[1,.65,.75],c=[3,3,2],l=[Math.PI,10*Math.PI/9,Math.PI/2.5],u=[0,0,1.5*Math.PI],d=function(e,t,n){return s[e]*Math.cos(c[e]*t+l[e]*n+u[e])},p=function(e,t){var n=e*Math.PI*2;return(d(0,n,t)+d(1,n,t)+d(2,n,t))/3};return a.resize(),a.ani=new Ne(Ne.Forever,(function(){for(var e=((new Date).getTime()-o)/1500*Math.PI*2,t=[],n=0;n<75;n++)t.push(p(n/74,e));a.drawValues(t)})),a}return d(n,[{key:"resized",value:function(){var e=this.opts,t=[this.canvas.width,this.canvas.height],n=t[0],r=t[1],a=.8*n,o=.8*r;a>150&&(a=150),o>100&&(o=100);var s=(n-a)/2,i=(r-o)/2;if(e.message){this.fontSize=tt(.15*o,10,14),this.applyLabelStyle(this.fontSize);var c=.5*this.fontSize,l=this.fontSize/2+c;i-=l,this.msgRegion=new dn(this.ctx,new un(0,n,i+o,i+o+2*l))}this.region=new dn(this.ctx,new un(s,s+a,i,i+o))}},{key:"drawValues",value:function(e){var t=this;if(this.region){this.clear();var n=function(e){return"hsl(".concat(e,", 35%, 50%)")},r=this.region,a=this.msgRegion,o=this.canvas,s=o.width,i=o.height,c=this.opts,l=c.backgroundColor,u=c.message,d=this.colorShift,h=this.ctx;l&&(h.fillStyle=!0===l?k.isDark()?"#0a1e34":"#f0f0f0":l,h.fillRect(0,0,s,i)),r.plot(new un(0,1,-1,1),(function(t,r){t.lineWidth=4,t.lineCap="round";var a=d+(new Date).getTime()%2e3/2e3*360,o=t.createLinearGradient(r.x(0),0,r.x(1),0);o.addColorStop(0,n(a)),t.strokeStyle=o,t.beginPath(),t.moveTo(r.x(0),r.y(e[0]));for(var s=1;s<e.length;s++){var i=s/(e.length-1);o.addColorStop(i,n(300*i+a)),t.lineTo(r.x(i),r.y(e[s]))}t.stroke()})),u&&a.plot(new un(0,1,0,1),(function(e,n){t.applyLabelStyle(t.fontSize),e.fillText(u,n.x(.5),n.y(.5),t.msgRegion.width())}))}}},{key:"render",value:function(){}},{key:"stop",value:function(){this.ani.stop(),this.canvas.remove()}}]),n}(on),un=function(){function e(t,n,r,a){i(this,e),h(this,"x",void 0),h(this,"y",void 0),this.setExtents(t,n,r,a)}return d(e,[{key:"setExtents",value:function(e,t,n,r){this.x={min:e,max:t},this.y={min:n,max:r}}},{key:"xRange",get:function(){return this.x.max-this.x.min}},{key:"midX",get:function(){return(this.x.max+this.x.min)/2}},{key:"yRange",get:function(){return this.y.max-this.y.min}},{key:"midY",get:function(){return(this.y.max+this.y.min)/2}}]),e}(),dn=function(){function e(t,n){i(this,e),h(this,"context",void 0),h(this,"extents",void 0),this.context=t,this.extents=n}return d(e,[{key:"setExtents",value:function(e,t,n,r){this.extents.setExtents(e,t,n,r)}},{key:"width",value:function(){return this.extents.xRange}},{key:"height",value:function(){return this.extents.yRange}},{key:"contains",value:function(e,t){var n=this.extents;return e<n.x.max&&e>n.x.min&&t<n.y.max&&t>n.y.min}},{key:"translator",value:function(e){var t=this.extents,n=e.x.min,r=e.y.min,a=e.yRange,o=e.xRange,s=t.x.min,i=t.x.max-s,c=t.y.max,l=c-t.y.min,u=i/o,d=l/a;return{x:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return(e-n)*u+s})),y:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return c-(e-r)*d})),unx:function(e){return(e-s)/u+n},uny:function(e){return r-(e-c)/d},w:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return e/o*i})),h:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return-e/a*l}))}}},{key:"clear",value:function(){var e=this.extents;this.context.clearRect(e.x.min,e.y.min,e.xRange,e.yRange)}},{key:"plot",value:function(e,t,n){var r=this.context,a=this.extents;r.save(),n||(r.beginPath(),r.rect(a.x.min,a.y.min,a.xRange,a.yRange),r.clip());var o=this.translator(e);t(this.context,o),r.restore()}}]),e}();function hn(e,t,n,r,a,o,s,i){i=i||qe.formatFourSigFigs;var c=t/a,l=r-n;if(c<1||l<=0)return{lbls:[]};for(var u=l/c,d=u+o-u%o,h=n+d-n%d,p=Math.max(Math.abs(r),Math.abs(n)),f=Math.round(Math.log10(p/d))+2,v=[],m=0;h<r;){var g=i(h=Number(h.toPrecision(f)));m=Math.max(m,e.measureText(g).width),v.push({val:h,txt:g}),h+=d}var y=e.measureText(s).width;return y>m&&(m=y),{widest:m,lbls:v}}var pn=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];function fn(e){return e[e.length-1]}function vn(e,t,n,r,a,o){e.beginPath(),e.moveTo(t,n),e.lineTo(r,a),o||e.stroke()}function mn(e,t,n,r,a){e.fillStyle=r,e.beginPath(),e.arc(t,n,a,0,en),e.fill()}function gn(e,t){return yn(e,t,1e-8)}function yn(e,t,n){return Math.abs(e-t)<Math.abs(n)}function bn(e,t){return e-e%t}function xn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return kn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function kn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var wn=3,Cn=function(){function e(t){i(this,e),h(this,"page",void 0),h(this,"host",void 0),this.page=qe.parseTemplate(t),qe.cleanTemplates(this.page.penaltyMarkerTmpl)}return d(e,[{key:"setHost",value:function(e){this.host=e}},{key:"update",value:function(){var e=this.page,t=this.host,n=pt().exchanges[t],r=n.auth,a=n.maxScore,o=n.penaltyThreshold,s=r.rep.score,i=Sn(r),c=i?i*o*-1:-1*o,l=25;e.scoreWarn.style.width="".concat(l,"%");var u=s>=0?l+s/a*75:l-Math.min(l,s/c*l);e.scorePointer.style.left="".concat(u,"%"),e.scoreMin.textContent=String(c),e.scoreMax.textContent=String(a);var d=Wn(s,a);e.limitBonus.textContent=d.toFixed(1);var h,p=xn(qe.applySelector(e.scoreTray,".penalty-marker"));try{for(p.s();!(h=p.n()).done;)h.value.remove()}catch(e){p.e(e)}finally{p.f()}if(i>1)for(var f=l/i,v=1;v<i;v++){var m=e.penaltyMarkerTmpl.cloneNode(!0);e.scoreTray.appendChild(m),m.style.left="".concat(f*v,"%")}e.score.textContent=String(s),e.scoreData.classList.remove("negative","positive"),s>0?e.scoreData.classList.add("positive"):e.scoreData.classList.add("negative")}}]),e}();function Sn(e){var t=e.weakStrength,n=e.targetTier,r=e.effectiveTier;if(r>n){var a=r-n;return t>=a?n:n+(a-t)}return r}var Fn,Dn,Tn,In,An,Rn,En,Bn,Pn,Ln,On,Mn,qn=function(e,t,n){var r,a,o=e.qty-e.filled;if(1===e.type)return o;if(e.sell)return o*e.rate/qt;var s=n||(null==t||null===(r=t.spot)||void 0===r?void 0:r.rate)||0;return t?s&&((null==t||null===(a=t.spot)||void 0===a?void 0:a.bookVolume)||0)>0?o*qt/s:t.lotsize:0};function Nn(e,t,n){return 3===e.type?0:function(e,t,n){var r;if(e.status!==It)return 0;var a=qn(e,t,n);return function(e,t){return e.type===Dt||e.tif===Tt||0!==t&&(e.sell?e.rate<t:e.rate>t)}(e,n||(null===(r=t.spot)||void 0===r?void 0:r.rate)||0)?2*a:a}(e,t,n)+function(e){return e.status!==At?0:qn(e)}(e)+function(e){var t,n=0,r=xn(e.matches||[]);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(a.side===Mt){if(a.status>Bt)continue}else if(a.status>Et)continue;n+=a.qty}}catch(e){r.e(e)}finally{r.f()}return n}(e)}function Wn(e,t){return e>0?1+e/t*(wn-1):1}var Vn="TakerFoundMakerRedemption:";function Un(e){return e.startsWith(Vn)?[e.substring(Vn.length),!0]:42===e.length?[e,!0]:[e,!1]}var _n=(h(Fn={},0,(function(e){var t=a(Un(e),2),n=t[0];return t[1]?"https://etherscan.io/address/".concat(n):"https://etherscan.io/tx/".concat(n)})),h(Fn,1,(function(e){var t=a(Un(e),2),n=t[0];return t[1]?"https://sepolia.etherscan.io/address/".concat(n):"https://sepolia.etherscan.io/tx/".concat(n)})),h(Fn,2,(function(e){var t=a(Un(e),2),n=t[0];return t[1]?"https://etherscan.io/address/".concat(n):"https://etherscan.io/tx/".concat(n)})),Fn),jn=(h(Dn={},0,(function(e){var t=a(Un(e),2),n=t[0];return t[1]?"https://polygonscan.com/address/".concat(n):"https://polygonscan.com/tx/".concat(n)})),h(Dn,1,(function(e){var t=a(Un(e),2),n=t[0];return t[1]?"https://amoy.polygonscan.com/address/".concat(n):"https://amoy.polygonscan.com/tx/".concat(n)})),h(Dn,2,(function(e){var t=a(Un(e),2),n=t[0];return t[1]?"https://polygonscan.com/address/".concat(n):"https://polygonscan.com/tx/".concat(n)})),Dn),Hn={42:(Tn={},h(Tn,0,(function(e){var t=a(e.split(":"),2),n=t[0],r=t[1];return void 0!==r?"https://explorer.dcrdata.org/tx/".concat(n,"/out/").concat(r):"https://explorer.dcrdata.org/tx/".concat(n)})),h(Tn,1,(function(e){var t=a(e.split(":"),2),n=t[0],r=t[1];return void 0!==r?"https://testnet.dcrdata.org/tx/".concat(n,"/out/").concat(r):"https://testnet.dcrdata.org/tx/".concat(n)})),h(Tn,2,(function(e){var t=a(e.split(":"),2),n=t[0],r=t[1];return void 0!==r?"http://127.0.0.1:17779/tx/".concat(n,"/out/").concat(r):"https://127.0.0.1:17779/tx/".concat(n)})),Tn),0:(In={},h(In,0,(function(e){return"https://mempool.space/tx/".concat(e.split(":")[0])})),h(In,1,(function(e){return"https://mempool.space/testnet/tx/".concat(e.split(":")[0])})),h(In,2,(function(e){return"https://mempool.space/tx/".concat(e.split(":")[0])})),In),2:(An={},h(An,0,(function(e){return"https://ltc.bitaps.com/".concat(e.split(":")[0])})),h(An,1,(function(e){return"https://sochain.com/tx/LTCTEST/".concat(e.split(":")[0])})),h(An,2,(function(e){return"https://ltc.bitaps.com/".concat(e.split(":")[0])})),An),20:(Rn={},h(Rn,0,(function(e){return"https://digiexplorer.info/tx/".concat(e.split(":")[0])})),h(Rn,1,(function(e){return"https://testnetexplorer.digibyteservers.io/tx/".concat(e.split(":")[0])})),h(Rn,2,(function(e){return"https://digiexplorer.info/tx/".concat(e.split(":")[0])})),Rn),60:_n,60001:_n,60002:_n,3:(En={},h(En,0,(function(e){return"https://dogeblocks.com/tx/".concat(e.split(":")[0])})),h(En,1,(function(e){return"https://blockexplorer.one/dogecoin/testnet/tx/".concat(e.split(":")[0])})),h(En,2,(function(e){return"https://dogeblocks.com/tx/".concat(e.split(":")[0])})),En),5:(Bn={},h(Bn,0,(function(e){return"https://blockexplorer.one/dash/mainnet/tx/".concat(e.split(":")[0])})),h(Bn,1,(function(e){return"https://blockexplorer.one/dash/testnet/tx/".concat(e.split(":")[0])})),h(Bn,2,(function(e){return"https://blockexplorer.one/dash/mainnet/tx/".concat(e.split(":")[0])})),Bn),133:(Pn={},h(Pn,0,(function(e){return"https://zcashblockexplorer.com/transactions/".concat(e.split(":")[0])})),h(Pn,1,(function(e){return"https://blockexplorer.one/zcash/testnet/tx/".concat(e.split(":")[0])})),h(Pn,2,(function(e){return"https://zcashblockexplorer.com/transactions/".concat(e.split(":")[0])})),Pn),147:(Ln={},h(Ln,0,(function(e){return"https://explorer.zcl.zelcore.io/tx/".concat(e.split(":")[0])})),h(Ln,2,(function(e){return"https://explorer.zcl.zelcore.io/tx/".concat(e.split(":")[0])})),Ln),136:(On={},h(On,0,(function(e){return"https://explorer.firo.org/tx/".concat(e.split(":")[0])})),h(On,1,(function(e){return"https://testexplorer.firo.org/tx/".concat(e.split(":")[0])})),h(On,2,(function(e){return"https://explorer.firo.org/tx/".concat(e.split(":")[0])})),On),145:(Mn={},h(Mn,0,(function(e){return"https://bch.loping.net/tx/".concat(e.split(":")[0])})),h(Mn,1,(function(e){return"https://tbch4.loping.net/tx/".concat(e.split(":")[0])})),h(Mn,2,(function(e){return"https://bch.loping.net/tx/".concat(e.split(":")[0])})),Mn),966:jn,966001:jn,966002:jn,966003:jn,966004:jn};function zn(e){return e.startsWith(Vn)?xe("TAKER_FOUND_MAKER_REDEMPTION",{makerAddr:e.substring(Vn.length)}):e}function Gn(e,t){var n=pt().user.net,r=Hn[function(e){var t=pt().user.assets[e];return t.token?t.token.parentID:e}(e)];if(r){var a=r[n];a&&(t.classList.remove("plainlink"),t.classList.add("subtlelink"),t.href=a(t.dataset.explorerCoin||""))}}function Xn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Kn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xn(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Yn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function Yn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Jn="multiplier",Zn="absolute",$n="absolute-plus",er="percent",tr="percent-plus",nr="basicMM",rr="arbMM",ar="basicArb",or={Binance:{name:"Binance",logo:"/img/binance.com.png"},BinanceUS:{name:"Binance U.S.",logo:"/img/binance.us.png"}},sr=new(function(){function e(){i(this,e),h(this,"cexBalanceCache",{})}var t,n,r,a,o,c,l,u;return d(e,[{key:"updateBotConfig",value:(u=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S("/api/updatebotconfig",t));case 1:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"updateCEXConfig",value:(l=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S("/api/updatecexconfig",t));case 1:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"removeBotConfig",value:(c=s(f().mark((function e(t,n,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S("/api/removebotconfig",{host:t,baseID:n,quoteID:r}));case 1:case"end":return e.stop()}}),e)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"report",value:(o=s(f().mark((function e(t,n,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S("/api/marketreport",{host:t,baseID:n,quoteID:r}));case 1:case"end":return e.stop()}}),e)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"startBot",value:(a=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("/api/startmarketmakingbot",{config:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"stopBot",value:(r=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("/api/stopmarketmakingbot",{market:t});case 2:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"status",value:(n=s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D("/api/marketmakingstatus");case 2:return e.abrupt("return",e.sent.status);case 3:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"botStats",value:function(e,t,n,r){for(var a=0,o=Object.values(pt().mmStatus.bots);a<o.length;a++){var s=o[a];if(s.runStats){var i=s.runStats,c=s.config;if(c.baseID===e&&c.quoteID===t&&c.host===n&&i.startTime===r)return i}}}},{key:"cachedCexBalance",value:function(e,t){var n;return null===(n=this.cexBalanceCache[e])||void 0===n?void 0:n[t]}},{key:"cexBalance",value:(t=s(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cexBalanceCache[t]||(this.cexBalanceCache[t]={}),e.next=3,S("/api/cexbalance",{cexName:t,assetID:n});case 3:return r=e.sent.cexBalance,this.cexBalanceCache[t][n]=r,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}());function ir(e){return pt().mmStatus.bots.reduce((function(t,n){var r,a,o,s,i,c,l,u,d,h,p,f,v,m,g,y,b,x,k,w,C=n.runStats;if(!n.running||!C)return t;var S=C.dexBalances,F=C.cexBalances;return t.cex.locked+=null!==(r=null===(a=F[e])||void 0===a?void 0:a.locked)&&void 0!==r?r:0,t.cex.locked+=null!==(o=null===(s=F[e])||void 0===s?void 0:s.reserved)&&void 0!==o?o:0,t.cex.avail+=null!==(i=null===(c=F[e])||void 0===c?void 0:c.available)&&void 0!==i?i:0,t.cex.total=t.cex.avail+t.cex.locked,t.dex.locked+=null!==(l=null===(u=S[e])||void 0===u?void 0:u.locked)&&void 0!==l?l:0,t.dex.locked+=null!==(d=null===(h=S[e])||void 0===h?void 0:h.reserved)&&void 0!==d?d:0,t.dex.avail+=null!==(p=null===(f=S[e])||void 0===f?void 0:f.available)&&void 0!==p?p:0,t.dex.total=t.dex.avail+t.dex.locked,t.avail+=(null!==(v=null===(m=S[e])||void 0===m?void 0:m.available)&&void 0!==v?v:0)+(null!==(g=null===(y=F[e])||void 0===y?void 0:y.available)&&void 0!==g?g:0),t.locked+=(null!==(b=null===(x=S[e])||void 0===x?void 0:x.locked)&&void 0!==b?b:0)+(null!==(k=null===(w=F[e])||void 0===w?void 0:w.locked)&&void 0!==k?k:0),t}),{avail:0,locked:0,cex:{avail:0,locked:0,total:0},dex:{avail:0,locked:0,total:0}})}function cr(e,t,n,r){qe.setText(e,"[data-host]",r);var a=pt().assets[t],o=a.unitInfo,s=a.name,i=a.symbol,c=a.token;qe.setText(e,"[data-base-name]",s),qe.setSrc(e,"[data-base-logo]",qe.logoPath(i)),qe.setText(e,"[data-base-ticker]",o.conventional.unit);var l=pt().assets[c?c.parentID:t],u=l.unitInfo,d=l.name,h=l.symbol;qe.setText(e,"[data-base-fee-name]",d),qe.setSrc(e,"[data-base-fee-logo]",qe.logoPath(h)),qe.setText(e,"[data-base-fee-ticker]",u.conventional.unit);var p=pt().assets[n],f=p.unitInfo,v=p.name,m=p.symbol,g=p.token;qe.setText(e,"[data-quote-name]",v),qe.setSrc(e,"[data-quote-logo]",qe.logoPath(m)),qe.setText(e,"[data-quote-ticker]",f.conventional.unit);var y=pt().assets[g?g.parentID:n],b=y.unitInfo,x=y.name,k=y.symbol;qe.setText(e,"[data-quote-fee-name]",x),qe.setSrc(e,"[data-quote-fee-logo]",qe.logoPath(k)),qe.setText(e,"[data-quote-fee-ticker]",b.conventional.unit)}function lr(e,t){var n=or[t];qe.setText(e,"[data-cex-name]",n.name),qe.setSrc(e,"[data-cex-logo]",n.logo);var r,a=Qn(qe.applySelector(e,"[data-cex-logo]"));try{for(a.s();!(r=a.n()).done;){var o=r.value;qe.show(o)}}catch(e){a.e(e)}finally{a.f()}}function ur(e,t,n,r){var a=pt().fiatRatesMap[t],o=pt().fiatRatesMap[n],s=pt().assets[t].unitInfo.conventional.conversionFactor,i=pt().assets[n].unitInfo.conventional.conversionFactor;return a&&o?e*a/o*i/s:r?e*r.rate/qt:i}var dr=function(e){g(s,e);var t,n,o=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=b(t);if(n){var a=b(this).constructor;e=Reflect.construct(r,arguments,a)}else e=r.apply(this,arguments);return y(this,e)});function s(e){var t;return i(this,s),h(v(t=o.call(this,e,{resize:function(){return t.resized()},click:function(){},zoom:function(){}})),"cfg",void 0),h(v(t),"loadedCEX",void 0),h(v(t),"cexLogo",void 0),t}return d(s,[{key:"resized",value:function(){this.render()}},{key:"draw",value:function(){}},{key:"setMarket",value:function(e){var t=this;this.cfg=e;var n=this.loadedCEX,r=this.cfg.cexName;r&&r!==n&&(this.loadedCEX=r,this.cexLogo=new Image,qe.bind(this.cexLogo,"load",(function(){t.render()})),this.cexLogo.src=or[r||""].logo),this.render()}},{key:"render",value:function(){var e=this,t=this.ctx,n=this.canvas,o=this.theme,s=this.cfg;if(0!==n.width&&s){var i=s.dict,c=i.buyPlacements,l=i.sellPlacements,u=i.profit,d=s.baseFiatRate,h=s.botType;if(h!==ar){this.clear();var p=function(n,r,a,o,s){t.save(),t.setLineDash([3,5]),t.lineWidth=1.5,t.strokeStyle=s,e.line(n,r,a,o),t.restore()},f=h===nr,v=n.width/2,m=a(f?[v,v]:[.48*n.width,.52*n.width],2),g=m[0],y=m[1],b=c.reduce((function(e,t){return e+t.lots}),0),x=l.reduce((function(e,t){return e+t.lots}),0),k=Math.max(b,x),w=0,C=0;if(f){var S=c.reduce((function(e,t){return Math.max(e,t.gapFactor)}),0),F=l.reduce((function(e,t){return Math.max(e,t.gapFactor)}),0);w=Math.max(S,F)}else{var D=[].concat(r(c),r(l)),T=D.reduce((function(e,t){return e+t.gapFactor}),0)/D.length;C=.01*(1+T),w=Math.min(10,Math.max(c.length,l.length))*C}var I=u+w,A=Math.max(1.05*I,.155),R=k*d,E=.2+.7*Math.log(tt(R,0,1e6))/Math.log(1e6),B=new dn(t,new un(0,n.width,0,n.height));f?p(v,0,v,n.height,o.gapLine):B.plot(new un(0,1,0,1),(function(t,n){var r=[n.y(0),n.y(1)],a=r[0],s=r[1];p(g,a,g,s,o.gapLine),p(y,a,y,s,o.gapLine);var i=n.y(.95);t.drawImage(e.cexLogo,v-8,i,16,16),e.applyLabelStyle(18),t.fillText("δ",v,i+29)}));var P=function(e,r){if(null!=r&&r.length){var s=a(e?[0,g]:[y,n.width],2),i=s[0],c=s[1],l=new dn(t,new un(i,c,n.height*(1-E),n.height)),d=a(e?[-A,0]:[0,A],2),h=d[0],p=d[1];l.plot(new un(h,p,0,k),(function(t,a){t.lineWidth=2.5,t.strokeStyle=e?o.buyLine:o.sellLine,t.fillStyle=e?o.buyFill:o.sellFill,t.beginPath();var s=e?-1:1,i=r[0],c=a.y(0),l=a.x((f?i.gapFactor:u+C)*s);t.moveTo(l,c);for(var d=0,h=0;h<r.length;h++){var p=r[h],v=f?p.gapFactor:u+(h+1)*C,m=a.x(v*s);t.lineTo(m,a.y(d)),d+=p.lots,t.lineTo(m,a.y(d))}var g=e?-.1*n.width:1.1*n.width;t.lineTo(g,a.y(d)),t.stroke(),t.lineTo(g,c),t.lineTo(l,c),t.closePath(),t.globalAlpha=.25,t.fill()}),!0)}};P(!1,l),P(!0,c)}}}}]),s}(on);function hr(e,t,n){return"".concat(e,"-").concat(t,"-").concat(n)}function pr(e,t,n){var r=fr(e,t,n);if(r)return r.config}function fr(e,t,n){var r=(pt().mmStatus.bots||[]).filter((function(r){return r.config.baseID===t&&r.config.quoteID===n&&r.config.host===e}));if(r.length)return r[0]}function vr(e,t){return e+t.lots}var mr=function(){function e(t){i(this,e),h(this,"cfg",void 0),h(this,"host",void 0),h(this,"baseID",void 0),h(this,"baseSymbol",void 0),h(this,"baseTicker",void 0),h(this,"baseFeeID",void 0),h(this,"baseIsAccountLocker",void 0),h(this,"baseFeeSymbol",void 0),h(this,"baseFeeTicker",void 0),h(this,"baseToken",void 0),h(this,"quoteID",void 0),h(this,"quoteSymbol",void 0),h(this,"quoteTicker",void 0),h(this,"quoteFeeID",void 0),h(this,"quoteIsAccountLocker",void 0),h(this,"quoteFeeSymbol",void 0),h(this,"quoteFeeTicker",void 0),h(this,"quoteToken",void 0),h(this,"botType",void 0),h(this,"cexName",void 0),h(this,"dinfo",void 0),h(this,"alloc",void 0),h(this,"proj",void 0),h(this,"bui",void 0),h(this,"baseFactor",void 0),h(this,"baseFeeUI",void 0),h(this,"baseFeeFactor",void 0),h(this,"qui",void 0),h(this,"quoteFactor",void 0),h(this,"quoteFeeUI",void 0),h(this,"quoteFeeFactor",void 0),h(this,"id",void 0),h(this,"mktID",void 0),h(this,"lotSize",void 0),h(this,"lotSizeConv",void 0),h(this,"lotSizeUSD",void 0),h(this,"quoteLot",void 0),h(this,"quoteLotConv",void 0),h(this,"quoteLotUSD",void 0),h(this,"rateStep",void 0),h(this,"baseFeeFiatRate",void 0),h(this,"quoteFeeFiatRate",void 0),h(this,"baseLots",void 0),h(this,"quoteLots",void 0),h(this,"marketReport",void 0),h(this,"cexBaseBalance",void 0),h(this,"cexQuoteBalance",void 0),h(this,"nBuyPlacements",void 0),h(this,"nSellPlacements",void 0);var n=this.host=t.host,r=this.baseID=t.baseID,a=this.quoteID=t.quoteID;this.cexName=t.cexName;var o=pt().mmStatus.bots.find((function(e){var t=e.config;return t.baseID===r&&t.quoteID===a&&t.host===n}));if(!o)throw Error("where's the bot status?");this.cfg=o.config;var s=pt().assets[r],c=s.token,l=s.symbol,u=s.unitInfo;this.baseSymbol=l,this.baseTicker=u.conventional.unit,this.bui=u,this.baseFactor=u.conventional.conversionFactor,this.baseToken=c;var d=this.baseFeeID=c?c.parentID:r,p=pt().assets[this.baseFeeID],f=p.unitInfo,v=p.symbol,m=p.wallet;this.baseIsAccountLocker=(16384&m.traits)>0,this.baseFeeUI=f,this.baseFeeTicker=f.conventional.unit,this.baseFeeSymbol=v,this.baseFeeFactor=this.baseFeeUI.conventional.conversionFactor;var g=pt().assets[a],y=g.token,b=g.symbol,x=g.unitInfo;this.quoteSymbol=b,this.quoteTicker=x.conventional.unit,this.qui=x,this.quoteFactor=x.conventional.conversionFactor,this.quoteToken=y;var k=this.quoteFeeID=y?y.parentID:a,w=pt().assets[this.quoteFeeID],C=w.unitInfo,S=w.symbol,F=w.wallet;this.quoteIsAccountLocker=(16384&F.traits)>0,this.quoteFeeUI=C,this.quoteFeeTicker=C.conventional.unit,this.quoteFeeSymbol=S,this.quoteFeeFactor=this.quoteFeeUI.conventional.conversionFactor,this.id=hr(n,r,a),this.mktID="".concat(l,"_").concat(b);var D=pt().exchanges[n].markets[this.mktID],T=D.lotsize,I=D.ratestep;this.lotSize=T,this.lotSizeConv=T/u.conventional.conversionFactor,this.rateStep=I,this.quoteLot=ur(T,r,a),this.quoteLotConv=this.quoteLot/x.conventional.conversionFactor,this.baseFeeFiatRate=pt().fiatRatesMap[d],this.quoteFeeFiatRate=pt().fiatRatesMap[k],t.arbMarketMakingConfig?(this.botType=rr,this.baseLots=t.arbMarketMakingConfig.sellPlacements.reduce(vr,0),this.quoteLots=t.arbMarketMakingConfig.buyPlacements.reduce(vr,0),this.nBuyPlacements=t.arbMarketMakingConfig.buyPlacements.length,this.nSellPlacements=t.arbMarketMakingConfig.sellPlacements.length):t.simpleArbConfig?(this.botType=ar,this.baseLots=t.uiConfig.simpleArbLots,this.quoteLots=t.uiConfig.simpleArbLots):t.basicMarketMakingConfig&&(this.botType=nr,this.baseLots=t.basicMarketMakingConfig.sellPlacements.reduce(vr,0),this.quoteLots=t.basicMarketMakingConfig.buyPlacements.reduce(vr,0),this.nBuyPlacements=t.basicMarketMakingConfig.buyPlacements.length,this.nSellPlacements=t.basicMarketMakingConfig.sellPlacements.length)}var t;return d(e,[{key:"initialize",value:(t=s(f().mark((function e(t){var n,r,a,o,s,i,c,l,u,d;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.host,r=this.baseID,a=this.quoteID,o=this.lotSizeConv,s=this.quoteLotConv,i=this.cexName,e.next=3,sr.report(n,r,a);case 3:if(c=e.sent,l=this.marketReport=c.report,this.lotSizeUSD=o*l.baseFiatRate,this.quoteLotUSD=s*l.quoteFiatRate,this.proj=this.projectedAllocations(),!i){e.next=17;break}return u=t[r]=t[r]||sr.cexBalance(i,r),d=t[a]=t[a]||sr.cexBalance(i,a),e.next=13,u;case 13:return this.cexBaseBalance=e.sent,e.next=16,d;case 16:this.cexQuoteBalance=e.sent;case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"status",value:function(){var e=this.baseID,t=this.quoteID,n=pt().mmStatus.bots.find((function(n){return n.config.baseID===e&&n.config.quoteID===t}));return n?{botCfg:n.config,running:n.running,runStats:n.runStats,latestEpoch:n.latestEpoch,cexProblems:n.cexProblems}:{botCfg:{},running:!1,runStats:{}}}},{key:"adjustedBalances",value:function(){var e=this.baseID,t=this.quoteID,n=this.baseFeeID,r=this.quoteFeeID,a=this.cexBaseBalance,o=this.cexQuoteBalance,s=this.baseFactor,i=this.quoteFactor,c=this.baseFeeFactor,l=this.quoteFeeFactor,u=[pt().walletMap[e],pt().walletMap[t]],d=u[0],h=u[1],p=[ir(e),ir(t)],f=p[0],v=p[1],m=0,g=0;a&&(m=(a.available||0)-f.cex.avail),o&&(g=(o.available||0)-v.cex.avail);var y=d.balance.available-f.dex.avail,b=h.balance.available-v.dex.avail,x=y+m,k=b+g,w=n===e?d:pt().walletMap[n],C=r===t?h:pt().walletMap[r],S=x,F=y,D=m;if(n!==e){var T=ir(e);F=w.balance.available-T.dex.total,a&&(D=(a.available||0)-T.cex.total),S=F+D}var I=k,A=b,R=g;if(r!==t){var E=ir(t);A=C.balance.available-E.dex.total,o&&(R=(o.available||0)-E.cex.total),I=A+R}return{baseAvail:x/s,quoteAvail:k/i,dexBaseAvail:y/s,dexQuoteAvail:b/i,cexBaseAvail:m/s,cexQuoteAvail:g/i,baseFeeAvail:S/c,quoteFeeAvail:I/l,dexBaseFeeAvail:F/c,dexQuoteFeeAvail:A/l,cexBaseFeeAvail:D/c,cexQuoteFeeAvail:R/l}}},{key:"feesAndCommit",value:function(){var e=this.baseID,t=this.quoteID,n=this.marketReport,r=n.baseFees,a=n.quoteFees,o=this.lotSize,s=this.baseLots,i=this.quoteLots,c=this.baseFeeID,l=this.quoteFeeID,u=this.baseIsAccountLocker,d=this.quoteIsAccountLocker,h=this.cfg.uiConfig,p=h.baseConfig,f=h.quoteConfig;return xr(e,t,r,a,o,s,i,c,l,u,d,p.orderReservesFactor,f.orderReservesFactor)}},{key:"projectedAllocations",value:function(){var e=this.cfg.uiConfig,t=e.quoteConfig,n=e.baseConfig,r=this.baseFactor,a=this.quoteFactor,o=this.baseID,s=this.quoteID,i=this.lotSizeConv,c=this.quoteLotConv,l=this.baseFeeFactor,u=this.quoteFeeFactor,d=this.baseFeeID,h=this.quoteFeeID,p=this.baseToken,f=this.quoteToken,v=this.cexName,m=this.feesAndCommit(),g=m.commit,y=m.fees,b={book:0,bookingFees:0,swapFeeReserves:0,cex:0,orderReserves:0,slippageBuffer:0},x={book:0,bookingFees:0,swapFeeReserves:0,cex:0,orderReserves:0,slippageBuffer:0};b.book=g.dex.base.lots*i,x.book=g.cex.base.lots*c,b.orderReserves=Math.max(g.cex.base.val,g.dex.base.val)*n.orderReservesFactor/r,x.orderReserves=Math.max(g.cex.quote.val,g.dex.quote.val)*t.orderReservesFactor/a,v&&(b.cex=g.cex.base.lots*i,x.cex=g.cex.quote.lots*c),b.bookingFees=y.base.bookingFees/l,x.bookingFees=y.quote.bookingFees/u,p&&(b.swapFeeReserves=y.base.tokenFeesPerSwap*n.swapFeeN/l),f&&(x.swapFeeReserves=y.quote.tokenFeesPerSwap*t.swapFeeN/u),x.slippageBuffer=(x.book+x.cex+x.orderReserves)*t.slippageBufferFactor;var k={},w=function(e,t){var n;k[e]=(null!==(n=k[e])&&void 0!==n?n:0)+t};return w(o,Math.round((b.book+b.cex+b.orderReserves)*r)),w(d,Math.round((b.bookingFees+b.swapFeeReserves)*l)),w(s,Math.round((x.book+x.cex+x.orderReserves+x.slippageBuffer)*a)),w(h,Math.round((x.bookingFees+x.swapFeeReserves)*u)),{qProj:x,bProj:b,alloc:k}}},{key:"fundingState",value:function(){var e=this.proj,t=e.bProj,n=e.qProj,r=this.baseID,a=this.quoteID,o=this.baseFeeID,s=this.quoteFeeID,i=this.cfg.uiConfig.cexRebalance,c=this.cexName,l=this.adjustedBalances(),u=l.baseAvail,d=l.quoteAvail,h=l.dexBaseAvail,p=l.dexQuoteAvail,f=l.cexBaseAvail,v=l.cexQuoteAvail,m=l.dexBaseFeeAvail,g=l.dexQuoteFeeAvail,y=Boolean(c&&i),b=t.cex,x=[t.book,0,0],k=x[0],w=x[1],C=x[2];r===o?k+=t.bookingFees:C+=t.bookingFees+t.swapFeeReserves,y?w+=t.orderReserves:k+=t.orderReserves,r===s&&(y?w+=n.bookingFees+n.swapFeeReserves:k+=n.bookingFees+n.swapFeeReserves);var S=[n.book,n.cex,0,0],F=S[0],D=S[1],T=S[2],I=S[3];if(a===s?F+=n.bookingFees:I+=n.bookingFees+n.swapFeeReserves,y)T+=n.orderReserves+n.slippageBuffer;else{F+=n.orderReserves;var A=n.book+n.cex+n.orderReserves;F+=(n.book+n.orderReserves)/A*n.slippageBuffer,D+=n.cex/A*n.slippageBuffer}a===o&&(y?T+=t.bookingFees+t.swapFeeReserves:F+=t.bookingFees+t.swapFeeReserves);var R=h>=k,E=f>=b,B=p>=F,P=v>=D,L=k+b+w,O=F+D+T,M=R&&E&&u>=L,q=B&&P&&d>=O,N=m>=C,W=g>=I,V=M&&q&&N&&W,U=!V;return V||(U=u>=L&&d>=O&&N&&W&&y),{base:{dex:{avail:h,req:k,funded:R},cex:{avail:f,req:b,funded:E},transferable:w,fees:{avail:m,req:C,funded:N},fundedAndBalanced:M,fundedAndNotBalanced:!M&&u>=L&&y},quote:{dex:{avail:p,req:F,funded:B},cex:{avail:v,req:D,funded:P},transferable:T,fees:{avail:g,req:I,funded:W},fundedAndBalanced:q,fundedAndNotBalanced:!q&&d>=O&&y},fundedAndBalanced:V,fundedAndNotBalanced:U,starved:!V&&!U}}}]),e}(),gr=function(){function e(t,n,r,a){var o=this;i(this,e),h(this,"div",void 0),h(this,"page",void 0),h(this,"mkt",void 0),h(this,"startTime",void 0),h(this,"ticker",void 0),h(this,"currentForm",void 0),h(this,"forms",void 0),h(this,"latestEpoch",void 0),h(this,"cexProblems",void 0),h(this,"orderReportFormEl",void 0),h(this,"orderReportForm",void 0),h(this,"displayedOrderReportFormSide",void 0),h(this,"dexBalancesRowTmpl",void 0),h(this,"placementRowTmpl",void 0),h(this,"placementAmtRowTmpl",void 0),this.div=t,this.page=qe.parseTemplate(t),this.orderReportFormEl=r.orderReportForm,this.orderReportForm=qe.idDescendants(r.orderReportForm),this.dexBalancesRowTmpl=r.dexBalancesRowTmpl,this.placementRowTmpl=r.placementRowTmpl,this.placementAmtRowTmpl=r.placementAmtRowTmpl,qe.cleanTemplates(this.dexBalancesRowTmpl,this.placementRowTmpl,this.placementAmtRowTmpl),this.forms=n,qe.bind(this.page.stopBttn,"click",(function(){return o.stop()})),qe.bind(this.page.runLogsBttn,"click",(function(){var e=o.mkt,t=e.baseID,n=e.quoteID,r=e.host,s=o.startTime;pt().loadPage("mmlogs",{baseID:t,quoteID:n,host:r,startTime:s,returnPage:a})})),qe.bind(this.page.buyOrdersBttn,"click",(function(){return o.showOrderReport("buys")})),qe.bind(this.page.sellOrdersBttn,"click",(function(){return o.showOrderReport("sells")}))}var t,n,o;return d(e,[{key:"stop",value:(o=s(f().mark((function e(){var t,n,r,a,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=this.mkt,r=n.host,a=n.baseID,o=n.quoteID,s=pt().loading(t.stopBttn),e.next=4,sr.stopBot({host:r,baseID:a,quoteID:o});case 4:s();case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"setMarket",value:(n=s(f().mark((function e(t,n,r){var a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=pt().mmStatus.bots.find((function(e){var a=e.config;return a.baseID===n&&a.quoteID===r&&a.host===t}))){e.next=3;break}return e.abrupt("return");case 3:return o=new mr(a.config),e.next=6,o.initialize({});case 6:this.setBotMarket(o);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"setBotMarket",value:(t=s(f().mark((function e(t){var n,a,o,s,i,c,l,u,d,h,p,v,m,g,y,b,x,k,w,C,S,F,D,T,I,A;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.mkt=t,c=this.page,l=this.div,u=this.mkt,d=u.host,h=u.baseID,p=u.quoteID,v=u.baseFeeID,m=u.quoteFeeID,g=u.cexName,y=u.baseFeeSymbol,b=u.quoteFeeSymbol,x=u.baseFeeTicker,k=u.quoteFeeTicker,w=u.cfg,C=u.baseFactor,S=u.quoteFactor,cr(l,h,p,d),qe.setVis(v!==h,c.baseFeeReservesBox),qe.setVis(m!==p,c.quoteFeeReservesBox),qe.setVis.apply(qe,[Boolean(g)].concat(r(qe.applySelector(l,"[data-cex-show]")))),c.baseFeeLogo.src=qe.logoPath(y),c.baseFeeTicker.textContent=x,c.quoteFeeLogo.src=qe.logoPath(b),c.quoteFeeTicker.textContent=k,F=w.basicMarketMakingConfig,D=null!==(n=null==F?void 0:F.gapStrategy)&&void 0!==n?n:er,T=null!==(a=null!==(o=null===(s=w.arbMarketMakingConfig)||void 0===s?void 0:s.profit)&&void 0!==o?o:null===(i=w.simpleArbConfig)||void 0===i?void 0:i.profitTrigger)&&void 0!==a?a:0,F&&(I=r(F.buyPlacements).sort((function(e,t){return e.gapFactor-t.gapFactor})),A=r(F.sellPlacements).sort((function(e,t){return e.gapFactor-t.gapFactor})),T=I.length>0?A.length>0?(I[0].gapFactor+A[0].gapFactor)/2:I[0].gapFactor:A[0].gapFactor),qe.hide(c.profitLabel,c.gapLabel,c.multiplierLabel,c.profitUnit,c.gapUnit,c.multiplierUnit),e.t0=D,e.next=e.t0===er||e.t0===tr?18:e.t0===Jn?21:24;break;case 18:return qe.show(c.profitLabel,c.profitUnit),c.gapFactor.textContent=(100*T).toFixed(2),e.abrupt("break",25);case 21:return qe.show(c.multiplierLabel,c.multiplierUnit),c.gapFactor.textContent=(100*T).toFixed(2),e.abrupt("break",25);case 24:c.gapFactor.textContent=qe.formatFourSigFigs(T/qt*C/S);case 25:this.update(),this.readBook();case 27:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"handleBalanceNote",value:function(e){if(this.mkt){var t=this.mkt,n=t.baseID,r=t.quoteID,a=t.baseFeeID,o=t.quoteFeeID;e.assetID!==n&&e.assetID!==a&&e.assetID!==r&&e.assetID!==o||this.update()}}},{key:"handleEpochReportNote",value:function(e){if(this.mkt){var t=this.mkt,n=t.baseID,r=t.quoteID,a=t.host;if(e.baseID===n&&e.quoteID===r&&e.host===a&&e.report){if(this.latestEpoch=e.report,this.forms.currentForm===this.orderReportFormEl&&this.forms.currentFormID===this.mkt.id){var o="buys"===this.displayedOrderReportFormSide?e.report.buysReport:e.report.sellsReport;o?this.updateOrderReport(o,this.displayedOrderReportFormSide,e.report.epochNum):this.forms.close()}this.update()}}}},{key:"handleCexProblemsNote",value:function(e){if(this.mkt){var t=this.mkt,n=t.baseID,r=t.quoteID,a=t.host;e.baseID===n&&e.quoteID===r&&e.host===a&&(this.cexProblems=e.problems,this.update())}}},{key:"setTicker",value:function(){this.page.runTime.textContent=qe.hmsSince(this.startTime)}},{key:"update",value:function(){var e,t,n,r=this,o=this.div,s=this.page,i=this.mkt,c=i.baseID,l=i.quoteID,u=i.baseFeeID,d=i.quoteFeeID,h=i.baseFactor,p=i.quoteFactor,f=i.baseFeeFactor,v=i.quoteFeeFactor,m=i.marketReport,g=m.baseFiatRate,y=m.quoteFiatRate,b=this.mkt.status(),x=b.botCfg,k=x.cexName,w=x.basicMarketMakingConfig,C=b.runStats,S=b.latestEpoch,F=b.cexProblems;if(this.latestEpoch=S,this.cexProblems=F,qe.hide(s.stats,s.cexRow,s.pendingDepositBox,s.pendingWithdrawalBox),C){this.ticker||(this.startTime=C.startTime,this.setTicker(),this.ticker=setInterval((function(){return r.setTicker()}),1e3)),qe.show(s.stats),br(100*C.profitLoss.profitRatio,s.profit,s.profitSign,2),br(C.profitLoss.profit,s.profitLoss,s.plSign,2),this.startTime=C.startTime;var D=function(e){return e?e.available+e.locked+e.pending+e.reserved:0},T=D(C.dexBalances[c])/h;s.walletBaseInventory.textContent=qe.formatFourSigFigs(T),s.walletBaseInvFiat.textContent=qe.formatFourSigFigs(T*g,2);var I=D(C.dexBalances[l])/p;if(s.walletQuoteInventory.textContent=qe.formatFourSigFigs(I),s.walletQuoteInvFiat.textContent=qe.formatFourSigFigs(I*y,2),qe.setVis(k,s.cexRow),k){qe.show(s.pendingDepositBox,s.pendingWithdrawalBox),lr(o,k);var A=D(C.cexBalances[c])/h;s.cexBaseInventory.textContent=qe.formatFourSigFigs(A),s.cexBaseInventoryFiat.textContent=qe.formatFourSigFigs(A*g,2);var R=D(C.cexBalances[l])/p;s.cexQuoteInventory.textContent=qe.formatFourSigFigs(R),s.cexQuoteInventoryFiat.textContent=qe.formatFourSigFigs(R*y,2)}if(u!==c){var E=D(C.dexBalances[u])/f;s.baseFeeReserves.textContent=qe.formatFourSigFigs(E)}if(d!==l){var B=D(C.dexBalances[d])/v;s.quoteFeeReserves.textContent=qe.formatFourSigFigs(B)}s.pendingDeposits.textContent=String(Math.round(C.pendingDeposits)),s.pendingWithdrawals.textContent=String(Math.round(C.pendingWithdrawals)),s.completedMatches.textContent=String(Math.round(C.completedMatches)),qe.setVis(C.tradedUSD,s.tradedUSDBox),C.tradedUSD>0&&(s.tradedUSD.textContent=qe.formatFourSigFigs(C.tradedUSD)),qe.setVis(g,s.roundTripFeesBox),g&&(s.roundTripFeesUSD.textContent=qe.formatFourSigFigs((null===(e=C.feeGap)||void 0===e?void 0:e.roundTripFees)/h*g||0));var P=pt().conventionalRate(c,l,(null===(t=C.feeGap)||void 0===t?void 0:t.basisPrice)||0);s.basisPrice.textContent=qe.formatFourSigFigs(P);var L=!w||w.gapStrategy===$n||w.gapStrategy===tr;if(qe.setVis(L,s.feeGapBox),L){var O,M=pt().conventionalRate(c,l,(null===(O=C.feeGap)||void 0===O?void 0:O.feeGap)||0);s.feeGap.textContent=qe.formatFourSigFigs(M),s.feeGapPct.textContent=(M/P*100||0).toFixed(2)}qe.setVis(w,s.gapStrategyBox),w&&(s.gapStrategy.textContent=w.gapStrategy);var q=pt().conventionalRate(c,l,(null===(n=C.feeGap)||void 0===n?void 0:n.remoteGap)||0);if(qe.setVis(q,s.remoteGapBox),q&&(s.remoteGap.textContent=qe.formatFourSigFigs(q),s.remoteGapPct.textContent=(q/P*100||0).toFixed(2)),qe.setVis(null==S?void 0:S.buysReport,s.buyOrdersReportBox),null!=S&&S.buysReport){var N=yr(S.buysReport);qe.setVis(N,s.buyOrdersSuccess),qe.setVis(!N,s.buyOrdersFailed)}if(qe.setVis(null==S?void 0:S.sellsReport,s.sellOrdersReportBox),null!=S&&S.sellsReport){var W=yr(S.sellsReport);qe.setVis(W,s.sellOrdersSuccess),qe.setVis(!W,s.sellOrdersFailed)}var V=kr(null==S?void 0:S.preOrderProblems,this.mkt.cexName,this.mkt.host),U=function(e){if(!e)return[];var t=[];if(e.depositErr)for(var n=0,r=Object.entries(e.depositErr);n<r.length;n++){var o=a(r[n],2),s=o[0],i=o[1];t.push(xe("DEPOSIT_ERROR",{assetSymbol:pt().assets[Number(s)].symbol.toUpperCase(),time:new Date(1e3*i.stamp).toLocaleString(),error:i.error}))}if(e.withdrawErr)for(var c=0,l=Object.entries(e.withdrawErr);c<l.length;c++){var u=a(l[c],2),d=u[0],h=u[1];t.push(xe("WITHDRAW_ERROR",{assetSymbol:pt().assets[Number(d)].symbol.toUpperCase(),time:new Date(1e3*h.stamp).toLocaleString(),error:h.error}))}return e.tradeErr&&t.push(xe("CEX_TRADE_ERROR",{time:new Date(1e3*e.tradeErr.stamp).toLocaleString(),error:e.tradeErr.error})),t}(this.cexProblems),_=[].concat(V,U);qe.setVis(_.length>0,s.preOrderProblemsBox),qe.empty(s.preOrderProblemsBox);var j,H=Qn(_);try{for(H.s();!(j=H.n()).done;){var z=j.value,G=document.createElement("span");G.textContent="- ".concat(z),s.preOrderProblemsBox.appendChild(G)}}catch(e){H.e(e)}finally{H.f()}}else this.ticker&&(clearInterval(this.ticker),this.ticker=void 0)}},{key:"updateOrderReport",value:function(e,t,n){var r=this,o=this.orderReportForm,s=xe("buys"===t?E:B);if(o.orderReportTitle.textContent=xe("ORDER_REPORT_TITLE",{side:s,epochNum:"".concat(n)}),qe.setVis(e.error,o.orderReportError),qe.setVis(!e.error,o.orderReportDetails),e.error){var i=kr(e.error,this.mkt.cexName,this.mkt.host);qe.empty(o.orderReportError);for(var c=0,l=i;c<l.length;c++){var u=l[c],d=document.createElement("span");d.textContent="- ".concat(u),o.orderReportError.appendChild(d)}}else{qe.empty(o.dexBalancesBody,o.placementsBody);var h=function(t){var n=r.dexBalancesRowTmpl.cloneNode(!0),a=qe.parseTemplate(n),o=pt().assets[t];a.asset.textContent=o.symbol.toUpperCase(),a.assetLogo.src=qe.logoPath(o.symbol);var s=o.unitInfo,i=e.availableDexBals[t]?e.availableDexBals[t].available:0,c=e.requiredDexBals[t]?e.requiredDexBals[t]:0,l=e.remainingDexBals[t]?e.remainingDexBals[t]:0,u=e.availableDexBals[t]?e.availableDexBals[t].pending:0,d=e.availableDexBals[t]?e.availableDexBals[t].locked:0,h=e.usedDexBals[t]?e.usedDexBals[t]:0;a.available.textContent=qe.formatCoinValue(i,s),a.locked.textContent=qe.formatCoinValue(d,s),a.required.textContent=qe.formatCoinValue(c,s),a.remaining.textContent=qe.formatCoinValue(l,s),a.pending.textContent=qe.formatCoinValue(u,s),a.used.textContent=qe.formatCoinValue(h,s);var p=wr(c,i);a.deficiency.textContent=qe.formatCoinValue(p,s),p>0&&a.deficiency.classList.add("text-warning");var f=wr(p,u);return a.deficiencyWithPending.textContent=qe.formatCoinValue(f,s),f>0&&a.deficiencyWithPending.classList.add("text-warning"),[n,p]},p=[this.mkt.baseID,this.mkt.quoteID];p.includes(this.mkt.baseFeeID)||p.push(this.mkt.baseFeeID),p.includes(this.mkt.quoteFeeID)||p.push(this.mkt.quoteFeeID);for(var f,v=0,m=[],g=0,y=p;g<y.length;g++){var b=a(h(y[g]),2),x=b[0];v+=b[1],o.dexBalancesBody.appendChild(x),m.push(x)}if(function(e,t){qe.setVis(e,o.dexDeficiencyHeader,o.dexDeficiencyWithPendingHeader);var n,r=Qn(t);try{for(r.s();!(n=r.n()).done;){var a=n.value,s=qe.parseTemplate(a);qe.setVis(e,s.deficiency,s.deficiencyWithPending)}}catch(e){r.e(e)}finally{r.f()}}(v>0,m),qe.setVis(this.mkt.cexName,o.cexSection,o.counterTradeRateHeader,o.requiredCEXHeader,o.usedCEXHeader),this.mkt.cexName){var k=or[this.mkt.cexName];k?(o.cexLogo.src=k.logo,o.cexBalancesTitle.textContent=xe("CEX_BALANCES",{cexName:k.name})):console.error("CEXDisplayInfo not found for ".concat(this.mkt.cexName));var w="buys"===t?this.mkt.baseID:this.mkt.quoteID;f=pt().assets[w],o.cexAsset.textContent=f.symbol.toUpperCase(),o.cexAssetLogo.src=qe.logoPath(f.symbol);var C=e.availableCexBal?e.availableCexBal.available:0,S=e.requiredCexBal?e.requiredCexBal:0,F=e.remainingCexBal?e.remainingCexBal:0,D=e.availableCexBal?e.availableCexBal.pending:0,T=e.availableCexBal?e.availableCexBal.reserved:0,I=e.usedCexBal?e.usedCexBal:0,A=wr(S,C),R=wr(A,D);o.cexAvailable.textContent=qe.formatCoinValue(C,f.unitInfo),o.cexLocked.textContent=qe.formatCoinValue(T,f.unitInfo),o.cexRequired.textContent=qe.formatCoinValue(S,f.unitInfo),o.cexRemaining.textContent=qe.formatCoinValue(F,f.unitInfo),o.cexPending.textContent=qe.formatCoinValue(D,f.unitInfo),o.cexUsed.textContent=qe.formatCoinValue(I,f.unitInfo);var P=A>0;qe.setVis(P,o.cexDeficiencyHeader,o.cexDeficiencyWithPendingHeader,o.cexDeficiency,o.cexDeficiencyWithPending),P&&(o.cexDeficiency.textContent=qe.formatCoinValue(A,f.unitInfo),o.cexDeficiencyWithPending.textContent=qe.formatCoinValue(R,f.unitInfo),R>0?o.cexDeficiencyWithPending.classList.add("text-warning"):o.cexDeficiencyWithPending.classList.remove("text-warning"))}var L,O=!1,M=Qn(e.placements);try{for(M.s();!(L=M.n()).done;)if(L.value.error){O=!0;break}}catch(e){M.e(e)}finally{M.f()}qe.setVis(O,o.errorHeader);for(var q=function(e,t){var n=r.placementRowTmpl.cloneNode(!0),a=qe.parseTemplate(n),o=pt().assets[r.mkt.baseID].unitInfo,s=pt().assets[r.mkt.quoteID].unitInfo;a.priority.textContent=String(t),a.rate.textContent=qe.formatRateFullPrecision(e.rate,o,s,r.mkt.rateStep),a.lots.textContent=String(e.lots),a.standingLots.textContent=String(e.standingLots),a.orderedLots.textContent=String(e.orderedLots),e.standingLots+e.orderedLots<e.lots&&(a.lots.classList.add("text-warning"),a.standingLots.classList.add("text-warning"),a.orderedLots.classList.add("text-warning")),qe.setVis(e.counterTradeRate>0,a.counterTradeRate),a.counterTradeRate.textContent=qe.formatRateFullPrecision(e.counterTradeRate,o,s,r.mkt.rateStep);for(var i=0,c=p;i<c.length;i++){var l=c[i],u=pt().assets[l],d=u.unitInfo,h=e.requiredDex[l]?e.requiredDex[l]:0,v=e.usedDex[l]?e.usedDex[l]:0,m=r.placementAmtRowTmpl.cloneNode(!0),g=qe.parseTemplate(m),y=r.placementAmtRowTmpl.cloneNode(!0),b=qe.parseTemplate(y);g.amt.textContent=qe.formatCoinValue(h,d),g.assetLogo.src=qe.logoPath(u.symbol),g.assetSymbol.textContent=u.symbol.toUpperCase(),b.amt.textContent=qe.formatCoinValue(v,d),b.assetLogo.src=qe.logoPath(u.symbol),b.assetSymbol.textContent=u.symbol.toUpperCase(),a.requiredDEX.appendChild(m),a.usedDEX.appendChild(y)}if(qe.setVis(r.mkt.cexName,a.requiredCEX,a.usedCEX),r.mkt.cexName){var x=qe.formatCoinValue(e.requiredCex,f.unitInfo);a.requiredCEX.textContent="".concat(x," ").concat(f.symbol.toUpperCase());var k=qe.formatCoinValue(e.usedCex,f.unitInfo);a.usedCEX.textContent="".concat(k," ").concat(f.symbol.toUpperCase())}if(qe.setVis(O,a.error),e.error){var w=kr(e.error,r.mkt.cexName,r.mkt.host);a.error.textContent=w.join("\n")}return n},N=0;N<e.placements.length;N++)o.placementsBody.appendChild(q(e.placements[N],N+1))}}},{key:"showOrderReport",value:function(e){if(this.latestEpoch){var t="buys"===e?this.latestEpoch.buysReport:this.latestEpoch.sellsReport;t&&(this.updateOrderReport(t,e,this.latestEpoch.epochNum),this.displayedOrderReportFormSide=e,this.forms.show(this.orderReportFormEl,this.mkt.id))}}},{key:"readBook",value:function(){if(this.mkt){var e=this.page,t=this.mkt,n=t.host,r=t.mktID,a=pt().exchanges[n].markets[r].orders||[];e.nBookedOrders.textContent=String(a.filter((function(e){return e.status===At})).length)}}}]),e}();function yr(e){if(e.error)return!1;for(var t=0;t<e.placements.length;t++){var n=e.placements[t];if(n.orderedLots+n.standingLots<n.lots)return!1;if(n.error)return!1}return!0}function br(e,t,n,r){t.textContent=qe.formatFourSigFigs(e,r),n.classList.toggle("ico-plus",e>0),n.classList.toggle("text-good",e>0)}function xr(e,t,n,r,a,o,s,i,c,l,u,d,h){var p=ur(a,e,t),f={dex:{base:{lots:o,val:o*a},quote:{lots:s,val:s*p}},cex:{base:{lots:s,val:s*a},quote:{lots:o,val:o*p}}},v=0,m=0;e!==i&&(v+=n.estimated.swap,i===c&&(v+=r.estimated.redeem));var g=n.max.swap;e===c&&(g+=r.max.redeem),l&&(g+=n.max.refund,u||i===c||(m=n.max.redeem));var y=0,b=0;t!==c&&(y+=r.estimated.swap,c===i&&(y+=n.estimated.redeem));var x=r.max.swap;t===i&&(x+=n.max.redeem),u&&(x+=r.max.refund,l||c===i||(b=r.max.redeem));var k=1+d,w=1+h,C=g*o*k,S=m*s*w,F=x*s*w,D=b*o*k;return{commit:f,fees:{base:Kn(Kn({},n),{},{bookingFeesPerLot:g,bookingFeesPerCounterLot:m,bookingFees:C+S,swapReservesFactor:k,redeemReservesFactor:w,tokenFeesPerSwap:v}),quote:Kn(Kn({},r),{},{bookingFeesPerLot:x,bookingFeesPerCounterLot:b,bookingFees:F+D,swapReservesFactor:w,redeemReservesFactor:k,tokenFeesPerSwap:y})}}}function kr(e,t,n){if(!e)return[];var r=[];if(e.walletNotSynced)for(var o=0,s=Object.entries(e.walletNotSynced);o<s.length;o++){var i=a(s[o],2),c=i[0];i[1]&&r.push(xe("WALLET_NOT_SYNCED",{assetSymbol:pt().assets[Number(c)].symbol.toUpperCase()}))}if(e.noWalletPeers)for(var l=0,u=Object.entries(e.noWalletPeers);l<u.length;l++){var d=a(u[l],2),h=d[0];d[1]&&r.push(xe("WALLET_NO_PEERS",{assetSymbol:pt().assets[Number(h)].symbol.toUpperCase()}))}return e.accountSuspended&&r.push(xe("ACCOUNT_SUSPENDED",{dexHost:n})),e.userLimitTooLow&&r.push(xe("USER_LIMIT_TOO_LOW",{dexHost:n})),e.noPriceSource&&r.push(xe("NO_PRICE_SOURCE")),e.cexOrderbookUnsynced&&r.push(xe("CEX_ORDERBOOK_UNSYNCED",{cexName:t})),e.causesSelfMatch&&r.push(xe("CAUSES_SELF_MATCH")),r}function wr(e,t){return e-t>0?e-t:0}function Cr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Sr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Sr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){i=!0,o=e})),f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function Sr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}window.mmstatus=function(){return sr.status()};var Fr=function(){function e(t,n){var r=this;i(this,e),h(this,"formsDiv",void 0),h(this,"currentForm",void 0),h(this,"currentFormID",void 0),h(this,"keyup",void 0),h(this,"closed",void 0),this.formsDiv=t,this.closed=null==n?void 0:n.closed,t.querySelectorAll(".form-closer").forEach((function(e){qe.bind(e,"click",(function(){r.close()}))})),qe.bind(t,"mousedown",(function(e){r.currentForm&&(qe.mouseInElement(e,r.currentForm)||r.close())})),this.keyup=function(e){"Escape"===e.key&&r.close()},qe.bind(document,"keyup",this.keyup)}var t;return d(e,[{key:"show",value:(t=s(f().mark((function e(t,n){var a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentForm=t,this.currentFormID=n,qe.hide.apply(qe,r(Array.from(this.formsDiv.children))),t.style.right="10000px",qe.show(this.formsDiv,t),a=(this.formsDiv.offsetWidth+t.offsetWidth)/2,e.next=8,qe.animate(Ur,(function(e){t.style.right="".concat((1-e)*a,"px")}),"easeOutHard");case 8:t.style.right="0";case 9:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"close",value:function(){qe.hide(this.formsDiv),this.currentForm=void 0,this.currentFormID=void 0,this.closed&&this.closed()}},{key:"exit",value:function(){qe.unbind(document,"keyup",this.keyup)}}]),e}(),Dr=function(){function e(t,n,r){var a=this;i(this,e),h(this,"page",void 0),h(this,"form",void 0),h(this,"success",void 0),h(this,"current",void 0),h(this,"subform",void 0),h(this,"walletCfgGuide",void 0),h(this,"parentSyncer",void 0),h(this,"createUpdater",void 0),this.form=t,this.success=n;var o=this.page=qe.parseTemplate(t);r&&(qe.show(o.goBack),qe.bind(o.goBack,"click",(function(){r()}))),qe.empty(o.walletTabTmpl),o.walletTabTmpl.removeAttribute("id"),this.subform=new Ir(o.walletSettings,!0),this.walletCfgGuide=qe.tmplElement(t,"walletCfgGuide"),zr(t,o.submitAdd,(function(){return a.submit()})),zr(t,o.oneBttn,(function(){return a.submit()})),pt().registerNoteFeeder({walletstate:function(e){a.reportWalletState(e.wallet)},walletsync:function(e){a.parentSyncer&&a.parentSyncer(pt().walletMap[e.assetID])},createwallet:function(e){a.reportCreationUpdate(e)}})}var t,n,a,o,c,l,u;return d(e,[{key:"reportWalletState",value:function(e){this.parentSyncer&&this.parentSyncer(e)}},{key:"reportCreationUpdate",value:function(e){this.createUpdater&&this.createUpdater(e)}},{key:"createWallet",value:(u=s(f().mark((function e(t,n,r){var a,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={assetID:t,pass:this.page.newWalletPass.value||"",config:this.subform.map(t),walletType:n,parentForm:r},o=new ln(this.form,{backgroundColor:!0}),e.next=4,S("/api/newwallet",a);case 4:return s=e.sent,o.stop(),e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"submit",value:(l=s(f().mark((function e(){var t,n,r,a,o,s,i,c,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=t.newWalletPass,qe.hide(t.newWalletErr),r=this.current,a=r.asset,o=r.parentAsset,s=this.current.selectedDef,c=s.type,o&&(c=a.token.definition.type,i={assetID:o.id,config:this.subform.map(o.id),walletType:s.type}),e.next=9,this.createWallet(a.id,c,i);case 9:if(l=e.sent,pt().checkResponse(l)){e.next=13;break}return this.setError(l.msg),e.abrupt("return");case 13:if(n.value="",!o){e.next=19;break}return e.next=17,this.runParentSync();case 17:e.next=20;break;case 19:this.success(this.current.asset.id);case 20:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"runParentSync",value:(c=s(f().mark((function e(){var t,n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,n=this.current,r=n.parentAsset,a=n.asset,r){e.next=3;break}return e.abrupt("return");case 3:return t.parentSyncPct.textContent="0",t.parentName.textContent=r.name,t.parentLogo.src=qe.logoPath(r.symbol),t.childName.textContent=a.name,t.childLogo.src=qe.logoPath(a.symbol),qe.hide(t.mainForm),qe.show(t.parentSyncing),e.prev=10,e.next=13,this.syncParent(r);case 13:this.success(this.current.asset.id),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(10),this.setError(e.t0.message||e.t0);case 19:qe.show(t.mainForm),qe.hide(t.parentSyncing);case 21:case"end":return e.stop()}}),e,this,[[10,16]])}))),function(){return c.apply(this,arguments)})},{key:"syncParent",value:function(e){var t=this,n=this.page,r=this.current.asset;return new Promise((function(a,o){var s=pt().assets[e.id].wallet;if(s&&s.synced)return a();t.parentSyncer=function(t){t.assetID===e.id&&(n.parentSyncPct.textContent=(100*t.syncProgress).toFixed(1))},t.createUpdater=function(e){if(e.assetID===r.id){switch(e.topic){case"QueuedCreationFailed":o(new Error("".concat(e.subject,": ").concat(e.details)));break;case"QueuedCreationSuccess":a();break;default:return}t.parentSyncer=null,t.createUpdater=null}}}))}},{key:"setAsset",value:(o=s(f().mark((function e(t){var n,r,a,o,s,i,c,l,u,d,h,p=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.parseAsset(t)){e.next=2;break}return e.abrupt("return");case 2:if(n=this.page,r=n.walletTypeTabs,a=this.current,o=a.winfo,s=a.asset,i=a.parentAsset,n.assetName.textContent=o.name,n.newWalletPass.value="",qe.empty(r),qe.hide(r,n.newWalletErr,n.tokenMsgBox),this.page.assetLogo.src=qe.logoPath(s.symbol),i&&(n.tokenParentLogo.src=qe.logoPath(i.symbol),n.tokenParentName.textContent=i.name,qe.show(n.tokenMsgBox)),c=i?i.info:null,!((l=c?c.availablewallets:o.availablewallets?o.availablewallets:[o.definition]).length>1)){e.next=34;break}qe.show(r),u=Cr(l),e.prev=16,h=f().mark((function e(){var t,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=d.value,(a=n.walletTabTmpl.cloneNode(!0)).dataset.tooltip=t.description,a.textContent=t.tab,r.appendChild(a),qe.bind(a,"click",(function(){var e,n=Cr(qe.kids(r));try{for(n.s();!(e=n.n()).done;)e.value.classList.remove("selected")}catch(e){n.e(e)}finally{n.f()}a.classList.add("selected"),p.update(t)}));case 6:case"end":return e.stop()}}),e)})),u.s();case 19:if((d=u.n()).done){e.next=23;break}return e.delegateYield(h(),"t0",21);case 21:e.next=19;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(16),u.e(e.t1);case 28:return e.prev=28,u.f(),e.finish(28);case 31:pt().bindTooltips(r),r.firstChild.classList.add("selected");case 34:return e.next=36,this.update(this.current.selectedDef);case 36:if(!s.walletCreationPending){e.next=39;break}return e.next=39,this.runParentSync();case 39:case"end":return e.stop()}}),e,this,[[16,25,28,31]])}))),function(e){return o.apply(this,arguments)})},{key:"parseAsset",value:function(e){if(this.current&&this.current.asset.id===e)return!1;var t=pt().assets[e],n=t.token;if(!n){if(!t.info)throw Error("this non-token asset has no wallet info!");return this.current={asset:t,winfo:t.info,selectedDef:t.info.availablewallets[0]},!0}var r=pt().user.assets[n.parentID];if(r.wallet)return this.current={asset:t,winfo:n,selectedDef:n.definition},!0;if(!r.info)throw Error("this parent has no wallet info!");return this.current={asset:t,parentAsset:r,winfo:n,selectedDef:r.info.availablewallets[0]},!0}},{key:"update",value:(a=s(f().mark((function e(t){var n,a,o,s,i,c,l,u,d,h,p,v,m,g,y,b,x,k;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.page,this.current.selectedDef=t,qe.hide(n.walletPassAndSubmitBttn,n.oneBttnBox,n.newWalletPassBox),a=t.guidelink,(o=t.configopts||[]).map((function(e){return e.isBirthdayConfig&&pt().seedGenTime>0&&(e.default=Gr(new Date)),e})),s=!1,i=Cr(o),e.prev=8,i.s();case 10:if((c=i.n()).done){e.next=17;break}if(!c.value.required){e.next=15;break}return s=!0,e.abrupt("break",17);case 15:e.next=10;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(8),i.e(e.t0);case 22:return e.prev=22,i.f(),e.finish(22);case 25:if(l=this.current,u=l.asset,d=l.parentAsset,h=l.winfo,(p=t.seeded||Boolean(u.token))&&!s?(qe.hide(n.walletSettingsHeader),qe.show(n.oneBttnBox)):p?(qe.show(n.walletPassAndSubmitBttn,n.walletSettingsHeader),n.newWalletPass.value="",n.submitAdd.textContent=xe("CREATE")):(qe.show(n.walletPassAndSubmitBttn,n.walletSettingsHeader),t.noauth||qe.show(n.newWalletPassBox),n.submitAdd.textContent=xe("ADD")),d){v=JSON.parse(JSON.stringify(o)),m=Cr(v);try{for(m.s();!(g=m.n()).done;)g.value.regAsset=d.id}catch(e){m.e(e)}finally{m.f()}if((y=h.definition.configopts||[]).length>0){b=JSON.parse(JSON.stringify(y)),x=Cr(b);try{for(x.s();!(k=x.n()).done;)k.value.regAsset=u.id}catch(e){x.e(e)}finally{x.f()}v.push.apply(v,r(b))}this.subform.update(u.id,v,!1)}else this.subform.update(u.id,o,!1);return this.setGuideLink(a),t.seeded||Boolean(this.current.asset.token)?qe.hide(this.subform.fileSelector):qe.show(this.subform.fileSelector),e.next=33,this.loadDefaults();case 33:case"end":return e.stop()}}),e,this,[[8,19,22,25]])}))),function(e){return a.apply(this,arguments)})},{key:"setGuideLink",value:function(e){qe.hide(this.walletCfgGuide),""!==e&&(this.walletCfgGuide.href=e,qe.show(this.walletCfgGuide))}},{key:"setError",value:(n=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.page.newWalletErr.textContent=t,qe.show(this.page.newWalletErr);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"loadDefaults",value:(t=s(f().mark((function e(){var t,n,r,a,o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.current,n=t.asset,r=t.parentAsset,(a=t.selectedDef).configpath){e.next=3;break}return e.abrupt("return");case 3:if(o=n.id,!r){e.next=8;break}if(!a.seeded){e.next=7;break}return e.abrupt("return");case 7:o=r.id;case 8:return s=pt().loading(this.form),e.next=11,S("/api/defaultwalletcfg",{assetID:o,type:a.type});case 11:if(i=e.sent,s(),pt().checkResponse(i)){e.next=16;break}return this.setError(i.msg),e.abrupt("return");case 16:this.subform.setLoadedConfig(i.config);case 17:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Tr=0,Ir=function(){function e(t,n){var r=this;i(this,e),h(this,"page",void 0),h(this,"form",void 0),h(this,"configElements",void 0),h(this,"configOpts",void 0),h(this,"sectionize",void 0),h(this,"allSettings",void 0),h(this,"dynamicOpts",void 0),h(this,"textInputTmpl",void 0),h(this,"dateInputTmpl",void 0),h(this,"checkboxTmpl",void 0),h(this,"repeatableTmpl",void 0),h(this,"fileSelector",void 0),h(this,"fileInput",void 0),h(this,"errMsg",void 0),h(this,"showOther",void 0),h(this,"showIcon",void 0),h(this,"hideIcon",void 0),h(this,"showHideMsg",void 0),h(this,"otherSettings",void 0),h(this,"loadedSettingsMsg",void 0),h(this,"loadedSettings",void 0),h(this,"defaultSettingsMsg",void 0),h(this,"defaultSettings",void 0),h(this,"assetHasActiveOrders",void 0),h(this,"assetID",void 0),this.page=qe.idDescendants(t),this.form=t,this.configElements=[],this.configOpts=[],this.sectionize=n,this.allSettings=qe.tmplElement(t,"allSettings"),this.dynamicOpts=qe.tmplElement(t,"dynamicOpts"),this.textInputTmpl=qe.tmplElement(t,"textInput"),this.textInputTmpl.remove(),this.dateInputTmpl=qe.tmplElement(t,"dateInput"),this.dateInputTmpl.remove(),this.checkboxTmpl=qe.tmplElement(t,"checkbox"),this.checkboxTmpl.remove(),this.repeatableTmpl=qe.tmplElement(t,"repeatableInput"),this.repeatableTmpl.remove(),this.fileSelector=qe.tmplElement(t,"fileSelector"),this.fileInput=qe.tmplElement(t,"fileInput"),this.errMsg=qe.tmplElement(t,"errMsg"),this.showOther=qe.tmplElement(t,"showOther"),this.showIcon=qe.tmplElement(t,"showIcon"),this.hideIcon=qe.tmplElement(t,"hideIcon"),this.showHideMsg=qe.tmplElement(t,"showHideMsg"),this.otherSettings=qe.tmplElement(t,"otherSettings"),this.loadedSettingsMsg=qe.tmplElement(t,"loadedSettingsMsg"),this.loadedSettings=qe.tmplElement(t,"loadedSettings"),this.defaultSettingsMsg=qe.tmplElement(t,"defaultSettingsMsg"),this.defaultSettings=qe.tmplElement(t,"defaultSettings"),n||qe.hide(this.showOther),qe.bind(this.fileSelector,"click",(function(){return r.fileInput.click()})),qe.bind(this.fileInput,"change",s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.fileInputChanged());case 1:case"end":return e.stop()}}),e)})))),qe.bind(this.showOther,"click",(function(){r.setOtherSettingsViz(r.hideIcon.classList.contains("d-hide"))}))}var t;return d(e,[{key:"fileInputChanged",value:(t=s(f().mark((function e(){var t,n,a,o,s,i,c,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(qe.hide(this.errMsg),this.fileInput.value){e.next=3;break}return e.abrupt("return");case 3:if((n=this.fileInput.files)&&0!==n.length){e.next=6;break}return e.abrupt("return");case 6:return a=pt().loading(this.form),e.next=9,n[0].text();case 9:if(o=e.sent){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,S("/api/parseconfig",{configtext:o});case 14:if(s=e.sent,a(),pt().checkResponse(s)){e.next=20;break}return this.errMsg.textContent=s.msg,qe.show(this.errMsg),e.abrupt("return");case 20:if(0!==Object.keys(s.map).length){e.next=22;break}return e.abrupt("return");case 22:(t=this.dynamicOpts).append.apply(t,r(this.setConfig(s.map))),this.reorder(this.dynamicOpts),i=[this.loadedSettings.children.length,this.defaultSettings.children.length],l=i[1],0===(c=i[0])&&qe.hide(this.loadedSettings,this.loadedSettingsMsg),0===l&&qe.hide(this.defaultSettings,this.defaultSettingsMsg),c+l===0&&qe.hide(this.showOther,this.otherSettings);case 28:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"addOpt",value:function(e,t,n,r){var a,o,s=this;if(t.isboolean)o=this.checkboxTmpl.cloneNode(!0);else if(t.isdate)o=this.dateInputTmpl.cloneNode(!0);else if(t.repeatable){if((o=this.repeatableTmpl.cloneNode(!0)).classList.add("repeatable"),qe.bind(qe.tmplElement(o,"add"),"click",(function(){s.addOpt(e,t,o,!0)})),!r)for(var i=0;i<(t.repeatN?t.repeatN-1:0);i++)this.addOpt(e,t,n,!0)}else o=this.textInputTmpl.cloneNode(!0);-1!==((null===(a=pt().extensionWallet(this.assetID))||void 0===a?void 0:a.hiddenFields)||[]).indexOf(t.key)&&qe.hide(o),this.configElements.push([t,o]);var c=o.querySelector("input");c.dataset.configKey=t.key,Tr++;var l="wcfg-"+String(Tr);c.id=l;var u=qe.safeSelector(o,"label");if(u.htmlFor=l,u.prepend(t.displayname),void 0!==t.regAsset){var d=new window.Image(15,15);d.src=qe.logoPathFromID(t.regAsset||-1),u.prepend(d)}if(n?n.after(o):e.appendChild(o),t.noecho&&(c.type="password",c.autocomplete="off"),t.description&&(u.dataset.tooltip=t.description),t.isboolean)c.checked=t.default;else if(t.isdate){var h=function(e){return e?Xr("now"===e?new Date:new Date(1e3*e)):""};c.max=h(t.max),c.min=h(t.min);var p=t.default?new Date(1e3*t.default):new Date;c.value=Xr(p)}else c.value=null!==t.default?t.default:"";return c.disabled=Boolean(t.disablewhenactive&&this.assetHasActiveOrders),o}},{key:"update",value:function(e,t,n){if(this.assetHasActiveOrders=n,this.configElements=[],this.configOpts=t||[],this.assetID=e,qe.empty(this.dynamicOpts,this.defaultSettings,this.loadedSettings),0===this.configOpts.length)return qe.hide(this.form);qe.show(this.form),this.setOtherSettingsViz(!1),qe.hide(this.loadedSettingsMsg,this.loadedSettings,this.defaultSettingsMsg,this.defaultSettings,this.errMsg);var r,a=[],o=Cr(this.configOpts);try{for(o.s();!(r=o.n()).done;){var s=r.value;this.sectionize&&null!==s.default?a.push(s):this.addOpt(this.dynamicOpts,s)}}catch(e){o.e(e)}finally{o.f()}if(a.length){var i,c=Cr(a);try{for(c.s();!(i=c.n()).done;){var l=i.value;this.addOpt(this.defaultSettings,l)}}catch(e){c.e(e)}finally{c.f()}qe.show(this.showOther,this.defaultSettingsMsg,this.defaultSettings)}else qe.hide(this.showOther);pt().bindTooltips(this.allSettings),this.dynamicOpts.children.length?qe.show(this.dynamicOpts):qe.hide(this.dynamicOpts)}},{key:"setOtherSettingsViz",value:function(e){if(e)return qe.hide(this.showIcon),qe.show(this.hideIcon,this.otherSettings),void(this.showHideMsg.textContent=xe("HIDE_ADDITIONAL_SETTINGS"));qe.hide(this.hideIcon,this.otherSettings),qe.show(this.showIcon),this.showHideMsg.textContent=xe("SHOW_ADDITIONAL_SETTINGS")}},{key:"setConfig",value:function(e){for(var t,n=[],o={},s=[],i=0,c=r(this.configElements);i<c.length;i++){var l=c[i],u=a(l,2),d=u[0],h=u[1],p=e[d.key];if(void 0!==p)if(d.repeatable){if(o[d.key]){h.remove(),s.push(l);continue}o[d.key]=!0;var f=p.split(d.repeatable),v=f[0];n.push(h),qe.safeSelector(h,"input").value=v;for(var m=1;m<(d.repeatN||1);m++)n.push(this.addOpt(h.parentElement,d,h,!0));for(var g=1;g<f.length;g++){var y=this.addOpt(h.parentElement,d,h,!0);qe.safeSelector(y,"input").value=f[g],n.push(y)}}else{n.push(h);var b=qe.safeSelector(h,"input");d.isboolean?b.checked="1"===(t=p)||"true"===t.toLowerCase():d.isdate?b.value=Xr(new Date(1e3*parseInt(p))):b.value=p}}for(var x=0,k=s;x<k.length;x++){var w=k[x],C=this.configElements.indexOf(w);C>=0&&this.configElements.splice(C,1)}return n}},{key:"setLoadedConfig",value:function(e){var t,n=this.setConfig(e);this.sectionize&&0!==n.length&&((t=this.loadedSettings).append.apply(t,r(n)),this.reorder(this.loadedSettings),qe.show(this.loadedSettings,this.loadedSettingsMsg),0===this.defaultSettings.children.length&&qe.hide(this.defaultSettings,this.defaultSettingsMsg))}},{key:"map",value:function(e){var t,n={},r=Cr(this.configElements);try{for(r.s();!(t=r.n()).done;){var o=a(t.value,2),s=o[0],i=o[1],c=qe.safeSelector(i,"input");if(void 0===s.regAsset||s.regAsset===e)if(s.isboolean&&s.key)n[s.key]=c.checked?"1":"0";else if(s.isdate&&s.key){var l=c.min?Gr(new Date(c.min+"T00:00")):Number.MIN_SAFE_INTEGER,u=c.max?Gr(new Date(c.max+"T00:00")):Number.MAX_SAFE_INTEGER,d=c.value?Gr(new Date(c.value+"T00:00")):0;d<l?d=l:d>u&&(d=u),n[s.key]=String(d)}else c.value&&(s.repeatable&&n[s.key]?n[s.key]+=s.repeatable+c.value:n[s.key]=c.value)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"reorder",value:function(e){var t=this,n={};e.querySelectorAll("input").forEach((function(e){var r=e.dataset.configKey;if(r){var o,s=[],i=Cr(t.configElements);try{for(i.s();!(o=i.n()).done;){var c=a(o.value,2),l=c[0],u=c[1];l.key===r&&s.push(u)}}catch(e){i.e(e)}finally{i.f()}n[r]=s}}));var r,o=Cr(this.configOpts);try{for(o.s();!(r=o.n()).done;){var s,i=r.value,c=Cr(n[i.key]||[]);try{for(c.s();!(s=c.n()).done;){var l=s.value;e.append(l)}}catch(e){c.e(e)}finally{c.f()}}}catch(e){o.e(e)}finally{o.f()}}}]),e}(),Ar=function(){function e(t,n,r){var a=this;i(this,e),h(this,"form",void 0),h(this,"success",void 0),h(this,"page",void 0),h(this,"xc",void 0),h(this,"certFile",void 0),h(this,"bondAssetID",void 0),h(this,"tier",void 0),h(this,"fees",void 0),this.form=t,this.success=n,this.page=qe.parseTemplate(t),this.certFile="",qe.bind(this.page.goBack,"click",(function(){return r()})),zr(t,this.page.submit,(function(){return a.submitForm()}))}var t,n;return d(e,[{key:"setExchange",value:function(e,t){this.xc=e,this.certFile=t,this.page.host.textContent=e.host}},{key:"setAsset",value:function(e,t,n){var r=pt().assets[e],a=r.unitInfo.conventional,o=a.conversionFactor,s=a.unit;this.bondAssetID=r.id,this.tier=t,this.fees=n;var i=this.page,c=this.xc.bondAssets[r.symbol].amount*t*2/o;i.tradingTier.textContent=String(t),i.logo.src=qe.logoPath(r.symbol),i.bondLock.textContent=qe.formatFourSigFigs(c),i.bondUnit.textContent=s;var l=pt().fiatRatesMap[e];qe.show(i.bondLockUSDBox),l?i.bondLockUSD.textContent=qe.formatFourSigFigs(c*l):qe.hide(i.bondLockUSDBox),n&&(i.feeReserves.textContent=qe.formatFourSigFigs(n/o)),i.reservesUnit.textContent=s}},{key:"setFees",value:function(e,t){this.fees=t;var n=pt().assets[e].unitInfo.conventional.conversionFactor;this.page.feeReserves.textContent=qe.formatFourSigFigs(t/n)}},{key:"animate",value:(n=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.form,qe.animate(400,(function(e){t.style.transform="scale(".concat(e,")"),t.style.opacity=String(Math.pow(e,4));var n="".concat(500*(1-e),"px");t.style.top=n,t.style.left=n}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"submitForm",value:(t=s(f().mark((function e(){var t,n,r,a,o,s,i,c,l,u,d,h;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,n=this.bondAssetID,r=this.xc,a=this.certFile,o=this.tier,s=pt().assets[n]){e.next=6;break}return t.regErr.innerText=xe("SELECT_WALLET_FOR_FEE_PAYMENT"),qe.show(t.regErr),e.abrupt("return");case 6:return qe.hide(t.regErr),i=r.bondAssets[s.wallet.symbol],c=r.host,!pt().exchanges[r.host]||pt().exchanges[r.host].viewOnly?(l={addr:c,cert:a,bond:i.amount*o,asset:i.id},u="/api/postbond"):(l={host:c,targetTier:o,bondAssetID:n},u="/api/updatebondoptions"),d=pt().loading(this.form),e.next=13,S(u,l);case 13:if(h=e.sent,d(),pt().checkResponse(h)){e.next=19;break}return t.regErr.textContent=h.msg,qe.show(t.regErr),e.abrupt("return");case 19:this.success();case 20:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Rr=function(){function e(t,n){var r=this;i(this,e),h(this,"form",void 0),h(this,"success",void 0),h(this,"xc",void 0),h(this,"selectedAssetID",void 0),h(this,"certFile",void 0),h(this,"page",void 0),h(this,"assetRows",void 0),h(this,"marketRows",void 0),this.form=t,this.certFile="",this.success=n;var a=this.page=qe.parseTemplate(t);qe.cleanTemplates(a.currentBondTmpl,a.bondAssetTmpl,a.marketTmpl),qe.bind(a.tradingTierInput,"input",(function(){r.setTier()})),qe.bind(a.tradingTierInput,"keyup",(function(e){"Enter"===e.key&&r.acceptTier()})),qe.bind(a.submitTradingTier,"click",(function(){r.acceptTier()})),qe.bind(a.tierUp,"click",(function(){r.incrementTier(!0)})),qe.bind(a.tierDown,"click",(function(){r.incrementTier(!1)})),qe.bind(a.goBackToAssets,"click",(function(){qe.hide(a.tradingTierForm),qe.show(a.assetForm)})),qe.bind(a.whatsABond,"click",(function(){qe.hide(a.assetForm),qe.show(a.whatsABondPanel)}));var o=function(){qe.show(a.assetForm),qe.hide(a.whatsABondPanel)};qe.bind(a.bondGotIt,"click",(function(){o()})),qe.bind(a.whatsABondBack,"click",(function(){o()})),qe.bind(a.usePrepaidBond,"click",(function(){r.showPrepaidBondForm()})),qe.bind(a.ppbGoBack,"click",(function(){r.hidePrepaidBondForm()})),qe.bind(a.submitPrepaidBond,"click",(function(){r.submitPrepaidBond()})),pt().registerNoteFeeder({createwallet:function(e){"QueuedCreationSuccess"===e.topic&&r.walletCreated(e.assetID)}})}var t,n;return d(e,[{key:"setTierError",value:function(e){this.page.tradingTierErr.textContent=e,qe.show(this.page.tradingTierErr)}},{key:"setAssetError",value:function(e){this.page.regAssetErr.textContent=e,qe.show(this.page.regAssetErr)}},{key:"clearErrors",value:function(){qe.hide(this.page.regAssetErr,this.page.tradingTierErr)}},{key:"setExchange",value:function(e,t){var n=this;this.xc=e,this.certFile=t,this.assetRows={},this.marketRows=[];var r=this.page;qe.hide(r.assetForm,r.tradingTierForm,r.whatsABondPanel,r.prepaidBonds),qe.empty(r.bondAssets,r.markets),this.clearErrors();for(var a=function(e,t){var a=pt().assets[e];if(a){var o=a.unitInfo.conventional,s=o.unit,i=o.conversionFactor,c=a.name,l=a.symbol,u=r.bondAssetTmpl.cloneNode(!0);r.bondAssets.appendChild(u);var d=qe.parseTemplate(u);d.logo.src=qe.logoPath(l),d.name.textContent=c,qe.bind(u,"click",(function(){n.assetSelected(e)})),d.feeSymbol.textContent=s;var h=t.amount/i;d.feeAmt.textContent=qe.formatFourSigFigs(h);var p=pt().fiatRatesMap[e];qe.setVis(p,d.fiatBox),p&&(d.fiatBondAmount.textContent=qe.formatFourSigFigs(h*p)),n.assetRows[e]={ready:d.ready}}},o=function(t){var a=t.baseid,o=t.quoteid,s=[pt().assets[a],pt().assets[o]];if(s[0]&&s[1]){var i=r.marketTmpl.cloneNode(!0);r.markets.appendChild(i);var c,l=e.assets[a],u=l.symbol,d=l.unitInfo,h=e.assets[o],p=h.symbol,f=h.unitInfo,v=Cr(qe.applySelector(i,"[data-base-ticker]"));try{for(v.s();!(c=v.n()).done;)c.value.textContent=d.conventional.unit}catch(e){v.e(e)}finally{v.f()}var m,g=Cr(qe.applySelector(i,"[data-quote-ticker]"));try{for(g.s();!(m=g.n()).done;)m.value.textContent=f.conventional.unit}catch(e){g.e(e)}finally{g.f()}var y=qe.parseTemplate(i);y.baseLogo.src=qe.logoPath(u),y.quoteLogo.src=qe.logoPath(p);var b=function(e){var n=t.parcelsize,o=t.lotsize/d.conventional.conversionFactor,s=o*n*2*e,i=o*n*2*wn*e;y.tradeLimitLow.textContent=qe.formatFourSigFigs(s),y.tradeLimitHigh.textContent=qe.formatFourSigFigs(i);var c=pt().fiatRatesMap[a];c&&(y.fiatTradeLimitLow.textContent=qe.formatFourSigFigs(s*c),y.fiatTradeLimitHigh.textContent=qe.formatFourSigFigs(i*c)),qe.setVis(c,r.fiatTradeLowBox,r.fiatTradeHighBox)};b(Sn(e.auth)||1),n.marketRows.push({mkt:t,tmpl:y,setTier:b})}},s=0,i=Object.values(e.assets||{});s<i.length;s++){var c=i[s],l=c.symbol,u=c.id;if(pt().assets[u]){var d=e.bondAssets[l];d&&a(u,d)}}for(var h=0,p=Object.values(e.markets||{});h<p.length;h++)o(p[h]);r.tradingTierInput.value=e.auth.targetTier?String(e.auth.targetTier):"1",this.validBondAssetSelected(e)?this.assetSelected(e.auth.bondAssetID):qe.show(r.assetForm)}},{key:"validBondAssetSelected",value:function(e){if(e.viewOnly)return!1;var t=e.auth,n=t.targetTier,r=t.bondAssetID;if(n<1)return!1;var a=pt().assets[r];return a&&Boolean(e.bondAssets[a.symbol])}},{key:"walletCreated",value:function(e){var t=this.assetRows[e],n=pt().assets[e];!function(e,t){t.wallet?e.textContent=xe("WALLET_READY"):t.walletCreationPending?e.textContent=xe("WALLET_PENDING"):e.textContent=xe("SETUP_NEEDED"),e.classList.remove("readygreen","setuporange"),e.classList.add(t.wallet?"readygreen":"setuporange")}(t.ready,n)}},{key:"refresh",value:function(){this.setExchange(this.xc,this.certFile)}},{key:"assetSelected",value:function(e){this.selectedAssetID=e,this.setTier();var t=this.page,n=t.assetForm,r=t.tradingTierForm,a=t.tradingTierInput;qe.hide(n),qe.show(r),a.focus()}},{key:"setTier",value:function(){var e,t=this.page,n=this.xc.bondAssets,r=this.selectedAssetID,o=pt().assets[r],s=o.symbol,i=o.unitInfo,c=i.conventional,l=c.conversionFactor,u=c.unit,d=n[s],h=null!==(e=t.tradingTierInput.value)&&void 0!==e?e:"";if(h){var p=parseInt(h);if(isNaN(p))this.setTierError(xe(ie));else{t.tradingTierInput.value=String(p),t.bondSizeDisplay.textContent=qe.formatCoinValue(d.amount,i);var f,v=Cr(qe.applySelector(t.tradingTierForm,"[data-tier]"));try{for(v.s();!(f=v.n()).done;)f.value.textContent=String(p)}catch(e){v.e(e)}finally{v.f()}var m,g=Cr(qe.applySelector(t.tradingTierForm,"[data-bond-asset-ticker]"));try{for(g.s();!(m=g.n()).done;)m.value.textContent=u}catch(e){g.e(e)}finally{g.f()}var y=d.amount*p*2;t.bondLockDisplay.textContent=qe.formatCoinValue(y,i);var b=pt().fiatRatesMap[r];b&&(t.fiatLockDisplay.textContent=qe.formatFourSigFigs(y/l*b));for(var x=0,k=Object.values(this.marketRows);x<k.length;x++)k[x].setTier(p);for(var w={},C=0,S=Object.entries(pt().assets);C<S.length;C++){var F=a(S[C],2),D=F[0],T=F[1].wallet;if(T){var I=T.balance,A=I.bondlocked+I.bondReserves;A>0&&(w[parseInt(D)]=A)}}var R=Object.keys(w).length>0;if(qe.setVis(R,t.currentBondBox),R){qe.empty(t.currentBonds);for(var E=0,B=Object.entries(w);E<B.length;E++){var P=a(B[E],2),L=P[0],O=P[1],M=parseInt(L),q=pt().assets[M],N=q.unitInfo,W=q.symbol,V=q.name,U=N.conventional,_=U.conversionFactor,j=U.unit,H=t.currentBondTmpl.cloneNode(!0);t.currentBonds.appendChild(H);var z=qe.parseTemplate(H);z.icon.src=qe.logoPath(W),z.name.textContent=V,z.amt.textContent=qe.formatCoinValue(O,N),z.ticker.textContent=j,z.name.textContent=V;var G=pt().fiatRatesMap[M];qe.setVis(z.fiatBox),G&&(z.fiatAmt.textContent=qe.formatFourSigFigs(O/_*G))}}qe.setVis(b,t.fiatLockBox)}}}},{key:"acceptTier",value:function(){var e,t=this.page,n=this.selectedAssetID;this.clearErrors();var r=null!==(e=t.tradingTierInput.value)&&void 0!==e?e:"";if(r){var a=parseInt(r);isNaN(a)?this.setTierError(xe(ie)):this.success(n,a)}}},{key:"incrementTier",value:function(e){var t,n=this.page.tradingTierInput;n.value=String(Math.max(1,(parseInt(null!==(t=n.value)&&void 0!==t?t:"")||1)+(e?1:-1))),this.setTier()}},{key:"animate",value:(n=s(f().mark((function e(){var t,n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=this.form,r=Array.from(t.bondAssets.children),n.style.opacity="0",e.next=8,qe.animate(350,(function(e){for(var t=0,a=r;t<a.length;t++){var o=a[t];o.style.marginTop="".concat(75*(1-e),"px"),o.style.transform="scale(".concat(e,")")}n.style.opacity=Math.pow(e,4).toFixed(1),n.style.top="".concat(50*(1-e),"px")}),"easeOut");case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"showPrepaidBondForm",value:function(){var e=this.page;qe.hide(e.assetForm,e.prepaidBondErr),e.prepaidBondCode.value="",qe.show(e.prepaidBonds)}},{key:"hidePrepaidBondForm",value:function(){var e=this.page;qe.hide(e.prepaidBonds),qe.show(e.assetForm)}},{key:"submitPrepaidBond",value:(t=s(f().mark((function e(){var t,n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,n=this.xc.host,qe.hide(t.prepaidBondErr),r=t.prepaidBondCode.value){e.next=7;break}return t.prepaidBondErr.textContent=xe(ue),qe.show(t.prepaidBondErr),e.abrupt("return");case 7:return e.next=9,S("/api/redeemprepaidbond",{host:n,code:r,cert:this.certFile});case 9:if(a=e.sent,pt().checkResponse(a)){e.next=14;break}return t.prepaidBondErr.textContent=a.msg,qe.show(t.prepaidBondErr),e.abrupt("return");case 14:this.success(ht,a.tier);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Er=function(){function e(t,n,r){var a=this;i(this,e),h(this,"form",void 0),h(this,"success",void 0),h(this,"goBack",void 0),h(this,"page",void 0),h(this,"assetID",void 0),h(this,"parentID",void 0),h(this,"xc",void 0),h(this,"bondAsset",void 0),h(this,"progressCache",void 0),h(this,"progressed",void 0),h(this,"funded",void 0),h(this,"bondFeeBuffer",void 0),h(this,"parentAssetSynced",void 0),this.form=t,this.success=n,this.page=qe.parseTemplate(t),this.assetID=-1,this.progressCache=[],this.progressed=!1,this.funded=!1,qe.bind(this.page.goBack,"click",(function(){a.assetID=-1,r()})),pt().registerNoteFeeder({walletstate:function(e){return a.reportWalletState(e.wallet)},walletsync:function(e){if(e.assetID===a.assetID){var t=pt().walletMap[e.assetID];a.reportProgress(t.synced,t.syncProgress)}},balance:function(e){return a.reportBalance(e.assetID)}})}return d(e,[{key:"setExchange",value:function(e){this.xc=e}},{key:"setWallet",value:function(e,t,n){this.assetID=e,this.progressCache=[],this.progressed=!1,this.funded=!1,this.bondFeeBuffer=t,this.parentAssetSynced=!1;var r=this.page,a=pt().assets[e],o=a.symbol,s=a.unitInfo,i=a.wallet,c=i.balance,l=i.address,u=i.synced,d=i.syncProgress,h=a.token;this.parentID=null==h?void 0:h.parentID;var p,f=this.bondAsset=this.xc.bondAssets[o],v=function(e,t){qe.empty(e),e.appendChild(qe.symbolize(t))},m=Cr(qe.applySelector(this.form,".unit"));try{for(m.s();!(p=m.n()).done;)v(p.value,a)}catch(e){m.e(e)}finally{m.f()}r.logo.src=qe.logoPath(o),r.depoAddr.textContent=l,qe.hide(r.syncUncheck,r.syncCheck,r.balUncheck,r.balCheck,r.syncRemainBox,r.bondCostBreakdown),qe.show(r.balanceBox);var g=2*f.amount*n;if(t>0){qe.show(r.bondCostBreakdown),r.bondLockNoFees.textContent=qe.formatCoinValue(g,s),r.bondLockFees.textContent=qe.formatCoinValue(t,s),g+=t;var y=Math.max(g-c.available+c.reservesDeficit,0);if(r.totalForBond.textContent=qe.formatCoinValue(y,s),qe.hide(r.sendEnough),qe.hide(r.txFeeBox,r.sendEnoughForToken,r.txFeeBalanceBox),qe.hide(r.sendEnoughWithEst),h){qe.show(r.txFeeBox,r.sendEnoughForToken,r.txFeeBalanceBox);var b=pt().assets[h.parentID];r.txFee.textContent=qe.formatCoinValue(t,b.unitInfo),r.parentFees.textContent=qe.formatCoinValue(t,b.unitInfo),r.tokenFees.textContent=qe.formatCoinValue(y,s),v(r.txFeeUnit,b),v(r.parentUnit,b),v(r.parentBalUnit,b),r.parentBal.textContent=b.wallet?qe.formatCoinValue(b.wallet.balance.available,b.unitInfo):"0"}else qe.show(r.sendEnoughWithEst);r.fee.textContent=qe.formatCoinValue(g,s)}else qe.show(r.sendEnough);qe.show(u?r.syncCheck:d>=1?r.syncSpinner:r.syncUncheck),qe.show(c.available>=2*f.amount+t?r.balCheck:r.balUncheck),r.progress.textContent=(100*d).toFixed(1),u&&(this.progressed=!0),this.reportBalance(e)}},{key:"reportWalletState",value:function(e){this.progressed&&this.funded||(e.assetID===this.assetID&&this.reportProgress(e.synced,e.syncProgress),this.reportBalance(e.assetID))}},{key:"reportBalance",value:function(e){if(!this.funded&&-1!==this.assetID&&(e===this.assetID||e===this.parentID)){var t=this.page,n=pt().assets[this.assetID],r=n.wallet.balance.available;if(t.balance.textContent=qe.formatCoinValue(r,n.unitInfo),n.token){var a=pt().assets[n.token.parentID],o=a.wallet.balance.available;if(t.parentBal.textContent=qe.formatCoinValue(o,a.unitInfo),o<this.bondFeeBuffer)return}r<2*this.bondAsset.amount+this.bondFeeBuffer||(qe.show(t.balCheck),qe.hide(t.balUncheck,t.balanceBox,t.sendEnough),this.funded=!0,this.progressed&&this.success())}}},{key:"reportProgress",value:function(e,t){var n=this.page;if(e)return n.progress.textContent="100",qe.hide(n.syncUncheck,n.syncRemainBox,n.syncSpinner),qe.show(n.syncCheck),this.progressed=!0,void(this.funded&&this.success());if(1===t?(qe.hide(n.syncUncheck),qe.show(n.syncSpinner)):(qe.hide(n.syncSpinner),qe.show(n.syncUncheck)),n.progress.textContent=(100*t).toFixed(1),t>=.999)return qe.hide(n.syncRemaining),qe.show(n.syncFinishingUp),qe.show(n.syncRemainBox),void(n.syncFinishingUp.textContent=xe("WALLET_SYNC_FINISHING_UP"));var r=this.progressCache;if(r.push({stamp:(new Date).getTime(),progress:t}),!(r.length<2)){for(;r.length>20;)r.shift();var a=[r[0],r[r.length-1]],o=a[0],s=a[1],i=s.progress-o.progress;if(0!==i){qe.hide(n.syncFinishingUp),qe.show(n.syncRemaining),qe.show(n.syncRemainBox);var c=i/(s.stamp-o.stamp),l=(1-s.progress)/c;n.syncRemain.textContent=qe.formatDuration(l)}}}}]),e}(),Br=function(){function e(t,n){var r=this;i(this,e),h(this,"form",void 0),h(this,"page",void 0),h(this,"order",void 0),h(this,"acceleratedRate",void 0),h(this,"earlyAcceleration",void 0),h(this,"currencyUnit",void 0),h(this,"success",void 0),this.form=t,this.success=n;var a=this.page=qe.idDescendants(t);qe.bind(a.accelerateSubmit,"click",(function(){r.submit()})),qe.bind(a.submitEarlyConfirm,"click",(function(){r.sendAccelerateRequest()}))}var t,n,r,a;return d(e,[{key:"displayEarlyAccelerationMsg",value:function(){var e=this.page;this.earlyAcceleration&&(e.recentAccelerationTime.textContent="".concat(Math.floor(this.earlyAcceleration.timePast/60)),e.recentSwapTime.textContent="".concat(Math.floor(this.earlyAcceleration.timePast/60)),this.earlyAcceleration.wasAcceleration?(qe.show(e.recentAccelerationMsg),qe.hide(e.recentSwapMsg),e.recentAccelerationTime.textContent="".concat(Math.floor(this.earlyAcceleration.timePast/60))):(qe.show(e.recentSwapMsg),qe.hide(e.recentAccelerationMsg),e.recentSwapTime.textContent="".concat(Math.floor(this.earlyAcceleration.timePast/60))),qe.hide(e.configureAccelerationDiv,e.accelerateErr),qe.show(e.earlyAccelerationDiv))}},{key:"sendAccelerateRequest",value:(a=s(f().mark((function e(){var t,n,r,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.order,n=this.page,r={orderID:t.id,newRate:this.acceleratedRate},a=pt().loading(n.accelerateMainDiv),e.next=6,S("/api/accelerateorder",r);case 6:o=e.sent,a(),pt().checkResponse(o)?(n.accelerateTxID.textContent=o.txID,qe.hide(n.accelerateMainDiv,n.preAccelerateErr,n.accelerateErr),qe.show(n.accelerateMsgDiv,n.accelerateSuccess),this.success()):(n.accelerateErr.textContent=xe(Z,{msg:o.msg}),qe.hide(n.earlyAccelerationDiv),qe.show(n.accelerateErr,n.configureAccelerationDiv));case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"submit",value:(r=s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.earlyAcceleration?this.displayEarlyAccelerationMsg():this.sendAccelerateRequest();case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"refresh",value:(n=s(f().mark((function e(t){var n,r,a,o,s,i,c=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.page,this.order=t,e.next=4,S("/api/preaccelerate",t.id);case 4:if(r=e.sent,pt().checkResponse(r)){e.next=10;break}return n.preAccelerateErr.textContent=xe(Z,{msg:r.msg}),qe.hide(n.accelerateMainDiv,n.accelerateSuccess),qe.show(n.accelerateMsgDiv,n.preAccelerateErr),e.abrupt("return");case 10:qe.hide(n.accelerateMsgDiv,n.preAccelerateErr,n.accelerateErr,n.feeEstimateDiv,n.earlyAccelerationDiv),qe.show(n.accelerateMainDiv,n.accelerateSuccess,n.configureAccelerationDiv),a=r.preAccelerate,this.earlyAcceleration=a.earlyAcceleration,this.currencyUnit=a.suggestedRange.yUnit,n.accelerateAvgFeeRate.textContent="".concat(a.swapRate," ").concat(a.suggestedRange.yUnit),n.accelerateCurrentFeeRate.textContent="".concat(a.suggestedRate," ").concat(a.suggestedRange.yUnit),this.acceleratedRate=a.suggestedRange.start.y,o=function(){},s=function(e,t){c.acceleratedRate=t},i=new xt(a.suggestedRange,a.suggestedRange.start.x,{updated:s,changed:function(){return c.updateAccelerationEstimate()},selected:o,roundY:!0}),qe.empty(n.sliderContainer),n.sliderContainer.appendChild(i.control),this.updateAccelerationEstimate();case 25:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"updateAccelerationEstimate",value:(t=s(f().mark((function e(){var t,n,r,a,o,s,i,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=this.order,r={orderID:n.id,newRate:this.acceleratedRate},a=pt().loading(t.sliderContainer),e.next=6,S("/api/accelerationestimate",r);case 6:if(o=e.sent,a(),pt().checkResponse(o)){e.next=12;break}return t.accelerateErr.textContent=xe("ORDER_ACCELERATION_FEE_ERR_MSG",{msg:o.msg}),qe.show(t.accelerateErr),e.abrupt("return");case 12:t.feeRateEstimate.textContent="".concat(this.acceleratedRate," ").concat(this.currencyUnit),n.sell?(s=n.baseID,i=n.baseSymbol):(s=n.quoteID,i=n.quoteSymbol),c=pt().unitInfo(s),t.feeEstimate.textContent="".concat(o.fee/c.conventional.conversionFactor," ").concat(i),qe.show(t.feeEstimateDiv);case 17:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Pr=function(){function e(t,n,r){var a=this;i(this,e),h(this,"form",void 0),h(this,"success",void 0),h(this,"page",void 0),h(this,"knownExchanges",void 0),h(this,"dexToUpdate",void 0),h(this,"certPicker",void 0),this.form=t,this.success=n;var o=this.page=qe.parseTemplate(t);this.certPicker=new Nr(t),qe.bind(o.skipRegistration,"change",(function(){return a.showOrHideSubmitBttn()})),qe.bind(o.showCustom,"click",(function(){qe.hide(o.showCustom),qe.show(o.customBox,o.auth)})),this.knownExchanges=Array.from(o.knownXCs.querySelectorAll(".known-exchange"));var s,c=Cr(this.knownExchanges);try{var l=function(){var e=s.value;qe.bind(e,"click",(function(){var t,n=e.dataset.host,r=Cr(a.knownExchanges);try{for(r.s();!(t=r.n()).done;)t.value.classList.remove("selected")}catch(e){r.e(e)}finally{r.f()}return a.checkDEX(n)}))};for(c.s();!(s=c.n()).done;)l()}catch(e){c.e(e)}finally{c.f()}zr(t,o.submit,(function(){return a.checkDEX()})),r&&(qe.hide(o.addDexHdr,o.skipRegistrationBox),qe.show(o.updateDexHdr),this.dexToUpdate=r),this.refresh()}var t,n;return d(e,[{key:"refresh",value:function(){var e=this.page;e.addr.value="",this.certPicker.clearCertFile(),qe.hide(e.err),0===this.knownExchanges.length||this.dexToUpdate?(qe.show(e.customBox,e.auth),qe.hide(e.showCustom,e.knownXCs,e.pickServerMsg,e.addCustomMsg)):(qe.hide(e.customBox),qe.show(e.showCustom));var t,n=Cr(this.knownExchanges);try{for(n.s();!(t=n.n()).done;)t.value.classList.remove("selected")}catch(e){n.e(e)}finally{n.f()}this.showOrHideSubmitBttn()}},{key:"showOrHideSubmitBttn",value:function(){var e=this.page;qe.setVis(qe.isDisplayed(e.customBox),e.auth)}},{key:"skipRegistration",value:function(){var e;return null!==(e=this.page.skipRegistration.checked)&&void 0!==e&&e}},{key:"animate",value:(n=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.form,qe.animate(550,(function(e){t.style.transform="scale(".concat(.9+.1*e,")"),t.style.opacity=String(Math.pow(e,4))}),"easeOut");case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"checkDEX",value:(t=s(f().mark((function e(t){var n,r,a,o,s,i,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.page,qe.hide(n.err),""!==(t=t||n.addr.value)){e.next=7;break}return n.err.textContent=xe("EMPTY_DEX_ADDRESS_MSG"),qe.show(n.err),e.abrupt("return");case 7:return e.next=9,this.certPicker.file();case 9:return r=e.sent,a=this.skipRegistration(),this.dexToUpdate?(o="/api/updatedexhost",s={newHost:t,cert:r,oldHost:this.dexToUpdate}):(o=a?"/api/adddex":"/api/discoveracct",s={addr:t,cert:r}),i=pt().loading(this.form),e.next=15,S(o,s);case 15:if(c=e.sent,i(),pt().checkResponse(c)){e.next=20;break}return String(c.msg).includes("certificate required")?qe.show(n.needCert):(n.err.textContent=c.msg,qe.show(n.err)),e.abrupt("return");case 20:return e.next=22,pt().fetchUser();case 22:if(this.dexToUpdate||!(a||c.paid||Object.keys(c.xc.auth.pendingBonds).length>0)){e.next=26;break}return e.next=25,pt().loadPage("markets");case 25:return e.abrupt("return");case 26:this.success(c.xc,r);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Lr=function(){function e(t,n,r){var a=this;i(this,e),h(this,"form",void 0),h(this,"addr",void 0),h(this,"success",void 0),h(this,"page",void 0),this.form=t,this.addr=n,this.success=r;var o=this.page=qe.parseTemplate(t);o.dexHost.textContent=n,zr(t,o.submit,(function(){return a.checkDEX()}))}var t,n;return d(e,[{key:"animate",value:(n=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.form,qe.animate(550,(function(e){t.style.transform="scale(".concat(.9+.1*e,")"),t.style.opacity=String(Math.pow(e,4))}),"easeOut");case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"checkDEX",value:(t=s(f().mark((function e(){var t,n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,qe.hide(t.err),n={addr:this.addr},r=pt().loading(this.form),e.next=6,S("/api/discoveracct",n);case 6:if(a=e.sent,r(),pt().checkResponse(a)){e.next=12;break}return t.err.textContent=a.msg,qe.show(t.err),e.abrupt("return");case 12:if(!a.paid){e.next=18;break}return e.next=15,pt().fetchUser();case 15:return e.next=17,pt().loadPage("markets");case 17:return e.abrupt("return");case 18:this.success(a.xc);case 19:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Or=function(){function e(t,n){var r=this;i(this,e),h(this,"form",void 0),h(this,"success",void 0),h(this,"page",void 0),this.success=n,this.form=t,zr(t,(this.page=qe.parseTemplate(t)).submit,(function(){r.submit()})),pt().registerNoteFeeder({login:function(e){r.handleLoginNote(e)}})}var t,n;return d(e,[{key:"handleLoginNote",value:function(e){if(""!==e.details){var t=qe.idel(this.form,"loaderMsg");qe.show(t),t&&(t.textContent=e.details)}}},{key:"focus",value:function(){this.page.pw.focus()}},{key:"refresh",value:function(){qe.hide(this.page.errMsg),this.page.pw.value=""}},{key:"submit",value:(n=s(f().mark((function e(){var t,n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,qe.hide(t.errMsg),""!==(n=t.pw.value||"")){e.next=6;break}return qe.showFormError(t.errMsg,xe(R)),e.abrupt("return");case 6:return r=pt().loading(this.form),e.next=9,S("/api/login",{pass:n});case 9:if(a=e.sent,r(),t.pw.value="",pt().checkResponse(a)){e.next=15;break}return qe.showFormError(t.errMsg,a.msg),e.abrupt("return");case 15:return e.next=17,pt().fetchUser();case 17:a.notes=a.notes||[],a.notes.reverse(),a.pokes=a.pokes||[],pt().loggedIn(a.notes,a.pokes),this.success();case 22:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"animate",value:(t=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.form,qe.animate(550,(function(e){t.style.transform="scale(".concat(.9+.1*e,")"),t.style.opacity=String(Math.pow(e,4))}),"easeOut");case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Mr=function(){function e(t){var n=this;i(this,e),h(this,"form",void 0),h(this,"page",void 0),h(this,"assetID",void 0),this.form=t;var r=this.page=qe.idDescendants(t);qe.cleanTemplates(r.unifiedReceiverTmpl),qe.bind(r.newDepAddrBttn,"click",s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.newDepositAddress();case 1:case"end":return e.stop()}}),e)})))),qe.bind(r.copyAddressBtn,"click",(function(){n.copyAddress()}))}var t,n,r;return d(e,[{key:"setAsset",value:(r=s(f().mark((function e(t){var n,r,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.assetID=t,n=this.page,qe.hide(n.depositErr,n.depositTokenMsgBox),r=pt().assets[t],n.depositLogo.src=qe.logoPath(r.symbol),a=pt().walletMap[t],n.depositName.textContent=r.unitInfo.conventional.unit,r.token&&(o=pt().assets[r.token.parentID],n.depositTokenParentLogo.src=qe.logoPath(o.symbol),n.depositTokenParentName.textContent=o.name,qe.show(n.depositTokenMsgBox)),qe.setVis(0!=(2&a.traits),n.newDepAddrBttnBox),this.setAddress(a.address);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setAddress",value:function(e){var t=this,n=this.page;if(qe.hide(n.unifiedReceivers),e.startsWith("unified:")){var r=JSON.parse(e.substring(8));qe.empty(n.unifiedReceivers),qe.show(n.unifiedReceivers);for(var o=function(){var e=a(i[s],2),r=e[0],o=e[1],c=n.unifiedReceiverTmpl.cloneNode(!0);n.unifiedReceivers.appendChild(c),c.textContent=r,c.dataset.type=r,"unified"===r&&c.classList.add("selected"),qe.bind(c,"click",(function(){for(var e=0,a=Array.from(n.unifiedReceivers.children);e<a.length;e++){var s=a[e];s.classList.toggle("selected",s.dataset.type===r)}t.setCentralAddress(o)}))},s=0,i=Object.entries(r);s<i.length;s++)o();e=r.unified}this.setCentralAddress(e)}},{key:"setCentralAddress",value:function(e){var t=this.page;t.depositAddress.textContent=e,t.qrcode.src="/generateqrcode?address=".concat(e)}},{key:"newDepositAddress",value:(n=s(f().mark((function e(){var t,n,r,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=this.assetID,r=this.form,qe.hide(t.depositErr),a=pt().loading(r),e.next=5,S("/api/depositaddress",{assetID:n});case 5:if(o=e.sent,a(),pt().checkResponse(o)){e.next=11;break}return t.depositErr.textContent=o.msg,qe.show(t.depositErr),e.abrupt("return");case 11:pt().walletMap[n].address=o.address,this.setAddress(o.address);case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"copyAddress",value:(t=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.page,navigator.clipboard.writeText(t.depositAddress.textContent||"").then((function(){qe.show(t.copyAlert),setTimeout((function(){qe.hide(t.copyAlert)}),800)})).catch((function(e){console.error("Unable to copy: ",e)}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),qr=function(){function e(t,n){var r=this;i(this,e),h(this,"form",void 0),h(this,"page",void 0),h(this,"success",void 0),this.form=t,this.success=n,zr(t,(this.page=qe.idDescendants(t)).resetAppPWSubmitBtn,(function(){return r.resetAppPW()}))}var t;return d(e,[{key:"resetAppPW",value:(t=s(f().mark((function e(){var t,n,r,a,o,s=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,n=t.newAppPassword.value||"",r=t.confirmNewAppPassword.value,""!==n){e.next=6;break}return qe.showFormError(t.appPWResetErrMsg,xe(R)),e.abrupt("return");case 6:if(n===r){e.next=9;break}return qe.showFormError(t.appPWResetErrMsg,xe(N)),e.abrupt("return");case 9:return a=pt().loading(this.form),e.next=12,S("/api/resetapppassword",{newPass:n,seed:t.seedInput.value});case 12:if(o=e.sent,a(),pt().checkResponse(o)){e.next=17;break}return qe.showFormError(t.appPWResetErrMsg,o.msg),e.abrupt("return");case 17:qe.isDisplayed(t.appPWResetErrMsg)&&qe.hide(t.appPWResetErrMsg),t.appPWResetSuccessMsg.textContent=xe("PASSWORD_RESET_SUCCESS_MSG"),qe.show(t.appPWResetSuccessMsg),setTimeout((function(){return s.success()}),3e3);case 21:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"focus",value:function(){this.page.newAppPassword.focus()}},{key:"refresh",value:function(){var e=this.page;e.newAppPassword.value="",e.confirmNewAppPassword.value="",e.seedInput.value="",qe.hide(e.appPWResetSuccessMsg,e.appPWResetErrMsg)}}]),e}(),Nr=function(){function e(t){var n=this;i(this,e),h(this,"page",void 0);var r=this.page=qe.parseTemplate(t);r.selectedCert.textContent=xe(j),qe.bind(r.certFile,"change",(function(){return n.onCertFileChange()})),qe.bind(r.removeCert,"click",(function(){return n.clearCertFile()})),qe.bind(r.addCert,"click",(function(){return r.certFile.click()}))}var t,n;return d(e,[{key:"onCertFileChange",value:(n=s(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,(n=t.certFile.files)&&n.length){e.next=4;break}return e.abrupt("return");case 4:t.selectedCert.textContent=n[0].name,qe.show(t.removeCert),qe.hide(t.addCert);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearCertFile",value:function(){var e=this.page;e.certFile.value="",e.selectedCert.textContent=xe(j),qe.hide(e.removeCert),qe.show(e.addCert)}},{key:"file",value:(t=s(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.page).certFile.value){e.next=7;break}if(!(n=t.certFile.files)||!n.length){e.next=7;break}return e.next=6,n[0].text();case 6:return e.abrupt("return",e.sent);case 7:return e.abrupt("return","");case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Wr=function(){function e(t,n){var r=this;i(this,e),h(this,"page",void 0),h(this,"success",void 0),h(this,"assetID",void 0),h(this,"parentID",void 0),h(this,"txFee",void 0),h(this,"host",void 0),this.page=qe.parseTemplate(t),this.success=n,qe.bind(this.page.submit,"click",(function(){r.approve()}))}var t,n;return d(e,[{key:"setAsset",value:(n=s(f().mark((function e(t,n){var r,a,o,s,i,c,l,u,d,h,p,v,m,g,y;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.assetID=t,this.host=n,a=pt().assets[t],o=this.parentID=null===(r=a.token)||void 0===r?void 0:r.parentID,s=this.page,qe.show(s.submissionElements),qe.hide(s.txMsg,s.errMsg,s.addressBox,s.balanceBox,s.addressBox),qe.empty(s.tokenSymbol),s.tokenSymbol.appendChild(qe.symbolize(a,!0)),i=pt().exchanges[n].assets[t].version,e.next=12,S("/api/approvetokenfee",{assetID:a.id,version:i,approving:!0});case 12:c=e.sent,pt().checkResponse(c)?(l=pt().assets[o],u=l.unitInfo,d=l.wallet,h=d.address,p=d.balance.available,v=l.name,m=this.txFee=c.txFee,g="".concat(qe.formatCoinValue(m,u)," ").concat(u.conventional.unit),(y=pt().fiatRatesMap[o])&&(g+=" (".concat(qe.formatFiatConversion(m,y,u)," USD)")),s.feeEstimate.textContent=g,qe.show(s.balanceBox),s.balance.textContent=qe.formatCoinValue(p,u),s.parentTicker.textContent=u.conventional.unit,s.parentName.textContent=v,p<m&&(qe.show(s.addressBox),s.address.textContent=h)):(s.errMsg.textContent=c.msg,qe.show(s.errMsg));case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"approve",value:(t=s(f().mark((function e(){var t,n,r,a,o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=this.assetID,r=this.host,a=this.success,o=pt().assets[n],e.next=5,S("/api/approvetoken",{assetID:o.id,dexAddr:r});case 5:if(s=e.sent,pt().checkResponse(s)){e.next=10;break}return t.errMsg.textContent=s.msg,qe.show(t.errMsg),e.abrupt("return");case 10:t.txid.innerText=s.txID,(i=Hn[o.id])&&i[pt().user.net]&&(t.txid.href=i[pt().user.net](s.txID)),qe.hide(t.submissionElements,t.balanceBox,t.addressBox),qe.show(t.txMsg),a&&a();case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"handleBalanceNote",value:function(e){var t=this.page,n=this.parentID,r=this.txFee;e.assetID===n&&(t.balance.textContent=qe.formatCoinValue(e.balance.available,pt().assets[n].unitInfo),e.balance.available>=r?qe.hide(t.addressBox):qe.hide(t.errMsg))}}]),e}(),Vr=function(){function e(t,n){var r=this;i(this,e),h(this,"form",void 0),h(this,"page",void 0),h(this,"success",void 0),h(this,"cexName",void 0),this.form=t,this.success=n,this.page=qe.parseTemplate(t),qe.bind(this.page.cexSubmit,"click",(function(){return r.submit()}))}var t;return d(e,[{key:"setCEX",value:function(e){this.cexName=e,lr(this.form,e);var t=this.page;qe.hide(t.cexConfigPrompt,t.cexConnectErrBox,t.cexFormErr),t.cexApiKeyInput.value="",t.cexSecretInput.value="";var n=pt().mmStatus.cexes[e],r=null==n?void 0:n.connectErr;r?(qe.show(t.cexConnectErrBox),t.cexConnectErr.textContent=r,t.cexApiKeyInput.value=n.config.apiKey,t.cexSecretInput.value=n.config.apiSecret):qe.show(t.cexConfigPrompt)}},{key:"submit",value:(t=s(f().mark((function e(){var t,n,r,a,o,s,i,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,n=this.cexName,r=this.form,qe.hide(t.cexFormErr),a=t.cexApiKeyInput.value,o=t.cexSecretInput.value,a&&o){e.next=8;break}return qe.show(t.cexFormErr),t.cexFormErr.textContent=xe(R),e.abrupt("return");case 8:return s=pt().loading(r),e.prev=9,e.next=12,sr.updateCEXConfig({name:n,apiKey:a,apiSecret:o});case 12:if(i=e.sent,pt().checkResponse(i)){e.next=15;break}throw i;case 15:return e.next=17,pt().fetchMMStatus();case 17:this.success(n),e.next=25;break;case 20:return e.prev=20,e.t0=e.catch(9),qe.show(t.cexFormErr),t.cexFormErr.textContent=xe(H,{msg:null!==(c=e.t0.msg)&&void 0!==c?c:String(e.t0)}),e.abrupt("return");case 25:return e.prev=25,s(),e.finish(25);case 28:case"end":return e.stop()}}),e,this,[[9,20,25,28]])}))),function(){return t.apply(this,arguments)})}]),e}(),Ur=300;function _r(e,t){return jr.apply(this,arguments)}function jr(){return(jr=s(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=document.body.offsetWidth/2,e.next=3,qe.animate(Ur,(function(e){t.style.right="".concat(e*r,"px")}),"easeInHard");case 3:return qe.hide(t),t.style.right="0",n.style.right=String(-r),qe.show(n),n.querySelector("input")&&qe.safeSelector(n,"input").focus(),e.next=10,qe.animate(Ur,(function(e){n.style.right="".concat(e*r-r,"px")}),"easeOutHard");case 10:n.style.right="0";case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hr(e,t){e.successMessage.textContent=t,qe.show(e.forms,e.checkmarkForm),e.checkmarkForm.style.right="0",e.checkmark.style.fontSize="0px";var n=a(k.isDark()?[223,226,225]:[51,51,51],3),r=n[0],o=n[1],s=n[2],i=16-r,c=163-o,l=16-s;return new Ne(1200,(function(t){e.checkmark.style.fontSize="".concat(80*t,"px"),e.checkmark.style.color="rgb(".concat(r+t*i,", ").concat(o+t*c,", ").concat(s+t*l,")")}),"easeOutElastic")}function zr(e,t,n){var r=function(e){e.preventDefault&&e.preventDefault(),n(e)};qe.bind(t,"click",r),qe.bind(e,"submit",r)}function Gr(e){return Math.floor(e.getTime()/1e3)}function Xr(e){return function(e){return new Date(e.getTime()-60*e.getTimezoneOffset()*1e3)}(e).toISOString().split("T")[0]}function Kr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Qr=function(e){g(k,e);var t,n,r,a,o,c,l,u,p,m,x=(p=k,m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(p);if(m){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return y(this,e)});function k(e,t){var n;i(this,k),h(v(n=x.call(this)),"body",void 0),h(v(n),"data",void 0),h(v(n),"xc",void 0),h(v(n),"page",void 0),h(v(n),"dexAddrForm",void 0),h(v(n),"discoverAcctForm",void 0),h(v(n),"newWalletForm",void 0),h(v(n),"regAssetForm",void 0),h(v(n),"walletWaitForm",void 0),h(v(n),"confirmRegisterForm",void 0),n.body=e,n.data=t;var r=n.page=qe.idDescendants(e);t.host&&r.dexAddrForm.classList.contains("selected")&&(r.dexAddrForm.classList.remove("selected"),r.discoverAcctForm.classList.add("selected"),r.discoverAcctForm.dataset.host=t.host);var a,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Kr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}(e.querySelectorAll(".form-closer"));try{for(o.s();!(a=o.n()).done;){var c=a.value;c!==r.resetPassFormCloser&&qe.hide(c)}}catch(e){o.e(e)}finally{o.f()}n.newWalletForm=new Dr(r.newWalletForm,(function(e){return n.newWalletCreated(e,n.confirmRegisterForm.tier)}),(function(){return n.animateRegAsset(r.newWalletForm)})),n.dexAddrForm=new Pr(r.dexAddrForm,function(){var e=s(f().mark((function e(t,a){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.requestFeepayment(r.dexAddrForm,t,a);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());var l=r.discoverAcctForm.dataset.host;l&&(n.discoverAcctForm=new Lr(r.discoverAcctForm,l,function(){var e=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.requestFeepayment(r.discoverAcctForm,t,"");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),n.regAssetForm=new Rr(r.regAssetForm,function(){var e=s(f().mark((function e(t,a){var o,s,i,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==ht){e.next=3;break}return n.registerDEXSuccess(),e.abrupt("return");case 3:if(o=pt().assets[t],!(s=o.wallet)){e.next=17;break}return i=n.xc.bondAssets[o.symbol],e.next=9,n.getBondsFeeBuffer(t,r.regAssetForm);case 9:if(c=e.sent,n.confirmRegisterForm.setAsset(t,a,c),!(s.synced&&s.balance.available>=2*i.amount+c)){e.next=14;break}return n.animateConfirmForm(r.regAssetForm),e.abrupt("return");case 14:return n.walletWaitForm.setWallet(t,c,a),_r(r.regAssetForm,r.walletWait),e.abrupt("return");case 17:n.confirmRegisterForm.tier=a,n.newWalletForm.setAsset(t),_r(r.regAssetForm,r.newWalletForm);case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),n.walletWaitForm=new Er(r.walletWait,(function(){n.animateConfirmForm(r.walletWait)}),(function(){n.animateRegAsset(r.walletWait)})),n.confirmRegisterForm=new Ar(r.confirmRegForm,(function(){n.registerDEXSuccess()}),(function(){n.animateRegAsset(r.confirmRegForm)}));var u=qe.safeSelector(r.forms,":scope > form.selected");switch(u.classList.remove("selected"),u){case r.dexAddrForm:n.dexAddrForm.animate();break;case r.discoverAcctForm:n.discoverAcctForm.animate()}return qe.show(u),u===r.discoverAcctForm&&n.discoverAcctForm.page.submit.click(),pt().authed&&n.auth(),n}return d(k,[{key:"auth",value:(u=s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt().fetchUser();case 2:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)})},{key:"requestFeepayment",value:(l=s(f().mark((function e(t,n,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.xc=n,this.confirmRegisterForm.setExchange(n,r),this.walletWaitForm.setExchange(n),this.regAssetForm.setExchange(n,r),this.animateRegAsset(t);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"animateRegAsset",value:(c=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:qe.hide(t),this.regAssetForm.animate(),qe.show(this.page.regAssetForm);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"animateConfirmForm",value:(o=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.confirmRegisterForm.animate(),qe.hide(t),qe.show(this.page.confirmRegForm);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getBondsFeeBuffer",value:(a=s(f().mark((function e(t,n){var r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=pt().loading(n),e.next=3,S("/api/bondsfeebuffer",{assetID:t});case 3:if(a=e.sent,r(),pt().checkResponse(a)){e.next=7;break}return e.abrupt("return",0);case 7:return e.abrupt("return",a.feeBuffer);case 8:case"end":return e.stop()}}),e)}))),function(e,t){return a.apply(this,arguments)})},{key:"getCertFile",value:(r=s(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="",!this.dexAddrForm.page.certFile.value){e.next=7;break}if(!(n=this.dexAddrForm.page.certFile.files)||!n.length){e.next=7;break}return e.next=6,n[0].text();case 6:t=e.sent;case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"registerDEXSuccess",value:(n=s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt().fetchUser();case 2:return pt().updateMenuItemsDisplay(),e.next=5,pt().loadPage(this.data.backTo||"markets");case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"newWalletCreated",value:(t=s(f().mark((function e(t,n){var r,a,o,s,i,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.regAssetForm.refresh(),e.next=3,pt().fetchUser();case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return");case 6:return a=this.page,o=r.assets[t],s=o.wallet,i=this.xc.bondAssets[o.symbol].amount,e.next=12,this.getBondsFeeBuffer(t,a.newWalletForm);case 12:if(c=e.sent,this.walletWaitForm.setWallet(t,c,n),this.confirmRegisterForm.setAsset(t,n,c),!(s.synced&&s.balance.available>=2*i+c)){e.next=19;break}return e.next=18,this.animateConfirmForm(a.newWalletForm);case 18:return e.abrupt("return");case 19:return e.next=21,_r(a.newWalletForm,a.walletWait);case 21:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),k}(ct);var Yr=function(e){g(o,e);var t,n,r,a=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(n);if(r){var a=b(this).constructor;e=Reflect.construct(t,arguments,a)}else e=t.apply(this,arguments);return y(this,e)});function o(e){var t;i(this,o),h(v(t=a.call(this)),"loginForm",void 0),h(v(t),"page",void 0),h(v(t),"appPassResetForm",void 0);var n=t.page=qe.idDescendants(e);t.loginForm=new Or(n.loginForm,(function(){t.loggedIn()}));var r=function(){qe.hide(n.resetAppPWForm),t.loginForm.refresh(),qe.show(n.loginForm),t.loginForm.focus()};return r(),t.appPassResetForm=new qr(n.resetAppPWForm,(function(){r()})),qe.bind(n.forgotPassBtn,"click",(function(){t.appPassResetForm.refresh(),_r(n.loginForm,n.resetAppPWForm)})),qe.bind(n.resetPassFormCloser,"click",(function(){r()})),qe.bind(n.forms,"mousedown",(function(e){!qe.mouseInElement(e,n.resetAppPWForm)&&qe.isDisplayed(n.resetAppPWForm)&&r()})),t}return d(o,[{key:"loggedIn",value:(t=s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt().loadPage("wallets");case 2:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),o}(ct);function Jr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Zr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zr(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){i=!0,o=e})),f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function Zr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var $r=1<<17,ea=["TICKET_STATUS_UNKNOWN","TICKET_STATUS_UNMINED","TICKET_STATUS_IMMATURE","TICKET_STATUS_LIVE","TICKET_STATUS_VOTED","TICKET_STATUS_MISSED","TICKET_STATUS_EXPIRED","TICKET_STATUS_UNSPENT","TICKET_STATUS_REVOKED"],ta=[2,4,5,8,14,15],na=[1,3,7,13,16],ra=[6,9,10,12];function aa(e){return ta.includes(e)?["+","positive-tx"]:na.includes(e)?["-","negative-tx"]:["",""]}var oa=["TX_TYPE_UNKNOWN","TX_TYPE_SEND","TX_TYPE_RECEIVE","TX_TYPE_SWAP","TX_TYPE_REDEEM","TX_TYPE_REFUND","TX_TYPE_SPLIT","TX_TYPE_CREATE_BOND","TX_TYPE_REDEEM_BOND","TX_TYPE_APPROVE_TOKEN","TX_TYPE_ACCELERATION","TX_TYPE_SELF_TRANSFER","TX_TYPE_REVOKE_TOKEN_APPROVAL","TX_TYPE_TICKET_PURCHASE","TX_TYPE_TICKET_VOTE","TX_TYPE_TICKET_REVOCATION","TX_TYPE_SWAP_OR_SEND","TX_TYPE_MIX"];function sa(e){return xe(oa[e])}var ia,ca,la=10,ua=0,da=function(e){g(ve,e);var t,n,o,c,l,u,p,m,x,w,C,F,D,T,I,E,B,P,L,O,M,q,N,W,V,U,_,j,z,X,K,Q,Y,J,Z,$,ee,te,ne,re,ae,oe,se,ie,ce,le,ue,de,he,pe,fe=(he=ve,pe=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(he);if(pe){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return y(this,e)});function ve(e,t){var n;i(this,ve),h(v(n=fe.call(this)),"body",void 0),h(v(n),"data",void 0),h(v(n),"page",void 0),h(v(n),"assetButtons",void 0),h(v(n),"newWalletForm",void 0),h(v(n),"reconfigForm",void 0),h(v(n),"walletCfgGuide",void 0),h(v(n),"depositAddrForm",void 0),h(v(n),"keyup",void 0),h(v(n),"changeWalletPW",void 0),h(v(n),"displayed",void 0),h(v(n),"animation",void 0),h(v(n),"forms",void 0),h(v(n),"forceReq",void 0),h(v(n),"forceUrl",void 0),h(v(n),"currentForm",void 0),h(v(n),"restoreInfoCard",void 0),h(v(n),"selectedAssetID",void 0),h(v(n),"stakeStatus",void 0),h(v(n),"maxSend",void 0),h(v(n),"unapprovingTokenVersion",void 0),h(v(n),"ticketPage",void 0),h(v(n),"oldestTx",void 0),h(v(n),"currTx",void 0),h(v(n),"mixing",void 0),h(v(n),"mixerToggle",void 0),h(v(n),"stampers",void 0),h(v(n),"secondTicker",void 0),n.body=e,n.data=t;var r=n.page=qe.idDescendants(e);n.stampers=[],ua=pt().user.net,n.secondTicker=window.setInterval((function(){!function(){var e,t=Jr(n.stampers);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.dataset.stamp&&(r.textContent=qe.timeSince(1e3*parseInt(r.dataset.stamp||"")))}}catch(e){t.e(e)}finally{t.f()}}()}),1e4),qe.cleanTemplates(r.restoreInfoCard,r.connectedIconTmpl,r.disconnectedIconTmpl,r.removeIconTmpl),n.restoreInfoCard=r.restoreInfoCard.cloneNode(!0),qe.show(r.connectedIconTmpl,r.disconnectedIconTmpl,r.removeIconTmpl),n.forms=qe.applySelector(r.forms,":scope > form"),r.forms.querySelectorAll(".form-closer").forEach((function(e){qe.bind(e,"click",(function(){n.closePopups()}))})),qe.bind(r.cancelForce,"click",(function(){n.closePopups()})),n.selectedAssetID=-1,qe.cleanTemplates(r.iconSelectTmpl,r.balanceDetailRow,r.recentOrderTmpl,r.vspRowTmpl,r.ticketHistoryRowTmpl,r.votingChoiceTmpl,r.votingAgendaTmpl,r.tspendTmpl,r.tkeyTmpl,r.txHistoryRowTmpl,r.txHistoryDateRowTmpl),qe.bind(r.createWallet,"click",(function(){return n.showNewWallet(n.selectedAssetID)})),qe.bind(r.connectBttn,"click",(function(){return n.doConnect(n.selectedAssetID)})),qe.bind(r.send,"click",(function(){return n.showSendForm(n.selectedAssetID)})),qe.bind(r.receive,"click",(function(){return n.showDeposit(n.selectedAssetID)})),qe.bind(r.unlockBttn,"click",(function(){return n.openWallet(n.selectedAssetID)})),qe.bind(r.lockBttn,"click",(function(){return n.lock(n.selectedAssetID)})),qe.bind(r.reconfigureBttn,"click",(function(){return n.showReconfig(n.selectedAssetID)})),qe.bind(r.needsProviderBttn,"click",(function(){return n.showReconfig(n.selectedAssetID)})),qe.bind(r.rescanWallet,"click",(function(){return n.rescanWallet(n.selectedAssetID)})),qe.bind(r.earlierTxs,"click",(function(){return n.loadEarlierTxs()})),qe.bind(r.copyTxIDBtn,"click",(function(){var e;nt((null===(e=n.currTx)||void 0===e?void 0:e.id)||"",r.txDetailsID,r.copyTxIDBtn,"#1e7d11")})),qe.bind(r.copyRecipientBtn,"click",(function(){var e;nt((null===(e=n.currTx)||void 0===e?void 0:e.recipient)||"",r.txDetailsRecipient,r.copyRecipientBtn,"#1e7d11")})),qe.bind(r.copyBondIDBtn,"click",(function(){var e,t;nt((null===(e=n.currTx)||void 0===e||null===(t=e.bondInfo)||void 0===t?void 0:t.bondID)||"",r.txDetailsBondID,r.copyBondIDBtn,"#1e7d11")})),qe.bind(r.copyBondAccountIDBtn,"click",(function(){var e,t;nt((null===(e=n.currTx)||void 0===e||null===(t=e.bondInfo)||void 0===t?void 0:t.accountID)||"",r.txDetailsBondAccountID,r.copyBondAccountIDBtn,"#1e7d11")})),qe.bind(r.hideMixTxsCheckbox,"change",(function(){n.showTxHistory(n.selectedAssetID)})),n.newWalletForm=new Dr(r.newWalletForm,(function(e){var t={assetName:pt().assets[e].name};n.assetUpdated(e,r.newWalletForm,xe("NEW_WALLET_SUCCESS",t)),n.sortAssetButtons(),n.updateTicketBuyer(e),n.updatePrivacy(e)})),n.reconfigForm=new Ir(r.reconfigInputs,!1),n.walletCfgGuide=qe.tmplElement(r.reconfigForm,"walletCfgGuide"),zr(r.sendForm,r.submitSendForm,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.stepSend();case 1:case"end":return e.stop()}}),e)})))),zr(r.vSendForm,r.vSend,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.send();case 1:case"end":return e.stop()}}),e)})))),zr(r.reconfigForm,r.submitReconfig,(function(){return n.reconfig()})),r.forms.querySelectorAll(".form-closer").forEach((function(e){qe.bind(e,"click",(function(){return n.closePopups()}))})),qe.bind(r.forms,"mousedown",(function(e){qe.mouseInElement(e,n.currentForm)||n.closePopups()})),n.mixerToggle=new Ue(r.toggleMixer,r.mixingErr,!1,(function(e){return n.updateMixerState(e)})),n.keyup=function(e){"Escape"===e.key&&qe.isDisplayed(n.page.forms)&&n.closePopups()},qe.bind(document,"keyup",n.keyup),qe.bind(r.downloadLogs,"click",s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.downloadLogs();case 1:case"end":return e.stop()}}),e)})))),qe.bind(r.exportWallet,"click",s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.displayExportWalletAuth();case 1:case"end":return e.stop()}}),e)})))),qe.bind(r.recoverWallet,"click",s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.showRecoverWallet();case 1:case"end":return e.stop()}}),e)})))),zr(r.exportWalletAuth,r.exportWalletAuthSubmit,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.exportWalletAuthSubmit();case 1:case"end":return e.stop()}}),e)})))),zr(r.recoverWalletConfirm,r.recoverWalletSubmit,(function(){n.recoverWallet()})),zr(r.confirmForce,r.confirmForceSubmit,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.confirmForceSubmit();case 1:case"end":return e.stop()}}),e)})))),qe.bind(r.disableWallet,"click",s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.showToggleWalletStatus(!0);case 1:case"end":return e.stop()}}),e)})))),qe.bind(r.enableWallet,"click",s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.showToggleWalletStatus(!1);case 1:case"end":return e.stop()}}),e)})))),zr(r.toggleWalletStatusConfirm,r.toggleWalletStatusSubmit,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.toggleWalletStatus();case 1:case"end":return e.stop()}}),e)})))),qe.bind(r.managePeers,"click",s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.showManagePeersForm();case 1:case"end":return e.stop()}}),e)})))),qe.bind(r.addPeerSubmit,"click",s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.submitAddPeer();case 1:case"end":return e.stop()}}),e)})))),qe.bind(r.unapproveTokenAllowance,"click",s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.showUnapproveTokenAllowanceTableForm();case 1:case"end":return e.stop()}}),e)})))),qe.bind(r.unapproveTokenSubmit,"click",s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.submitUnapproveTokenAllowance();case 1:case"end":return e.stop()}}),e)})))),qe.bind(r.showVSPs,"click",(function(){n.showVSPPicker()})),qe.bind(r.vspDisplay,"click",(function(){n.showVSPPicker()})),zr(r.vspPicker,r.customVspSubmit,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.setCustomVSP();case 1:case"end":return e.stop()}}),e)})))),qe.bind(r.purchaseTicketsBttn,"click",(function(){n.showPurchaseTicketsDialog()})),zr(r.purchaseTicketsForm,r.purchaserSubmit,(function(){n.purchaseTickets()})),qe.bind(r.purchaserInput,"change",(function(){n.purchaserInputChanged()})),qe.bind(r.ticketHistory,"click",(function(){n.showTicketHistory()})),qe.bind(r.ticketHistoryNextPage,"click",(function(){n.nextTicketPage()})),qe.bind(r.ticketHistoryPrevPage,"click",(function(){n.prevTicketPage()})),qe.bind(r.setVotes,"click",(function(){n.showSetVotesDialog()})),qe.bind(r.purchaseTicketsErrCloser,"click",(function(){qe.hide(r.purchaseTicketsErrBox)})),qe.bind(r.privacyInfoBttn,"click",(function(){n.showForm(r.mixingInfo)})),n.depositAddrForm=new Mr(r.deposit),qe.bind(r.walletBal,"click",(function(){n.populateMaxSend()})),qe.bind(r.sendAmt,"input",(function(){var e=pt().assets[n.selectedAssetID].unitInfo,t=et(r.sendAmt.value),a=e.conventional.conversionFactor;qe.showFiatValue(r.sendValue,t*a,pt().fiatRatesMap[n.selectedAssetID],e)})),qe.bind(r.maxSend,"click",(function(){n.populateMaxSend()})),qe.bind(r.sendAddr,"input",s(f().mark((function e(){var t,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=pt().assets[n.selectedAssetID],r.sendAddr.classList.remove("border-danger","border-success"),a=r.sendAddr.value||"",t&&""!==a){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,n.validateSendAddress(a,t.id);case 7:e.sent?r.sendAddr.classList.add("border-success"):r.sendAddr.classList.add("border-danger");case 9:case"end":return e.stop()}}),e)})))),qe.bind(r.showChangePW,"click",(function(){n.changeWalletPW=!n.changeWalletPW,n.setPWSettingViz(n.changeWalletPW)})),qe.bind(r.changeWalletTypeSelect,"change",(function(){n.changeWalletType()})),qe.bind(r.showChangeType,"click",(function(){qe.isHidden(r.changeWalletType)?(qe.show(r.changeWalletType,r.changeTypeHideIcon),qe.hide(r.changeTypeShowIcon),r.changeTypeMsg.textContent=xe("KEEP_WALLET_TYPE")):n.showReconfig(n.selectedAssetID,{skipAnimation:!0})})),pt().registerNoteFeeder({fiatrateupdate:function(e){n.handleRatesNote(e)},balance:function(e){n.handleBalanceNote(e)},walletstate:function(e){n.handleWalletStateNote(e)},walletconfig:function(e){n.handleWalletStateNote(e)},walletsync:function(e){n.updateSyncAndPeers(e.assetID)},createwallet:function(e){n.handleCreateWalletNote(e)},walletnote:function(e){n.handleCustomWalletNote(e)}});var a=n.sortAssetButtons().id,o=k.fetchLocal(k.selectedAssetLK);return o&&(a=Number(o)),n.setSelectedAsset(a),setInterval((function(){var e,t=Jr(n.page.txHistoryTableBody.children);try{for(t.s();!(e=t.n()).done;){var r=e.value,a=qe.tmplElement(r,"age");a.textContent=qe.timeSince(parseInt(a.dataset.timestamp))}}catch(e){t.e(e)}finally{t.f()}}),5e3),n}return d(ve,[{key:"closePopups",value:function(){qe.hide(this.page.forms),this.currTx=void 0,this.animation&&this.animation.stop()}},{key:"safePost",value:(de=s(f().mark((function e(t,n){var r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.selectedAssetID,e.next=3,S(t,n);case 3:if(a=e.sent,r===this.selectedAssetID){e.next=6;break}throw Error("asset changed during request. aborting");case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return de.apply(this,arguments)})},{key:"stepSend",value:(ue=s(f().mark((function e(){var t,n,r,a,o,s,i,c,l,u,d,h,p,v,m,g,y,b,x,k,w,C;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,qe.hide(t.vSendErr,t.sendErr,t.vSendEstimates,t.txFeeNotAvailable),n=parseInt(t.sendForm.dataset.assetID||""),r=pt().assets[n].token,a=t.subtractCheckBox.checked||!1,o=pt().unitInfo(n).conventional.conversionFactor,s=Math.round(et(t.sendAmt.value,0)*o),""!==(i=t.sendAddr.value||"")){e.next=10;break}return e.abrupt("return",qe.showFormError(t.sendErr,xe(G,{address:i})));case 10:if(c=pt().assets[n],l=c.wallet,u=c.unitInfo,d=c.symbol,h=0,0==(512&l.traits)){e.next=36;break}return p={addr:t.sendAddr.value,assetID:n,subtract:a,value:s},v=pt().loading(t.sendForm),e.next=17,S("/api/txfee",p);case 17:if(m=e.sent,v(),pt().checkResponse(m)){e.next=29;break}return t.txFeeNotAvailable.dataset.tooltip=xe("TXFEE_ERR_MSG",{err:m.msg}),qe.show(t.txFeeNotAvailable),e.next=24,this.validateSendAddress(i,n);case 24:if(e.sent){e.next=27;break}return e.abrupt("return",qe.showFormError(t.sendErr,xe(G,{address:i||""})));case 27:e.next=34;break;case 29:if(!m.ok){e.next=34;break}if(m.validaddress){e.next=32;break}return e.abrupt("return",qe.showFormError(t.sendErr,xe(G,{address:t.sendAddr.value||""})));case 32:h=m.txfee,qe.show(t.vSendEstimates);case 34:e.next=41;break;case 36:return e.next=38,this.validateSendAddress(i,n);case 38:if(e.sent){e.next=41;break}return e.abrupt("return",qe.showFormError(t.sendErr,xe(G,{address:i||""})));case 41:return t.vSendSymbol.textContent=d.toUpperCase(),t.vSendLogo.src=qe.logoPath(d),r?(g=pt().assets[r.parentID],y=g.unitInfo,b=g.symbol,t.vSendFee.textContent=qe.formatFullPrecision(h,y)+" "+b):t.vSendFee.textContent=qe.formatFullPrecision(h,u),x=pt().fiatRatesMap[n],qe.showFiatValue(t.vSendFeeFiat,h,x,u),t.vSendDestinationAmt.textContent=qe.formatFullPrecision(s-h,u),t.vTotalSend.textContent=qe.formatFullPrecision(s,u),qe.showFiatValue(t.vTotalSendFiat,s,x,u),t.vSendAddr.textContent=t.sendAddr.value||"",k=l.balance.available-s,t.balanceAfterSend.textContent=qe.formatFullPrecision(k,u),qe.showFiatValue(t.balanceAfterSendFiat,k,x,u),qe.show(t.approxSign),a||(qe.hide(t.approxSign),t.vSendDestinationAmt.textContent=qe.formatFullPrecision(s,u),w=s,r||(w+=h),t.vTotalSend.textContent=qe.formatFullPrecision(w,u),qe.showFiatValue(t.vTotalSendFiat,w,x,u),C=l.balance.available-s,r||(C-=h),C<=0?(t.balanceAfterSend.textContent=qe.formatFullPrecision(0,u),qe.showFiatValue(t.balanceAfterSendFiat,0,x,u)):(t.balanceAfterSend.textContent=qe.formatFullPrecision(C,u),qe.showFiatValue(t.balanceAfterSendFiat,C,x,u))),qe.hide(t.sendForm),e.next=58,this.showForm(t.vSendForm);case 58:case"end":return e.stop()}}),e,this)}))),function(){return ue.apply(this,arguments)})},{key:"cancelSend",value:(le=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,qe.hide(t.vSendForm,t.sendErr),e.next=4,this.showForm(t.sendForm);case 4:case"end":return e.stop()}}),e,this)}))),function(){return le.apply(this,arguments)})},{key:"validateSendAddress",value:(ce=s(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("/api/validateaddress",{addr:t,assetID:n});case 2:return r=e.sent,e.abrupt("return",pt().checkResponse(r));case 4:case"end":return e.stop()}}),e)}))),function(e,t){return ce.apply(this,arguments)})},{key:"setPWSettingViz",value:function(e){var t=this.page;if(e)return qe.hide(t.showIcon),qe.show(t.hideIcon,t.changePW),void(t.switchPWMsg.textContent=xe("KEEP_WALLET_PASS"));qe.hide(t.hideIcon,t.changePW),qe.show(t.showIcon),t.switchPWMsg.textContent=xe("NEW_WALLET_PASS")}},{key:"assetVersionUsedByDEXes",value:function(){var e=this.selectedAssetID,t={},n=pt().exchanges;for(var r in n){var a=n[r],o=a.assets[e];o&&(t[o.version]||(t[o.version]=[]),t[o.version].push(a.host))}return t}},{key:"submitUnapproveTokenAllowance",value:(ie=s(f().mark((function e(){var t,n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,e.next=4,S("/api/unapprovetoken",{assetID:this.selectedAssetID,version:this.unapprovingTokenVersion});case 4:if(n=e.sent,pt().checkResponse(n)){e.next=9;break}return t.unapproveTokenErr.textContent=n.msg,qe.show(t.unapproveTokenErr),e.abrupt("return");case 9:(r=Hn[this.selectedAssetID])&&r[ua]&&(t.unapproveTokenTxID.href=r[ua](n.txID)),t.unapproveTokenTxID.textContent=n.txID,qe.hide(t.unapproveTokenSubmissionElements,t.unapproveTokenErr),qe.show(t.unapproveTokenTxMsg);case 14:case"end":return e.stop()}}),e,this)}))),function(){return ie.apply(this,arguments)})},{key:"showUnapproveTokenAllowanceForm",value:(se=s(f().mark((function e(t){var n,r,a,o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.page,this.unapprovingTokenVersion=t,qe.show(n.unapproveTokenSubmissionElements),qe.hide(n.unapproveTokenTxMsg,n.unapproveTokenErr),(r=pt().assets[this.selectedAssetID])&&r.token){e.next=7;break}return e.abrupt("return");case 7:if(a=pt().assets[r.token.parentID]){e.next=10;break}return e.abrupt("return");case 10:return qe.empty(n.tokenAllowanceRemoveSymbol),n.tokenAllowanceRemoveSymbol.appendChild(qe.symbolize(r,!0)),n.tokenAllowanceRemoveVersion.textContent=t.toString(),e.next=16,S("/api/approvetokenfee",{assetID:this.selectedAssetID,version:t,approving:!1});case 16:o=e.sent,pt().checkResponse(o)?(s="".concat(qe.formatCoinValue(o.txFee,a.unitInfo)," ").concat(a.unitInfo.conventional.unit),(i=pt().fiatRatesMap[a.id])&&(s+=" (".concat(qe.formatFiatConversion(o.txFee,i,a.unitInfo)," USD)")),n.unapprovalFeeEstimate.textContent=s):(n.unapproveTokenErr.textContent=o.msg,qe.show(n.unapproveTokenErr)),this.showForm(n.unapproveTokenForm);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return se.apply(this,arguments)})},{key:"showUnapproveTokenAllowanceTableForm",value:(oe=s(f().mark((function e(){var t,n,r,a,o,s,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,(n=pt().assets[this.selectedAssetID])&&n.wallet&&n.wallet.approved){e.next=4;break}return e.abrupt("return");case 4:for(;t.tokenVersionBody.firstChild;)t.tokenVersionBody.removeChild(t.tokenVersionBody.firstChild);qe.empty(t.tokenVersionTableAssetSymbol),t.tokenVersionTableAssetSymbol.appendChild(qe.symbolize(n,!0)),r=this.assetVersionUsedByDEXes(),a=!1,o=f().mark((function e(o){var s,c,l,u;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(s=n.wallet.approved[o])&&s===ut.Approved){e.next=3;break}return e.abrupt("return","continue");case 3:a=!0,c=t.tokenVersionRow.cloneNode(!0),(l=qe.parseTemplate(c)).version.textContent=o.toString(),r[o]&&(l.usedBy.textContent=r[o].join(", ")),u=i.page.removeIconTmpl.cloneNode(!0),qe.bind(u,"click",(function(){i.showUnapproveTokenAllowanceForm(o)})),l.remove.appendChild(u),t.tokenVersionBody.appendChild(c);case 12:case"end":return e.stop()}}),e)})),s=0;case 11:if(!(s<=n.wallet.version)){e.next=19;break}return e.delegateYield(o(s),"t0",13);case 13:if("continue"!==e.t0){e.next=16;break}return e.abrupt("continue",16);case 16:s++,e.next=11;break;case 19:qe.setVis(a,t.tokenVersionTable),qe.setVis(!a,t.tokenVersionNone),this.showForm(t.unapproveTokenTableForm);case 22:case"end":return e.stop()}}),e,this)}))),function(){return oe.apply(this,arguments)})},{key:"updateWalletPeersTable",value:(ae=s(f().mark((function e(){var t,n,r,a,o,i,c=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,qe.hide(t.peerSpinner),e.next=4,S("/api/getwalletpeers",{assetID:this.selectedAssetID});case 4:if(n=e.sent,pt().checkResponse(n)){e.next=9;break}return t.managePeersErr.textContent=n.msg,qe.show(t.managePeersErr),e.abrupt("return");case 9:for(;t.peersTableBody.firstChild;)t.peersTableBody.removeChild(t.peersTableBody.firstChild);(r=n.peers||[]).sort((function(e,t){return e.source-t.source})),a=xe("DEFAULT"),o=xe("ADDED"),i=xe("DISCOVERED"),r.forEach((function(e){var n,r=t.peerTableRow.cloneNode(!0),l=qe.parseTemplate(r);switch(l.addr.textContent=e.addr,e.source){case dt.WalletDefault:l.source.textContent=a;break;case dt.UserAdded:l.source.textContent=o;break;case dt.Discovered:l.source.textContent=i}if(n=e.connected?c.page.connectedIconTmpl.cloneNode(!0):c.page.disconnectedIconTmpl.cloneNode(!0),l.connected.appendChild(n),e.source===dt.UserAdded){var u=c.page.removeIconTmpl.cloneNode(!0);qe.bind(u,"click",s(f().mark((function n(){var r;return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return qe.hide(t.managePeersErr),n.next=3,S("/api/removewalletpeer",{assetID:c.selectedAssetID,addr:e.addr});case 3:if(r=n.sent,pt().checkResponse(r)){n.next=8;break}return t.managePeersErr.textContent=r.msg,qe.show(t.managePeersErr),n.abrupt("return");case 8:c.spinUntilPeersUpdate();case 9:case"end":return n.stop()}}),n)})))),l.remove.appendChild(u)}t.peersTableBody.appendChild(r)}));case 16:case"end":return e.stop()}}),e,this)}))),function(){return ae.apply(this,arguments)})},{key:"showManagePeersForm",value:(re=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,e.next=3,this.updateWalletPeersTable();case 3:qe.hide(t.managePeersErr),this.showForm(t.managePeersForm);case 5:case"end":return e.stop()}}),e,this)}))),function(){return re.apply(this,arguments)})},{key:"submitAddPeer",value:(ne=s(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,qe.hide(t.managePeersErr),e.next=4,S("/api/addwalletpeer",{assetID:this.selectedAssetID,addr:t.addPeerInput.value});case 4:if(n=e.sent,pt().checkResponse(n)){e.next=9;break}return t.managePeersErr.textContent=n.msg,qe.show(t.managePeersErr),e.abrupt("return");case 9:this.spinUntilPeersUpdate(),t.addPeerInput.value="";case 11:case"end":return e.stop()}}),e,this)}))),function(){return ne.apply(this,arguments)})},{key:"spinUntilPeersUpdate",value:(te=s(f().mark((function e(){var t,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.page,qe.show(t.peerSpinner),setTimeout((function(){qe.isDisplayed(t.peerSpinner)&&n.updateWalletPeersTable()}),1e4);case 3:case"end":return e.stop()}}),e,this)}))),function(){return te.apply(this,arguments)})},{key:"showToggleWalletStatus",value:function(e){var t=this.page;qe.hide(t.toggleWalletStatusErr,t.walletStatusDisable,t.disableWalletMsg,t.walletStatusEnable,t.enableWalletMsg),e?qe.show(t.walletStatusDisable,t.disableWalletMsg):qe.show(t.walletStatusEnable,t.enableWalletMsg),this.showForm(t.toggleWalletStatusConfirm)}},{key:"toggleWalletStatus",value:(ee=s(f().mark((function e(){var t,n,r,a,o,s,i,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,qe.hide(t.toggleWalletStatusErr),n=pt().assets[this.selectedAssetID],r=!n.wallet.disabled,a={assetID:this.selectedAssetID,disable:r},o={assetName:n.name},s=pt().loading(t.toggleWalletStatusConfirm),e.next=10,S("/api/togglewalletstatus",a);case 10:if(i=e.sent,s(),pt().checkResponse(i)){e.next=16;break}return i.code===A.activeOrdersErr?t.toggleWalletStatusErr.textContent=xe("ACTIVE_ORDERS_ERR_MSG",o):t.toggleWalletStatusErr.textContent=i.msg,qe.show(t.toggleWalletStatusErr),e.abrupt("return");case 16:c=xe("WALLET_DISABLED",o),r||(c=xe("WALLET_ENABLED",o)),this.assetUpdated(this.selectedAssetID,t.toggleWalletStatusConfirm,c);case 19:case"end":return e.stop()}}),e,this)}))),function(){return ee.apply(this,arguments)})},{key:"showBox",value:($=s(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.style.opacity="0",qe.show(t),n&&n.focus(),e.next=5,qe.animate(300,(function(e){t.style.opacity="".concat(e)}),"easeOut");case 5:t.style.opacity="1",this.displayed=t;case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return $.apply(this,arguments)})},{key:"showForm",value:(Z=s(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.page,this.currentForm=t,this.forms.forEach((function(e){return qe.hide(e)})),t.style.right="10000px",qe.show(n.forms,t),r=(n.forms.offsetWidth+t.offsetWidth)/2,e.next=8,qe.animate(300,(function(e){t.style.right="".concat((1-e)*r,"px")}),"easeOutHard");case 8:t.style.right="0";case 9:case"end":return e.stop()}}),e,this)}))),function(e){return Z.apply(this,arguments)})},{key:"showSuccess",value:(J=s(f().mark((function e(t){var n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.forms.forEach((function(e){return qe.hide(e)})),this.currentForm=this.page.checkmarkForm,this.animation=Hr(this.page,t),e.next=5,this.animation.wait();case 5:this.animation=new Ne(1500,(function(){}),"",(function(){n.currentForm===n.page.checkmarkForm&&n.closePopups()}));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return J.apply(this,arguments)})},{key:"showNewWallet",value:(Y=s(f().mark((function e(t){var n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.page,r=n.newWalletForm,this.newWalletForm.setAsset(t),a=this.newWalletForm.loadDefaults(),e.next=6,this.showForm(r);case 6:return e.next=8,a;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"sortAssetButtons",value:function(){var e=this,t=this.page;this.assetButtons={},qe.empty(t.assetSelect);var n=r(Object.values(pt().assets));n.sort((function(e,t){if(e.wallet&&!t.wallet)return-1;if(!e.wallet&&t.wallet)return 1;if(!e.wallet&&!t.wallet)return"dcr"===e.symbol?-1:1;var n=[e.wallet.balance,t.wallet.balance],r=n[0],a=n[1],o=r.available+r.immature+r.locked,s=a.available+a.immature+a.locked;if(0===o&&0===s)return e.symbol.localeCompare(t.symbol);if(0===o)return 1;if(0===o)return-1;var i=[pt().fiatRatesMap[e.id],pt().fiatRatesMap[t.id]],c=i[0],l=i[1];return c&&!l?-1:!c&&l?1:l*s-c*o}));var a,o=Jr(n);try{var s=function(){var n=a.value,r=t.iconSelectTmpl.cloneNode(!0);t.assetSelect.appendChild(r);var o=qe.parseTemplate(r);e.assetButtons[n.id]={tmpl:o,bttn:r},e.updateAssetButton(n.id),qe.bind(r,"click",(function(){e.setSelectedAsset(n.id),k.storeLocal(k.selectedAssetLK,String(n.id))}))};for(o.s();!(a=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}return t.assetSelect.classList.remove("invisible"),n[0]}},{key:"updateAssetButton",value:function(e){var t,n=pt().assets[e],r=this.assetButtons[e],o=r.bttn,s=r.tmpl;qe.hide(s.fiatBox,s.noWallet),o.classList.add("nowallet"),(t=s.img).src||(t.src=qe.logoPath(n.symbol));var i=n.symbol.split(".");if(2===i.length){var c,l=i[1];s.parentImg.classList.remove("d-hide"),(c=s.parentImg).src||(c.src=qe.logoPath(l))}if(this.selectedAssetID===e&&o.classList.add("selected"),s.name.textContent=n.name,n.wallet){o.classList.remove("nowallet");var u=n.wallet.balance,d=n.unitInfo,h=u.available+u.locked+u.immature,p=a(qe.formatBestUnitsFourSigFigs(h,d),2),f=p[0],v=p[1];s.balance.textContent=f,s.unit.textContent=v,qe.show(s.balanceBox);var m=pt().fiatRatesMap[n.id];m&&(qe.show(s.fiatBox),s.fiat.textContent=qe.formatFourSigFigs(h/d.conventional.conversionFactor*m))}else qe.show(s.noWallet)}},{key:"setSelectedAsset",value:(Q=s(f().mark((function e(t){var n,r,a,o,s,i,c,l,u,d;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.page.assetSelect,r=Jr(n.children);try{for(r.s();!(a=r.n()).done;)a.value.classList.remove("selected")}catch(e){r.e(e)}finally{r.f()}this.assetButtons[t].bttn.classList.add("selected"),this.selectedAssetID=t,this.page.hideMixTxsCheckbox.checked=!0,this.updateDisplayedAsset(t),this.showAvailableMarkets(t),o=this.showRecentActivity(t),s=this.showTxHistory(t),i=this.updateTicketBuyer(t),c=this.updatePrivacy(t),l=0,u=[o,s,i,c];case 13:if(!(l<u.length)){e.next=20;break}return d=u[l],e.next=17,d;case 17:l++,e.next=13;break;case 20:case"end":return e.stop()}}),e,this)}))),function(e){return Q.apply(this,arguments)})},{key:"updateDisplayedAsset",value:function(e){if(e===this.selectedAssetID){var t=pt().assets[e],n=t.symbol,r=t.wallet,a=t.name,o=t.token,s=t.unitInfo,i=this.page,c=this.body;if(qe.setText(c,"[data-asset-name]",a),qe.setText(c,"[data-ticker]",s.conventional.unit),i.assetLogo.src=qe.logoPath(n),qe.hide(i.balanceBox,i.fiatBalanceBox,i.createWallet,i.walletDetails,i.sendReceive,i.connectBttnBox,i.statusLocked,i.statusReady,i.statusOff,i.unlockBttnBox,i.lockBttnBox,i.connectBttnBox,i.peerCountBox,i.syncProgressBox,i.statusDisabled,i.tokenInfoBox,i.needsProviderBox,i.feeStateBox,i.txSyncBox,i.txProgress,i.txFindingAddrs),this.checkNeedsProvider(e),o){var l=pt().assets[o.parentID];i.tokenParentLogo.src=qe.logoPath(l.symbol),i.tokenParentName.textContent=l.name,i.contractAddress.textContent=o.contractAddress,qe.show(i.tokenInfoBox)}if(r){this.updateDisplayedAssetBalance();var u=r.feeState,d=r.running,h=r.disabled,p=r.type,f=pt().walletDefinition(e,p);i.walletType.textContent=f.tab,u&&this.updateFeeState(u),h?qe.show(i.statusDisabled):d?this.updateSyncAndPeers(r.assetID):qe.show(i.statusOff,i.connectBttnBox)}else qe.show(i.createWallet);i.walletDetailsBox.classList.remove("invisible")}}},{key:"updateSyncAndPeers",value:function(e){var t=this.page;if(e===this.selectedAssetID){var n=pt().walletMap[e],r=n.peerCount,a=n.syncProgress,o=n.syncStatus,s=n.encrypted,i=n.open;if(n.running&&(qe.show(t.sendReceive,t.peerCountBox,t.syncProgressBox),t.peerCount.textContent=String(r),t.syncProgress.textContent="".concat((100*a).toFixed(1),"%"),i?(qe.show(t.statusReady),!pt().haveActiveOrders(e)&&s&&qe.show(t.lockBttnBox)):qe.show(t.statusLocked,t.unlockBttnBox),qe.setVis(void 0!==o.txs,t.txSyncBox),void 0!==o.txs))if(qe.hide(t.txProgress,t.txFindingAddrs),0===o.txs&&o.blocks>=o.targetHeight)qe.show(t.txFindingAddrs);else{qe.show(t.txProgress);var c=o.txs/o.targetHeight;t.txProgress.textContent="".concat((100*c).toFixed(1),"%")}}}},{key:"updateFeeState",value:function(e){var t=this.page,n=this.selectedAssetID;qe.hide(t.feeStateBox);var r=pt().assets[n],a=r.unitInfo,o=r.token,s=pt().fiatRatesMap[n];if(s){var i=o?o.parentID:n,c=pt().fiatRatesMap[i];if(!o||c){qe.show(t.feeStateBox);var l=o?pt().assets[o.parentID].unitInfo:a;qe.formatBestRateElement(t.feeStateNetRate,i,e.rate,l),qe.formatBestValueElement(t.feeStateSendFees,i,e.send,l),qe.formatBestValueElement(t.feeStateSwapFees,i,e.swap,l),qe.formatBestValueElement(t.feeStateRedeemFees,i,e.redeem,l),t.feeStateXcRate.textContent=qe.formatFourSigFigs(s);var u=e.send/l.conventional.conversionFactor*c;t.feeStateSendFiat.textContent=qe.formatFourSigFigs(u);var d=e.swap/l.conventional.conversionFactor*c;t.feeStateSwapFiat.textContent=qe.formatFourSigFigs(d);var h=e.redeem/l.conventional.conversionFactor*c;t.feeStateRedeemFiat.textContent=qe.formatFourSigFigs(h),qe.show(t.feeStateBox)}}}},{key:"checkNeedsProvider",value:(K=s(f().mark((function e(t){var n,r,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt().needsCustomProvider(t);case 2:if(n=e.sent,r=this.page,a=r.needsProviderBox,o=r.needsProviderBttn,qe.setVis(n,a),n){e.next=7;break}return e.abrupt("return");case 7:qe.blink(o);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"updateTicketBuyer",value:(X=s(f().mark((function e(t){var n,r,a,o,s,i,c,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ticketPage={number:0,history:[],scanned:!1},r=pt().assets[t],a=r.wallet,o=r.unitInfo,s=this.page,qe.hide(s.stakingBox,s.pickVSP,s.stakingSummary,s.stakingErr,s.vspDisplayBox,s.ticketPriceBox,s.purchaseTicketsBox,s.stakingRpcSpvMsg,s.ticketsDisabled),null!=a&&a.running&&0!=(32768&a.traits)){e.next=6;break}return e.abrupt("return");case 6:return qe.show(s.stakingBox),i=pt().loading(s.stakingBox),e.next=10,this.safePost("/api/stakestatus",t);case 10:if(c=e.sent,i(),pt().checkResponse(c)){e.next=19;break}if(!c.msg.includes("disconnected from consensus RPC")){e.next=16;break}return qe.show(s.stakingRpcSpvMsg),e.abrupt("return");case 16:return qe.show(s.stakingErr),s.stakingErr.textContent=c.msg,e.abrupt("return");case 19:if(qe.show(s.stakingSummary,s.ticketPriceBox),l=c.status,this.stakeStatus=l,s.stakingAgendaCount.textContent=String(l.stances.agendas.length),s.stakingTspendCount.textContent=String(l.stances.tspends.length),s.purchaserCurrentPrice.textContent=qe.formatFourSigFigs(l.ticketPrice/o.conventional.conversionFactor),s.purchaserBal.textContent=qe.formatCoinValue(a.balance.available,o),this.updateTicketStats(l.stats,o,l.ticketPrice,l.votingSubsidy),!(null===(n=pt().extensionWallet(this.selectedAssetID))||void 0===n?void 0:n.disableStaking)){e.next=33;break}return qe.hide(s.setVotes,s.showVSPs),qe.show(s.ticketsDisabled),s.extensionModeAppName.textContent=pt().user.extensionModeConfig.name,e.abrupt("return");case 33:this.setVSPViz(l.vsp);case 34:case"end":return e.stop()}}),e,this)}))),function(e){return X.apply(this,arguments)})},{key:"setVSPViz",value:function(e){var t=this.page,n=this.stakeStatus;if(qe.hide(t.vspDisplayBox),e)return qe.show(t.vspDisplayBox,t.purchaseTicketsBox),qe.hide(t.pickVSP),void(t.vspURL.textContent=e);qe.setVis(!n.isRPC,t.pickVSP),qe.setVis(n.isRPC,t.purchaseTicketsBox)}},{key:"updateTicketStats",value:function(e,t,n,r){var a=this.page,o=this.stakeStatus;o.stats=e,n&&(o.ticketPrice=n),r&&(o.votingSubsidy=r);var s=o.tickets.filter((function(e){return e.status<=3&&e.status>=1})).length;a.stakingTicketCount.textContent=String(s),a.immatureTicketCount.textContent=String(e.mempool),qe.setVis(e.mempool>0,a.immatureTicketCountBox),a.queuedTicketCount.textContent=String(e.queued),a.formQueuedTix.textContent=String(e.queued),qe.setVis(e.queued>0,a.formQueueTixBox,a.queuedTicketCountBox),a.totalTicketCount.textContent=String(e.ticketCount),a.totalTicketRewards.textContent=qe.formatFourSigFigs(e.totalRewards/t.conventional.conversionFactor),a.totalTicketVotes.textContent=String(e.votes),n&&(a.ticketPrice.textContent=qe.formatFourSigFigs(n/t.conventional.conversionFactor)),r&&(a.votingSubsidy.textContent=qe.formatFourSigFigs(r/t.conventional.conversionFactor))}},{key:"showVSPPicker",value:(z=s(f().mark((function e(){var t,n,r,a,o,s,i,c,l=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.selectedAssetID,n=this.page,this.showForm(n.vspPicker),qe.empty(n.vspPickerList),qe.hide(n.stakingErr),r=pt().loading(n.vspPicker),e.next=8,this.safePost("/api/listvsps",t);case 8:if(a=e.sent,r(),pt().checkResponse(a)){e.next=14;break}return qe.show(n.stakingErr),n.stakingErr.textContent=a.msg,e.abrupt("return");case 14:o=a.vsps,s=Jr(o),e.prev=16,c=f().mark((function e(){var r,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=i.value,a=n.vspRowTmpl.cloneNode(!0),n.vspPickerList.appendChild(a),(o=qe.parseTemplate(a)).url.textContent=r.url,o.feeRate.textContent=r.feePercentage.toFixed(2),o.voting.textContent=String(r.voting),qe.bind(a,"click",(function(){qe.hide(n.stakingErr),l.setVSP(t,r)}));case 8:case"end":return e.stop()}}),e)})),s.s();case 19:if((i=s.n()).done){e.next=23;break}return e.delegateYield(c(),"t0",21);case 21:e.next=19;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(16),s.e(e.t1);case 28:return e.prev=28,s.f(),e.finish(28);case 31:case"end":return e.stop()}}),e,this,[[16,25,28,31]])}))),function(){return z.apply(this,arguments)})},{key:"showPurchaseTicketsDialog",value:function(){var e=this.page;e.purchaserInput.value="",qe.hide(e.purchaserErr),this.showForm(this.page.purchaseTicketsForm),e.purchaserInput.focus()}},{key:"purchaserInputChanged",value:function(){var e=this.page,t=parseInt(e.purchaserInput.value||"0");e.purchaserInput.value=t<=1?"1":String(t)}},{key:"purchaseTickets",value:(j=s(f().mark((function e(){var t,n,r,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,n=this.selectedAssetID,!((r=parseInt(t.purchaserInput.value||"0"))<1)){e.next=4;break}return e.abrupt("return");case 4:return a=pt().loading(t.purchaseTicketsForm),e.next=7,this.safePost("/api/purchasetickets",{assetID:n,n:r});case 7:if(o=e.sent,a(),pt().checkResponse(o)){e.next=13;break}return t.purchaserErr.textContent=o.msg,qe.show(t.purchaserErr),e.abrupt("return");case 13:this.showSuccess(xe("TICKETS_PURCHASED",{n:r.toLocaleString(qe.languages())}));case 14:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"processTicketPurchaseUpdate",value:function(e){var t=this.stakeStatus,n=this.selectedAssetID,r=this.page,a=e.assetID,o=e.payload,s=o.err,i=o.remaining,c=o.tickets,l=o.stats;if(a===n){if(s)return qe.show(r.purchaseTicketsErrBox),void(r.purchaseTicketsErr.textContent=s);c&&(t.tickets=c.concat(t.tickets)),l&&this.updateTicketStats(l,pt().assets[a].unitInfo),t.stats.queued=i,r.queuedTicketCount.textContent=String(i),r.formQueuedTix.textContent=String(i),qe.setVis(i>0,r.queuedTicketCountBox)}}},{key:"setVSP",value:(_=s(f().mark((function e(t,n){var r,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.closePopups(),r=this.page,a=pt().loading(r.stakingBox),e.next=5,this.safePost("/api/setvsp",{assetID:t,url:n.url});case 5:if(o=e.sent,a(),pt().checkResponse(o)){e.next=11;break}return qe.show(r.stakingErr),r.stakingErr.textContent=o.msg,e.abrupt("return");case 11:this.setVSPViz(n.url);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"setCustomVSP",value:function(){var e=this.selectedAssetID,t={url:this.page.customVspUrl.value};this.setVSP(e,t)}},{key:"pageOfTickets",value:function(e){var t=this.stakeStatus,n=this.ticketPage,a=e*la,o=[];if(a<t.tickets.length){if(o.push.apply(o,r(t.tickets.slice(a,a+la))),o.length<la){var s=la-o.length;o.push.apply(o,r(n.history.slice(0,s)))}}else a-=t.tickets.length,o.push.apply(o,r(n.history.slice(a,a+la)));return o}},{key:"displayTicketPage",value:function(e,t){var n=this.page,r=this.selectedAssetID,a=pt().unitInfo(r),o=Hn[r][pt().user.net];qe.empty(n.ticketHistoryRows),n.ticketHistoryPage.textContent=String(e);var s,i=Jr(t);try{for(i.s();!(s=i.n()).done;){var c=s.value,l=c.tx,u=c.status,d=n.ticketHistoryRowTmpl.cloneNode(!0);n.ticketHistoryRows.appendChild(d),pt().bindUrlHandlers(d);var h=qe.parseTemplate(d);h.age.textContent=qe.timeSince(1e3*l.stamp),h.price.textContent=qe.formatFullPrecision(l.ticketPrice,a),h.status.textContent=xe(ea[u]),h.hashStart.textContent=l.hash.slice(0,6),h.hashEnd.textContent=l.hash.slice(-6),h.detailsLinkUrl.setAttribute("href",o(l.hash))}}catch(e){i.e(e)}finally{i.f()}}},{key:"ticketPageN",value:(U=s(f().mark((function e(t){var n,a,o,s,i,c,l,u,d,h,p,v,m,g;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.page,a=this.stakeStatus,o=this.ticketPage,s=this.selectedAssetID,!((i=this.pageOfTickets(t)).length<la)||o.scanned){e.next=18;break}return l=la-i.length,u=o.history.length>0?o.history:a.tickets,d=u.length>0?u[u.length-1].tx.blockHeight:-1,h=u.filter((function(e){return e.tx.blockHeight===d})).length,p=pt().loading(n.ticketHistoryForm),e.next=10,this.safePost("/api/ticketpage",{assetID:s,scanStart:d,n:l,skipN:h});case 10:if(v=e.sent,p(),pt().checkResponse(v)){e.next=15;break}return console.error("error fetching ticket page",v.msg),e.abrupt("return");case 15:(c=this.ticketPage.history).push.apply(c,r(v.tickets)),i.push.apply(i,r(v.tickets)),v.tickets.length<l&&(this.ticketPage.scanned=!0);case 18:if(m=a.tickets.length+o.history.length,qe.setVis(m>=la,n.ticketHistoryPagination),qe.setVis(m>0,n.ticketHistoryTable),qe.setVis(0===m,n.noTicketsMessage),0!==i.length){e.next=25;break}return qe.hide(n.ticketHistoryNextPage),e.abrupt("return");case 25:this.displayTicketPage(t,i),o.number=t,g=t*la+i.length===m,qe.setVis(!g||!o.scanned,n.ticketHistoryNextPage),qe.setVis(t>0,n.ticketHistoryPrevPage);case 30:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"showTicketHistory",value:(V=s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.showForm(this.page.ticketHistoryForm),e.next=3,this.ticketPageN(this.ticketPage.number);case 3:case"end":return e.stop()}}),e,this)}))),function(){return V.apply(this,arguments)})},{key:"nextTicketPage",value:(W=s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ticketPageN(this.ticketPage.number+1);case 2:case"end":return e.stop()}}),e,this)}))),function(){return W.apply(this,arguments)})},{key:"prevTicketPage",value:(N=s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ticketPageN(this.ticketPage.number-1);case 2:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"showSetVotesDialog",value:function(){var e,t=this,n=this.page,r=this.stakeStatus,a=this.selectedAssetID,o=pt().unitInfo(a);qe.hide(n.votingFormErr);var i=Hn[a][pt().user.net],c=function(){var e=s(f().mark((function e(r){var a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return qe.hide(n.votingFormErr),a=pt().loading(n.votingForm),e.next=4,t.safePost("/api/setvotes",r);case 4:if(o=e.sent,a(),pt().checkResponse(o)){e.next=10;break}throw qe.show(n.votingFormErr),n.votingFormErr.textContent=o.msg,Error(o.msg);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=s(f().mark((function e(t,n){var o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c({assetID:a,choices:h({},t,n)});case 2:o=Jr(r.stances.agendas);try{for(o.s();!(s=o.n()).done;)(i=s.value).id===t&&(i.currentChoice=n)}catch(e){o.e(e)}finally{o.f()}case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();qe.empty(n.votingAgendas);var u,d=Jr(r.stances.agendas);try{var p=function(){var e=u.value,t=n.votingAgendaTmpl.cloneNode(!0);n.votingAgendas.appendChild(t);var r=qe.parseTemplate(t);r.description.textContent=e.description;var a,o=Jr(e.choices);try{var s=function(){var t=a.value,o=n.votingChoiceTmpl.cloneNode(!0);r.choices.appendChild(o);var s,i=qe.parseTemplate(o);i.id.textContent=(s=t.id).charAt(0).toUpperCase()+s.slice(1),i.id.dataset.tooltip=t.description,i.radio.value=t.id,i.radio.name=e.id,qe.bind(i.radio,"change",(function(){i.radio.checked&&l(e.id,t.id)})),t.id===e.currentChoice&&(i.radio.checked=!0)};for(o.s();!(a=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}pt().bindTooltips(r.choices)};for(d.s();!(u=d.n()).done;)p()}catch(e){d.e(e)}finally{d.f()}var v=function(){var e=s(f().mark((function e(t,n){var o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c({assetID:a,tSpendPolicy:h({},t,n)});case 2:o=Jr(r.stances.tspends);try{for(o.s();!(s=o.n()).done;)(i=s.value).hash===t&&(i.currentPolicy=n)}catch(e){o.e(e)}finally{o.f()}case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();qe.empty(n.votingTspends);var m,g=Jr(r.stances.tspends);try{var y=function(){var e=m.value,t=n.tspendTmpl.cloneNode(!0);n.votingTspends.appendChild(t),pt().bindUrlHandlers(t);for(var r=qe.parseTemplate(t),a=function(){var t=c[s];t.name=e.hash,e.currentPolicy===t.value&&(t.checked=!0),qe.bind(t,"change",(function(){var n;t.checked&&v(e.hash,null!==(n=t.value)&&void 0!==n?n:"")}))},s=0,c=[r.yes,r.no];s<c.length;s++)a();e.value>0?r.value.textContent=qe.formatFourSigFigs(e.value/o.conventional.conversionFactor):qe.hide(r.value),r.hash.textContent=e.hash,r.explorerLink.setAttribute("href",i(e.hash))};for(g.s();!(m=g.n()).done;)y()}catch(e){g.e(e)}finally{g.f()}var b=function(){var e=s(f().mark((function e(t,n){var o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c({assetID:a,treasuryPolicy:h({},t,n)});case 2:o=Jr(r.stances.treasuryKeys);try{for(o.s();!(s=o.n()).done;)(i=s.value).key===t&&(i.policy=n)}catch(e){o.e(e)}finally{o.f()}case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();qe.empty(n.votingTKeys);var x,k=Jr(null!==(e=r.stances.treasuryKeys)&&void 0!==e?e:[]);try{var w=function(){var e=x.value,t=n.tkeyTmpl.cloneNode(!0);n.votingTKeys.appendChild(t);for(var r=qe.parseTemplate(t),a=function(){var t=s[o];t.name=e.key,e.policy===t.value&&(t.checked=!0),qe.bind(t,"change",(function(){var n;t.checked&&b(e.key,null!==(n=t.value)&&void 0!==n?n:"")}))},o=0,s=[r.yes,r.no];o<s.length;o++)a();r.key.textContent=e.key};for(k.s();!(x=k.n()).done;)w()}catch(e){k.e(e)}finally{k.f()}this.showForm(n.votingForm)}},{key:"updatePrivacy",value:(q=s(f().mark((function e(t){var n,r,a,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(n=pt().extensionWallet(t))||void 0===n?void 0:n.disablePrivacy,this.mixing=!1,a=pt().assets[t].wallet,o=this.page,qe.hide(o.mixingBox,o.mixerOff,o.mixerOn),!r&&null!=a&&a.running&&0!=(a.traits&$r)){e.next=7;break}return e.abrupt("return");case 7:return qe.show(o.mixingBox,o.mixerLoading),e.next=10,this.safePost("/api/mixingstats",{assetID:t});case 10:if(s=e.sent,qe.hide(o.mixerLoading),pt().checkResponse(s)){e.next=16;break}return qe.show(o.mixingErr),o.mixingErr.textContent=s.msg,e.abrupt("return");case 16:this.mixing=s.stats.enabled,this.mixing?qe.show(o.mixerOn):qe.show(o.mixerOff),this.mixerToggle.setState(this.mixing);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"updateMixerState",value:(M=s(f().mark((function e(t){var n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.page,qe.hide(n.mixingErr),r=pt().loading(n.mixingBox),e.next=5,S("/api/configuremixer",{assetID:this.selectedAssetID,enabled:t});case 5:if(a=e.sent,r(),pt().checkResponse(a)){e.next=11;break}return n.mixingErr.textContent=xe(H,{msg:a.msg}),qe.show(n.mixingErr),e.abrupt("return");case 11:qe.setVis(t,n.mixerOn),qe.setVis(!t,n.mixerOff),this.mixerToggle.setState(t);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"updateDisplayedAssetBalance",value:function(){var e,t,n,r=this.page,a=pt().assets[this.selectedAssetID],o=a.wallet,s=a.unitInfo,i=a.id,c=o.balance;qe.show(r.balanceBox,r.walletDetails);var l=c.locked+c.contractlocked+c.bondlocked,u=c.available+l+c.immature;r.balance.textContent=qe.formatCoinValue(u,s),r.balanceUnit.textContent=s.conventional.unit;var d=pt().fiatRatesMap[i];d&&(qe.show(r.fiatBalanceBox),r.fiatBalance.textContent=qe.formatFiatConversion(u,d,s)),qe.empty(r.balanceDetailBox);var h,p,f=function(e,t,n){var a=r.balanceDetailRow.cloneNode(!0);r.balanceDetailBox.appendChild(a);var o=qe.parseTemplate(a);return o.name.textContent=e,n&&(o.tooltipMsg.dataset.tooltip=n,qe.show(o.tooltipMsg)),o.balance.textContent=qe.formatCoinValue(t,s),a},v=function(e,t,n){h=void 0,p=f(e,t,n)},m=function(e,t,n){(h=f(e,t,n)).classList.add("sub")},g=function(){h&&(p.classList.add("itemized"),h.classList.add("last"))};if(v(xe("AVAILABLE_TITLE"),c.available,""),void 0!==(null===(e=c.other)||void 0===e?void 0:e.Shielded)){var y=c.available-c.other.Shielded.amt;m(xe("TRANSPARENT"),y),m(xe("SHIELDED"),c.other.Shielded.amt)}g(),v(xe("LOCKED_TITLE"),l,xe("LOCKED_BAL_MSG")),c.orderlocked>0&&m(xe("ORDER"),c.orderlocked,xe("LOCKED_ORDER_BAL_MSG")),c.contractlocked>0&&m(xe("SWAPPING"),c.contractlocked,xe("LOCKED_SWAPPING_BAL_MSG")),c.bondlocked>0&&m(xe("BONDED"),c.bondlocked,xe("LOCKED_BOND_BAL_MSG")),c.bondReserves>0&&m(xe("BOND_RESERVES"),c.bondReserves,xe("BOND_RESERVES_MSG")),void 0!==(null==c||null===(t=c.other)||void 0===t?void 0:t.Staked)&&m("Staked",c.other.Staked.amt),g(),c.immature&&v(xe("IMMATURE_TITLE"),c.immature,xe("IMMATURE_BAL_MSG")),void 0!==(null==c||null===(n=c.other)||void 0===n?void 0:n.Unmixed)&&m("Unmixed",c.other.Unmixed.amt),g(),r.purchaserBal.textContent=qe.formatFourSigFigs(c.available/s.conventional.conversionFactor),pt().bindTooltips(r.balanceDetailBox)}},{key:"showAvailableMarkets",value:function(e){for(var t=this.page,n=pt().user.exchanges,r=[],o=0,s=Object.values(n);o<s.length;o++){var i=s[o];if(i.markets)for(var c=0,l=Object.values(i.markets);c<l.length;c++){var u=l[c];u.baseid!==e&&u.quoteid!==e||r.push([i.host,i,u])}}var d=function(e,t){var n=t.spot;if(!n)return 0;var r=pt().unitInfo(e).conventional.conversionFactor;return(e===t.baseid?n.vol24:n.vol24*n.rate/qt)/r};r.sort((function(t,n){var r=a(t,3),o=r[0],s=r[2],i=a(n,3),c=i[0],l=i[2];return s.spot||l.spot?d(e,l)-d(e,s):o.localeCompare(c)})),qe.empty(t.availableMarkets);for(var h=function(){var r=a(f[p],3),o=r[0],s=r[1],i=r[2],c=i.spot,l=i.baseid,u=i.basesymbol,h=i.quoteid,v=i.quotesymbol,m=t.marketRow.cloneNode(!0);t.availableMarkets.appendChild(m);var g=qe.parseTemplate(m);if(g.host.textContent=o,g.baseLogo.src=qe.logoPath(u),g.quoteLogo.src=qe.logoPath(v),qe.empty(g.baseSymbol,g.quoteSymbol),g.baseSymbol.appendChild(qe.symbolize(s.assets[l],!0)),g.quoteSymbol.appendChild(qe.symbolize(s.assets[h],!0)),c){var y=pt().conventionalRate(l,h,c.rate,n[o]);g.price.textContent=qe.formatFourSigFigs(y);var b=function(e){return e.split(".")[0].toUpperCase()};g.priceQuoteUnit.textContent=b(v),g.priceBaseUnit.textContent=b(u),g.volume.textContent=qe.formatFourSigFigs(d(e,i)),g.volumeUnit.textContent=b(e===l?u:v)}else qe.hide(g.priceBox,g.volumeBox);qe.bind(m,"click",(function(){return pt().loadPage("markets",{host:o,baseID:l,quoteID:h})}))},p=0,f=r;p<f.length;p++)h();t.marketsOverviewBox.classList.remove("invisible")}},{key:"showRecentActivity",value:(O=s(f().mark((function e(t){var n,r,a,o,s,i,c,l,u,d,h,p,v,m,g,y;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.page,r=pt().loading(n.orderActivityBox),a={n:20,assets:[t],hosts:[],statuses:[]},e.next=5,S("/api/orders",a);case 5:if(o=e.sent,r(),qe.hide(n.noActivity,n.orderActivity),o.orders&&0!==o.orders.length){e.next=12;break}return qe.show(n.noActivity),n.orderActivityBox.classList.remove("invisible"),e.abrupt("return");case 12:for(qe.show(n.orderActivity),qe.empty(n.recentOrders),s=0,i=o.orders;s<i.length;s++)c=i[s],l=n.recentOrderTmpl.cloneNode(!0),n.recentOrders.appendChild(l),u=qe.parseTemplate(l),d=void 0,h=void 0,p=[pt().unitInfo(c.baseID),pt().unitInfo(c.quoteID)],v=p[0],m=p[1],c.sell?(g=[pt().assets[c.baseID],pt().assets[c.quoteID]],d=g[0],h=g[1],u.fromQty.textContent=qe.formatCoinValue(c.qty,v),c.type===St&&(u.toQty.textContent=qe.formatCoinValue(c.qty/qt*c.rate,m))):(y=[pt().assets[c.quoteID],pt().assets[c.baseID]],d=y[0],h=y[1],c.type===Ft?u.fromQty.textContent=qe.formatCoinValue(c.qty,v):(u.fromQty.textContent=qe.formatCoinValue(c.qty/qt*c.rate,m),u.toQty.textContent=qe.formatCoinValue(c.qty,v))),u.fromLogo.src=qe.logoPath(d.symbol),qe.empty(u.fromSymbol,u.toSymbol),u.fromSymbol.appendChild(qe.symbolize(d,!0)),u.toLogo.src=qe.logoPath(h.symbol),u.toSymbol.appendChild(qe.symbolize(h,!0)),u.status.textContent=_t(c),u.filled.textContent="".concat((jt(c)/c.qty*100).toFixed(1),"%"),u.age.textContent=qe.timeSince(c.submitTime),u.link.href="order/".concat(c.id),pt().bindInternalNavigation(l);n.orderActivityBox.classList.remove("invisible");case 16:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"updateTxHistoryRow",value:function(e,t,n){var r=qe.parseTemplate(e),o=n,s=n;if(t.tokenID)if(o=t.tokenID,n!==t.tokenID)s=n;else{var i=pt().assets[n];i.token?s=i.token.parentID:console.error("unable to determine fee asset for tx ".concat(t.id))}var c=pt().unitInfo(o),l=pt().unitInfo(s);r.age.textContent=qe.timeSince(1e3*t.timestamp),r.age.dataset.timestamp=String(1e3*t.timestamp),qe.setVis(0===t.timestamp,r.pending),qe.setVis(0!==t.timestamp,r.age),t.timestamp>0&&(r.age.dataset.stamp=String(t.timestamp));var u=sa(t.type);if(t.tokenID&&t.tokenID!==n){var d=pt().assets[t.tokenID].unitInfo.conventional.unit;u="".concat(d," ").concat(u)}if(r.type.textContent=u,r.id.textContent=ha(t.id,12),r.id.setAttribute("title",t.id),r.fees.textContent=qe.formatCoinValue(t.fees,l),ra.includes(t.type))r.amount.textContent="-";else{var h=a(aa(t.type),2),p=h[0],f=h[1],v=qe.formatCoinValue(t.amount,c);r.amount.textContent="".concat(p).concat(v),""!==f&&r.amount.classList.add(f)}}},{key:"txHistoryRow",value:function(e,t){var n=this,r=this.page.txHistoryRowTmpl.cloneNode(!0);r.dataset.txid=e.id,qe.bind(r,"click",(function(){return n.showTxDetailsPopup(e.id)})),this.updateTxHistoryRow(r,e,t);var a=qe.parseTemplate(r);return this.stampers.push(a.age),r}},{key:"txHistoryDateRow",value:function(e){var t=this.page.txHistoryDateRowTmpl.cloneNode(!0);return qe.parseTemplate(t).date.textContent=e,t}},{key:"setTxDetailsPopupElements",value:function(e){var t=this.page,n=Hn[this.selectedAssetID];n&&n[ua]&&(t.txViewBlockExplorer.href=n[ua](e.id));var r=sa(e.type);if(e.tokenID&&e.tokenID!==this.selectedAssetID){var o=pt().assets[e.tokenID].symbol.split(".")[0].toUpperCase();r="".concat(o," ").concat(r)}if(t.txDetailsType.textContent=r,qe.setVis(16===e.type,t.txTypeTooltip),t.txTypeTooltip.dataset.tooltip=xe("SWAP_OR_SEND_TOOLTIP"),ra.includes(e.type))qe.hide(t.txDetailsAmtSection);else{var s=this.selectedAssetID;e.tokenID&&(s=e.tokenID),qe.show(t.txDetailsAmtSection);var i=pt().unitInfo(s),c=qe.formatCoinValue(e.amount,i),l=a(aa(e.type),2),u=l[0],d=l[1];t.txDetailsAmount.textContent="".concat(u).concat(c," ").concat(i.conventional.unit),""!==d&&t.txDetailsAmount.classList.add(d)}var h=this.selectedAssetID;if(void 0!==e.tokenID){var p=pt().assets[e.tokenID];p.token?h=p.token.parentID:console.error("wallet transaction ".concat(e.id," is supposed to be a token tx, but asset ").concat(e.tokenID," is not a token"))}var f=pt().unitInfo(h),v=qe.formatCoinValue(e.fees,f);t.txDetailsFee.textContent="".concat(v," ").concat(f.conventional.unit),t.txDetailsBlockNumber.textContent="".concat(e.blockNumber);var m=new Date(1e3*e.timestamp),g=m.toLocaleDateString(),y=m.toLocaleTimeString();if(t.txDetailsTimestamp.textContent="".concat(g," ").concat(y),qe.setVis(0===e.blockNumber,t.timestampPending,t.blockNumberPending),qe.setVis(0!==e.blockNumber,t.txDetailsBlockNumber,t.txDetailsTimestamp),t.txDetailsID.textContent=ha(e.id,20),t.txDetailsID.setAttribute("title",e.id),e.recipient?(qe.show(t.txDetailsRecipientSection),t.txDetailsRecipient.textContent=ha(e.recipient,20),t.txDetailsRecipient.setAttribute("title",e.recipient)):qe.hide(t.txDetailsRecipientSection),e.bondInfo){qe.show(t.txDetailsBondIDSection,t.txDetailsBondLocktimeSection),qe.setVis(""!==e.bondInfo.accountID,t.txDetailsBondAccountIDSection),t.txDetailsBondID.textContent=ha(e.bondInfo.bondID,20),t.txDetailsBondID.setAttribute("title",e.bondInfo.bondID);var b=new Date(1e3*e.bondInfo.lockTime),x=b.toLocaleDateString(),k=b.toLocaleTimeString();t.txDetailsBondLocktime.textContent="".concat(x," ").concat(k),t.txDetailsBondAccountID.textContent=ha(e.bondInfo.accountID,20),t.txDetailsBondAccountID.setAttribute("title",e.bondInfo.accountID)}else qe.hide(t.txDetailsBondIDSection,t.txDetailsBondLocktimeSection,t.txDetailsBondAccountIDSection);e.additionalData&&e.additionalData.Nonce?(qe.show(t.txDetailsNonceSection),t.txDetailsNonce.textContent="".concat(e.additionalData.Nonce)):qe.hide(t.txDetailsNonceSection)}},{key:"showTxDetailsPopup",value:function(e){var t=pt().getWalletTx(this.selectedAssetID,e);t?(this.currTx=t,this.setTxDetailsPopupElements(t),this.showForm(this.page.txDetails)):console.error("wallet transaction ".concat(e," not found"))}},{key:"txHistoryTableNewestDate",value:function(){return this.page.txHistoryTableBody.children.length>=1&&qe.parseTemplate(this.page.txHistoryTableBody.children[0]).date.textContent||""}},{key:"txDate",value:function(e){return 0===e.timestamp?(new Date).toLocaleDateString():new Date(1e3*e.timestamp).toLocaleDateString()}},{key:"handleTxNote",value:function(e,t){var n;if(0==(pt().assets[this.selectedAssetID].wallet.traits&$r)||!this.page.hideMixTxs.checked||17!==e.type)if(t)this.oldestTx?this.txDate(e)!==this.txHistoryTableNewestDate()?(this.page.txHistoryTableBody.insertBefore(this.txHistoryRow(e,this.selectedAssetID),this.page.txHistoryTableBody.children[0]),this.page.txHistoryTableBody.insertBefore(this.txHistoryDateRow(this.txDate(e)),this.page.txHistoryTableBody.children[0])):this.page.txHistoryTableBody.insertBefore(this.txHistoryRow(e,this.selectedAssetID),this.page.txHistoryTableBody.children[1]):(qe.show(this.page.txHistoryTable),qe.hide(this.page.noTxHistory),this.page.txHistoryTableBody.appendChild(this.txHistoryDateRow(this.txDate(e))),this.page.txHistoryTableBody.appendChild(this.txHistoryRow(e,this.selectedAssetID)),this.oldestTx=e);else{var r,a=Jr(this.page.txHistoryTableBody.children);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.dataset.txid===e.id){this.updateTxHistoryRow(o,e,this.selectedAssetID);break}}}catch(e){a.e(e)}finally{a.f()}e.id===(null===(n=this.currTx)||void 0===n?void 0:n.id)&&this.setTxDetailsPopupElements(e)}}},{key:"getTxHistory",value:(L=s(f().mark((function e(t,n,a){var o,s,i,c,l,u,d,h,p;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=10,n&&(o=15),s={txs:[],lastTx:!1},i=a,c=0;case 5:if(!(c<40)){e.next=18;break}return e.next=8,pt().txHistory(t,o,i);case 8:if((l=e.sent).txs.length>0&&(i=l.txs[l.txs.length-1].id),u=l.txs,n&&(u=u.filter((function(e){return 17!==e.type}))),s.txs.length+u.length>10?(h=10-s.txs.length,(d=s.txs).push.apply(d,r(u.slice(0,h)))):(l.lastTx&&(s.lastTx=!0),(p=s.txs).push.apply(p,r(u))),!(s.txs.length>=10||l.lastTx)){e.next=15;break}return e.abrupt("break",18);case 15:c++,e.next=5;break;case 18:return e.abrupt("return",s);case 19:case"end":return e.stop()}}),e)}))),function(e,t,n){return L.apply(this,arguments)})},{key:"showTxHistory",value:(P=s(f().mark((function e(t){var n,r,a,o,s,i,c,l,u,d,h;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.page,qe.hide(n.txHistoryTable,n.txHistoryBox,n.noTxHistory,n.earlierTxs,n.txHistoryNotAvailable,n.hideMixTxs),qe.empty(n.txHistoryTableBody),(a=pt().assets[t].wallet)&&!a.disabled&&0!=(65536&a.traits)){e.next=7;break}return qe.show(n.txHistoryNotAvailable),e.abrupt("return");case 7:return this.oldestTx=void 0,o=0!=(a.traits&$r),qe.setVis(o,n.hideMixTxs),qe.show(n.txHistoryBox),e.prev=11,s=o&&!!n.hideMixTxsCheckbox.checked,e.next=15,this.getTxHistory(t,s);case 15:r=e.sent,e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(11),qe.show(n.noTxHistory),e.abrupt("return");case 22:if(0!==r.txs.length){e.next=25;break}return qe.show(n.noTxHistory),e.abrupt("return");case 25:i=this.txDate(r.txs[0]),n.txHistoryTableBody.appendChild(this.txHistoryDateRow(i)),c=Jr(r.txs);try{for(c.s();!(l=c.n()).done;)u=l.value,(d=this.txDate(u))!==i&&(i=d,n.txHistoryTableBody.appendChild(this.txHistoryDateRow(d))),h=this.txHistoryRow(u,t),n.txHistoryTableBody.appendChild(h)}catch(e){c.e(e)}finally{c.f()}this.oldestTx=r.txs[r.txs.length-1],qe.show(n.txHistoryTable),qe.setVis(!r.lastTx,n.earlierTxs);case 32:case"end":return e.stop()}}),e,this,[[11,18]])}))),function(e){return P.apply(this,arguments)})},{key:"loadEarlierTxs",value:(B=s(f().mark((function e(){var t,n,r,a,o,s,i,c,l,u;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.oldestTx){e.next=2;break}return e.abrupt("return");case 2:return t=this.page,r=pt().assets[this.selectedAssetID].wallet,a=0!=(r.traits&$r)&&!!t.hideMixTxsCheckbox.checked,e.prev=5,e.next=8,this.getTxHistory(this.selectedAssetID,a,this.oldestTx.id);case 8:n=e.sent,e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(5),console.error(e.t0),e.abrupt("return");case 15:o=this.txDate(this.oldestTx),s=Jr(n.txs);try{for(s.s();!(i=s.n()).done;)c=i.value,(l=this.txDate(c))!==o&&(o=l,t.txHistoryTableBody.appendChild(this.txHistoryDateRow(l))),u=this.txHistoryRow(c,this.selectedAssetID),t.txHistoryTableBody.appendChild(u)}catch(e){s.e(e)}finally{s.f()}qe.setVis(!n.lastTx,t.earlierTxs),n.txs.length>0&&(this.oldestTx=n.txs[n.txs.length-1]);case 20:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(){return B.apply(this,arguments)})},{key:"rescanWallet",value:(E=s(f().mark((function e(t){var n,r,a,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.page,qe.hide(n.reconfigErr),r="/api/rescanwallet",a={assetID:t},o=pt().loading(this.body),e.next=7,S(r,a);case 7:if(s=e.sent,o(),s.code!==A.activeOrdersErr){e.next=14;break}return this.forceUrl=r,this.forceReq=a,this.showConfirmForce(),e.abrupt("return");case 14:if(pt().checkResponse(s)){e.next=17;break}return qe.showFormError(n.reconfigErr,s.msg),e.abrupt("return");case 17:this.assetUpdated(t,n.reconfigForm,xe("RESCAN_STARTED"));case 18:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"showConfirmForce",value:function(){qe.hide(this.page.confirmForceErr),this.showForm(this.page.confirmForce)}},{key:"showRecoverWallet",value:function(){qe.hide(this.page.recoverWalletErr),this.showForm(this.page.recoverWalletConfirm)}},{key:"openWallet",value:(I=s(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={assetID:t},e.next=3,S("/api/openwallet",n);case 3:if(r=e.sent,pt().checkResponse(r)){e.next=7;break}return console.error("openwallet error",r),e.abrupt("return");case 7:this.assetUpdated(t,void 0,xe("WALLET_UNLOCKED"));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"showReconfig",value:(T=s(f().mark((function e(t,n){var r,a,o,s,i,c,l,u,d,h,p,v,m,g,y,b,x;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.page,qe.hide(a.changeWalletType,a.changeTypeHideIcon,a.reconfigErr,a.showChangeType,a.changeTypeHideIcon,a.reconfigErr,a.enableWallet,a.disableWallet),this.changeWalletPW=!1,this.setPWSettingViz(this.changeWalletPW),o=pt().assets[t],s=pt().currentWalletDefinition(t),i=o.token?[o.token.definition]:o.info?o.info.availablewallets:[],c=null===(r=pt().extensionWallet(t))||void 0===r?void 0:r.disableWalletType,i.length>1&&!c){qe.empty(a.changeWalletTypeSelect),qe.show(a.showChangeType,a.changeTypeShowIcon),a.changeTypeMsg.textContent=xe("CHANGE_WALLET_TYPE"),l=Jr(i);try{for(l.s();!(u=l.n()).done;)d=u.value,h=document.createElement("option"),d.type===s.type&&(h.selected=!0),h.value=h.textContent=d.type,a.changeWalletTypeSelect.appendChild(h)}catch(e){l.e(e)}finally{l.f()}}if(null!=n&&n.elevateProviders){p=Jr(s.configopts);try{for(p.s();!(v=p.n()).done;)"providers"===(m=v.value).key&&(m.required=!0)}catch(e){p.e(e)}finally{p.f()}}return g=pt().walletMap[t],qe.setVis(4&g.traits,a.downloadLogs),qe.setVis(32&g.traits,a.recoverWallet),qe.setVis(256&g.traits,a.exportWallet),qe.setVis(1&g.traits,a.rescanWallet),qe.setVis(1024&g.traits&&!g.disabled,a.managePeers),qe.setVis(8192&g.traits&&!g.disabled,a.unapproveTokenAllowance),qe.setVis(9509&g.traits,a.otherActionsLabel),g.disabled?qe.show(a.enableWallet):qe.show(a.disableWallet),this.showOrHideRecoverySupportMsg(g,s.seeded),a.recfgAssetLogo.src=qe.logoPath(o.symbol),a.recfgAssetName.textContent=o.name,null!=n&&n.skipAnimation||this.showForm(a.reconfigForm),y=pt().loading(a.reconfigForm),e.next=26,S("/api/walletsettings",{assetID:t});case 26:if(b=e.sent,y(),pt().checkResponse(b)){e.next=31;break}return qe.showFormError(a.reconfigErr,b.msg),e.abrupt("return");case 31:x=pt().haveActiveOrders(t),this.reconfigForm.update(o.id,s.configopts||[],x),this.setGuideLink(s.guidelink),this.reconfigForm.setConfig(b.map),this.updateDisplayedReconfigFields(s);case 36:case"end":return e.stop()}}),e,this)}))),function(e,t){return T.apply(this,arguments)})},{key:"showOrHideRecoverySupportMsg",value:function(e,t){this.setRecoverySupportMsgViz(t&&!e.running&&!e.disabled&&Boolean(32&e.traits),e.symbol)}},{key:"setRecoverySupportMsgViz",value:function(e,t){var n=this.page;if(e)return n.reconfigSupportMsg.textContent=xe("WALLET_RECOVERY_SUPPORT_MSG",{walletSymbol:t.toLocaleUpperCase()}),qe.show(n.reconfigSupportMsg),n.submitReconfig.setAttribute("disabled",""),void n.submitReconfig.classList.add("grey");n.submitReconfig.removeAttribute("disabled"),n.submitReconfig.classList.remove("grey"),qe.empty(n.reconfigSupportMsg),qe.hide(n.reconfigSupportMsg)}},{key:"changeWalletType",value:function(){var e=this.page.changeWalletTypeSelect.value||"",t=pt().walletDefinition(this.selectedAssetID,e);this.reconfigForm.update(this.selectedAssetID,t.configopts||[],!1);var n=pt().walletMap[this.selectedAssetID],r=pt().currentWalletDefinition(this.selectedAssetID);t.type!==r.type?this.setRecoverySupportMsgViz(!1,n.symbol):this.showOrHideRecoverySupportMsg(n,t.seeded),this.setGuideLink(t.guidelink),this.updateDisplayedReconfigFields(t)}},{key:"setGuideLink",value:function(e){qe.hide(this.walletCfgGuide),""!==e&&(this.walletCfgGuide.href=e,qe.show(this.walletCfgGuide))}},{key:"updateDisplayedReconfigFields",value:function(e){var t,n=null===(t=pt().extensionWallet(this.selectedAssetID))||void 0===t?void 0:t.disablePassword;e.seeded||"token"===e.type||n?(qe.hide(this.page.showChangePW,this.reconfigForm.fileSelector),this.changeWalletPW=!1,this.setPWSettingViz(!1)):qe.show(this.page.showChangePW,this.reconfigForm.fileSelector)}},{key:"showDeposit",value:(D=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.depositAddrForm.setAsset(t),this.showForm(this.page.deposit);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"showSendForm",value:(F=s(f().mark((function e(t){var n,r,a,o,s,i,c,l,u,d,h,p,v,m,g;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.page,r=n.sendForm,a=pt().assets[t],o=a.wallet,s=a.unitInfo,i=a.symbol,c=a.token,qe.hide(n.toggleSubtract),n.subtractCheckBox.checked=!1,(l=0!=(64&o.traits))&&qe.show(n.toggleSubtract),qe.hide(n.sendErr,n.maxSendDisplay,n.sendTokenMsgBox),n.sendAddr.classList.remove("border-danger","border-success"),n.sendAddr.value="",n.sendAmt.value="",u=pt().fiatRatesMap[t],qe.showFiatValue(n.sendValue,0,u,s),n.walletBal.textContent=qe.formatFullPrecision(o.balance.available,s),n.sendLogo.src=qe.logoPath(i),n.sendName.textContent=s.conventional.unit,c&&(d=pt().assets[c.parentID],n.sendTokenParentLogo.src=qe.logoPath(d.symbol),n.sendTokenParentName.textContent=d.name,qe.show(n.sendTokenMsgBox)),!(o.balance.available>0&&0!=(512&o.traits))){e.next=25;break}return h={assetID:t,subtract:l,maxWithdraw:!0,value:o.balance.available},p=pt().loading(this.body),e.next=22,S("/api/txfee",h);case 22:v=e.sent,p(),pt().checkResponse(v)&&(m=o.balance.available,c||(m-=v.txfee)<0&&(m=0),this.maxSend=m,n.maxSend.textContent=qe.formatFullPrecision(m,s),qe.showFiatValue(n.maxSendFiat,m,u,s),c?(g=pt().assets[c.parentID].unitInfo,n.maxSendFee.textContent=qe.formatFullPrecision(v.txfee,g)+" "+g.conventional.unit,qe.showFiatValue(n.maxSendFeeFiat,v.txfee,pt().fiatRatesMap[c.parentID],g)):(n.maxSendFee.textContent=qe.formatFullPrecision(v.txfee,s),qe.showFiatValue(n.maxSendFeeFiat,v.txfee,u,s)),qe.show(n.maxSendDisplay));case 25:qe.showFiatValue(n.sendValue,0,u,s),n.walletBal.textContent=qe.formatFullPrecision(o.balance.available,s),r.dataset.assetID=String(t),this.showForm(r);case 29:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"doConnect",value:(C=s(f().mark((function e(t){var n,r,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=pt().loading(this.body),e.next=3,S("/api/connectwallet",{assetID:t});case 3:r=e.sent,n(),pt().checkResponse(r)||(a=pt().assets[t].symbol,(o=this.page).errorModalMsg.textContent=xe("CONNECTING_WALLET_ERR_MSG",{assetName:a,errMsg:r.msg}),this.showForm(o.errorModal)),this.updateDisplayedAsset(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"assetUpdated",value:function(e,t,n){e===this.selectedAssetID&&(this.updateDisplayedAsset(e),t&&Object.is(this.currentForm,t)&&(n?this.showSuccess(n):this.closePopups()))}},{key:"populateMaxSend",value:(w=s(f().mark((function e(){var t,n,r,a,o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.page,n=pt().assets[this.selectedAssetID],r=n.id,a=n.unitInfo,o=n.wallet,s=pt().fiatRatesMap[r],0==(64&o.traits)?(t.sendAmt.value=String(this.maxSend/a.conventional.conversionFactor),qe.showFiatValue(t.sendValue,this.maxSend,s,a),t.subtractCheckBox.checked=!1):(i=o.balance.available,t.sendAmt.value=String(i/a.conventional.conversionFactor),qe.showFiatValue(t.sendValue,i,s,a),t.subtractCheckBox.checked=!0);case 4:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"send",value:(x=s(f().mark((function e(){var t,n,r,a,o,s,i,c,l,u,d;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.page,a=parseInt(null!==(t=r.sendForm.dataset.assetID)&&void 0!==t?t:""),o=null!==(n=r.subtractCheckBox.checked)&&void 0!==n&&n,s=pt().unitInfo(a).conventional.conversionFactor,i=r.vSendPw.value||"",r.vSendPw.value="",""!==i){e.next=9;break}return qe.showFormError(r.vSendErr,xe(R)),e.abrupt("return");case 9:return c={assetID:a,address:r.sendAddr.value,subtract:o,value:Math.round(et(r.sendAmt.value)*s),pw:i},l=pt().loading(r.vSendForm),e.next=13,S("/api/send",c);case 13:if(u=e.sent,l(),pt().checkResponse(u)){e.next=18;break}return qe.showFormError(r.vSendErr,u.msg),e.abrupt("return");case 18:d=pt().assets[a].name,this.assetUpdated(a,r.vSendForm,xe("SEND_SUCCESS",{assetName:d}));case 20:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"reconfig",value:(m=s(f().mark((function e(){var t,n,r,a,o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.page,r=this.selectedAssetID,qe.hide(n.reconfigErr),a=pt().currentWalletDefinition(r).type,qe.isHidden(n.changeWalletType)||(a=n.changeWalletTypeSelect.value||""),o=pt().loading(n.reconfigForm),s={assetID:r,config:this.reconfigForm.map(r),walletType:a},this.changeWalletPW&&(s.newWalletPW=n.newPW.value),e.next=10,this.safePost("/api/reconfigurewallet",s);case 10:if(i=e.sent,n.newPW.value="",o(),pt().checkResponse(i)){e.next=16;break}return qe.showFormError(n.reconfigErr,i.msg),e.abrupt("return");case 16:if(null===(t=this.data)||void 0===t||!t.goBack){e.next=19;break}return pt().loadPage(this.data.goBack),e.abrupt("return");case 19:this.assetUpdated(r,n.reconfigForm,xe("RECONFIG_SUCCESS")),this.updateTicketBuyer(r),pt().clearTxHistory(r),this.showTxHistory(r),this.updatePrivacy(r),this.checkNeedsProvider(r);case 25:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"lock",value:(p=s(f().mark((function e(t){var n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.page,r=pt().loading(n.newWalletForm),e.next=4,S("/api/closewallet",{assetID:t});case 4:if(a=e.sent,r(),pt().checkResponse(a)){e.next=8;break}return e.abrupt("return");case 8:this.updateDisplayedAsset(t),this.updatePrivacy(t);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"downloadLogs",value:(u=s(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=new URLSearchParams("")).append("assetid","".concat(this.selectedAssetID)),(n=new URL(window.location.href)).search=t.toString(),n.pathname="/wallets/logfile",window.open(n.toString());case 6:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"displayExportWalletAuth",value:(l=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.page,qe.hide(t.exportWalletErr),t.exportWalletPW.value="",this.showForm(t.exportWalletAuth);case 4:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"exportWalletAuthSubmit",value:(c=s(f().mark((function e(){var t,n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n={assetID:this.selectedAssetID,pass:t.exportWalletPW.value},r=pt().loading(t.forms),e.next=6,S("/api/restorewalletinfo",n);case 6:a=e.sent,r(),pt().checkResponse(a)?(t.exportWalletPW.value="",this.displayRestoreWalletInfo(a.restorationinfo)):qe.showFormError(t.exportWalletErr,a.msg);case 9:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"displayRestoreWalletInfo",value:(o=s(f().mark((function e(t){var n,r,a,o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.page,qe.empty(n.restoreInfoCardsList),r=Jr(t);try{for(r.s();!(a=r.n()).done;)o=a.value,s=this.restoreInfoCard.cloneNode(!0),(i=qe.parseTemplate(s)).name.textContent=o.target,i.seed.textContent=o.seed,i.seedName.textContent="".concat(o.seedName,":"),i.instructions.textContent=o.instructions,n.restoreInfoCardsList.appendChild(s)}catch(e){r.e(e)}finally{r.f()}this.showForm(n.restoreWalletInfo);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"recoverWallet",value:(n=s(f().mark((function e(){var t,n,r,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,qe.hide(t.recoverWalletErr),n={assetID:this.selectedAssetID},r="/api/recoverwallet",a=pt().loading(t.forms),e.next=7,S(r,n);case 7:o=e.sent,a(),o.code===A.activeOrdersErr?(this.forceUrl=r,this.forceReq=n,this.showConfirmForce()):pt().checkResponse(o)?this.closePopups():qe.showFormError(t.recoverWalletErr,o.msg);case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"confirmForceSubmit",value:(t=s(f().mark((function e(){var t,n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,this.forceReq.force=!0,n=pt().loading(t.forms),e.next=5,S(this.forceUrl,this.forceReq);case 5:r=e.sent,n(),pt().checkResponse(r)?this.closePopups():qe.showFormError(t.confirmForceErr,r.msg);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"handleBalanceNote",value:function(e){this.updateAssetButton(e.assetID),e.assetID===this.selectedAssetID&&this.updateDisplayedAssetBalance()}},{key:"handleRatesNote",value:function(e){if(this.updateAssetButton(this.selectedAssetID),e.fiatRates[this.selectedAssetID]){this.updateDisplayedAssetBalance();var t=pt().walletMap[this.selectedAssetID].feeState;t&&this.updateFeeState(t)}}},{key:"handleWalletStateNote",value:function(e){var t=e.wallet,n=t.assetID,r=t.feeState;this.updateAssetButton(n),this.assetUpdated(n),"WalletPeersUpdate"===e.topic&&n===this.selectedAssetID&&qe.isDisplayed(this.page.managePeersForm)&&this.updateWalletPeersTable(),r&&n===this.selectedAssetID&&this.updateFeeState(r)}},{key:"handleCreateWalletNote",value:function(e){this.updateAssetButton(e.assetID),this.assetUpdated(e.assetID),this.showTxHistory(e.assetID)}},{key:"handleCustomWalletNote",value:function(e){var t=e.payload;switch(t.route){case"tipChange":var n=t;if(42===n.assetID){if(!this.stakeStatus)return;var r=n.data;if(pt().walletMap[n.assetID].synced){var a=pt().unitInfo(n.assetID);this.updateTicketStats(r.stats,a,r.ticketPrice,r.votingSubsidy)}}break;case"ticketPurchaseUpdate":this.processTicketPurchaseUpdate(t);break;case"transaction":var o=t;o.assetID===this.selectedAssetID&&this.handleTxNote(o.transaction,o.new);break;case"transactionHistorySynced":var s=t;s.assetID===this.selectedAssetID&&this.showTxHistory(s.assetID)}}},{key:"unload",value:function(){clearInterval(this.secondTicker),qe.unbind(document,"keyup",this.keyup)}}]),ve}(ct);function ha(e,t){return e.length<=t?e:"".concat(e.substring(0,t/2),"...").concat(e.substring(e.length-t/2))}function pa(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var fa="order",va="match",ma="bondpost",ga="conn";function ya(){return"desktop_notifications-".concat(window.location.host)}var ba,xa=(h(ia={},fa,"BROWSER_NTFN_ORDERS"),h(ia,va,"BROWSER_NTFN_MATCHES"),h(ia,ma,"BROWSER_NTFN_BONDS"),h(ia,ga,"BROWSER_NTFN_CONNECTIONS"),ia),ka=(h(ca={},fa,!0),h(ca,va,!0),h(ca,ma,!0),h(ca,ga,!0),function(){function e(){i(this,e)}var t,n;return d(e,null,[{key:"ntfnPermissionGranted",value:function(){return"granted"===window.Notification.permission}},{key:"ntfnPermissionDenied",value:function(){return"denied"===window.Notification.permission}},{key:"requestNtfnPermission",value:(n=s(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("Notification"in window){t.next=2;break}return t.abrupt("return");case 2:if(!e.ntfnPermissionGranted()){t.next=6;break}e.sendDesktopNotification(xe(ee)),t.next=10;break;case 6:if(e.ntfnPermissionDenied()){t.next=10;break}return t.next=9,Notification.requestPermission();case 9:e.sendDesktopNotification(xe(ee));case 10:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{key:"sendDesktopNotification",value:(t=s(f().mark((function t(n,r){var a;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.ntfnPermissionGranted()){t.next=2;break}return t.abrupt("return");case 2:return a=new window.Notification(n,{body:r,icon:"/img/softened-icon.png"}),t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})}]),e}()),wa=function(){function e(){i(this,e)}var t,n;return d(e,null,[{key:"ntfnPermissionGranted",value:function(){return!0}},{key:"ntfnPermissionDenied",value:function(){return!1}},{key:"requestNtfnPermission",value:(n=s(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendDesktopNotification(xe(ee));case 2:return t.abrupt("return",Promise.resolve());case 3:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{key:"sendDesktopNotification",value:(t=s(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ca()){e.next=5;break}return e.next=3,window.sendOSNotification(t,n);case 3:e.next=11;break;case 5:if(!Sa()){e.next=10;break}return e.next=8,window.webkit.messageHandlers.bwHandler.postMessage(["sendOSNotification",t,n]);case 8:e.next=11;break;case 10:console.error("sendDesktopNotification: unknown environment");case 11:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})}]),e}();function Ca(){return void 0!==window.isWebview}function Sa(){var e,t;return void 0!==(null===(e=window.webkit)||void 0===e||null===(t=e.messageHandlers)||void 0===t?void 0:t.bwHandler)}var Fa=Ca()||Sa()?wa:ka;function Da(){return(Da=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ba.browserNtfnEnabled&&ba[t.type]){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Fa.sendDesktopNotification(t.subject,Ea(t.details));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ta(){var e;if(void 0!==ba)return ba;var t=ya();return ba=null!==(e=k.fetchLocal(t))&&void 0!==e?e:{}}var Ia=/\{\{\{([^|]+)\|([^}]+)\}\}\}/g,Aa=/\{\{\{order\|([^}]+)\}\}\}/g;function Ra(e,t){for(var n=t.replace(Aa,(function(e,t){var n=document.createElement("a");return n.setAttribute("href","/order/"+t),n.setAttribute("class","subtlelink"),n.textContent=t.slice(0,8),n.outerHTML})).replace(Ia,(function(e,t,n){var r=document.createElement("a");return r.setAttribute("data-explorer-coin",n),r.setAttribute("target","_blank"),r.textContent=n.slice(0,8),Gn(t,r),r.outerHTML})),r=qe.noderize(n).body;r.firstChild;)e.appendChild(r.firstChild)}function Ea(e){return e.replace(Ia,(function(e,t,n){return n.slice(0,8)}))}var Ba=["bonds"];var Pa=function(e){g(A,e);var t,n,r,a,o,c,l,u,p,m,x,w,C,F,D,T,I=(D=A,T=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(D);if(T){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return y(this,e)});function A(e){var t;i(this,A),h(v(t=I.call(this)),"body",void 0),h(v(t),"currentDEX",void 0),h(v(t),"page",void 0),h(v(t),"forms",void 0),h(v(t),"fiatRateSources",void 0),h(v(t),"regAssetForm",void 0),h(v(t),"confirmRegisterForm",void 0),h(v(t),"newWalletForm",void 0),h(v(t),"walletWaitForm",void 0),h(v(t),"dexAddrForm",void 0),h(v(t),"appPassResetForm",void 0),h(v(t),"currentForm",void 0),h(v(t),"keyup",void 0),t.body=e;var n=t.page=qe.idDescendants(e);t.forms=qe.applySelector(n.forms,":scope > form"),t.fiatRateSources=qe.applySelector(n.fiatRateSources,"input[type=checkbox]"),n.darkMode.checked="1"===k.fetchLocal(k.darkModeLK),qe.bind(n.darkMode,"click",(function(){k.storeLocal(k.darkModeLK,n.darkMode.checked?"1":"0"),n.darkMode.checked?document.body.classList.add("dark"):document.body.classList.remove("dark")})),n.showPokes.checked="1"===k.fetchLocal(k.popupsLK),qe.bind(n.showPokes,"click",(function(){var e=n.showPokes.checked||!1;k.storeLocal(k.popupsLK,e?"1":"0"),pt().showPopups=e})),n.commitHash.textContent=pt().commitHash.substring(0,7),qe.bind(n.addADex,"click",(function(){t.dexAddrForm.refresh(),t.showForm(n.dexAddrForm)})),t.fiatRateSources.forEach((function(e){qe.bind(e,"change",s(f().mark((function t(){var n;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S("/api/toggleratesource",{disable:!e.checked,source:e.value});case 2:return n=t.sent,pt().checkResponse(n)||(e.checked=!e.checked),t.next=6,pt().fetchUser();case 6:case"end":return t.stop()}}),t)}))))})),t.regAssetForm=new Rr(n.regAssetForm,function(){var e=s(f().mark((function e(r,a){var o,s,i,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r!==ht){e.next=5;break}return e.next=3,pt().fetchUser();case 3:return window.location.reload(),e.abrupt("return");case 5:if(o=pt().assets[r],!(s=o.wallet)){e.next=19;break}return i=t.currentDEX.bondAssets[o.symbol],e.next=11,t.getBondsFeeBuffer(r,n.regAssetForm);case 11:if(c=e.sent,t.confirmRegisterForm.setAsset(r,a,c),!(s.synced&&s.balance.available>=2*i.amount+c)){e.next=16;break}return t.animateConfirmForm(n.regAssetForm),e.abrupt("return");case 16:return t.walletWaitForm.setWallet(r,c,a),t.slideSwap(n.walletWait),e.abrupt("return");case 19:t.confirmRegisterForm.setAsset(r,a,0),t.newWalletForm.setAsset(r),t.slideSwap(n.newWalletForm);case 22:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),t.confirmRegisterForm=new Ar(n.confirmRegForm,(function(){t.registerDEXSuccess()}),(function(){t.animateRegAsset(n.confirmRegForm)})),t.newWalletForm=new Dr(n.newWalletForm,(function(e){return t.newWalletCreated(e,t.confirmRegisterForm.tier)}),(function(){return t.animateRegAsset(n.newWalletForm)})),t.walletWaitForm=new Er(n.walletWait,(function(){t.animateConfirmForm(n.walletWait)}),(function(){t.animateRegAsset(n.walletWait)})),t.dexAddrForm=new Pr(n.dexAddrForm,function(){var e=s(f().mark((function e(r,a){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.currentDEX=r,t.confirmRegisterForm.setExchange(r,a),t.walletWaitForm.setExchange(r),t.regAssetForm.setExchange(r,a),t.animateRegAsset(n.dexAddrForm);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),qe.bind(n.importAccount,"click",(function(){return t.prepareAccountImport(n.authorizeAccountImportForm)})),zr(n.authorizeAccountImportForm,n.authorizeImportAccountConfirm,(function(){return t.importAccount()})),qe.bind(n.changeAppPW,"click",(function(){return t.showForm(n.changeAppPWForm)})),zr(n.changeAppPWForm,n.submitNewPW,(function(){return t.changeAppPW()})),t.appPassResetForm=new qr(n.resetAppPWForm,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt().loadPage("login");case 2:qe.hide(n.forms);case 3:case"end":return e.stop()}}),e)})))),qe.bind(n.resetAppPW,"click",(function(){t.appPassResetForm.refresh(),t.showForm(n.resetAppPWForm),t.appPassResetForm.focus()})),qe.bind(n.accountFile,"change",(function(){return t.onAccountFileChange()})),qe.bind(n.removeAccount,"click",(function(){return t.clearAccountFile()})),qe.bind(n.addAccount,"click",(function(){return n.accountFile.click()})),qe.bind(n.exportSeed,"click",(function(){qe.hide(n.exportSeedErr),t.showForm(n.exportSeedAuth)})),zr(n.exportSeedAuth,n.exportSeedSubmit,(function(){return t.submitExportSeedReq()})),qe.bind(n.gameCodeLink,"click",(function(){return t.showForm(n.gameCodeForm)})),qe.bind(n.gameCodeSubmit,"click",(function(){return t.submitGameCode()}));var r=function(){qe.hide(n.forms),n.exportSeedPW.value="",n.legacySeed.textContent="",n.mnemonic.textContent=""};return qe.bind(n.forms,"mousedown",(function(e){qe.mouseInElement(e,t.currentForm)||r()})),t.keyup=function(e){"Escape"===e.key&&r()},qe.bind(document,"keyup",t.keyup),n.forms.querySelectorAll(".form-closer").forEach((function(e){qe.bind(e,"click",(function(){r()}))})),t.renderDesktopNtfnSettings(),t}return d(A,[{key:"updateNtfnSetting",value:function(e){var t=e.target,n=t.getAttribute("name");null!==n&&function(e,t){Ta(),ba[e]=t,k.storeLocal(ya(),ba)}(n,t.checked)}},{key:"getBrowserNtfnSettings",value:function(){return Ta()}},{key:"renderDesktopNtfnSettings",value:(F=s(f().mark((function e(){var t,n,r,a,o,i,c=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.page,n=this.getBrowserNtfnSettings(),r=xa,(a=t.browserNtfnCheckboxTemplate).removeAttribute("id"),o=t.browserNtfnCheckboxContainer,qe.empty(t.browserNtfnCheckboxContainer),Object.keys(r).forEach((function(e){var t=a.cloneNode(!0),s=n[e],i=qe.tmplElement(t,"checkbox");qe.tmplElement(t,"label").textContent=xe(r[e]),i.setAttribute("name",e),s&&i.setAttribute("checked","checked"),o.appendChild(t),qe.bind(i,"click",c.updateNtfnSetting)})),i=t.browserNtfnEnabled,qe.bind(i,"click",function(){var e=s(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Fa.ntfnPermissionDenied()){e.next=2;break}return e.abrupt("return");case 2:if(!(n=t.target).checked){e.next=7;break}return e.next=6,Fa.requestNtfnPermission();case 6:n.checked=!Fa.ntfnPermissionDenied();case 7:c.updateNtfnSetting(t),n.dispatchEvent(new Event("change"));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),qe.bind(i,"change",(function(e){var n=e.target,r=Fa.ntfnPermissionDenied();qe.setVis(n.checked,t.browserNtfnCheckboxContainer),qe.setVis(r,t.browserNtfnBlockedMsg),n.disabled=r})),i.checked=Fa.ntfnPermissionGranted()&&n.browserNtfnEnabled,i.dispatchEvent(new Event("change"));case 13:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"slideSwap",value:function(e){_r(this.currentForm,e),this.currentForm=e}},{key:"getBondsFeeBuffer",value:(C=s(f().mark((function e(t,n){var r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=pt().loading(n),e.next=3,S("/api/bondsfeebuffer",{assetID:t});case 3:if(a=e.sent,r(),pt().checkResponse(a)){e.next=7;break}return e.abrupt("return",0);case 7:return e.abrupt("return",a.feeBuffer);case 8:case"end":return e.stop()}}),e)}))),function(e,t){return C.apply(this,arguments)})},{key:"newWalletCreated",value:(w=s(f().mark((function e(t,n){var r,a,o,s,i,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt().fetchUser();case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return");case 5:return a=this.page,o=r.assets[t],s=o.wallet,i=this.currentDEX.bondAssets[o.symbol].amount,e.next=11,this.getBondsFeeBuffer(t,a.newWalletForm);case 11:if(c=e.sent,this.confirmRegisterForm.setFees(t,c),!(s.synced&&s.balance.available>=2*i+c)){e.next=17;break}return e.next=16,this.animateConfirmForm(a.newWalletForm);case 16:return e.abrupt("return");case 17:this.walletWaitForm.setWallet(t,c,n),this.slideSwap(a.walletWait);case 19:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"onAccountFileChange",value:(x=s(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,(n=t.accountFile.files)&&n.length){e.next=4;break}return e.abrupt("return");case 4:t.selectedAccount.textContent=n[0].name,qe.show(t.removeAccount),qe.hide(t.addAccount);case 7:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"clearAccountFile",value:function(){var e=this.page;e.accountFile.value="",e.selectedAccount.textContent=xe(j),qe.hide(e.removeAccount),qe.show(e.addAccount)}},{key:"prepareAccountImport",value:(m=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.page.importAccountErr.textContent="",this.showForm(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"importAccount",value:(p=s(f().mark((function e(){var t,n,r,a,o,s,i,c,l,u,d;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,n="",!t.accountFile.value){e.next=10;break}if((r=t.accountFile.files)&&r.length){e.next=7;break}return console.error("importAccount: no file specified"),e.abrupt("return");case 7:return e.next=9,r[0].text();case 9:n=e.sent;case 10:e.prev=10,a=JSON.parse(n),e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(10),t.importAccountErr.textContent=e.t0.message,qe.show(t.importAccountErr),e.abrupt("return");case 19:if(void 0!==a){e.next=22;break}return qe.showFormError(t.importAccountErr,xe("ACCT_UNDEFINED")),e.abrupt("return");case 22:return s=(o=a).bonds,i=void 0===s?[]:s,c=pa(o,Ba),l={account:c,bonds:i},u=pt().loading(this.body),e.next=27,S("/api/importaccount",l);case 27:if(d=e.sent,u(),pt().checkResponse(d)){e.next=32;break}return qe.showFormError(t.importAccountErr,d.msg),e.abrupt("return");case 32:return e.next=34,pt().fetchUser();case 34:qe.hide(t.forms),window.location.reload();case 36:case"end":return e.stop()}}),e,this,[[10,14]])}))),function(){return p.apply(this,arguments)})},{key:"submitExportSeedReq",value:(u=s(f().mark((function e(){var t,n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=t.exportSeedPW.value,r=pt().loading(this.body),e.next=5,S("/api/exportseed",{pass:n});case 5:if(a=e.sent,r(),pt().checkResponse(a)){e.next=10;break}return qe.showFormError(t.exportSeedErr,a.msg),e.abrupt("return");case 10:t.exportSeedPW.value="",128===a.seed.length&&1===a.seed.split(" ").length?t.legacySeed.textContent=a.seed.match(/.{1,32}/g).map((function(e){var t;return null===(t=e.match(/.{1,8}/g))||void 0===t?void 0:t.join(" ")})).join("\n"):t.mnemonic.textContent=a.seed,this.showForm(t.authorizeSeedDisplay);case 13:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"showForm",value:(l=s(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.page,this.currentForm=t,this.forms.forEach((function(e){return qe.hide(e)})),t.style.right="10000px",qe.show(n.forms,t),r=(n.forms.offsetWidth+t.offsetWidth)/2,e.next=8,qe.animate(300,(function(e){t.style.right="".concat((1-e)*r,"px")}),"easeOutHard");case 8:t.style.right="0";case 9:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"getCertFile",value:(c=s(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="",!this.dexAddrForm.page.certFile.value){e.next=7;break}if(!(n=this.dexAddrForm.page.certFile.files)||!n.length){e.next=7;break}return e.next=6,n[0].text();case 6:t=e.sent;case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"registerDEXSuccess",value:(o=s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.location.reload();case 1:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})},{key:"changeAppPW",value:(a=s(f().mark((function e(){var t,n,r,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,qe.hide(t.changePWErrMsg),n=function(){t.appPW.value="",t.newAppPW.value="",t.confirmNewPW.value=""},t.appPW.value&&t.newAppPW.value&&t.confirmNewPW.value){e.next=7;break}return qe.showFormError(t.changePWErrMsg,xe("NO_APP_PASS_ERROR_MSG")),n(),e.abrupt("return");case 7:if(t.newAppPW.value===t.confirmNewPW.value){e.next=11;break}return qe.showFormError(t.changePWErrMsg,xe(N)),n(),e.abrupt("return");case 11:return r=pt().loading(t.changeAppPW),a={appPW:t.appPW.value,newAppPW:t.newAppPW.value},n(),e.next=16,S("/api/changeapppass",a);case 16:if(o=e.sent,r(),pt().checkResponse(o)){e.next=21;break}return qe.showFormError(t.changePWErrMsg,o.msg),e.abrupt("return");case 21:qe.hide(t.forms);case 22:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"unload",value:function(){qe.unbind(document,"keyup",this.keyup)}},{key:"animateRegAsset",value:(r=s(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:qe.hide(t),n=this.page.regAssetForm,this.currentForm=n,this.regAssetForm.animate(),qe.show(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"animateConfirmForm",value:(n=s(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.confirmRegisterForm.animate(),n=this.page.confirmRegForm,this.currentForm=n,qe.hide(t),qe.show(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"submitGameCode",value:(t=s(f().mark((function e(){var t,n,r,a,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,qe.hide(t.gameCodeErr),n=t.gameCodeInput.value){e.next=7;break}return t.gameCodeErr.textContent=xe("NO_CODE_PROVIDED"),qe.show(t.gameCodeErr),e.abrupt("return");case 7:return r=t.gameCodeMsg.value||"",a=pt().loading(t.gameCodeForm),e.next=11,S("/api/redeemgamecode",{code:n,msg:r});case 11:if(o=e.sent,a(),pt().checkResponse(o)){e.next=17;break}return t.gameCodeErr.textContent=xe(H,{msg:o.msg}),qe.show(t.gameCodeErr),e.abrupt("return");case 17:qe.show(t.gameCodeSuccess),t.gameRedeemTx.dataset.explorerCoin=o.coinString,Gn(42,t.gameRedeemTx),t.gameRedeemTx.textContent=o.coinString,s=pt().unitInfo(42),t.gameRedeemValue.textContent=qe.formatCoinValue(o.win,s);case 24:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),A}(ct);function La(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Oa=function(){function e(t,n,r){i(this,e),h(this,"base",void 0),h(this,"baseSymbol",void 0),h(this,"quote",void 0),h(this,"quoteSymbol",void 0),h(this,"buys",void 0),h(this,"sells",void 0),this.base=t.base,this.baseSymbol=n,this.quote=t.quote,this.quoteSymbol=r,this.buys=t.book.buys||[],this.sells=t.book.sells||[]}return d(e,[{key:"add",value:function(e){if(0!==e.qtyAtomic){var t=e.sell?this.sells:this.buys;t.splice(function(e,t,n){for(var r=0;r<e.length;r++)if(e[r].rate<t===n)return r;return e.length}(t,e.rate,!e.sell),0,e)}else window.log("zeroqty","zero quantity order encountered",e)}},{key:"remove",value:function(e){this.removeFromSide(this.sells,e)||this.removeFromSide(this.buys,e)}},{key:"removeFromSide",value:function(e,t){var n=a(this.findOrder(e,t),2),r=n[0],o=n[1];return!!r&&(e.splice(o,1),!0)}},{key:"findOrder",value:function(e,t){for(var n=0;n<e.length;n++)if(e[n].token===t)return[e[n],n];return[null,-1]}},{key:"updateRemaining",value:function(e,t,n){this.updateRemainingSide(this.sells,e,t,n)||this.updateRemainingSide(this.buys,e,t,n)}},{key:"updateRemainingSide",value:function(e,t,n,r){var a=this.findOrder(e,t)[0];return!!a&&(a.qty=n,a.qtyAtomic=r,!0)}},{key:"setEpoch",value:function(e){var t=function(t){return void 0===t.epoch||0===t.epoch||t.epoch===e};this.sells=this.sells.filter(t),this.buys=this.buys.filter(t)}},{key:"empty",value:function(){return!this.sells.length&&!this.buys.length}},{key:"count",value:function(){return this.sells.length+this.buys.length}},{key:"bestGapOrder",value:function(e){var t,n=null,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return La(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?La(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(!a.epoch)return a;n||(n=a)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"bestGapBuy",value:function(){return this.bestGapOrder(this.buys)}},{key:"bestGapSell",value:function(){return this.bestGapOrder(this.sells)}}]),e}();function Ma(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qa(e,t,n){if(e||!t.error){if(void 0!==n[e])for(var r=0;r<n[e].length;r++)n[e][r](t)}else{var a=t.error;console.error("websocket error (code ".concat(a.code,"): ").concat(a.message))}}var Na=0;const Wa=new(function(){function e(){i(this,e),h(this,"uri",void 0),h(this,"connection",void 0),h(this,"handlers",void 0),h(this,"queue",void 0),h(this,"maxQlength",void 0),h(this,"reloader",void 0),this.handlers={},this.queue=[],this.maxQlength=5}return d(e,[{key:"registerRoute",value:function(e,t){this.handlers[e]=this.handlers[e]||[],this.handlers[e].push(t)}},{key:"deregisterRoute",value:function(e){this.handlers[e]=[]}},{key:"request",value:function(e,t){if(this.connection&&this.connection.readyState===window.WebSocket.OPEN){Na++;var n=JSON.stringify({route:e,type:1,id:Na,payload:t});window.log("ws","sending",n),this.connection.send(n)}else{for(;this.queue.length>this.maxQlength-1;)this.queue.shift();this.queue.push([e,t])}}},{key:"close",value:function(e){window.log("ws","close, reason:",e,this.handlers),this.handlers={},this.connection&&this.connection.close()}},{key:"connect",value:function(e,t){var n=this;this.uri=e,this.reloader=t;var r=0;!function o(){window.log("ws","connecting to ".concat(e));var s=n.connection=new window.WebSocket(e);if(s){var i=setTimeout((function(){s&&s.close()}),500);s.onmessage=function(e){var t=JSON.parse(e.data);qa(t.route,t.payload,n.handlers)},s.onclose=function(e){window.log("ws","onclose"),clearTimeout(i),s=n.connection=null,qa("close",null,n.handlers),r++;var t=Math.min(Math.pow(1.25,r),10);console.error("websocket disconnected (".concat(e.code,"), trying again in ").concat(t.toFixed(1)," seconds")),setTimeout((function(){o()}),1e3*t)},s.onopen=function(){window.log("ws","onopen"),clearTimeout(i),r>0&&(r=0,t()),qa("open",null,n.handlers);var e=n.queue;n.queue=[];var o,s=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ma(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ma(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}(e);try{for(s.s();!(o=s.n()).done;){var c=a(o.value,2),l=c[0],u=c[1];n.request(l,u)}}catch(e){s.e(e)}finally{s.f()}},s.onerror=function(e){window.log("ws","onerror:",e),qa("error",e,n.handlers)}}}()}}]),e}());function Va(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ua(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Va(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Va(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ja(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ja(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){i=!0,o=e})),f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function ja(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ha=qe.bind,za="book",Ga="book_order",Xa="unbook_order",Ka="update_remaining",Qa="epoch_order",Ya="candles",Ja="candle_update",Za="buygreen-bg",$a="sellred-bg",eo="5m",to=new Intl.NumberFormat(qe.languages(),{minimumFractionDigits:1,maximumFractionDigits:2}),no=4294967295,ro=function(e){g(_,e);var t,n,o,c,l,u,p,m,x,w,C,F,D,T,I,A,R,q,N,W,V,U=(W=_,V=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(W);if(V){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return y(this,e)});function _(e,t){var n;i(this,_),h(v(n=U.call(this)),"page",void 0),h(v(n),"main",void 0),h(v(n),"maxLoaded",void 0),h(v(n),"maxOrderUpdateCounter",void 0),h(v(n),"market",void 0),h(v(n),"currentForm",void 0),h(v(n),"openAsset",void 0),h(v(n),"currentCreate",void 0),h(v(n),"maxEstimateTimer",void 0),h(v(n),"book",void 0),h(v(n),"cancelData",void 0),h(v(n),"metaOrders",void 0),h(v(n),"preorderCache",void 0),h(v(n),"currentOrder",void 0),h(v(n),"depthLines",void 0),h(v(n),"activeMarkerRate",void 0),h(v(n),"hovers",void 0),h(v(n),"ogTitle",void 0),h(v(n),"depthChart",void 0),h(v(n),"candleChart",void 0),h(v(n),"candleDur",void 0),h(v(n),"balanceWgt",void 0),h(v(n),"mm",void 0),h(v(n),"marketList",void 0),h(v(n),"newWalletForm",void 0),h(v(n),"depositAddrForm",void 0),h(v(n),"approveTokenForm",void 0),h(v(n),"reputationMeter",void 0),h(v(n),"keyup",void 0),h(v(n),"secondTicker",void 0),h(v(n),"candlesLoading",void 0),h(v(n),"accelerateOrderForm",void 0),h(v(n),"recentMatches",void 0),h(v(n),"recentMatchesSortKey",void 0),h(v(n),"recentMatchesSortDirection",void 0),h(v(n),"stats",void 0),h(v(n),"loadingAnimations",void 0),h(v(n),"mmRunning",void 0),h(v(n),"forms",void 0);var r=n.page=qe.idDescendants(e);if(n.main=e,!n.main.parentElement)return y(n);n.maxOrderUpdateCounter=0,n.metaOrders={},n.recentMatches=[],n.preorderCache={},n.depthLines={hover:[],input:[]},n.hovers=[],n.recentMatchesSortKey="age",n.recentMatchesSortDirection=-1,n.ogTitle=document.title,n.forms=new Fr(r.forms);var a={click:function(e){n.reportDepthClick(e)},volume:function(e){n.reportDepthVolume(e)},mouse:function(e){n.reportDepthMouse(e)},zoom:function(e){n.reportDepthZoom(e)}};n.depthChart=new sn(r.depthChart,a,k.fetchLocal(k.depthZoomLK));var o={mouse:function(e){n.reportMouseCandle(e)}};n.candleChart=new cn(r.candlesChart,o),n.accelerateOrderForm=new Br(r.accelerateForm,(function(){})),n.approveTokenForm=new Wr(r.approveTokenForm),n.candleDur=k.fetchLocal(k.lastCandleDurationLK)||"1h";var c=qe.tmplElement(r.notRegistered,"registerBttn");Ha(c,"click",(function(){pt().loadPage("register",{host:n.market.dex.host})})),r.walletInfoTmpl.removeAttribute("id");var l=r.walletInfoTmpl,u=r.walletInfoTmpl.cloneNode(!0);l.after(u);var d=n.balanceWgt=new so(l,u),p=d.base.stateIcons.icons,m=d.quote.stateIcons.icons;Ha(d.base.tmpl.connect,"click",(function(){n.unlockWallet(n.market.base.id)})),Ha(d.quote.tmpl.connect,"click",(function(){n.unlockWallet(n.market.quote.id)})),Ha(d.base.tmpl.expired,"click",(function(){n.unlockWallet(n.market.base.id)})),Ha(d.quote.tmpl.expired,"click",(function(){n.unlockWallet(n.market.quote.id)})),Ha(p.sleeping,"click",(function(){n.unlockWallet(n.market.base.id)})),Ha(m.sleeping,"click",(function(){n.unlockWallet(n.market.quote.id)})),Ha(p.locked,"click",(function(){n.unlockWallet(n.market.base.id)})),Ha(m.locked,"click",(function(){n.unlockWallet(n.market.quote.id)})),Ha(p.disabled,"click",(function(){n.showToggleWalletStatus(n.market.base)})),Ha(m.disabled,"click",(function(){n.showToggleWalletStatus(n.market.quote)})),Ha(d.base.tmpl.newWalletBttn,"click",(function(){n.showCreate(n.market.base)})),Ha(d.quote.tmpl.newWalletBttn,"click",(function(){n.showCreate(n.market.quote)})),Ha(d.base.tmpl.walletAddr,"click",(function(){n.showDeposit(n.market.base.id)})),Ha(d.quote.tmpl.walletAddr,"click",(function(){n.showDeposit(n.market.quote.id)})),Ha(d.base.tmpl.wantProviders,"click",(function(){n.showCustomProviderDialog(n.market.base.id)})),Ha(d.quote.tmpl.wantProviders,"click",(function(){n.showCustomProviderDialog(n.market.quote.id)})),n.depositAddrForm=new Mr(r.deposit);var g={orderReportForm:r.orderReportForm,dexBalancesRowTmpl:r.dexBalancesRowTmpl,placementRowTmpl:r.placementRowTmpl,placementAmtRowTmpl:r.placementAmtRowTmpl};qe.cleanTemplates(r.dexBalancesRowTmpl,r.placementRowTmpl,r.placementAmtRowTmpl),n.mm=new gr(r.mmRunning,n.forms,g,"markets"),n.reputationMeter=new Cn(r.reputationMeter),zr(r.toggleWalletStatusConfirm,r.toggleWalletStatusSubmit,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.toggleWalletStatus();case 1:case"end":return e.stop()}}),e)})))),vt(r),qe.cleanTemplates(r.orderRowTmpl,r.durBttnTemplate,r.booleanOptTmpl,r.rangeOptTmpl,r.orderOptTmpl,r.userOrderTmpl,r.recentMatchesTemplate),Ha(r.approveBaseBttn,"click",(function(){n.showTokenApprovalForm(!0)})),Ha(r.approveQuoteBttn,"click",(function(){n.showTokenApprovalForm(!1)}));var b=function(e){qe.setVis(!e,r.showTradingTier),qe.setVis(e,r.tradingLimits,r.hideTradingTier)};Ha(r.showTradingTier,"click",(function(){b(!0)})),Ha(r.hideTradingTier,"click",(function(){b(!1)}));var x=function(e){qe.setVis(!e,r.showTradingReputation),qe.setVis(e,r.reputationMeter,r.hideTradingReputation)};Ha(r.showTradingReputation,"click",(function(){x(!0)})),Ha(r.hideTradingReputation,"click",(function(){x(!1)})),Ha(r.buyBttn,"click",(function(){n.setBuy()})),Ha(r.sellBttn,"click",(function(){n.setSell()})),Ha(r.limitBttn,"click",(function(){uo(r.marketBttn,r.limitBttn),n.setOrderVisibility(),r.rateField.value&&(n.depthLines.input=[{rate:et(r.rateField.value,0),color:n.isSell()?n.depthChart.theme.sellLine:n.depthChart.theme.buyLine}],n.drawChartLines())})),Ha(r.marketBttn,"click",(function(){uo(r.limitBttn,r.marketBttn),n.setOrderVisibility(),n.setMarketBuyOrderEstimate(),n.depthLines.input=[],n.drawChartLines()})),Ha(r.maxOrd,"click",(function(){if(n.isSell()){var e=n.market.maxSell;if(!e)return;r.lotField.value=String(e.swap.lots)}else{var t=n.market.maxBuys[n.adjustedRate()];if(!t)return;r.lotField.value=String(t.swap.lots)}n.lotChanged()})),qe.disableMouseWheel(r.rateField,r.lotField,r.qtyField,r.mktBuyField),Wa.registerRoute(za,(function(e){n.handleBookRoute(e)})),Wa.registerRoute(Ga,(function(e){n.handleBookOrderRoute(e)})),Wa.registerRoute(Xa,(function(e){n.handleUnbookOrderRoute(e)})),Wa.registerRoute(Ka,(function(e){n.handleUpdateRemainingRoute(e)})),Wa.registerRoute(Qa,(function(e){n.handleEpochOrderRoute(e)})),Wa.registerRoute(Ya,(function(e){n.handleCandlesRoute(e)})),Wa.registerRoute(Ja,(function(e){n.handleCandleUpdateRoute(e)})),Wa.registerRoute("epoch_match_summary",(function(e){n.handleEpochMatchSummary(e)})),n.newWalletForm=new Dr(r.newWalletForm,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.createWallet();case 1:case"end":return e.stop()}}),e)})))),zr(r.orderForm,r.submitBttn,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.stepSubmit();case 1:case"end":return e.stop()}}),e)})))),zr(r.verifyForm,r.vSubmit,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.submitOrder();case 1:case"end":return e.stop()}}),e)})))),zr(r.cancelForm,r.cancelSubmit,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.submitCancel();case 1:case"end":return e.stop()}}),e)})))),qe.bind(r.vFeeDetails,"click",(function(){return n.forms.show(r.vDetailPane)})),qe.bind(r.closeDetailPane,"click",(function(){return n.showVerifyForm()})),r.recentMatchesTable.querySelectorAll("[data-ordercol]").forEach((function(e){return Ha(e,"click",(function(){return w(e.dataset.ordercol||"")}))}));var w=function(e){C(),n.recentMatchesSortKey===e?n.recentMatchesSortDirection*=-1:(n.recentMatchesSortKey=e,n.recentMatchesSortDirection=1),n.refreshRecentMatchesTable(),S()},C=function(){r.recentMatchesTable.querySelectorAll("[data-ordercol]").forEach((function(e){return e.classList.remove("sorted-asc","sorted-dsc")}))},S=function(){var e=n.recentMatchesSortKey,t=1===n.recentMatchesSortDirection?"sorted-asc":"sorted-dsc";qe.safeSelector(r.recentMatchesTable,"[data-ordercol=".concat(e,"]")).classList.add(t)};S();var F=function(){n.forms.close()};Ha(r.forms,"mousedown",(function(e){if(qe.isDisplayed(r.vDetailPane)&&!qe.mouseInElement(e,r.vDetailPane))return n.showVerifyForm();qe.mouseInElement(e,n.currentForm)||F()})),n.keyup=function(e){"Escape"===e.key&&F()},Ha(document,"keyup",n.keyup),r.forms.querySelectorAll(".form-closer").forEach((function(e){qe.bind(e,"click",(function(){F()}))})),Ha(r.lotField,["change","keyup"],(function(){n.lotChanged()})),Ha(r.qtyField,"change",(function(){n.quantityChanged(!0)})),Ha(r.qtyField,"keyup",(function(){n.quantityChanged(!1)})),Ha(r.mktBuyField,["change","keyup"],(function(){n.marketBuyChanged()})),Ha(r.rateField,"change",(function(){n.rateFieldChanged()})),Ha(r.rateField,"keyup",(function(){n.previewQuoteAmt(!0)})),Ha(r.marketSearchV1,["change","keyup"],(function(){n.filterMarkets()}));var D=function(e){qe.setVis(!e,r.disclaimer,r.disclaimerAck),qe.setVis(e,r.showDisclaimer)};Ha(r.disclaimerAck,"click",(function(){k.storeLocal(k.orderDisclaimerAckedLK,!0),D(!0)})),Ha(r.showDisclaimer,"click",(function(){k.storeLocal(k.orderDisclaimerAckedLK,!1),D(!1)})),D(k.fetchLocal(k.orderDisclaimerAckedLK));var T=function(){n.depthLines.hover=[],n.drawChartLines()};Ha(r.buyRows,"mouseleave",T),Ha(r.sellRows,"mouseleave",T),Ha(r.userOrders,"mouseleave",(function(){n.activeMarkerRate=null,n.setDepthMarkers()}));var I=r.marketStats,A=I.cloneNode(!0);A.classList.add("listopen"),qe.hide(I,A),A.removeAttribute("id"),pt().headerSpace.appendChild(A),n.stats=[{row:I,tmpl:qe.parseTemplate(I)},{row:A,tmpl:qe.parseTemplate(A)}];var R=function(){k.storeLocal(k.leftMarketDockLK,"0"),r.leftMarketDock.classList.remove("default"),r.leftMarketDock.classList.add("stashed");var e,t=_a(n.stats);try{for(t.s();!(e=t.n()).done;)e.value.row.classList.remove("listopen")}catch(e){t.e(e)}finally{t.f()}},E=function(){k.storeLocal(k.leftMarketDockLK,"1"),r.leftMarketDock.classList.remove("default","stashed");var e,t=_a(n.stats);try{for(t.s();!(e=t.n()).done;)e.value.row.classList.add("listopen")}catch(e){t.e(e)}finally{t.f()}};qe.bind(r.leftHider,"click",(function(){return R()})),qe.bind(r.marketReopener,"click",(function(){return E()}));var B,P=_a(n.stats);try{for(P.s();!(B=P.n()).done;){var L=B.value;qe.bind(L.tmpl.marketSelect,"click",(function(){0===r.leftMarketDock.clientWidth?E():R()}))}}catch(e){P.e(e)}finally{P.f()}n.marketList=new ao(r.marketListV1);var O,M=_a(n.marketList.markets);try{var q=function(){var e=O.value;Ha(e.node,"click",(function(){var t,r,a,o,s=e.mkt,i=s.quoteid,c=s.baseid,l=s.xc.host;(null===(t=n.market)||void 0===t||null===(r=t.base)||void 0===r?void 0:r.id)===c&&(null===(a=n.market)||void 0===a||null===(o=a.quote)||void 0===o?void 0:o.id)===i||(n.startLoadingAnimations(),n.setMarket(l,c,i))}))};for(M.s();!(O=M.n()).done;)q()}catch(e){M.e(e)}finally{M.f()}return"1"!==k.fetchLocal(k.leftMarketDockLK)&&R(),pt().registerNoteFeeder({order:function(e){n.handleOrderNote(e)},match:function(e){n.handleMatchNote(e)},epoch:function(e){n.handleEpochNote(e)},conn:function(e){n.handleConnNote(e)},balance:function(e){n.handleBalanceNote(e)},bondpost:function(e){n.handleBondUpdate(e)},spots:function(e){n.handlePriceUpdate(e)},walletstate:function(e){n.handleWalletState(e)},reputation:function(){n.updateReputation()},feepayment:function(){n.updateReputation()},runstats:function(e){n.mm.update(),e.baseID===n.market.base.id&&e.quoteID===n.market.quote.id&&e.host===n.market.dex.host&&Boolean(n.mmRunning)!==Boolean(e.stats)&&(n.mmRunning=Boolean(e.stats),n.resolveOrderFormVisibility())},epochreport:function(e){e.baseID===n.market.base.id&&e.quoteID===n.market.quote.id&&e.host===n.market.dex.host&&n.mm.handleEpochReportNote(e)},cexproblems:function(e){e.baseID===n.market.base.id&&e.quoteID===n.market.quote.id&&e.host===n.market.dex.host&&n.mm.handleCexProblemsNote(e)},runevent:function(e){e.baseID===n.market.base.id&&e.quoteID===n.market.quote.id&&e.host===n.market.dex.host&&n.mm.update()}}),n.loadingAnimations={},n.startLoadingAnimations(),n.secondTicker=window.setInterval((function(){for(var e=0,t=Object.values(n.metaOrders);e<t.length;e++){var a=t[e];a.details.age.textContent=qe.timeSince(a.ord.submitTime)}var o,s=_a(qe.applySelector(r.recentMatchesLiveList,"[data-tmpl=age]"));try{for(s.s();!(o=s.n()).done;){var i,c=o.value;c.textContent=qe.timeSince(parseFloat(null!==(i=c.dataset.sinceStamp)&&void 0!==i?i:"0"))}}catch(e){s.e(e)}finally{s.f()}}),1e3),n.init(t),n}return d(_,[{key:"init",value:(N=s(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=null!=t&&t.host?io(t.host,parseInt(t.baseID),parseInt(t.quoteID)):k.fetchLocal(k.lastMarketLK))&&this.marketList.exists(n.host,n.base,n.quote)||(r=this.marketList.first())&&(n={host:r.mkt.xc.host,base:r.mkt.baseid,quote:r.mkt.quoteid}),n?this.setMarket(n.host,n.base,n.quote):this.balanceWgt.setBalanceVisibility(!1),this.setRegistrationStatusVisibility();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"startLoadingAnimations",value:function(){var e=this.page,t=this.loadingAnimations,n=this.depthChart,r=this.candleChart;n.canvas.classList.add("invisible"),r.canvas.classList.add("invisible"),t.candles&&t.candles.stop(),t.candles=new ln(e.candlesChart,{message:xe("CANDLES_LOADING")}),t.depth&&t.depth.stop(),t.depth=new ln(e.depthChart,{message:xe("DEPTH_LOADING")})}},{key:"isSell",value:function(){return this.page.sellBttn.classList.contains("selected")}},{key:"isLimit",value:function(){return this.page.limitBttn.classList.contains("selected")}},{key:"setBuy",value:function(){var e=this.page;uo(e.sellBttn,e.buyBttn),e.submitBttn.classList.remove($a),e.submitBttn.classList.add(Za),e.maxLbl.textContent=xe(E),this.setOrderBttnText(),this.setOrderVisibility(),this.drawChartLines(),this.isLimit()?(this.currentOrder=this.parseOrder(),this.updateOrderBttnState()):this.marketBuyChanged()}},{key:"setSell",value:function(){var e=this.page;uo(e.buyBttn,e.sellBttn),e.submitBttn.classList.add($a),e.submitBttn.classList.remove(Za),e.maxLbl.textContent=xe(B),this.setOrderBttnText(),this.setOrderVisibility(),this.drawChartLines(),this.currentOrder=this.parseOrder(),this.updateOrderBttnState()}},{key:"hasPendingBonds",value:function(){return Object.keys(this.market.dex.auth.pendingBonds||[]).length>0}},{key:"setCurrMarketPrice",value:function(){var e=this.market;if(e){var t=pt().exchanges[e.dex.host],n=t.markets[e.cfg.name];if(n.spot){var r,a=_a(this.stats);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=t.assets[n.baseid].unitInfo.conventional,i=s.conversionFactor,c=s.unit,l=pt().fiatRatesMap[n.baseid];l?(o.tmpl.volume.textContent=qe.formatFourSigFigs(n.spot.vol24/i*l),o.tmpl.volUnit.textContent="USD"):(o.tmpl.volume.textContent=qe.formatFourSigFigs(n.spot.vol24/i),o.tmpl.volUnit.textContent=c),fo(o.tmpl,t,n)}}catch(e){a.e(e)}finally{a.f()}this.page.obPrice.textContent=qe.formatFourSigFigs(n.spot.rate/this.market.rateConversionFactor),this.page.obPrice.classList.remove("sellcolor","buycolor"),this.page.obPrice.classList.add(n.spot.change24>=0?"buycolor":"sellcolor"),qe.setVis(n.spot.change24>=0,this.page.obUp),qe.setVis(n.spot.change24<0,this.page.obDown)}}}},{key:"setMarketDetails",value:function(){if(this.market){var e,t=_a(this.stats);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=this.market,a=r.baseCfg,o=r.quoteCfg;n.tmpl.baseIcon.src=qe.logoPath(a.symbol),n.tmpl.quoteIcon.src=qe.logoPath(o.symbol),qe.empty(n.tmpl.baseSymbol,n.tmpl.quoteSymbol),n.tmpl.baseSymbol.appendChild(qe.symbolize(a,!0)),n.tmpl.quoteSymbol.appendChild(qe.symbolize(o,!0))}}catch(e){t.e(e)}finally{t.f()}}}},{key:"setHighLow",value:function(){var e=0,t=0,n=this.market.cfg.spot;if(n&&n.low24&&n.high24)e=n.high24,t=n.low24;else{var r,a=null===(r=this.market)||void 0===r?void 0:r.candleCaches[eo];if(!a){if(this.candleDur!==eo)return void this.requestCandles(eo);var o,s=_a(this.stats);try{for(s.s();!(o=s.n()).done;){var i=o.value;i.tmpl.high.textContent="-",i.tmpl.low.textContent="-"}}catch(e){s.e(e)}finally{s.f()}return}for(var c=(new Date).getTime()-864e5,l=a.candles.length-1;l>=0;l--){var u=a.candles[l];if(u.endStamp<c)break;(0===t||u.lowRate>0&&u.lowRate<t)&&(t=u.lowRate),u.highRate>e&&(e=u.highRate)}}var d,h=this.market.base.id,p=this.market.quote.id,f=this.market.dex,v=_a(this.stats);try{for(v.s();!(d=v.n()).done;){var m=d.value;m.tmpl.high.textContent=e>0?qe.formatFourSigFigs(pt().conventionalRate(h,p,e,f)):"-",m.tmpl.low.textContent=t>0?qe.formatFourSigFigs(pt().conventionalRate(h,p,t,f)):"-"}}catch(e){v.e(e)}finally{v.f()}}},{key:"assetsAreSupported",value:function(){var e,t,n,r,a=this.market,o=a.base,s=a.quote,i=a.baseCfg,c=a.quoteCfg;if(!o||!s)return{isSupported:!1,text:xe("NOT_SUPPORTED",{asset:(o?c.symbol:i.symbol).toUpperCase()})};var l=o.token?null===(e=pt().assets[o.token.parentID].info)||void 0===e?void 0:e.versions:null===(t=o.info)||void 0===t?void 0:t.versions,u=s.token?null===(n=pt().assets[s.token.parentID].info)||void 0===n?void 0:n.versions:null===(r=s.info)||void 0===r?void 0:r.versions,d="";return l.includes(i.version)?u.includes(c.version)||(d=xe(P,{asset:s.symbol.toUpperCase(),version:c.version+""})):d=xe(P,{asset:o.symbol.toUpperCase(),version:i.version+""}),{isSupported:l.includes(i.version)&&u.includes(c.version),text:d}}},{key:"setOrderVisibility",value:function(){var e=this.page;this.isLimit()?(qe.show(e.priceBox,e.tifBox,e.qtyBox,e.maxBox),qe.hide(e.mktBuyBox),this.previewQuoteAmt(!0)):(qe.hide(e.tifBox,e.maxBox,e.priceBox),this.isSell()?(qe.hide(e.mktBuyBox),qe.show(e.qtyBox),this.previewQuoteAmt(!0)):(qe.show(e.mktBuyBox),qe.hide(e.qtyBox),this.previewQuoteAmt(!1))),this.updateOrderBttnState()}},{key:"resolveOrderFormVisibility",value:(q=s(f().mark((function e(){var t,n,r,a,o,i,c,l,u,d,h,p=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=function(){var e=s(f().mark((function e(){var t,n,r,a,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p.assetsAreSupported().isSupported){e.next=2;break}return e.abrupt("return",!1);case 2:if(p.market&&!(p.market.dex.auth.effectiveTier<1)){e.next=4;break}return e.abrupt("return",!1);case 4:if(t=p.tokenAssetApprovalStatuses(),n=t.baseAssetApprovalStatus,r=t.quoteAssetApprovalStatus,n===ut.Approved&&r===ut.Approved){e.next=7;break}return e.abrupt("return",!1);case 7:if(a=p.market,o=a.base,s=a.quote,o&&pt().assets[o.id].wallet&&s&&pt().assets[s.id].wallet){e.next=11;break}return e.abrupt("return",!1);case 11:if(!p.mmRunning){e.next=13;break}return e.abrupt("return",!1);case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.t0=qe,e.next=5,n();case 5:e.t1=e.sent,e.t2=t.orderForm,e.t3=t.orderTypeBttns,e.t0.setVis.call(e.t0,e.t1,e.t2,e.t3),this.market&&(r=this.market.dex.auth,a=r.effectiveTier,o=r.pendingStrength,qe.setVis(a>0||o>0,t.reputationAndTradingTierBox)),(i=pt().mmStatus)&&void 0===this.mmRunning&&this.market.base&&this.market.quote&&(c=this.market,l=c.base.id,u=c.quote.id,d=c.dex.host,h=i.bots.find((function(e){var t=e.config;return t.baseID===l&&t.quoteID===u&&t.host===d})),this.mmRunning=Boolean(null==h?void 0:h.running)),qe.setVis(this.mmRunning,t.mmRunning),this.mmRunning&&qe.hide(t.orderForm,t.orderTypeBttns);case 14:case"end":return e.stop()}}),e,this)}))),function(){return q.apply(this,arguments)})},{key:"setLoaderMsgVisibility",value:function(){var e=this.page,t=this.assetsAreSupported(),n=t.isSupported,r=t.text;n?qe.hide(e.loaderMsg):(e.loaderMsg.textContent=r,qe.show(e.loaderMsg),qe.hide(e.notRegistered),qe.hide(e.noWallet))}},{key:"showTokenApprovalForm",value:(R=s(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t?this.market.base.id:this.market.quote.id,this.approveTokenForm.setAsset(n,this.market.dex.host),this.forms.show(this.page.approveTokenForm);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"tokenAssetApprovalStatuses",value:function(){var e=this.market,t=e.base,n=e.quote,r=ut.Approved,a=ut.Approved;if(null!=t&&t.token){var o,s=pt().assets[t.id],i=this.market.dex.assets[t.id].version;null!=s&&null!==(o=s.wallet)&&void 0!==o&&o.approved&&void 0!==s.wallet.approved[i]&&(r=s.wallet.approved[i])}if(null!=n&&n.token){var c,l=pt().assets[n.id],u=this.market.dex.assets[n.id].version;null!=l&&null!==(c=l.wallet)&&void 0!==c&&c.approved&&void 0!==l.wallet.approved[u]&&(a=l.wallet.approved[u])}return{baseAssetApprovalStatus:r,quoteAssetApprovalStatus:a}}},{key:"setTokenApprovalVisibility",value:function(){var e=this.page,t=this.tokenAssetApprovalStatuses(),n=t.baseAssetApprovalStatus,r=t.quoteAssetApprovalStatus;if(n===ut.Approved&&r===ut.Approved)return qe.hide(e.tokenApproval),e.sellBttn.removeAttribute("disabled"),void e.buyBttn.removeAttribute("disabled");n!==ut.Approved&&r===ut.Approved&&(e.sellBttn.setAttribute("disabled","disabled"),e.buyBttn.removeAttribute("disabled"),this.setBuy(),qe.show(e.approvalRequiredSell),qe.hide(e.approvalRequiredBuy,e.approvalRequiredBoth)),n===ut.Approved&&r!==ut.Approved&&(e.buyBttn.setAttribute("disabled","disabled"),e.sellBttn.removeAttribute("disabled"),this.setSell(),qe.show(e.approvalRequiredBuy),qe.hide(e.approvalRequiredSell,e.approvalRequiredBoth)),n!==ut.Approved&&r!==ut.Approved&&(qe.show(e.approvalRequiredBoth),qe.hide(e.approvalRequiredSell,e.approvalRequiredBuy)),qe.show(e.tokenApproval),e.approvalPendingBaseSymbol.textContent=e.baseTokenAsset.textContent=this.market.base.symbol.toUpperCase(),e.approvalPendingQuoteSymbol.textContent=e.quoteTokenAsset.textContent=this.market.quote.symbol.toUpperCase(),qe.setVis(n===ut.NotApproved,e.approveBaseBttn),qe.setVis(r===ut.NotApproved,e.approveQuoteBttn),qe.setVis(n===ut.Pending,e.approvalPendingBase),qe.setVis(r===ut.Pending,e.approvalPendingQuote)}},{key:"setRegistrationStatusView",value:function(e,t,n){var r=this.page;r.regStatusTitle.textContent=e,r.regStatusConfsDisplay.textContent=t,r.registrationStatus.classList.remove("completed","error","waiting"),r.registrationStatus.classList.add(n)}},{key:"updateRegistrationStatusView",value:function(){var e=this.page,t=this.market.dex;if(e.regStatusDex.textContent=t.host,e.postingBondsDex.textContent=t.host,t.auth.effectiveTier>=1)this.setRegistrationStatusView(xe("REGISTRATION_FEE_SUCCESS"),"","completed");else{var n=(t.auth.pendingBonds||[]).map((function(e){var n=t.bondAssets[e.symbol].confs;return"".concat(e.confs," / ").concat(n)})).join(", ");this.setRegistrationStatusView(xe("WAITING_FOR_CONFS"),n,"waiting")}}},{key:"setRegistrationStatusVisibility",value:function(){var e=this,t=this.page,n=this.market;if(n&&n.dex&&n.dex.connectionStatus===lt.Connected){this.updateRegistrationStatusView();var r=function(e){for(var n=0,r=[t.registrationStatus,t.bondRequired,t.bondCreationPending,t.notRegistered];n<r.length;n++){var a=r[n];qe.setVis(a===e,a)}};if(n.dex.auth.effectiveTier>=1){var a=function(){var t=s(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r(void 0),e.resolveOrderFormVisibility();case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();if(qe.isHidden(t.orderForm))return void setTimeout(a,5e3);a()}else n.dex.viewOnly?(t.unregisteredDex.textContent=n.dex.host,r(t.notRegistered)):this.hasPendingBonds()?r(t.registrationStatus):n.dex.auth.targetTier>0?r(t.bondCreationPending):(t.acctTier.textContent="".concat(n.dex.auth.effectiveTier),t.dexSettingsLink.href="/dexsettings/".concat(n.dex.host),r(t.bondRequired))}}},{key:"setOrderBttnText",value:function(){this.isSell()?this.page.submitBttn.textContent=xe("SET_BUTTON_SELL",{asset:qe.shortSymbol(this.market.baseCfg.unitInfo.conventional.unit)}):this.page.submitBttn.textContent=xe("SET_BUTTON_BUY",{asset:qe.shortSymbol(this.market.baseCfg.unitInfo.conventional.unit)})}},{key:"setOrderBttnEnabled",value:function(e,t){var n=this.page.submitBttn;e?(n.removeAttribute("disabled"),n.removeAttribute("title")):(n.setAttribute("disabled","true"),t&&n.setAttribute("title",t))}},{key:"updateOrderBttnState",value:function(){var e=this.market,t=this.currentOrder,n=t.qty,r=t.rate,a=t.isLimit,o=t.sell,s=pt().assets[this.market.base.id].wallet,i=pt().assets[e.quote.id].wallet;if(s&&i)if(n<=0||n<e.cfg.lotsize)this.setOrderBttnEnabled(!1,xe(re));else if(a)if(r){if(o)return s.balance.available<e.cfg.lotsize?void this.setOrderBttnEnabled(!1,xe(ne)):void(e.maxSell&&this.setOrderBttnEnabled(n<=e.maxSell.swap.value,xe(ne)));var c=this.adjustedRate(),l=e.cfg.lotsize*(c/qt);if(i.balance.available<l)this.setOrderBttnEnabled(!1,xe(te));else if(e.maxBuys[c]){var u=n<=e.maxBuys[c].swap.lots*e.cfg.lotsize;this.setOrderBttnEnabled(u,xe(te))}}else this.setOrderBttnEnabled(!1,xe(ae));else o?this.setOrderBttnEnabled(n<=s.balance.available,xe(ne)):this.setOrderBttnEnabled(n<=i.balance.available,xe(te))}},{key:"setCandleDurBttns",value:function(){var e=this,t=this.page,n=this.market;qe.empty(t.durBttnBox);var r,a=_a(n.dex.candleDurs);try{var o=function(){var n=r.value,a=t.durBttnTemplate.cloneNode(!0);a.textContent=n,qe.bind(a,"click",(function(){return e.candleDurationSelected(n)})),t.durBttnBox.appendChild(a)};for(a.s();!(r=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}this.loadCandles()}},{key:"setMarket",value:(A=s(f().mark((function e(t,n,r){var a,o,i,c,l,u,d,h,p,v,m,g,y,b,x,w;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=pt().user.exchanges[t],o=this.page,window.cexBook=s(f().mark((function e(){var a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("/api/cexbook",{host:t,baseID:n,quoteID:r});case 2:a=e.sent,console.log(a.book);case 4:case"end":return e.stop()}}),e)}))),o.lotField.value="",o.qtyField.value="",o.rateField.value="",this.depthChart.clear(),qe.empty(this.page.buyRows),qe.empty(this.page.sellRows),this.recentMatches=[],qe.empty(o.recentMatchesLiveList),this.balanceWgt.setBalanceVisibility(!1),qe.hide(o.notRegistered,o.bondRequired,o.noWallet),a&&a.markets&&a.connectionStatus===lt.Connected){e.next=19;break}return i=xe("CONNECTION_FAILED"),a.disabled&&(i=xe("DEX_DISABLED_MSG")),o.chartErrMsg.textContent=i,qe.show(o.chartErrMsg),e.abrupt("return");case 19:c=_a(this.stats);try{for(c.s();!(l=c.n()).done;)u=l.value,qe.show(u.row)}catch(e){c.e(e)}finally{c.f()}d=a.assets[n],h=a.assets[r],p=[pt().unitInfo(n,a),pt().unitInfo(r,a)],m=p[1],g=qt/(v=p[0]).conventional.conversionFactor*m.conventional.conversionFactor,qe.hide(o.maxOrd,o.chartErrMsg),this.maxEstimateTimer&&(window.clearTimeout(this.maxEstimateTimer),this.maxEstimateTimer=null),y=co(d.symbol,h.symbol),b=pt().assets[n],x=pt().assets[r],w={dex:a,sid:y,cfg:a.markets[y],base:b,quote:x,baseUnitInfo:v,quoteUnitInfo:m,maxSell:null,maxBuys:{},maxSellRequested:!1,candleCaches:{},baseCfg:d,quoteCfg:h,rateConversionFactor:g,sellBalance:0,buyBalance:0,bookLoaded:!1},this.market=w,this.mm.setMarket(t,n,r),this.mmRunning=void 0,o.lotSize.textContent=qe.formatCoinValue(w.cfg.lotsize,w.baseUnitInfo),o.rateStep.textContent=qe.formatCoinValue(w.cfg.ratestep/g),this.displayMessageIfMissingWallet(),this.balanceWgt.setWallets(t,n,r),this.setMarketDetails(),this.setCurrMarketPrice(),Wa.request("loadmarket",io(t,n,r)),k.storeLocal(k.lastMarketLK,{host:t,base:n,quote:r}),pt().updateMarketElements(this.main,n,r,a),this.marketList.select(t,n,r),this.setLoaderMsgVisibility(),this.setTokenApprovalVisibility(),this.setRegistrationStatusVisibility(),this.resolveOrderFormVisibility(),this.setOrderBttnText(),this.setOrderBttnEnabled(!1,xe(ae)),this.setCandleDurBttns(),this.previewQuoteAmt(!1),this.updateTitle(),this.reputationMeter.setHost(a.host),this.updateReputation(),this.loadUserOrders();case 56:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return A.apply(this,arguments)})},{key:"displayMessageIfMissingWallet",value:function(){var e,t,n,r,a=this.page,o=this.market,s=o.baseCfg.symbol.toLocaleUpperCase(),i=o.quoteCfg.symbol.toLocaleUpperCase(),c="";if(qe.hide(a.noWallet),null!==(e=o.base)&&void 0!==e&&e.wallet||null!==(t=o.quote)&&void 0!==t&&t.wallet)if(null!==(n=o.base)&&void 0!==n&&n.wallet){if(null!==(r=o.quote)&&void 0!==r&&r.wallet)return;c=xe(oe,{asset:i})}else c=xe(oe,{asset:s});else c=xe("NO_WALLET_MSG",{asset1:s,asset2:i});a.noWallet.textContent=c,qe.show(a.noWallet)}},{key:"reportDepthClick",value:function(e){this.page.rateField.value=String(e),this.rateFieldChanged()}},{key:"reportDepthVolume",value:function(e){var t=this.page,n=this.market,r=n.baseUnitInfo,a=n.quoteUnitInfo;t.sellBookedBase.textContent=qe.formatCoinValue(e.sellBase*r.conventional.conversionFactor,r),t.sellBookedQuote.textContent=qe.formatCoinValue(e.sellQuote*a.conventional.conversionFactor,a),t.buyBookedBase.textContent=qe.formatCoinValue(e.buyBase*r.conventional.conversionFactor,r),t.buyBookedQuote.textContent=qe.formatCoinValue(e.buyQuote*a.conventional.conversionFactor,a)}},{key:"reportDepthMouse",value:function(e){for(;this.hovers.length;)this.hovers.shift().classList.remove("hover");var t=this.page;if(e){qe.show(t.depthLegend);for(var n=0,r=Object.values(this.metaOrders);n<r.length;n++){var a=r[n],o=a.div,s=a.ord;s.status===At&&e.hoverMarkers.indexOf(s.rate)>-1&&(o.classList.add("hover"),this.hovers.push(o))}t.hoverPrice.textContent=qe.formatCoinValue(e.rate),t.hoverVolume.textContent=qe.formatCoinValue(e.depth),t.hoverVolume.style.color=e.dotColor}else qe.hide(t.depthLegend)}},{key:"reportDepthZoom",value:function(e){k.storeLocal(k.depthZoomLK,e)}},{key:"reportMouseCandle",value:function(e){var t=this.page;e?(qe.show(t.candlesLegend),t.candleStart.textContent=qe.formatCoinValue(e.startRate/this.market.rateConversionFactor),t.candleEnd.textContent=qe.formatCoinValue(e.endRate/this.market.rateConversionFactor),t.candleHigh.textContent=qe.formatCoinValue(e.highRate/this.market.rateConversionFactor),t.candleLow.textContent=qe.formatCoinValue(e.lowRate/this.market.rateConversionFactor),t.candleVol.textContent=qe.formatCoinValue(e.matchVolume,this.market.baseUnitInfo)):qe.hide(t.candlesLegend)}},{key:"parseOrder",value:function(){var e=this.page,t=e.qtyField,n=this.isLimit(),r=this.isSell(),a=this.market,o=a.baseUnitInfo.conventional.conversionFactor;return n||r||(t=e.mktBuyField,o=a.quoteUnitInfo.conventional.conversionFactor),{host:a.dex.host,isLimit:n,sell:r,base:a.base.id,quote:a.quote.id,qty:lo(t.value||"",o),rate:lo(e.rateField.value||"",a.rateConversionFactor),tifnow:e.tifNow.checked||!1,options:{}}}},{key:"previewQuoteAmt",value:function(e){var t=this.page;if(this.market.base&&this.market.quote){var n=this.currentOrder=this.parseOrder(),r=this.adjustedRate();if(t.orderErr.textContent="",r&&(n.sell?this.preSell():this.preBuy()),this.depthLines.input=[],r&&this.isLimit()&&(this.depthLines.input=[{rate:n.rate/this.market.rateConversionFactor,color:n.sell?this.depthChart.theme.sellLine:this.depthChart.theme.buyLine}]),this.drawChartLines(),!e||!r||!n.qty)return t.orderPreview.textContent="",void this.drawChartLines();var a=pt().assets[n.quote].unitInfo.conventional.unit,o=n.qty*n.rate/qt,s=qe.formatCoinValue(o,this.market.quoteUnitInfo);t.orderPreview.textContent=xe("ORDER_PREVIEW",{total:s,asset:a}),this.isSell()?this.preSell():this.preBuy()}}},{key:"preSell",value:function(){var e=this,t=this.market,n=pt().assets[t.base.id].wallet;return n.balance.available<t.cfg.lotsize?(this.setMaxOrder(null),void this.updateOrderBttnState()):t.maxSell?(this.setMaxOrder(t.maxSell.swap),void this.updateOrderBttnState()):void(t.maxSellRequested||(t.maxSellRequested=!0,this.scheduleMaxEstimate("/api/maxsell",{},0,(function(r){t.maxSellRequested=!1,t.maxSell=r.maxSell,t.sellBalance=n.balance.available,e.setMaxOrder(r.maxSell.swap),e.updateOrderBttnState()}))))}},{key:"preBuy",value:function(){var e=this,t=this.market,n=this.adjustedRate(),r=pt().assets[t.quote.id].wallet;if(r){var a=t.cfg.lotsize*(n/qt);if(r.balance.available<a)return this.setMaxOrder(null),void this.updateOrderBttnState();if(t.maxBuys[n])return this.setMaxOrder(t.maxBuys[n].swap),void this.updateOrderBttnState();var o=Object.keys(t.maxBuys).length?350:0;this.scheduleMaxEstimate("/api/maxbuy",{rate:n},o,(function(r){t.maxBuys[n]=r.maxBuy,t.buyBalance=pt().assets[t.quote.id].wallet.balance.available,e.setMaxOrder(r.maxBuy.swap),e.updateOrderBttnState()}))}}},{key:"scheduleMaxEstimate",value:function(e,t,n,r){var a=this,o=this.page;this.maxLoaded||(this.maxLoaded=pt().loading(o.maxOrd));var i=[this.market.base.id,this.market.quote.id],c=i[0],l=i[1],u=[pt().assets[c].wallet,pt().assets[l].wallet],d=u[0],h=u[1];if(d&&d.running&&h&&h.running){this.maxEstimateTimer&&window.clearTimeout(this.maxEstimateTimer),qe.show(o.maxOrd,o.maxLotBox),qe.hide(o.maxAboveZero,o.maxZeroNoFees,o.maxZeroNoBal),o.maxFromLots.textContent=xe("CALCULATING"),o.maxFromLotsLbl.textContent="",this.maxOrderUpdateCounter++;var p=this.maxOrderUpdateCounter;this.maxEstimateTimer=window.setTimeout(s(f().mark((function n(){var s;return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a.maxEstimateTimer=null,p===a.maxOrderUpdateCounter){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,S(e,Ua({host:a.market.dex.host,base:c,quote:l},t));case 5:if(s=n.sent,p===a.maxOrderUpdateCounter){n.next=8;break}return n.abrupt("return");case 8:if(pt().checkResponse(s)){n.next=13;break}return console.warn("max order estimate not available:",s),o.maxFromLots.textContent=xe("ESTIMATE_UNAVAILABLE"),a.maxLoaded&&(a.maxLoaded(),a.maxLoaded=null),n.abrupt("return");case 13:r(s);case 14:case"end":return n.stop()}}),n)}))),n)}}},{key:"setMaxOrder",value:function(e){var t=this.page;this.maxLoaded&&(this.maxLoaded(),this.maxLoaded=null),qe.show(t.maxOrd,t.maxLotBox);var n=this.isSell(),r=0;if(e&&(r=e.lots),t.maxFromLots.textContent=r.toString(),t.maxFromLotsLbl.textContent=xe(1===r?"LOT":"LOTS"),e){var a=n?this.market.base:this.market.quote;if(0===r){var o=this.market.cfg.lotsize;if(!n){var s=this.anyRate()[1];if(0===s)return;o*=s}if(a.wallet.balance.available/o>0){if(a.token){var i=pt().assets[a.token.parentID],c=i.wallet.balance.available,l=i.unitInfo;return void(c<e.feeReservesPerLot&&(qe.show(t.maxZeroNoFees),t.maxZeroNoFeesTicker.textContent=l.conventional.unit,t.maxZeroMinFees.textContent=qe.formatCoinValue(e.feeReservesPerLot,l)))}if(a.wallet.balance.available/(o+e.feeReservesPerLot)>0)return}return qe.show(t.maxZeroNoBal),void(t.maxZeroNoBalTicker.textContent=a.unitInfo.conventional.unit)}qe.show(t.maxAboveZero),t.maxFromAmt.textContent=qe.formatCoinValue(e.value||0,a.unitInfo),t.maxFromTicker.textContent=a.unitInfo.conventional.unit}}},{key:"validateOrder",value:function(e){var t=this.page,n=this.market,r=n.cfg.minimumRate,a=n.rateConversionFactor;if(e.isLimit){if(!e.rate)return qe.show(t.orderErr),t.orderErr.textContent=xe("NO_ZERO_RATE"),!1;if(e.rate<r){qe.show(t.orderErr);var o=e.rate/a,s=r/a;return t.orderErr.textContent="rate is lower than the market's minimum rate. ".concat(o," < ").concat(s),!1}}return!!e.qty||(qe.show(t.orderErr),t.orderErr.textContent=xe("NO_ZERO_QUANTITY"),!1)}},{key:"handleBook",value:function(e){var t,n=this.market,r=n.cfg,a=n.baseUnitInfo,o=n.quoteUnitInfo,s=n.baseCfg,i=n.quoteCfg;this.book=new Oa(e,s.symbol,i.symbol),this.loadTable();var c,l=_a(e.book.epoch||[]);try{for(l.s();!(c=l.n()).done;){var u=c.value;u.rate>0&&this.book.add(u),this.addTableOrder(u)}}catch(e){l.e(e)}finally{l.f()}if(!this.book)return this.depthChart.clear(),qe.empty(this.page.buyRows),void qe.empty(this.page.sellRows);qe.show(this.page.epochLine),this.loadingAnimations.depth&&this.loadingAnimations.depth.stop(),this.depthChart.canvas.classList.remove("invisible"),this.depthChart.set(this.book,r.lotsize,r.ratestep,a,o),this.recentMatches=null!==(t=e.book.recentMatches)&&void 0!==t?t:[],this.refreshRecentMatchesTable()}},{key:"midGapConventional",value:function(){var e=this.midGap();if(!e)return e;var t=this.market,n=t.baseUnitInfo,r=t.quoteUnitInfo;return e*n.conventional.conversionFactor/r.conventional.conversionFactor}},{key:"midGap",value:function(){var e=this.book;if(e)return e.buys&&e.buys.length?e.sells&&e.sells.length?(e.buys[0].msgRate+e.sells[0].msgRate)/2/qt:e.buys[0].msgRate/qt:e.sells&&e.sells.length?e.sells[0].msgRate/qt:null}},{key:"setMarketBuyOrderEstimate",value:function(){var e=this.market,t=e.cfg.lotsize,n=pt().user.exchanges[e.dex.host].markets[e.sid].buybuffer,r=this.midGapConventional();r&&(this.page.minMktBuy.textContent=qe.formatCoinValue(t*n*r,e.baseUnitInfo))}},{key:"maxUserOrderCount",value:function(){var e=this.market,t=e.dex.host,n=e.cfg.name;return Math.max(10,pt().orders(t,n).length)}},{key:"loadUserOrders",value:(I=s(f().mark((function e(){var t,n,r,a,o,s,i,c,l,u,d,h,p;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s in t=this.market,n=t.base,r=t.quote,a=t.dex.host,o=t.cfg.name,this.metaOrders)delete this.metaOrders[s];if(n&&r){e.next=4;break}return e.abrupt("return",this.resolveUserOrders([]));case 4:if(!((i=pt().orders(a,o)).length>=10)){e.next=7;break}return e.abrupt("return",this.resolveUserOrders(i));case 7:return c={hosts:[a],market:{baseID:n.id,quoteID:r.id},n:this.maxUserOrderCount()},e.next=10,S("/api/orders",c);case 10:l=e.sent,u=l.orders||[],d=_a(i),e.prev=13,p=f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=h.value,u.some((function(e){return e.id===t.id}))||u.push(t);case 2:case"end":return e.stop()}}),e)})),d.s();case 16:if((h=d.n()).done){e.next=20;break}return e.delegateYield(p(),"t0",18);case 18:e.next=16;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(13),d.e(e.t1);case 25:return e.prev=25,d.f(),e.finish(25);case 28:return e.abrupt("return",this.resolveUserOrders(l.orders||[]));case 29:case"end":return e.stop()}}),e,this,[[13,22,25,28]])}))),function(){return I.apply(this,arguments)})},{key:"refreshActiveOrders",value:function(){var e=pt().orders(this.market.dex.host,co(this.market.baseCfg.symbol,this.market.quoteCfg.symbol));return this.resolveUserOrders(e)}},{key:"resolveUserOrders",value:function(e){var t,n,r,a=this,o=this.page,s=this.metaOrders,i=this.market,c=i.cfg,l=function(e){return e.status<Rt||Ut(e)},u=_a(e);try{for(u.s();!(r=u.n()).done;){var d=r.value;s[d.id]={ord:d}}}catch(e){u.e(e)}finally{u.f()}var h=Object.keys(s).map((function(e){return s[e]}));h.sort((function(e,t){var n=[l(e.ord),l(t.ord)],r=n[0],a=n[1];return r&&!a?-1:!r&&a?1:t.ord.submitTime-e.ord.submitTime}));var p=this.maxUserOrderCount();for(var f in h.length>p&&(h=h.slice(0,p)),s)delete s[f];qe.empty(o.userOrders),qe.setVis(null===(t=h)||void 0===t?void 0:t.length,o.userOrders),qe.setVis(!(null!==(n=h)&&void 0!==n&&n.length),o.userNoOrders);var v,m=!1,g=_a(h);try{var y=function(){var e=v.value,t=o.userOrderTmpl.cloneNode(!0);o.userOrders.appendChild(t);var n=qe.parseTemplate(t),r=qe.parseTemplate(n.header),u=qe.parseTemplate(n.details);e.div=t,e.header=r,e.details=u;var d,h=e.ord,p=h.id,f=l(h);p&&(s[p]=e),!h.readyToTick&&Ut(h)&&(n.header.classList.add("unready-user-order"),m=!0),r.sideLight.classList.add(h.sell?"sell":"buy"),f||r.sideLight.classList.add("inactive"),u.side.textContent=e.header.side.textContent=Nt(h),u.side.classList.add(h.sell?"sellcolor":"buycolor"),r.side.classList.add(h.sell?"sellcolor":"buycolor"),u.qty.textContent=e.header.qty.textContent=qe.formatCoinValue(h.qty,i.baseUnitInfo),d=h.type===Ft?a.marketOrderRateString(h,i):qe.formatRateFullPrecision(h.rate,i.baseUnitInfo,i.quoteUnitInfo,c.ratestep),u.rate.textContent=e.header.rate.textContent=d,r.baseSymbol.textContent=i.baseUnitInfo.conventional.unit,u.type.textContent=function(e){switch(e){case 1:return xe(X);case Dt:return xe(K);default:return xe("CANCEL_ORDER")}}(h.type),a.updateMetaOrder(e),qe.bind(t,"mouseenter",(function(){a.activeMarkerRate=h.rate,a.setDepthMarkers()}));var g,y=function(e){e.stopPropagation(),a.showCancel(t,p)},b=function(e){e.stopPropagation(),a.showAccelerate(h)};p?(Qt(h)&&(qe.show(u.cancelBttn),Ha(u.cancelBttn,"click",(function(e){y(e)}))),Ha(u.accelerateBttn,"click",(function(e){b(e)})),pt().canAccelerateOrder(h)&&qe.show(u.accelerateBttn),u.link.href="order/".concat(p),pt().bindInternalNavigation(t)):(qe.hide(u.accelerateBttn),qe.hide(u.cancelBttn),qe.hide(u.link)),qe.bind(n.header,"click",(function(){if(qe.isDisplayed(n.details))return qe.hide(n.details),r.expander.classList.add("ico-arrowdown"),void r.expander.classList.remove("ico-arrowup");qe.show(n.details),r.expander.classList.remove("ico-arrowdown"),r.expander.classList.add("ico-arrowup"),g&&g.remove()})),qe.bind(n.header,"mouseenter",(function(){if(!qe.isDisplayed(n.details)){g&&g.remove();var e=document.createElement("div");g=e,document.body.appendChild(e),e.className="user-order-floaty-menu";var r=qe.layoutMetrics(n.header),s=r.bodyTop+r.height;e.style.top="".concat(s-1,"px"),e.style.left="".concat(r.bodyLeft,"px");var i=a.metaOrders[p].ord,c=function(t,n){var r=t.cloneNode(!0);e.appendChild(r),qe.show(r),qe.bind(r,"click",(function(e){n(e)}))};Qt(i)&&c(u.cancelBttn,(function(e){y(e)})),pt().canAccelerateOrder(i)&&c(u.accelerateBttn,(function(e){b(e)})),e.appendChild(u.link.cloneNode(!0));var l=o.orderScroller.scrollTop,d=function n(r){var a=o.orderScroller.scrollTop-l;e.style.top="".concat(s+a,"px"),qe.mouseInElement(r,e)||qe.mouseInElement(r,t)||(e.remove(),g=null,document.removeEventListener("mousemove",n),o.orderScroller.removeEventListener("scroll",n))};document.addEventListener("mousemove",d),o.orderScroller.addEventListener("scroll",d)}})),pt().bindTooltips(t)};for(g.s();!(v=g.n()).done;)y()}catch(e){g.e(e)}finally{g.f()}qe.setVis(m,o.unreadyOrdersMsg),this.setDepthMarkers()}},{key:"marketOrderRateString",value:function(e,t){var n;if(null===(n=e.matches)||void 0===n||!n.length)return xe(K);var r=qe.formatRateFullPrecision(Gt(e),t.baseUnitInfo,t.quoteUnitInfo,t.cfg.ratestep);return e.matches.length>1&&(r="~ "+r),r}},{key:"updateMetaOrder",value:function(e){var t=e.header,n=e.details,r=e.ord;r.status<=At||Ut(r)?t.activeLight.classList.add("active"):t.activeLight.classList.remove("active"),n.status.textContent=t.status.textContent=_t(r),n.age.textContent=qe.timeSince(r.submitTime),n.filled.textContent="".concat((jt(r)/r.qty*100).toFixed(1),"%"),n.settled.textContent="".concat((Ht(r)/r.qty*100).toFixed(1),"%")}},{key:"setDepthMarkers",value:function(){for(var e={buys:[],sells:[]},t=this.market.rateConversionFactor,n=0,r=Object.values(this.metaOrders);n<r.length;n++){var a=r[n].ord;a.rate&&a.status===At&&(a.sell?e.sells.push({rate:a.rate/t,active:a.rate===this.activeMarkerRate}):e.buys.push({rate:a.rate/t,active:a.rate===this.activeMarkerRate}))}this.depthChart.setMarkers(e),this.book&&this.depthChart.draw()}},{key:"updateTitle",value:function(){var e=this.midGapConventional(),t=this.market,n=t.baseUnitInfo.conventional.unit,r=t.quoteUnitInfo.conventional.unit;document.title=e?"".concat(qe.formatCoinValue(e)," | ").concat(n).concat(r," | ").concat(this.ogTitle):"".concat(n).concat(r," | ").concat(this.ogTitle)}},{key:"handleBookRoute",value:function(e){pt().log("book","handleBookRoute:",e);var t=e.payload,n=this.market,r=n.baseCfg,a=n.quoteCfg,o=n.dex.host;t.base===r.id&&t.quote===a.id&&e.host===o&&(this.handleBook(t),this.market.bookLoaded=!0,this.updateTitle(),this.setMarketBuyOrderEstimate())}},{key:"handleBookOrderRoute",value:function(e){if(pt().log("book","handleBookOrderRoute:",e),e.host===this.market.dex.host&&e.marketID===this.market.sid){var t=e.payload;t.rate>0&&this.book.add(t),this.addTableOrder(t),this.updateTitle(),this.depthChart.draw()}}},{key:"handleUnbookOrderRoute",value:function(e){if(pt().log("book","handleUnbookOrderRoute:",e),e.host===this.market.dex.host&&e.marketID===this.market.sid){var t=e.payload;this.book.remove(t.token),this.removeTableOrder(t),this.updateTitle(),this.depthChart.draw()}}},{key:"handleUpdateRemainingRoute",value:function(e){if(pt().log("book","handleUpdateRemainingRoute:",e),e.host===this.market.dex.host&&e.marketID===this.market.sid){var t=e.payload;this.book.updateRemaining(t.token,t.qty,t.qtyAtomic),this.updateTableOrder(t),this.depthChart.draw()}}},{key:"handleEpochOrderRoute",value:function(e){if(pt().log("book","handleEpochOrderRoute:",e),e.host===this.market.dex.host&&e.marketID===this.market.sid){var t=e.payload;t.msgRate>0&&this.book.add(t),t.qtyAtomic>0&&this.addTableOrder(t),this.depthChart.draw()}}},{key:"handleCandlesRoute",value:function(e){if(this.candlesLoading&&(clearTimeout(this.candlesLoading.timer),this.candlesLoading.loaded(),this.candlesLoading=null),e.host===this.market.dex.host&&e.marketID===this.market.cfg.name){var t=e.payload.dur;this.market.candleCaches[t]=e.payload,this.setHighLow(),this.candleDur===t&&(this.loadingAnimations.candles&&this.loadingAnimations.candles.stop(),this.candleChart.canvas.classList.remove("invisible"),this.candleChart.setCandles(e.payload,this.market.cfg,this.market.baseUnitInfo,this.market.quoteUnitInfo))}}},{key:"handleEpochMatchSummary",value:function(e){this.addRecentMatches(e.payload.matchSummaries),this.refreshRecentMatchesTable()}},{key:"handleCandleUpdateRoute",value:function(e){if(e.host===this.market.dex.host){var t=e.payload,n=t.dur,r=t.candle,a=this.market.candleCaches[n];if(a){var o=a.candles;0===o.length?o.push(r):o[o.length-1].startStamp===r.startStamp?o[o.length-1]=r:o.push(r),this.candleDur===n&&this.candleChart.draw()}}}},{key:"showToggleWalletStatus",value:function(e){var t=this.page;this.openAsset=e,qe.hide(t.toggleWalletStatusErr,t.walletStatusDisable,t.disableWalletMsg),qe.show(t.walletStatusEnable,t.enableWalletMsg),this.forms.show(t.toggleWalletStatusConfirm)}},{key:"toggleWalletStatus",value:(T=s(f().mark((function e(){var t,n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,qe.hide(t.toggleWalletStatusErr),n={assetID:this.openAsset.id,disable:!1},r=pt().loading(t.toggleWalletStatusConfirm),e.next=7,S("/api/togglewalletstatus",n);case 7:if(a=e.sent,r(),pt().checkResponse(a)){e.next=13;break}return t.toggleWalletStatusErr.textContent=a.msg,qe.show(t.toggleWalletStatusErr),e.abrupt("return");case 13:qe.hide(this.page.forms),this.balanceWgt.updateAsset(this.openAsset.id);case 15:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"showVerify",value:function(){this.preorderCache={};var e,t=this.page,n=this.currentOrder=this.parseOrder(),r=n.sell,a=pt().assets[n.base],o=pt().assets[n.quote],s=r?o:a,i=r?a:o,c=function(e){switch(e.dataset.icon){case"from":if(i.token){var t=pt().assets[i.token.parentID];e.src=qe.logoPath(t.symbol)}else e.src=qe.logoPath(i.symbol);break;case"to":if(s.token){var n=pt().assets[s.token.parentID];e.src=qe.logoPath(n.symbol)}else e.src=qe.logoPath(s.symbol)}},l=_a(qe.applySelector(t.vDetailPane,"[data-icon]"));try{for(l.s();!(e=l.n()).done;)c(e.value)}catch(e){l.e(e)}finally{l.f()}var u,d=_a(qe.applySelector(t.vFeeSummary,"[data-icon]"));try{for(d.s();!(u=d.n()).done;)c(u.value)}catch(e){d.e(e)}finally{d.f()}qe.hide(t.vPreorderErr),qe.show(t.vPreorder),t.vBuySell.textContent=xe(r?"SELLING":"BUYING");var h=xe(r?B:E);if(t.vSideSubmit.textContent=h,t.vOrderHost.textContent=n.host,n.isLimit){qe.show(t.verifyLimit),qe.hide(t.verifyMarket);var p="Limit ".concat(h," Order");t.vOrderType.textContent=n.tifnow?p+" (immediate)":p,t.vRate.textContent=qe.formatCoinValue(n.rate/this.market.rateConversionFactor),t.vQty.textContent=qe.formatCoinValue(n.qty,a.unitInfo);var f=n.rate/qt*n.qty;t.vTotal.textContent=qe.formatCoinValue(f,o.unitInfo),this.showFiatValue(o.id,f,t.vFiatTotal)}else{qe.hide(t.verifyLimit),qe.show(t.verifyMarket),t.vOrderType.textContent="Market ".concat(h," Order");var v=n.sell?this.market.baseUnitInfo:this.market.quoteUnitInfo;t.vmFromTotal.textContent=qe.formatCoinValue(n.qty,v),t.vmFromAsset.textContent=i.symbol.toUpperCase(),this.showFiatValue(i.id,n.qty,t.vmFromTotalFiat);var m=this.midGap();if(m){qe.show(t.vMarketEstimate);var g=n.sell?n.qty*m:n.qty/m;t.vmToTotal.textContent=qe.formatCoinValue(g,s.unitInfo),t.vmToAsset.textContent=s.symbol.toUpperCase(),this.showFiatValue(s.id,g,t.vmTotalFiat)}else qe.hide(t.vMarketEstimate)}r?(t.vHeader.classList.add($a),t.vHeader.classList.remove(Za),t.vSubmit.classList.add($a),t.vSubmit.classList.remove(Za)):(t.vHeader.classList.add(Za),t.vHeader.classList.remove($a),t.vSubmit.classList.add(Za),t.vSubmit.classList.remove($a)),this.showVerifyForm(),a.wallet.open&&o.wallet.open?this.preOrder(n):(qe.hide(t.vPreorder),this.unlockWalletsForEstimates())}},{key:"showFiatValue",value:function(e,t,n){if(n){var r=pt().fiatRatesMap[e];n.textContent=qe.formatFiatConversion(t,r,pt().unitInfo(e)),r?qe.show(n.parentElement):qe.hide(n.parentElement)}}},{key:"showVerifyForm",value:(D=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.page,qe.hide(t.vErr),this.forms.show(t.verifyForm);case 3:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"unlockWalletsForEstimates",value:(F=s(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=pt().loading(t.verifyForm),e.next=4,this.unlockMarketWallets();case 4:n(),qe.show(t.vPreorder),this.preOrder(this.parseOrder());case 7:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"unlockWallet",value:(C=s(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("/api/openwallet",{assetID:t});case 2:if(n=e.sent,pt().checkResponse(n)){e.next=5;break}throw Error("error unlocking wallet "+n.msg);case 5:this.balanceWgt.updateAsset(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"unlockMarketWallets",value:(w=s(f().mark((function e(){var t,n,r,a,o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=this.market,n=t.base,r=t.quote,a=[],n.wallet.open||a.push(n.id),r.wallet.open||a.push(r.id),o=0,s=a;o<s.length;o++)i=s[o],this.unlockWallet(i);case 5:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"fetchPreorder",value:(x=s(f().mark((function e(t){var n,r,a,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.page,r=JSON.stringify(t.options),!(a=this.preorderCache[r])){e.next=5;break}return e.abrupt("return",a);case 5:return qe.hide(n.vPreorderErr),o=pt().loading(n.verifyForm),e.next=9,S("/api/preorder",ho(t));case 9:if(s=e.sent,o(),pt().checkResponse(s)){e.next=13;break}return e.abrupt("return",{err:s.msg});case 13:return this.preorderCache[r]=s.estimate,e.abrupt("return",s.estimate);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"setPreorderErr",value:function(e){var t=this.page;qe.hide(t.vPreorder),qe.show(t.vPreorderErr),t.vPreorderErrTip.dataset.tooltip=e}},{key:"showPreOrderAdvancedOptions",value:function(){var e=this.page;qe.hide(e.showAdvancedOptions),qe.show(e.hideAdvancedOptions,e.vOtherOrderOpts)}},{key:"hidePreOrderAdvancedOptions",value:function(){var e=this.page;qe.hide(e.hideAdvancedOptions,e.vOtherOrderOpts),qe.show(e.showAdvancedOptions)}},{key:"reloadOrderOpts",value:function(e,t,n,r){var a=this.page;qe.empty(a.vDefaultOrderOpts,a.vOtherOrderOpts);var o,s=function(t,n){var o=function(e,t,n,r){var a,o,s=r&&t.sell||!r&&!t.sell,i=(a=t.host,o=s?t.base:t.quote,pt().exchanges[a].assets[o].symbol);switch(!0){case!!e.boolean:return new yt(e,i,t.options,n).node;case!!e.xyRange:return new bt(e,i,t.options,n).node;default:console.error("no option type specified",e)}return console.error("unknown option type",e),document.createElement("div")}(t,e,r,n);t.showByDefault?a.vDefaultOrderOpts.appendChild(o):a.vOtherOrderOpts.appendChild(o)},i=_a(t.options||[]);try{for(i.s();!(o=i.n()).done;)s(o.value,!0)}catch(e){i.e(e)}finally{i.f()}var c,l=_a(n.options||[]);try{for(l.s();!(c=l.n()).done;)s(c.value,!1)}catch(e){l.e(e)}finally{l.f()}pt().bindTooltips(a.vDefaultOrderOpts),pt().bindTooltips(a.vOtherOrderOpts)}},{key:"preOrder",value:(m=s(f().mark((function e(t){var n,r,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.page,r=function(){var e=s(f().mark((function e(){var o,i,c,l,u;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.fetchPreorder(t);case 2:if(!(o=e.sent).err){e.next=5;break}return e.abrupt("return",a.setPreorderErr(o.err));case 5:i=o,qe.hide(n.vPreorderErr),qe.show(n.vPreorder),c=i.swap,l=i.redeem,c.options=c.options||[],l.options=l.options||[],a.setFeeEstimates(c,l,t),u=function(){var e=s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r();case 2:qe.animate(400,(function(e){n.vFeeSummary.style.backgroundColor="rgba(128, 128, 128, ".concat(.5-.5*e,")")}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),qe.bind(n.showAdvancedOptions,"click",(function(){a.showPreOrderAdvancedOptions()})),qe.bind(n.hideAdvancedOptions,"click",(function(){a.hidePreOrderAdvancedOptions()})),a.reloadOrderOpts(t,c,l,u);case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r();case 3:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"setFeeEstimates",value:function(e,t,n){var r=this.page,a=this.market;if(e.estimate&&t.estimate){qe.show(r.vPreorderEstimates);var o=a.baseUnitInfo,s=a.quoteUnitInfo,i=a.rateConversionFactor,c=function(e){return e<.05?"< 0.1":to.format(e)},l=1,u=1,d=o,h=s;if(a.base.token){var p=pt().assets[a.base.token.parentID];d=p.unitInfo;var f=pt().fiatRatesMap[a.base.id],v=pt().fiatRatesMap[p.id];l=f&&v?v/f*o.conventional.conversionFactor/p.unitInfo.conventional.conversionFactor:0}if(a.quote.token){var m=pt().assets[a.quote.token.parentID];h=m.unitInfo;var g=pt().fiatRatesMap[a.quote.id],y=pt().fiatRatesMap[m.id];u=g&&y?y/g*s.conventional.conversionFactor/m.unitInfo.conventional.conversionFactor:0}var b=d,x=h,k=l,w=u;if(this.currentOrder.sell){var C=[b,x];x=C[0],b=C[1];var S=[k,w];w=S[0],k=S[1]}var F=e.estimate.value||0,D=w>0?F/w:F,T=e.estimate.realisticBestCase/D*100;r.vSwapFeesLowPct.textContent=w<=0?"":"(".concat(c(T),"%)"),r.vSwapFeesLow.textContent=qe.formatCoinValue(e.estimate.realisticBestCase,x);var I=e.estimate.realisticWorstCase/D*100;r.vSwapFeesHighPct.textContent=w<=0?"":"(".concat(c(I),"%)"),r.vSwapFeesHigh.textContent=qe.formatCoinValue(e.estimate.realisticWorstCase,x);var A=e.estimate.maxFees/D*100;r.vSwapFeesMaxPct.textContent=w<=0?"":"(".concat(c(A),"%)"),r.vSwapFeesMax.textContent=qe.formatCoinValue(e.estimate.maxFees,x);var R=this.midGap()||n.rate/i,E=n.sell?F*R:F/R,B=k>0?E/k:E,P=t.estimate.realisticBestCase/B*100;r.vRedeemFeesLowPct.textContent=k<=0?"":"(".concat(c(P),"%)"),r.vRedeemFeesLow.textContent=qe.formatCoinValue(t.estimate.realisticBestCase,b);var L=t.estimate.realisticWorstCase/B*100;r.vRedeemFeesHighPct.textContent=k<=0?"":"(".concat(c(L),"%)"),r.vRedeemFeesHigh.textContent=qe.formatCoinValue(t.estimate.realisticWorstCase,b),l&&u?(qe.show(r.vFeeSummaryPct),qe.hide(r.vFeeSummary),r.vFeeSummaryLow.textContent=c(T+P),r.vFeeSummaryHigh.textContent=c(I+L)):(qe.hide(r.vFeeSummaryPct),qe.show(r.vFeeSummary),r.summarySwapFeesLow.textContent=r.vSwapFeesLow.textContent,r.summarySwapFeesHigh.textContent=r.vSwapFeesHigh.textContent,r.summaryRedeemFeesLow.textContent=r.vRedeemFeesLow.textContent,r.summaryRedeemFeesHigh.textContent=r.vRedeemFeesHigh.textContent)}else qe.hide(r.vPreorderEstimates)}},{key:"submitCancel",value:(p=s(f().mark((function e(){var t,n,r,a,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=this.cancelData,r=n.order,a={orderID:r.id},o=pt().loading(t.cancelSubmit),e.next=7,S("/api/cancel",a);case 7:if(s=e.sent,o(),pt().checkResponse(s)){e.next=13;break}return t.cancelErr.textContent=s.msg,qe.show(t.cancelErr),e.abrupt("return");case 13:qe.hide(n.bttn,t.forms),r.cancelling=!0;case 15:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"showCancel",value:function(e,t){var n=this.metaOrders[t].ord,r=this.page,a=n.qty-n.filled,o=Vt(n)?this.market.quote:this.market.base;r.cancelRemain.textContent=qe.formatCoinValue(a,o.unitInfo),r.cancelUnit.textContent=o.symbol.toUpperCase(),qe.hide(r.cancelErr),this.forms.show(r.cancelForm),this.cancelData={bttn:qe.tmplElement(e,"cancelBttn"),order:n}}},{key:"showAccelerate",value:function(e){var t=pt().loading(this.main);this.accelerateOrderForm.refresh(e),t(),this.forms.show(this.page.accelerateForm)}},{key:"showCreate",value:function(e){var t=this.page;this.currentCreate=e,this.newWalletForm.setAsset(e.id),this.forms.show(t.newWalletForm)}},{key:"stepSubmit",value:function(){var e=this.page,t=this.market;if(qe.hide(e.orderErr),this.validateOrder(this.parseOrder())){var n=pt().walletMap[t.base.id],r=pt().walletMap[t.quote.id];return n?r?void this.showVerify():(e.orderErr.textContent=xe(L,{asset:t.quote.symbol}),void qe.show(e.orderErr)):(e.orderErr.textContent=xe(L,{asset:t.base.symbol}),void qe.show(e.orderErr))}}},{key:"showDeposit",value:(u=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.depositAddrForm.setAsset(t),this.forms.show(this.page.deposit);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"showCustomProviderDialog",value:function(e){pt().loadPage("wallets",{promptProvider:e,goBack:"markets"})}},{key:"handlePriceUpdate",value:function(e){this.market&&(e.host===this.market.dex.host&&e.spots[this.market.cfg.name]&&this.setCurrMarketPrice(),this.marketList.updateSpots(e))}},{key:"handleWalletState",value:(l=s(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.market){e.next=2;break}return e.abrupt("return");case 2:if(t.wallet.assetID===(null===(n=this.market.base)||void 0===n?void 0:n.id)||t.wallet.assetID===(null===(r=this.market.quote)||void 0===r?void 0:r.id)){e.next=4;break}return e.abrupt("return");case 4:this.setTokenApprovalVisibility(),this.resolveOrderFormVisibility();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"handleBondUpdate",value:(c=s(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.dex,this.market){e.next=3;break}return e.abrupt("return");case 3:if(n===this.market.dex.host){e.next=5;break}return e.abrupt("return");case 5:if("AccountRegistered"!==t.topic){e.next=8;break}return e.next=8,pt().fetchUser();case 8:this.market.dex=pt().exchanges[n],this.setRegistrationStatusVisibility(),this.updateReputation();case 11:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"updateReputation",value:function(){var e=this.page,t=this.market,n=t.dex.host,r=t.cfg,o=t.baseCfg.unitInfo,s=t.quoteCfg.unitInfo,i=pt().exchanges[n].auth;e.parcelSizeLots.textContent=String(r.parcelsize),e.marketLimitBase.textContent=qe.formatFourSigFigs(r.parcelsize*r.lotsize/o.conventional.conversionFactor),e.marketLimitBaseUnit.textContent=o.conventional.unit,e.marketLimitQuoteUnit.textContent=s.conventional.unit;var c=this.anyRate()[1];if(c){var l=r.lotsize*c;e.marketLimitQuote.textContent=qe.formatFourSigFigs(r.parcelsize*l/s.conventional.conversionFactor)}else e.marketLimitQuote.textContent="-";var u=Sn(i);e.tradingTier.textContent=String(u);var d=function(e){for(var t=pt().exchanges[e],n=t.auth,r=t.maxScore,a=t.markets,o=n.rep.score,s=Sn(n),i=0,c=0,l=Object.values(a);c<l.length;c++){var u,d=l[c],h=0,p=xn(d.inflight||[]);try{for(p.s();!(u=p.n()).done;)h+=Nn(u.value,d)}catch(e){p.e(e)}finally{p.f()}var f,v=xn(d.orders||[]);try{for(v.s();!(f=v.n()).done;)h+=Nn(f.value,d)}catch(e){v.e(e)}finally{v.f()}i+=h/(d.parcelsize*d.lotsize)}return[i,2*Wn(o,r)*s]}(n),h=a(d,2),p=h[0],f=h[1];e.tradingLimit.textContent=(f*r.parcelsize).toFixed(2),e.limitUsage.textContent=f>0?(p/f*100).toFixed(1):"0",e.orderLimitRemain.textContent=((f-p)*r.parcelsize).toFixed(1),e.orderTradingTier.textContent=String(u),this.reputationMeter.update()}},{key:"anyRate",value:function(){var e=this.market,t=e.cfg.spot,n=e.baseCfg.id,r=e.quoteCfg.id,a=e.rateConversionFactor;if(e.bookLoaded){var o=this.midGap();if(o)return[o*qt,o,this.midGapConventional()||0]}if(t&&t.rate)return[t.rate,t.rate/qt,t.rate/a];var s=[pt().fiatRatesMap[n],pt().fiatRatesMap[r]],i=s[0],c=s[1];if(i&&c){var l=i/c,u=l*a;return[u,u/qt,l]}return[0,0,0]}},{key:"handleMatchNote",value:function(e){var t=this.metaOrders[e.orderID],n=e.match;if(!t)return this.refreshActiveOrders();if(t.ord.type===Ft&&0===n.status){var r=pt().order(e.orderID);r&&(t.details.rate.textContent=t.header.rate.textContent=this.marketOrderRateString(r,this.market))}(n.side===Mt&&n.status===Bt||1===n.side&&n.status===Pt)&&this.updateReputation(),pt().canAccelerateOrder(t.ord)?qe.show(t.details.accelerateBttn):qe.hide(t.details.accelerateBttn)}},{key:"handleOrderNote",value:function(e){var t=e.order,n=this.metaOrders[t.id],r="AsyncOrderFailure"===e.topic||"AsyncOrderSubmitted"===e.topic;if(!n||r||"OrderLoaded"===e.topic&&t.readyToTick)return this.refreshActiveOrders();var a=n.ord.status;n.ord=t,"MissedCancel"===e.topic&&qe.show(n.details.cancelBttn),t.filled===t.qty&&qe.hide(n.details.cancelBttn),pt().canAccelerateOrder(t)?qe.show(n.details.accelerateBttn):qe.hide(n.details.accelerateBttn),this.updateMetaOrder(n),(a===It&&t.status===At||a===At&&t.status>At)&&(this.setDepthMarkers(),this.updateReputation(),this.mm.readBook())}},{key:"handleEpochNote",value:function(e){if(pt().log("book","handleEpochNote:",e),this.market&&e.host===this.market.dex.host&&e.marketID===this.market.sid){this.book&&(this.book.setEpoch(e.epoch),this.depthChart.draw()),this.clearOrderTableEpochs();for(var t=0,n=Object.values(this.metaOrders);t<n.length;t++){var r=n[t],a=r.ord,o=r.details,s=r.header,i=e.epoch>a.epoch;switch(!0){case a.type===St&&a.status===It&&i:var c=a.tif===Tt?xe(O):xe(M);o.status.textContent=s.status.textContent=c,a.status=a.tif===Tt?Rt:At;break;case a.type===Ft&&a.status===It:o.status.textContent=s.status.textContent=xe(O),a.status=Rt}}}}},{key:"recentMatchesSortCompare",value:function(){var e=this;switch(this.recentMatchesSortKey){case"rate":return function(t,n){return e.recentMatchesSortDirection*(t.rate-n.rate)};case"qty":return function(t,n){return e.recentMatchesSortDirection*(t.qty-n.qty)};case"age":return function(t,n){return e.recentMatchesSortDirection*(t.stamp-n.stamp)}}}},{key:"refreshRecentMatchesTable",value:function(){var e=this.page,t=this.recentMatches;if(qe.empty(e.recentMatchesLiveList),t){var n=this.recentMatchesSortCompare();t.sort(n);var r,a=_a(t);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=e.recentMatchesTemplate.cloneNode(!0),i=qe.parseTemplate(s);pt().bindTooltips(s),i.rate.textContent=qe.formatCoinValue(o.rate/this.market.rateConversionFactor),i.qty.textContent=qe.formatCoinValue(o.qty,this.market.baseUnitInfo),i.age.textContent=qe.timeSince(o.stamp),i.age.dataset.sinceStamp=String(o.stamp),s.classList.add(o.sell?"sellcolor":"buycolor"),e.recentMatchesLiveList.append(s)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"addRecentMatches",value:function(e){this.recentMatches=[].concat(r(e),r(this.recentMatches)).slice(0,100)}},{key:"handleBalanceNote",value:function(e){this.approveTokenForm.handleBalanceNote(e),this.preorderCache={};var t=this.market;if(t&&t.dex&&t.dex.connectionStatus===lt.Connected){this.mm.handleBalanceNote(e);var n=this.balanceWgt;e.assetID!==n.base.id&&e.assetID!==n.quote.id||n.setBalanceVisibility(!0);var r=e.balance.available;switch(e.assetID){case t.baseCfg.id:if(!t.maxSell)break;"number"==typeof t.sellBalance&&t.sellBalance!==r&&(t.maxSell=null),this.isSell()&&this.preSell();break;case t.quoteCfg.id:if(!Object.keys(t.maxBuys).length)break;"number"==typeof t.buyBalance&&t.buyBalance!==r&&(t.maxBuys={}),this.isSell()||this.preBuy()}}}},{key:"submitOrder",value:(o=s(f().mark((function e(){var t,n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,qe.hide(t.orderErr,t.vErr),n=this.currentOrder,r={order:ho(n)},this.validateOrder(n)){e.next=6;break}return e.abrupt("return");case 6:return t.vSubmit.classList.add("d-hide"),t.vLoader.classList.remove("d-hide"),e.next=10,S("/api/tradeasync",r);case 10:if(a=e.sent,t.vSubmit.classList.remove("d-hide"),t.vLoader.classList.add("d-hide"),pt().checkResponse(a)){e.next=17;break}return t.vErr.textContent=a.msg,qe.show(t.vErr),e.abrupt("return");case 17:qe.hide(t.forms),this.refreshActiveOrders();case 19:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"createWallet",value:(n=s(f().mark((function e(){var t,n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt().fetchUser();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:n=t.assets[this.currentCreate.id],qe.hide(this.page.forms),(r=this.market).baseCfg.id===n.id?r.base=n:r.quoteCfg.id===n.id&&(r.quote=n),this.balanceWgt.updateAsset(n.id),this.displayMessageIfMissingWallet(),this.resolveOrderFormVisibility();case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"lotChanged",value:function(){var e=this.page,t=parseInt(e.lotField.value||"0");if(t<=0)return e.lotField.value=""===e.lotField.value?"":"0",e.qtyField.value="",this.previewQuoteAmt(!1),void this.setOrderBttnEnabled(!1,xe(re));var n=t*this.market.cfg.lotsize;if(e.lotField.value=String(t),e.qtyField.value=String(n/this.market.baseUnitInfo.conventional.conversionFactor),!this.isLimit()&&this.isSell()){var r=pt().assets[this.market.base.id].wallet;this.setOrderBttnEnabled(n<=r.balance.available,xe(ne))}this.previewQuoteAmt(!0)}},{key:"quantityChanged",value:function(e){var t=this.page,n=this.currentOrder=this.parseOrder();if(n.qty<0)return t.lotField.value="0",t.qtyField.value="",void this.previewQuoteAmt(!1);var r=this.market.cfg.lotsize,a=Math.floor(n.qty/r),o=n.qty=this.currentOrder.qty=a*r;t.lotField.value=String(a),(n.isLimit||n.sell)&&(e&&(t.qtyField.value=String(o/this.market.baseUnitInfo.conventional.conversionFactor)),this.previewQuoteAmt(!0))}},{key:"marketBuyChanged",value:function(){var e=this.page,t=lo(e.mktBuyField.value||"",this.market.quoteUnitInfo.conventional.conversionFactor),n=this.midGap();if(t>0){var r=pt().assets[this.market.quote.id].wallet;this.setOrderBttnEnabled(t<=r.balance.available,xe(te))}else this.setOrderBttnEnabled(!1,xe(re));if(!n||!t)return e.mktBuyLots.textContent="0",void(e.mktBuyScore.textContent="0");var a=t/n,o=a/this.market.cfg.lotsize;e.mktBuyLots.textContent=o.toFixed(1),e.mktBuyScore.textContent=qe.formatCoinValue(a,this.market.baseUnitInfo)}},{key:"rateFieldChanged",value:function(){var e=this.adjustedRate();if(e<=0)return this.depthLines.input=[],this.drawChartLines(),this.page.rateField.value="0",this.previewQuoteAmt(!0),void this.updateOrderBttnState();var t=this.currentOrder=this.parseOrder(),n=e/this.market.rateConversionFactor;this.page.rateField.value=String(n),this.depthLines.input=[{rate:n,color:t.sell?this.depthChart.theme.sellLine:this.depthChart.theme.buyLine}],this.drawChartLines(),this.previewQuoteAmt(!0),this.updateOrderBttnState()}},{key:"adjustedRate",value:function(){var e=this.page.rateField.value;if(!e)return NaN;var t=lo(e,this.market.rateConversionFactor);return t-t%this.market.cfg.ratestep}},{key:"loadTable",value:function(){this.loadTableSide(!0),this.loadTableSide(!1)}},{key:"binOrdersByRateAndEpoch",value:function(e){if(!e||!e.length)return[];var t=[],n=[],r=[],a=e[0].msgRate;e[0].epoch?n.push(e[0]):r.push(e[0]);for(var o=1;o<e.length;o++)e[o].msgRate!==a&&(t.push(r),t.push(n),n=[],r=[],a=e[o].msgRate),e[o].epoch?n.push(e[o]):r.push(e[o]);return t.push(r),t.push(n),t.filter((function(e){return e.length>0}))}},{key:"loadTableSide",value:function(e){var t=this,n=e?this.book.sells:this.book.buys,r=e?this.page.sellRows:this.page.buyRows;qe.empty(r),n&&n.length&&this.binOrdersByRateAndEpoch(n).forEach((function(e){r.appendChild(t.orderTableRow(e))}))}},{key:"addTableOrder",value:function(e){var t=e.sell?this.page.sellRows:this.page.buyRows,n=t.firstChild;if(0!==e.rate){for(n&&0===n.manager.getRate()&&(n=n.nextSibling);n;){if(0===n.manager.compare(e))return void n.manager.insertOrder(e);if(n.manager.compare(e)>0){var r=this.orderTableRow([e]);return void t.insertBefore(r,n)}n=n.nextSibling}var a=this.orderTableRow([e]);t.appendChild(a)}else{if(0===e.qtyAtomic)return;n&&0===n.manager.getRate()?n.manager.insertOrder(e):(n=this.orderTableRow([e]),t.insertBefore(n,t.firstChild))}}},{key:"removeTableOrder",value:function(e){for(var t=e.token,n=0,r=[this.page.sellRows,this.page.buyRows];n<r.length;n++)for(var a=r[n],o=0,s=Array.from(a.children);o<s.length;o++)if(s[o].manager.removeOrder(t))return}},{key:"updateTableOrder",value:function(e){for(var t=0,n=[this.page.sellRows,this.page.buyRows];t<n.length;t++)for(var r=n[t],a=0,o=Array.from(r.children);a<o.length;a++)if(o[a].manager.updateOrderQty(e))return}},{key:"clearOrderTableEpochs",value:function(){this.clearOrderTableEpochSide(this.page.sellRows),this.clearOrderTableEpochSide(this.page.buyRows)}},{key:"clearOrderTableEpochSide",value:function(e){for(var t=0,n=Array.from(e.children);t<n.length;t++)n[t].manager.removeEpochOrders()}},{key:"orderTableRow",value:function(e){var t=this,n=this.page.orderRowTmpl.cloneNode(!0),r=this.market,a=r.baseUnitInfo,o=r.quoteUnitInfo,s=r.rateConversionFactor,i=r.cfg.ratestep,c=new po(n,e,a,o,i);return n.manager=c,Ha(n,"click",(function(){t.reportDepthClick(n.manager.getRate()/s)})),0!==n.manager.getRate()&&qe.bind(n,"mouseenter",(function(){var e=t.depthChart;t.depthLines.hover=[{rate:n.manager.getRate()/s,color:n.manager.isSell()?e.theme.sellLine:e.theme.buyLine}],t.drawChartLines()})),n}},{key:"handleConnNote",value:(t=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.marketList.setConnectionStatus(t),t.connectionStatus!==lt.Connected){e.next=6;break}return e.next=4,pt().fetchUser();case 4:return e.next=6,pt().loadPage("markets");case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"filterMarkets",value:function(){var e,t=null===(e=this.page.marketSearchV1.value)||void 0===e?void 0:e.toLowerCase(),n=t?function(e){return e.name.includes(t)}:function(){return!0};this.marketList.setFilter(n)}},{key:"drawChartLines",value:function(){this.depthChart.setLines([].concat(r(this.depthLines.hover),r(this.depthLines.input))),this.depthChart.draw()}},{key:"candleDurationSelected",value:function(e){var t,n;null!==(t=this.market)&&void 0!==t&&null!==(n=t.dex)&&void 0!==n&&n.candleDurs.includes(e)||(e="1h"),this.candleDur=e,this.loadCandles(),k.storeLocal(k.lastCandleDurationLK,e)}},{key:"loadCandles",value:function(){var e,t=_a(qe.kids(this.page.durBttnBox));try{for(t.s();!(e=t.n()).done;){var n=e.value;n.textContent===this.candleDur?n.classList.add("selected"):n.classList.remove("selected")}}catch(e){t.e(e)}finally{t.f()}var r=this.market,a=r.candleCaches,o=r.cfg,s=r.baseUnitInfo,i=r.quoteUnitInfo,c=a[this.candleDur];c?this.candleChart.setCandles(c,o,s,i):this.requestCandles()}},{key:"requestCandles",value:function(e){var t=this;this.candlesLoading={loaded:function(){},timer:window.setTimeout((function(){t.candlesLoading&&(t.candlesLoading=null,console.error("candles not received"))}),1e4)};var n=this.market,r=n.dex,a=n.baseCfg,o=n.quoteCfg;Wa.request("loadcandles",{host:r.host,base:a.id,quote:o.id,dur:e||this.candleDur})}},{key:"unload",value:function(){Wa.request("unmarket",{}),Wa.deregisterRoute(za),Wa.deregisterRoute(Ga),Wa.deregisterRoute(Xa),Wa.deregisterRoute(Ka),Wa.deregisterRoute(Qa),Wa.deregisterRoute(Ya),Wa.deregisterRoute(Ja),this.depthChart.unattach(),this.candleChart.unattach(),qe.unbind(document,"keyup",this.keyup),clearInterval(this.secondTicker)}}]),_}(ct),ao=function(){function e(t){i(this,e),h(this,"div",void 0),h(this,"rowTmpl",void 0),h(this,"markets",void 0),h(this,"selected",void 0),this.div=t,this.rowTmpl=qe.idel(t,"marketTmplV1"),qe.cleanTemplates(this.rowTmpl),this.reloadMarketsPane()}return d(e,[{key:"updateSpots",value:function(e){var t,n=_a(this.markets);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.mkt.xc.host===e.host){var a=pt().exchanges[r.mkt.xc.host],o=a.markets[r.mkt.name];fo(r.tmpl,a,o)}}}catch(e){n.e(e)}finally{n.f()}}},{key:"reloadMarketsPane",value:function(){qe.empty(this.div),this.markets=[];for(var e,t,n,a,o,s=0,i=function(){for(var e=[],t=pt().assets,n=function(e,n){return n.map((function(n){var r=t[n.baseid],a=r?r.name:n.basesymbol,o=pt().unitInfo(n.baseid,e);return Object.assign({xc:e,baseName:a,bui:o},n)}))},a=0,o=Object.values(pt().exchanges);a<o.length;a++){var s=o[a];e.push.apply(e,r(n(s,Object.values(s.markets||{}))))}return e.sort((function(e,t){if(!e.spot)return t.spot?1:e.name===t.name?e.xc.host.localeCompare(t.xc.host):e.name.localeCompare(t.name);if(!t.spot)return-1;var n=e.spot.vol24/e.lotsize;return t.spot.vol24/t.lotsize-n})),e}();s<i.length;s++){var c=i[s];this.markets.push((e=c,void 0,void 0,void 0,void 0,t=pt().unitInfo(e.baseid,e.xc),n=pt().unitInfo(e.quoteid,e.xc),a=qt/t.conventional.conversionFactor*n.conventional.conversionFactor,o=new oo(this.rowTmpl,e,a),this.div.appendChild(o.node),o))}pt().bindTooltips(this.div)}},{key:"find",value:function(e,t,n){var r,a=_a(this.markets);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.mkt.xc.host===e&&o.mkt.baseid===t&&o.mkt.quoteid===n)return o}}catch(e){a.e(e)}finally{a.f()}return null}},{key:"exists",value:function(e,t,n){return null!==this.find(e,t,n)}},{key:"first",value:function(){return this.markets[0]}},{key:"select",value:function(e,t,n){var r=this.find(e,t,n);if(!r)return console.error("select: no market row for ".concat(e,", ").concat(t,"-").concat(n));var a,o=_a(this.markets);try{for(o.s();!(a=o.n()).done;)a.value.node.classList.remove("selected")}catch(e){o.e(e)}finally{o.f()}this.selected=r,this.selected.node.classList.add("selected")}},{key:"setConnectionStatus",value:function(e){var t,n=_a(this.markets);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.mkt.xc.host===e.host&&(e.connectionStatus===lt.Connected?qe.hide(r.tmpl.disconnectedIco):qe.show(r.tmpl.disconnectedIco))}}catch(e){n.e(e)}finally{n.f()}}},{key:"setFilter",value:function(e){var t,n=_a(this.markets);try{for(n.s();!(t=n.n()).done;){var r=t.value;e(r)?qe.show(r.node):qe.hide(r.node)}}catch(e){n.e(e)}finally{n.f()}}}]),e}(),oo=d((function e(t,n,r){i(this,e),h(this,"node",void 0),h(this,"mkt",void 0),h(this,"name",void 0),h(this,"baseID",void 0),h(this,"quoteID",void 0),h(this,"lotSize",void 0),h(this,"tmpl",void 0),h(this,"rateConversionFactor",void 0),this.mkt=n,this.name=n.name,this.baseID=n.baseid,this.quoteID=n.quoteid,this.lotSize=n.lotsize,this.rateConversionFactor=r,this.node=t.cloneNode(!0);var a,o,s,c,l=this.tmpl=qe.parseTemplate(this.node);l.baseIcon.src=qe.logoPath(n.basesymbol),l.quoteIcon.src=qe.logoPath(n.quotesymbol),l.baseSymbol.appendChild(qe.symbolize(n.xc.assets[n.baseid],!0)),l.quoteSymbol.appendChild(qe.symbolize(n.xc.assets[n.quoteid],!0)),l.baseName.textContent=n.baseName,l.host.textContent=n.xc.host,l.host.style.color=(s=n.xc.host,(c=Object.keys(pt().exchanges)).sort(),a=c.indexOf(s),o=vo[a%vo.length],"hsl(".concat(360*o,", 35%, 50%)")),l.host.dataset.tooltip=n.xc.host,fo(l,n.xc,n),this.mkt.xc.connectionStatus!==lt.Connected&&qe.show(l.disconnectedIco)})),so=function(){function e(t,n){var r=this;i(this,e),h(this,"base",void 0),h(this,"quote",void 0),h(this,"dex",void 0),qe.hide(t,n);var a=qe.parseTemplate(t);this.base={id:0,parentID:no,cfg:null,node:t,tmpl:a,iconBox:a.walletState,stateIcons:new Ve(a.walletState)},a.balanceRowTmpl.remove();var o=qe.parseTemplate(n);this.quote={id:0,parentID:no,cfg:null,node:n,tmpl:o,iconBox:o.walletState,stateIcons:new Ve(o.walletState)},o.balanceRowTmpl.remove(),pt().registerNoteFeeder({balance:function(e){r.updateAsset(e.assetID)},walletstate:function(e){r.updateAsset(e.wallet.assetID)},walletsync:function(e){r.updateAsset(e.assetID)},createwallet:function(e){r.updateAsset(e.assetID)}})}var t;return d(e,[{key:"setBalanceVisibility",value:function(e){e?qe.show(this.base.node,this.quote.node):qe.hide(this.base.node,this.quote.node)}},{key:"setWallets",value:function(e,t,n){var r=function(e){var t=pt().assets[e];return null!=t&&t.token?t.token.parentID:no};this.dex=pt().user.exchanges[e],this.base.id=t,this.base.parentID=r(t),this.base.cfg=this.dex.assets[t],this.quote.id=n,this.quote.parentID=r(n),this.quote.cfg=this.dex.assets[n],this.updateWallet(this.base),this.updateWallet(this.quote),this.setBalanceVisibility(this.dex.connectionStatus===lt.Connected)}},{key:"updateWallet",value:function(e){var t=e.cfg,n=e.tmpl,r=e.iconBox,a=e.stateIcons,o=e.id;if(t){var s=pt().assets[o];if(qe.hide(n.newWalletRow,n.expired,n.unsupported,n.connect,n.spinner,n.walletState,n.balanceRows,n.walletAddr,n.wantProvidersBox),this.checkNeedsProvider(o,n.wantProvidersBox),n.logo.src=qe.logoPath(t.symbol),n.addWalletSymbol.textContent=t.symbol.toUpperCase(),qe.empty(n.symbol),s){n.symbol.appendChild(qe.symbolize(s,!0)),qe.show(r);var i=s.wallet;if(a.readWallet(i),!i)return s.walletCreationPending?void qe.show(n.spinner):void qe.show(n.newWalletRow);qe.show(n.walletAddr);var c=i.balance;if(c||i.running||i.disabled){if(!c)return pt().fetchBalance(o),void qe.show(n.spinner);qe.show(n.balanceRows),qe.empty(n.balanceRows);var l=function(t,r,a,o){var s=n.balanceRowTmpl.cloneNode(!0);n.balanceRows.appendChild(s);var i=qe.parseTemplate(s);i.title.textContent=t,i.bal.textContent=qe.formatCoinValue(r,a),o&&(i.bal.append(o),e.parentBal=i.bal)};if(l(xe("AVAILABLE"),c.available,s.unitInfo),l(xe(z),c.locked+c.contractlocked+c.bondlocked,s.unitInfo),l(xe("IMMATURE"),c.immature,s.unitInfo),s.token){var u=pt().assets[s.token.parentID],d=u.wallet.balance,h=u.unitInfo,p=u.symbol,f=document.createElement("img");f.src=qe.logoPath(p),f.classList.add("micro-icon","ms-1"),l(xe("FEE_BALANCE"),d.available,h,f)}(new Date).getTime()-new Date(c.stamp).getTime()>36e5&&!i.disabled?(qe.show(n.expired),i.running&&pt().fetchBalance(o)):qe.hide(n.expired)}else qe.show(n.connect)}else qe.show(n.unsupported)}}},{key:"checkNeedsProvider",value:(t=s(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=qe,e.next=3,pt().needsCustomProvider(t);case 3:e.t1=e.sent,e.t2=n,e.t0.setVis.call(e.t0,e.t1,e.t2);case 6:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"updateParent",value:function(e){var t,n=pt().assets[e.parentID],r=n.wallet.balance,a=n.unitInfo;null!==(t=e.parentBal)&&void 0!==t&&t.firstChild&&(e.parentBal.firstChild.textContent=qe.formatCoinValue(r.available,a))}},{key:"updateAsset",value:function(e){e===this.base.id?this.updateWallet(this.base):e===this.quote.id&&this.updateWallet(this.quote),e===this.base.parentID&&this.updateParent(this.base),e===this.quote.parentID&&this.updateParent(this.quote)}}]),e}();function io(e,t,n){return{host:e,base:t,quote:n}}function co(e,t){return"".concat(e,"_").concat(t)}function lo(e,t){return e?Math.round(parseFloat(e)*t):0}function uo(e,t){e.classList.remove("selected"),t.classList.add("selected")}function ho(e){for(var t={},n=0,r=Object.entries(e.options);n<r.length;n++){var o=a(r[n],2),s=o[0],i=o[1];t[s]=JSON.stringify(i)}return Object.assign({},e,{options:t})}var po=function(){function e(t,n,r,a,o){i(this,e),h(this,"tableRow",void 0),h(this,"page",void 0),h(this,"orderBin",void 0),h(this,"sell",void 0),h(this,"msgRate",void 0),h(this,"epoch",void 0),h(this,"baseUnitInfo",void 0),this.tableRow=t;var s=this.page=qe.parseTemplate(t);this.orderBin=n,this.sell=n[0].sell,this.msgRate=n[0].msgRate,this.epoch=!!n[0].epoch,this.baseUnitInfo=r;var c=qe.formatRateFullPrecision(this.msgRate,r,a,o);if(qe.setVis(this.isEpoch(),this.page.epoch),0===this.msgRate)s.rate.innerText="market";else{var l=this.isSell()?"sellcolor":"buycolor";s.rate.innerText=c,s.rate.classList.add(l)}this.updateQtyNumOrdersEl()}return d(e,[{key:"updateQtyNumOrdersEl",value:function(){var e=this.page,t=this.orderBin,n=t.reduce((function(e,t){return e+t.qtyAtomic}),0),r=t.length;e.qty.innerText=qe.formatFullPrecision(n,this.baseUnitInfo),r>1?(e.numOrders.removeAttribute("hidden"),e.numOrders.innerText=String(r),e.numOrders.title="quantity is comprised of ".concat(r," orders")):e.numOrders.setAttribute("hidden","true")}},{key:"insertOrder",value:function(e){this.orderBin.push(e),this.updateQtyNumOrdersEl()}},{key:"updateOrderQty",value:function(e){for(var t=e.token,n=e.qty,r=e.qtyAtomic,a=0;a<this.orderBin.length;a++)if(this.orderBin[a].token===t)return this.orderBin[a].qty=n,this.orderBin[a].qtyAtomic=r,this.updateQtyNumOrdersEl(),!0;return!1}},{key:"removeOrder",value:function(e){var t=this.orderBin.findIndex((function(t){return t.token===e}));return!(t<0||(this.orderBin.splice(t,1),this.orderBin.length?this.updateQtyNumOrdersEl():this.tableRow.remove(),0))}},{key:"removeEpochOrders",value:function(e){this.orderBin=this.orderBin.filter((function(t){return!(t.epoch&&t.epoch!==e)})),this.orderBin.length?this.updateQtyNumOrdersEl():this.tableRow.remove()}},{key:"getRate",value:function(){return this.msgRate}},{key:"isEpoch",value:function(){return this.epoch}},{key:"isSell",value:function(){return this.sell}},{key:"compare",value:function(e){return this.getRate()===e.msgRate&&this.isEpoch()===!!e.epoch?0:this.getRate()!==e.msgRate?this.getRate()>e.msgRate===e.sell?1:-1:this.isEpoch()?1:-1}}]),e}();function fo(e,t,n){if(n.spot){e.price.textContent=qe.formatFourSigFigs(pt().conventionalRate(n.baseid,n.quoteid,n.spot.rate,t));var r=n.spot.change24>0?"+":"";e.change.classList.remove("buycolor","sellcolor"),e.change.classList.add(n.spot.change24>=0?"buycolor":"sellcolor"),e.change.textContent="".concat(r).concat((100*n.spot.change24).toFixed(1),"%")}}var vo=[.5,1/4,3/4,1/8,5/8,3/8,7/8];function mo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return go(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?go(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function go(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var yo=function(e){g(p,e);var t,n,r,a,o,c,l,u=(c=p,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(c);if(l){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return y(this,e)});function p(e){var t;i(this,p),h(v(t=u.call(this)),"main",void 0),h(v(t),"offset",void 0),h(v(t),"loading",void 0),h(v(t),"currentForm",void 0),h(v(t),"orderTmpl",void 0),h(v(t),"filterState",void 0),h(v(t),"page",void 0),t.main=e,t.offset="",t.loading=!1;var n=t.page=qe.idDescendants(e);t.orderTmpl=n.rowTmpl,t.orderTmpl.remove();var r=t.filterState={hosts:[],assets:[],statuses:[]},a=new URLSearchParams(window.location.search),o=function(e,t){var n=a.get(t);if(n&&0!==n.length){var o=n.split(",");n&&(r[t]=o),e.querySelectorAll("input").forEach((function(e){o.indexOf(e.value)>=0&&(e.checked=!0)}))}};o(n.hostFilter,"hosts"),o(n.assetFilter,"assets"),o(n.statusFilter,"statuses");var s=[],c=function(e,n){var a=e.querySelector(".apply-bttn");s.push(a),qe.bind(a,"click",(function(){t.submitFilter(),s.forEach((function(e){return qe.hide(e)}))})),e.querySelectorAll("input").forEach((function(t){qe.bind(t,"change",(function(){!function(e,t){if(e.length!==t.length)return!1;var n,r=mo(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(-1===t.indexOf(a))return!1}}catch(e){r.e(e)}finally{r.f()}return!0}(bo(e),r[n])?qe.show(a):qe.hide(a)}))}))};return c(n.hostFilter,"hosts"),c(n.assetFilter,"assets"),c(n.statusFilter,"statuses"),qe.bind(t.main,"scroll",(function(){t.loading||n.ordersTable.offsetHeight-t.main.offsetHeight-t.main.scrollTop<0&&t.nextPage()})),n.forms.querySelectorAll(".form-closer").forEach((function(e){qe.bind(e,"click",(function(){qe.hide(n.forms)}))})),qe.bind(n.forms,"mousedown",(function(e){qe.mouseInElement(e,t.currentForm)||qe.hide(n.forms)})),qe.bind(n.exportOrders,"click",(function(){t.exportOrders()})),n.showArchivedDateField.addEventListener("change",(function(){n.showArchivedDateField.checked?qe.show(n.archivedDateField):qe.hide(n.archivedDateField,n.deleteArchivedRecordsErr)})),qe.bind(n.deleteArchivedRecords,"click",(function(){var e=t.page;e.showArchivedDateField.checked=!1,e.saveMatchesToFile.checked=!1,e.saveOrdersToFile.checked=!1,e.deleteArchivedRecordsErr.textContent="",e.archivedRecordsLocation.textContent="",e.deleteArchivedRecordsMsg.textContent="",qe.hide(e.deleteArchivedResult,e.deleteArchivedRecordsErr,e.deleteArchivedRecordsMsg,e.archivedRecordsLocation,e.archivedDateField),t.showForm(e.deleteArchivedRecordsForm)})),qe.bind(n.deleteArchivedRecordsSubmit,"click",(function(){var e=0;n.showArchivedDateField.checked&&(e=Date.parse(n.olderThan.value||""),isNaN(e)||e<=0)?qe.showFormError(n.deleteArchivedRecordsErr,xe("INVALID_DATE_ERR_MSG")):t.deleteArchivedRecords(e)})),t.submitFilter(),t}return d(p,[{key:"showForm",value:(o=s(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentForm=t,n=this.page,qe.hide(n.deleteArchivedRecordsForm),t.style.right="10000px",qe.show(n.forms,t),r=(n.forms.offsetWidth+t.offsetWidth)/2,e.next=8,qe.animate(500,(function(e){t.style.right="".concat((1-e)*r,"px")}),"easeOutHard");case 8:t.style.right="0px";case 9:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"setOrders",value:function(e){qe.empty(this.page.tableBody),this.appendOrders(e)}},{key:"appendOrders",value:function(e){var t,n=this.page.tableBody,r=mo(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,o=this.orderTmpl.cloneNode(!0),s=qe.parseTemplate(o),i=void 0,c=void 0,l=void 0,u=void 0,d=void 0,h="",p=pt().exchanges[a.host]||void 0;if((pt().assets[a.baseID]||p.assets[a.baseID])&&(pt().assets[a.quoteID]||p.assets[a.quoteID])){var f=[pt().unitInfo(a.baseID,p),pt().unitInfo(a.quoteID,p)],v=f[0],m=f[1];if(a.sell){var g=[a.baseSymbol,a.quoteSymbol];i=g[0],c=g[1];var y=[v.conventional.unit,m.conventional.unit];l=y[0],u=y[1],d=qe.formatCoinValue(a.qty,v),a.type===St&&(h=qe.formatCoinValue(a.qty/qt*a.rate,m))}else{var b=[a.quoteSymbol,a.baseSymbol];i=b[0],c=b[1];var x=[m.conventional.unit,v.conventional.unit];l=x[0],u=x[1],a.type===Ft?d=qe.formatCoinValue(a.qty,v):(d=qe.formatCoinValue(a.qty/qt*a.rate,m),h=qe.formatCoinValue(a.qty,v))}var k="".concat(v.conventional.unit,"-").concat(m.conventional.unit);s.host.textContent="".concat(k," @ ").concat(a.host),s.fromQty.textContent=d,s.fromLogo.src=qe.logoPath(i),s.fromSymbol.textContent=l,s.toQty.textContent=h,s.toLogo.src=qe.logoPath(c),s.toSymbol.textContent=u,s.type.textContent="".concat(Wt(a)," ").concat(Nt(a));var w=qe.formatCoinValue(pt().conventionalRate(a.baseID,a.quoteID,a.rate,p));a.type===Ft&&(w=zt(a)),s.rate.textContent=w,s.status.textContent=_t(a),s.filled.textContent="".concat((jt(a)/a.qty*100).toFixed(1),"%"),s.settled.textContent="".concat((Ht(a)/a.qty*100).toFixed(1),"%");var C=new Date(a.submitTime).toLocaleString();s.timeAgo.textContent="".concat(qe.timeSince(a.submitTime)," ago"),s.time.textContent=C,qe.tmplElement(o,"link").href="order/".concat(a.id),pt().bindInternalNavigation(o),n.appendChild(o)}}}catch(e){r.e(e)}finally{r.f()}50===e.length?this.offset=e[e.length-1].id:this.offset=""}},{key:"submitFilter",value:(a=s(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,this.offset="",(n=this.filterState).hosts=bo(t.hostFilter),n.assets=bo(t.assetFilter).map((function(e){return parseInt(e)})),n.statuses=bo(t.statusFilter).map((function(e){return parseInt(e)})),e.t0=this,e.next=9,this.fetchOrders();case 9:e.t1=e.sent,e.t0.setOrders.call(e.t0,e.t1);case 11:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"fetchOrders",value:(r=s(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=pt().loading(this.main),e.next=3,S("/api/orders",this.currentFilter());case 3:return n=e.sent,t(),e.abrupt("return",n.orders);case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"exportOrders",value:function(){this.offset="";var e=this.currentFilter(),t=new URL(window.location.href),n=new URLSearchParams(""),r=function(t){e[t].forEach((function(e){n.append(t,e)}))};r("hosts"),r("assets"),r("statuses"),t.search=n.toString(),t.pathname="/orders/export",window.open(t.toString())}},{key:"deleteArchivedRecords",value:(n=s(f().mark((function e(t){var n,r,a,o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.page,r=n.saveMatchesToFile.checked||!1,a=n.saveOrdersToFile.checked||!1,o={olderThanMs:t,saveMatchesToFile:r,saveOrdersToFile:a},s=pt().loading(this.main),e.next=7,S("/api/deletearchivedrecords",o);case 7:if(i=e.sent,s(),pt().checkResponse(i)){e.next=11;break}return e.abrupt("return",qe.showFormError(n.deleteArchivedRecordsErr,i.msg));case 11:i.archivedRecordsDeleted>0?(n.deleteArchivedRecordsMsg.textContent=xe("DELETE_ARCHIVED_RECORDS_RESULT",{nRecords:i.archivedRecordsDeleted}),(r||a)&&(n.archivedRecordsLocation.textContent=xe("ARCHIVED_RECORDS_PATH",{path:i.archivedRecordsPath}),qe.show(n.archivedRecordsLocation)),this.submitFilter()):n.deleteArchivedRecordsMsg.textContent=xe("NO_ARCHIVED_RECORDS"),qe.show(n.deleteArchivedResult,n.deleteArchivedRecordsMsg);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"currentFilter",value:function(){var e,t,n=this.filterState;return{hosts:n.hosts,assets:null===(e=n.assets)||void 0===e?void 0:e.map((function(e){return parseInt(e)})),statuses:null===(t=n.statuses)||void 0===t?void 0:t.map((function(e){return parseInt(e)})),n:50,offset:this.offset}}},{key:"nextPage",value:(t=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==this.offset&&!this.loading){e.next=2;break}return e.abrupt("return");case 2:return this.loading=!0,qe.show(this.page.orderLoader),e.next=6,this.fetchOrders();case 6:t=e.sent,this.loading=!1,qe.hide(this.page.orderLoader),this.appendOrders(t);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),p}(ct);function bo(e){var t=[];return e.querySelectorAll("input").forEach((function(e){e.checked&&t.push(e.value)})),t}function xo(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ko(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ko(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function ko(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var wo=288e5,Co=function(e){g(p,e);var t,n,r,a,o,c,l,u=(c=p,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(c);if(l){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return y(this,e)});function p(e){var t;i(this,p),h(v(t=u.call(this)),"orderID",void 0),h(v(t),"order",void 0),h(v(t),"page",void 0),h(v(t),"currentForm",void 0),h(v(t),"secondTicker",void 0),h(v(t),"refreshOnPopupClose",void 0),h(v(t),"accelerateOrderForm",void 0),h(v(t),"stampers",void 0);var n=t.page=qe.idDescendants(e);t.stampers=qe.applySelector(e,"[data-stamp]"),t.orderID=e.dataset.oid||"",qe.cleanTemplates(n.matchCardTmpl);var r=function(){var e,n=xo(t.stampers);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.textContent=qe.timeSince(parseInt(r.dataset.stamp||""))}}catch(e){n.e(e)}finally{n.f()}};return r(),n.forms.querySelectorAll(".form-closer").forEach((function(e){qe.bind(e,"click",(function(){t.refreshOnPopupClose?window.location.replace(window.location.href):qe.hide(n.forms)}))})),e.querySelectorAll("[data-explorer-id]").forEach((function(e){Gn(parseInt(e.dataset.explorerId||""),e)})),n.cancelBttn&&qe.bind(n.cancelBttn,"click",(function(){t.showForm(n.cancelForm)})),qe.bind(n.accelerateBttn,"click",(function(){t.showAccelerateForm()})),vt(n),t.accelerateOrderForm=new Br(n.accelerateForm,(function(){t.refreshOnPopupClose=!0})),qe.cleanTemplates(n.booleanOptTmpl,n.rangeOptTmpl,n.orderOptTmpl),qe.bind(n.forms,"mousedown",(function(e){if(!qe.mouseInElement(e,t.currentForm)){if(t.refreshOnPopupClose)return void window.location.reload();qe.hide(n.forms)}})),zr(n.cancelForm,n.cancelSubmit,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.submitCancel();case 1:case"end":return e.stop()}}),e)})))),t.secondTicker=window.setInterval((function(){r()}),1e4),pt().registerNoteFeeder({order:function(e){t.handleOrderNote(e)},match:function(e){t.handleMatchNote(e)}}),t.start(),t}return d(p,[{key:"start",value:(o=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=pt().order(this.orderID))){e.next=5;break}this.order=t,e.next=8;break;case 5:return e.next=7,this.fetchOrder();case 7:t=e.sent;case 8:this.page.mktBaseSymbol.replaceWith(qe.symbolize(pt().assets[t.baseID])),this.page.mktQuoteSymbol.replaceWith(qe.symbolize(pt().assets[t.quoteID])),this.setAccelerationButtonVis(),this.showMatchCards();case 12:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"unload",value:function(){clearInterval(this.secondTicker)}},{key:"fetchOrder",value:(a=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("/api/order",this.orderID);case 2:if(t=e.sent,pt().checkResponse(t)){e.next=5;break}throw t.msg;case 5:return this.order=t.order,e.abrupt("return",this.order);case 7:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"setImmutableMatchCardElements",value:function(e,t){var n=qe.parseTemplate(e);n.matchID.textContent=t.matchID;var r=new Date(t.stamp);n.matchTime.textContent=r.toLocaleTimeString(qe.languages(),{year:"numeric",month:"short",day:"numeric"}),n.matchTimeAgo.dataset.stamp=t.stamp.toString(),n.matchTimeAgo.textContent=qe.timeSince(t.stamp),this.stampers.push(n.matchTimeAgo);var a=function(e,t){var n=t.qty;return Vt(e)&&(n=Xt(t.rate,t.qty)),(n/e.qty*100).toFixed(1)+" %"}(this.order,t),o=qe.bipSymbol(this.order.baseID),s=qe.bipSymbol(this.order.quoteID),i=pt().unitInfo(this.order.baseID),c=pt().unitInfo(this.order.quoteID),l=[i.conventional.unit.toLowerCase(),c.conventional.unit.toLowerCase()],u=l[0],d=l[1],h=Xt(t.rate,t.qty);if(t.isCancel)return qe.show(n.cancelInfoDiv),qe.hide(n.infoDiv,n.status,n.statusHdr),this.order.sell?(n.cancelAmount.textContent=qe.formatCoinValue(t.qty,i),n.cancelIcon.src=qe.logoPathFromID(this.order.baseID)):(n.cancelAmount.textContent=qe.formatCoinValue(h,c),n.cancelIcon.src=qe.logoPathFromID(this.order.quoteID)),void(n.cancelOrderPortion.textContent=a);qe.show(n.infoDiv),qe.hide(n.cancelInfoDiv),n.orderPortion.textContent=a,t.side===Lt?(n.side.textContent=xe("MAKER"),qe.show(n.makerSwapYou,n.makerRedeemYou,n.takerSwapThem,n.takerRedeemThem),qe.hide(n.takerSwapYou,n.takerRedeemYou,n.makerSwapThem,n.makerRedeemThem)):(n.side.textContent=xe("TAKER"),qe.hide(n.makerSwapYou,n.makerRedeemYou,n.takerSwapThem,n.takerRedeemThem),qe.show(n.takerSwapYou,n.takerRedeemYou,n.makerSwapThem,n.makerRedeemThem)),t.side===Lt&&this.order.sell||t.side===Ot&&!this.order.sell?(n.makerSwapAsset.textContent=u,n.takerSwapAsset.textContent=d,n.makerRedeemAsset.textContent=d,n.takerRedeemAsset.textContent=u):(n.makerSwapAsset.textContent=d,n.takerSwapAsset.textContent=u,n.makerRedeemAsset.textContent=u,n.takerRedeemAsset.textContent=d);var p=pt().conventionalRate(this.order.baseID,this.order.quoteID,t.rate);n.rate.textContent="".concat(p," ").concat(u,"/").concat(d),this.order.sell?(n.refundAsset.textContent=o,n.fromAmount.textContent=qe.formatCoinValue(t.qty,i),n.toAmount.textContent=qe.formatCoinValue(h,c),n.fromIcon.src=qe.logoPathFromID(this.order.baseID),n.toIcon.src=qe.logoPathFromID(this.order.quoteID)):(n.refundAsset.textContent=s,n.fromAmount.textContent=qe.formatCoinValue(h,c),n.toAmount.textContent=qe.formatCoinValue(t.qty,i),n.fromIcon.src=qe.logoPathFromID(this.order.quoteID),n.toIcon.src=qe.logoPathFromID(this.order.baseID))}},{key:"setMutableMatchCardElements",value:function(e,t){if(!t.isCancel){var n=qe.parseTemplate(e);n.status.textContent=function(e){if(e.revoked)return e.active?e.redeem?Kt(Q):e.side===Lt?Kt(J):e.counterRedeem?Kt("MATCH_STATUS_REDEEM_PENDING"):Kt(J):e.refund?Kt("MATCH_STATUS_REFUNDED"):e.redeem?Kt(Y):Kt("MATCH_STATUS_COMPLETE");switch(e.status){case 0:return xe("MATCH_STATUS_NEWLY_MATCHED");case 1:return xe("MATCH_STATUS_MAKER_SWAP_CAST");case Et:return xe("MATCH_STATUS_TAKER_SWAP_CAST");case Bt:return e.side===Lt?xe(Q):xe("MATCH_STATUS_MAKER_REDEEMED");case Pt:return xe(Q);case 5:return xe(Y)}return xe(W)}(t);var r=function(e,t,n){if(!n)return qe.hide(t),void qe.show(e);t.textContent=zn(n.stringID),t.dataset.explorerCoin=n.stringID,Gn(n.assetID,t),qe.show(t),qe.hide(e)};if(r(n.makerSwapPending,n.makerSwapCoin,Fo(t)),r(n.takerSwapPending,n.takerSwapCoin,Do(t)),r(n.makerRedeemPending,n.makerRedeemCoin,To(t)),r(n.takerRedeemPending,n.takerRedeemCoin,Io(t)),t.refund)n.refundCoin.textContent=zn(t.refund.stringID),n.refundCoin.dataset.explorerCoin=t.refund.stringID,Gn(t.refund.assetID,n.refundCoin),qe.show(n.refundCoin),qe.hide(n.refundPending);else{var a=72e6;t.side===Ot&&(a=wo);var o=new Date(t.stamp+a);if(Date.now()>o.getTime())n.refundPending.textContent=xe("REFUND_IMMINENT");else{var s=o.toLocaleTimeString(qe.languages(),{year:"numeric",month:"short",day:"numeric"});n.refundPending.textContent=xe("REFUND_WILL_HAPPEN_AFTER",{refundAfterTime:s})}qe.hide(n.refundCoin),qe.show(n.refundPending)}if(1!==t.status||t.revoked||t.refund)if(t.status!==Et||t.revoked||t.refund)!function(e){return e.status<5&&e.side===Lt&&e.status>=Bt}(t)||t.revoked||t.refund?!function(e){return e.status<5&&e.side===Ot&&e.status>=Pt}(t)||t.revoked||t.refund?qe.hide(n.makerSwapMsg,n.takerSwapMsg,n.makerRedeemMsg,n.takerRedeemMsg):(n.takerRedeemMsg.textContent=So(t.redeem),qe.hide(n.makerSwapMsg,n.takerSwapMsg,n.makerRedeemMsg),qe.show(n.takerRedeemMsg)):(n.makerRedeemMsg.textContent=So(t.redeem),qe.hide(n.makerSwapMsg,n.takerSwapMsg,n.takerRedeemMsg),qe.show(n.makerRedeemMsg));else{var i=Do(t);n.takerSwapMsg.textContent=So(i),qe.hide(n.makerSwapMsg,n.makerRedeemMsg,n.takerRedeemMsg),qe.show(n.takerSwapMsg)}else{var c=Fo(t);n.makerSwapMsg.textContent=So(c),qe.hide(n.takerSwapMsg,n.makerRedeemMsg,n.takerRedeemMsg),qe.show(n.makerSwapMsg)}if(t.revoked){qe.setVis(Fo(t),n.makerSwap),qe.setVis(Do(t),n.takerSwap);var l=new Date(t.stamp+wo),u=Date.now()>l.getTime();qe.setVis(To(t)||Do(t)&&t.active&&!t.refund&&!u,n.makerRedeem),qe.setVis(Io(t)||To(t)&&t.active&&!t.refund,n.takerRedeem);var d=Boolean(Do(t));t.side===Lt&&(d=Boolean(Fo(t)),Do(t)&&(d=d&&u)),qe.setVis(t.refund||t.active&&!t.redeem&&!t.counterRedeem&&d,n.refund)}else qe.setVis(Fo(t)||t.active,n.makerSwap),qe.setVis(Do(t)||t.active,n.takerSwap),qe.setVis(To(t)||t.active,n.makerRedeem),qe.setVis(Io(t)||t.active,n.takerRedeem),qe.setVis(t.refund,n.refund)}}},{key:"addNewMatchCard",value:function(e){var t=this.page,n=t.matchCardTmpl.cloneNode(!0);pt().bindUrlHandlers(n),n.dataset.matchID=e.matchID,this.setImmutableMatchCardElements(n,e),this.setMutableMatchCardElements(n,e),t.matchBox.appendChild(n)}},{key:"showMatchCards",value:function(){var e=this,t=this.order;t&&t.matches&&(t.matches.sort((function(e,t){return e.stamp-t.stamp})),t.matches.forEach((function(t){return e.addNewMatchCard(t)})))}},{key:"showCancel",value:function(){var e=this.order,t=this.page,n=e.qty-e.filled,r=Vt(e)?pt().assets[e.quoteID]:pt().assets[e.baseID];t.cancelRemain.textContent=qe.formatCoinValue(n,r.unitInfo),t.cancelUnit.textContent=r.unitInfo.conventional.unit.toUpperCase(),this.showForm(t.cancelForm)}},{key:"showForm",value:(r=s(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentForm=t,n=this.page,qe.hide(n.cancelForm,n.accelerateForm),t.style.right="10000px",qe.show(n.forms,t),r=(n.forms.offsetWidth+t.offsetWidth)/2,e.next=8,qe.animate(500,(function(e){t.style.right="".concat((1-e)*r,"px")}),"easeOutHard");case 8:t.style.right="0px";case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"submitCancel",value:(n=s(f().mark((function e(){var t,n,r,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=this.order,r={orderID:n.id},a=pt().loading(t.cancelForm),e.next=6,S("/api/cancel",r);case 6:if(o=e.sent,a(),pt().checkResponse(o)){e.next=10;break}return e.abrupt("return");case 10:t.status.textContent=xe(q),qe.hide(t.forms),n.cancelling=!0;case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setAccelerationButtonVis",value:function(){var e=this.order;if(e){var t=this.page;qe.setVis(pt().canAccelerateOrder(e),t.accelerateBttn,t.actionsLabel)}}},{key:"showAccelerateForm",value:(t=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=pt().loading(this.page.accelerateBttn),this.accelerateOrderForm.refresh(this.order),t(),this.showForm(this.page.accelerateForm);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"handleOrderNote",value:function(e){var t=this.page,n=e.order;if(n.id===this.orderID){this.order=n;var r=t.cancelBttn;r&&n.status>At&&qe.hide(r),t.status.textContent=_t(n);var a,o=xo(n.matches||[]);try{for(o.s();!(a=o.n()).done;){var s=a.value;this.processMatch(s)}}catch(e){o.e(e)}finally{o.f()}this.setAccelerationButtonVis()}}},{key:"handleMatchNote",value:function(e){e.orderID===this.orderID&&(this.processMatch(e.match),this.setAccelerationButtonVis())}},{key:"processMatch",value:function(e){var t,n=null,r=xo(qe.applySelector(this.page.matchBox,".match-card"));try{for(r.s();!(t=r.n()).done;){var a=t.value;if(a.dataset.matchID===e.matchID){n=a;break}}}catch(e){r.e(e)}finally{r.f()}n?this.setMutableMatchCardElements(n,e):this.addNewMatchCard(e)}}]),p}(ct);function So(e){return e.confs&&0!==e.confs.required?"".concat(e.confs.count," / ").concat(e.confs.required," ").concat(xe("CONFIRMATIONS")):""}function Fo(e){return e.side===Lt?e.swap:e.counterSwap}function Do(e){return e.side===Lt?e.counterSwap:e.swap}function To(e){return e.side===Lt?e.redeem:e.counterRedeem}function Io(e){return e.side===Lt?e.counterRedeem:e.redeem}function Ao(){return Ao="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},Ao.apply(this,arguments)}function Ro(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Eo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Eo(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){i=!0,o=e})),f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function Eo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Bo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b(e);if(t){var a=b(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return y(this,n)}}function Po(e){var t,n=e.cex,r=n.avail,a=n.req,o=e.dex,s=o.avail,i=o.req,c=e.transferable,l=Math.min(s,i),u=Math.min(r,a);if(e.fundedAndNotBalanced)if(s>i){var d=a-r;if(s-i<d)throw Error("bad math has us with dex surplus + cex underfund invalid remains");l+=d+c}else{var h=i-s;if(r-a<h)throw Error("bad math got us with cex surplus + dex underfund invalid remains");u+=h+c}else if(e.fundedAndBalanced){if(c>0){var p=s-i,f=r-a;t={left:{cex:0,dex:0},right:{cex:0,dex:0},cexRange:0,dexRange:0},f>c&&p>c?(t.left.cex=c+a,t.left.dex=i,t.right.cex=a,t.right.dex=c+i):p<c&&f<c?(t.left.cex=c-p+a,t.left.dex=p+i,t.right.cex=f+a,t.right.dex=c-f+i):p>c?(t.left.cex=a,t.left.dex=c+i,t.right.cex=f+a,t.right.dex=c-f+i):(t.left.cex=c-p+a,t.left.dex=p+i,t.right.cex=c+a,t.right.dex=i),t.cexRange=t.right.cex-t.left.cex,t.dexRange=t.right.dex-t.left.dex,l=t.left.dex+t.dexRange/2,u=t.left.cex+t.cexRange/2}}else r<a?l=Math.min(s,i+c+(a-r)):s<i?u=Math.min(r,a+c+(i-s)):(l=Math.min(s,i+c),u=Math.min(r,i+a+c-l));return[l,u,t]}var Lo=function(e){g(p,e);var t,n,o,c,l,u=Bo(p);function p(e){var t;i(this,p),h(v(t=u.call(this)),"page",void 0),h(v(t),"forms",void 0),h(v(t),"currentForm",void 0),h(v(t),"keyup",void 0),h(v(t),"cexConfigForm",void 0),h(v(t),"bots",void 0),h(v(t),"sortedBots",void 0),h(v(t),"cexes",void 0),h(v(t),"twoColumn",void 0),h(v(t),"runningMMDisplayElements",void 0),t.bots={},t.sortedBots=[],t.cexes={};var n=t.page=qe.idDescendants(e);qe.cleanTemplates(n.botTmpl,n.botRowTmpl,n.exchangeRowTmpl),t.forms=new Fr(n.forms),t.cexConfigForm=new Vr(n.cexConfigForm,(function(e){return t.cexConfigured(e)})),t.runningMMDisplayElements={orderReportForm:n.orderReportForm,dexBalancesRowTmpl:n.dexBalancesRowTmpl,placementRowTmpl:n.placementRowTmpl,placementAmtRowTmpl:n.placementAmtRowTmpl},qe.cleanTemplates(n.dexBalancesRowTmpl,n.placementRowTmpl,n.placementAmtRowTmpl),qe.bind(n.newBot,"click",(function(){t.newBot()})),qe.bind(n.archivedLogsBtn,"click",(function(){pt().loadPage("mmarchives")})),t.twoColumn=window.innerWidth>=768,new ResizeObserver((function(){t.resized()})).observe(e);for(var r=function(){var e=a(s[o],2),r=e[0],i=e[1],c=n.exchangeRowTmpl.cloneNode(!0);n.cexRows.appendChild(c);var l=qe.parseTemplate(c),u=function(){t.cexConfigForm.setCEX(r),t.forms.show(n.cexConfigForm)};qe.bind(l.configureBttn,"click",u),qe.bind(l.reconfigBttn,"click",u),qe.bind(l.errConfigureBttn,"click",u);var d=t.cexes[r]={tr:c,tmpl:l,dinfo:i,cexName:r};t.updateCexRow(d)},o=0,s=Object.entries(or);o<s.length;o++)r();return t.setup(),t}return d(p,[{key:"resized",value:function(){var e=window.innerWidth>=768;if(e!==this.twoColumn){this.twoColumn=e,this.clearBotBoxes();var t,n=Ro(this.sortedBots);try{for(n.s();!(t=n.n()).done;){var r=t.value.div;this.appendBotBox(r)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"setup",value:(l=s(f().mark((function e(){var t,n,a,o,s,i,c,l,u,d=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,n=pt().mmStatus,a=n.bots.map((function(e){return e.config})),pt().registerNoteFeeder({runstats:function(e){d.handleRunStatsNote(e)},runevent:function(e){var t=d.bots[hr(e.host,e.baseID,e.quoteID)];if(t)return t.handleRunStats()},epochreport:function(e){var t=d.bots[hr(e.host,e.baseID,e.quoteID)];t&&t.handleEpochReportNote(e)},cexproblems:function(e){var t=d.bots[hr(e.host,e.baseID,e.quoteID)];t&&t.handleCexProblemsNote(e)},cexnote:function(e){d.handleCEXNote(e)}}),o=!a||0===a.length,qe.setVis(o,t.noBots),!o){e.next=8;break}return e.abrupt("return");case 8:t.noBots.remove(),s=r(n.bots).sort((function(e,t){var n,r,a,o;return e.running&&!t.running?-1:t.running&&!e.running?1:e.running||t.running?(null!==(n=null===(r=t.runStats)||void 0===r?void 0:r.startTime)&&void 0!==n?n:0)-(null!==(a=null===(o=e.runStats)||void 0===o?void 0:o.startTime)&&void 0!==a?a:0):e.config.baseID+e.config.quoteID-(t.config.baseID+t.config.quoteID)})),i={},c=Ro(s);try{for(c.s();!(l=c.n()).done;)u=l.value,this.addBot(u,i)}catch(e){c.e(e)}finally{c.f()}case 13:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"handleCEXNote",value:(c=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.topic,e.next="BalanceUpdate"===e.t0?3:4;break;case 3:return e.abrupt("return",this.handleCEXBalanceUpdate(t.cexName));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"handleCEXBalanceUpdate",value:(o=s(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=this.cexes[t])&&this.updateCexRow(n);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"handleRunStatsNote",value:(n=s(f().mark((function e(t){var n,r,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.baseID,r=t.quoteID,a=t.host,!(o=this.bots[hr(a,n,r)])){e.next=4;break}return e.abrupt("return",o.handleRunStats());case 4:this.addBot(pt().botStatus(a,n,r));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unload",value:function(){qe.unbind(document,"keyup",this.keyup)}},{key:"addBot",value:function(e,t){var n,r=this.page,a=this.bots,o=this.sortedBots,s=e.config,i=s.baseID,c=s.quoteID,l=s.host,u=[pt().assets[i].symbol,pt().assets[c].symbol],d=u[1],h="".concat(u[0],"_").concat(d);if(null!==(n=pt().exchanges[l])&&void 0!==n&&n.markets[h]){var p=new Oo(this,this.runningMMDisplayElements,e,t);r.botRows.appendChild(p.row.tr),o.push(p),a[p.id]=p,this.appendBotBox(p.div)}}},{key:"appendBotBox",value:function(e){var t=this.page,n=t.boxZero,r=t.boxOne;(this.twoColumn&&(n.children.length+r.children.length)%2!=0?r:n).append(e)}},{key:"clearBotBoxes",value:function(){for(var e=this.page,t=e.boxOne,n=e.boxZero;n.children.length>1;)n.removeChild(n.lastChild);for(;t.children.length>0;)t.removeChild(t.lastChild)}},{key:"showBot",value:function(e){var t=this.sortedBots,n=t.findIndex((function(t){return t.id===e}));t.splice(n,1),t.unshift(this.bots[e]),this.clearBotBoxes();var r,a=Ro(t);try{for(a.s();!(r=a.n()).done;){var o=r.value.div;this.appendBotBox(o)}}catch(e){a.e(e)}finally{a.f()}var s=this.bots[e].div;qe.animate(250,(function(e){s.style.opacity="".concat(e),s.style.transform="scale(".concat(.8+.2*e,")")}))}},{key:"newBot",value:function(){pt().loadPage("mmsettings")}},{key:"cexConfigured",value:(t=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt().fetchMMStatus();case 2:this.updateCexRow(this.cexes[t]),this.forms.close();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateCexRow",value:function(e){var t=e.tmpl,n=e.dinfo,r=e.cexName;t.logo.src=n.logo,t.name.textContent=n.name;var o=pt().mmStatus.cexes[r];if(qe.setVis(!o,t.unconfigured),qe.setVis(o&&!o.connectErr,t.configured),qe.setVis(null==o?void 0:o.connectErr,t.connectErrBox),null!=o&&o.connectErr&&(t.connectErr.textContent="connection error",t.connectErr.dataset.tooltip=o.connectErr),t.logo.classList.toggle("greyscale",!o),o){for(var s=0,i={},c=0,l=Object.entries(o.balances);c<l.length;c++){var u=a(l[c],2),d=u[0],h=u[1],p=parseInt(d),f=qe.bipCEXSymbol(p);if(!i[f]){i[f]=!0;var v=pt().assets[p].unitInfo,m=pt().fiatRatesMap[p];m&&(s+=m*(h.available+h.locked)/v.conventional.conversionFactor)}}t.usdBalance.textContent=qe.formatFourSigFigs(s)}}},{key:"percentageBalanceStr",value:function(e,t,n){var r=pt().assets[e],a=r.unitInfo,o=qe.formatCoinValue(t*n/100,a);return"".concat(qe.formatFourSigFigs(n),"% - ").concat(o," ").concat(r.symbol.toUpperCase())}},{key:"walletBalanceStr",value:function(e,t){var n=pt().assets[e].wallet.balance.available;return this.percentageBalanceStr(e,n,t)}}]),p}(ct),Oo=function(e){g(c,e);var t,n,o=Bo(c);function c(e,t,n,r){var a,s;i(this,c),h(v(s=o.call(this,n.config)),"pg",void 0),h(v(s),"div",void 0),h(v(s),"page",void 0),h(v(s),"placementsChart",void 0),h(v(s),"baseAllocSlider",void 0),h(v(s),"quoteAllocSlider",void 0),h(v(s),"row",void 0),h(v(s),"runDisplay",void 0),r=null!==(a=r)&&void 0!==a?a:{},s.pg=e;var l=v(s),u=l.baseID,d=l.quoteID,p=l.host,f=l.botType,m=l.nBuyPlacements,g=l.nSellPlacements,y=l.cexName;s.id=hr(p,u,d);var b=s.div=e.page.botTmpl.cloneNode(!0),x=s.page=qe.parseTemplate(b);s.runDisplay=new gr(x.onBox,e.forms,t,"mm"),cr(b,u,d,p),y&&lr(b,y),f===rr?x.botTypeDisplay.textContent=xe(pe):f===ar?x.botTypeDisplay.textContent=xe(fe):f===nr&&(x.botTypeDisplay.textContent=xe(he)),qe.setVis(f!==ar,x.placementsChartBox,x.baseTokenSwapFeesBox),f!==ar&&(s.placementsChart=new dr(x.placementsChart),x.buyPlacementCount.textContent=String(m),x.sellPlacementCount.textContent=String(g)),qe.bind(x.startBttn,"click",(function(){return s.start()})),qe.bind(x.allocationBttn,"click",(function(){return s.allocate()})),qe.bind(x.reconfigureBttn,"click",(function(){return s.reconfigure()})),qe.bind(x.goBackFromAllocation,"click",(function(){return s.hideAllocationDialog()})),qe.bind(x.marketLink,"click",(function(){return pt().loadPage("markets",{host:p,baseID:u,quoteID:d})})),s.baseAllocSlider=new Je(x.baseAllocSlider,(function(){})),s.quoteAllocSlider=new Je(x.quoteAllocSlider,(function(){}));var k=e.page.botRowTmpl.cloneNode(!0);cr(k,u,d,p);var w=qe.parseTemplate(k);return s.row={tr:k,tmpl:w},qe.bind(w.allocateBttn,"click",(function(t){t.stopPropagation(),s.allocate(),e.showBot(s.id)})),qe.bind(k,"click",(function(){return e.showBot(s.id)})),s.initialize(r),s}return d(c,[{key:"initialize",value:(n=s(f().mark((function e(t){var n,a,o,s,i,l,u,d,h,p,v,m,g,y,x,k,w,C,S,F,D,T,I;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ao(b(c.prototype),"initialize",this).call(this,t);case 2:this.runDisplay.setBotMarket(this),n=this.page,a=this.host,o=this.cexName,s=this.botType,i=this.div,l=this.cfg,u=l.arbMarketMakingConfig,d=l.basicMarketMakingConfig,h=this.mktID,p=this.baseFactor,v=this.quoteFactor,m=this.marketReport.baseFiatRate,s!==ar&&(g=[],y=[],x=0,u?(g=u.buyPlacements.map((function(e){return{lots:e.lots,gapFactor:e.multiplier}})),y=u.sellPlacements.map((function(e){return{lots:e.lots,gapFactor:e.multiplier}})),x=u.profit):d&&(g=d.buyPlacements,y=d.sellPlacements,g.length>0&&(k=g.reduce((function(e,t){return t.gapFactor<e.gapFactor?t:e}))),y.length>0&&(w=y.reduce((function(e,t){return t.gapFactor<e.gapFactor?t:e}))),k&&w?x=(k.gapFactor+w.gapFactor)/2:k?x=k.gapFactor:w&&(x=w.gapFactor)),C={cexName:o,botType:s,baseFiatRate:m,dict:{profit:x,buyPlacements:g,sellPlacements:y}},this.placementsChart.setMarket(C)),qe.setVis(s!==nr,n.cexDataBox),s!==nr&&(S=pt().mmStatus.cexes[o])&&(F=S.markets?S.markets[h]:void 0,qe.setVis(null==F?void 0:F.day,n.cexDataBox),null!=F&&F.day&&(D=F.day,n.cexPrice.textContent=qe.formatFourSigFigs(D.lastPrice),n.cexVol.textContent=qe.formatFourSigFigs(m*D.vol))),qe.setVis.apply(qe,[Boolean(o)].concat(r(qe.applySelector(i,"[data-cex-show]")))),(T=pt().exchanges[a].markets[h].spot)&&(qe.show(n.dexDataBox),I=qt/p*v,n.dexPrice.textContent=qe.formatFourSigFigs(T.rate/I),n.dexVol.textContent=qe.formatFourSigFigs(T.vol24/p*m)),this.updateDisplay(),this.updateTableRow(),qe.hide(n.loadingBg);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"updateTableRow",value:function(){var e=this.row.tmpl,t=this.status(),n=t.running,r=t.runStats;qe.setVis(n,e.profitLossBox),qe.setVis(!n,e.allocateBttnBox),r&&(e.profitLoss.textContent=qe.formatFourSigFigs(r.profitLoss.profit,2))}},{key:"updateDisplay",value:function(){var e=this.page,t=this.marketReport;if([t.baseFiatRate,t.quoteFiatRate,this.baseFeeFiatRate,this.quoteFeeFiatRate].some((function(e){return!e})))return qe.hide(e.onBox,e.offBox),void qe.show(e.noFiatDisplay);var n=this.status().running;qe.setVis(n,e.onBox),qe.setVis(!n,e.offBox),n?this.updateRunningDisplay():this.updateIdleDisplay()}},{key:"updateRunningDisplay",value:function(){this.runDisplay.update()}},{key:"updateIdleDisplay",value:function(){var e=this.page,t=this.proj,n=t.alloc,r=t.qProj,a=t.bProj,o=this.baseID,s=this.quoteID,i=this.cexName,c=this.bui,l=this.qui,u=this.baseFeeID,d=this.quoteFeeID,h=this.baseFactor,p=this.quoteFactor,f=this.baseFeeFactor,v=this.quoteFeeFactor,m=this.marketReport,g=m.baseFiatRate,y=m.quoteFiatRate,b=this.cfg.uiConfig,x=b.baseConfig,k=b.quoteConfig,w=this.quoteFeeUI,C=this.baseFeeUI;e.baseAlloc.textContent=qe.formatFullPrecision(n[o],c);var S=n[o]/h*g,F=S;if(e.baseAllocUSD.textContent=qe.formatFourSigFigs(S),e.baseBookAlloc.textContent=qe.formatFullPrecision(a.book*h,c),e.baseOrderReservesAlloc.textContent=qe.formatFullPrecision(a.orderReserves*h,c),e.baseOrderReservesPct.textContent=String(Math.round(100*x.orderReservesFactor)),qe.setVis(i,e.baseCexAllocBox),i&&(e.baseCexAlloc.textContent=qe.formatFullPrecision(a.cex*h,c)),qe.setVis(u===o,e.baseBookingFeesAllocBox),qe.setVis(u!==o,e.baseTokenFeesAllocBox),u===o){var D=o===d?a.bookingFees+r.bookingFees:a.bookingFees;e.baseBookingFeesAlloc.textContent=qe.formatFullPrecision(D*f,C)}else{var T=n[u];e.baseTokenFeeAlloc.textContent=qe.formatFullPrecision(T,C);var I=T/f*pt().fiatRatesMap[u];F+=I,e.baseTokenAllocUSD.textContent=qe.formatFourSigFigs(I);var A=u===d,R=a.bookingFees+(A?r.bookingFees:0);e.baseTokenBookingFees.textContent=qe.formatFullPrecision(R*f,C),e.baseTokenSwapFeeN.textContent=String(x.swapFeeN+(A?k.swapFeeN:0));var E=a.swapFeeReserves+(A?r.swapFeeReserves:0);e.baseTokenSwapFees.textContent=qe.formatFullPrecision(E*f,C)}e.quoteAlloc.textContent=qe.formatFullPrecision(n[s],l);var B=n[s]/p*y;if(F+=B,e.quoteAllocUSD.textContent=qe.formatFourSigFigs(B),e.quoteBookAlloc.textContent=qe.formatFullPrecision(r.book*p,l),e.quoteOrderReservesAlloc.textContent=qe.formatFullPrecision(r.orderReserves*p,l),e.quoteOrderReservesPct.textContent=String(Math.round(100*k.orderReservesFactor)),e.quoteSlippageAlloc.textContent=qe.formatFullPrecision(r.slippageBuffer*p,l),e.slippageBufferFactor.textContent=String(Math.round(100*k.slippageBufferFactor)),qe.setVis(i,e.quoteCexAllocBox),i&&(e.quoteCexAlloc.textContent=qe.formatFullPrecision(r.cex*p,l)),qe.setVis(s===d,e.quoteBookingFeesAllocBox),qe.setVis(d!==s&&d!==u,e.quoteTokenFeesAllocBox),s===d){var P=s===u?a.bookingFees+r.bookingFees:r.bookingFees;e.quoteBookingFeesAlloc.textContent=qe.formatFullPrecision(P*v,w)}else if(d!==u){e.quoteTokenFeeAlloc.textContent=qe.formatFullPrecision(n[d],w);var L=n[d]/v*pt().fiatRatesMap[d];F+=L,e.quoteTokenAllocUSD.textContent=qe.formatFourSigFigs(L),e.quoteTokenBookingFees.textContent=qe.formatFullPrecision(r.bookingFees*v,w),e.quoteTokenSwapFeeN.textContent=String(k.swapFeeN),e.quoteTokenSwapFees.textContent=qe.formatFullPrecision(r.swapFeeReserves*v,w)}e.totalAllocUSD.textContent=qe.formatFourSigFigs(F)}},{key:"allocate",value:function(){var e,t,n,o,s,i=this,c=this.fundingState(),l=this.page,u=this.marketReport,d=u.baseFiatRate,p=u.quoteFiatRate,f=this.baseID,v=this.quoteID,m=this.baseFeeID,g=this.quoteFeeID,y=this.baseFeeFiatRate,b=this.quoteFeeFiatRate,x=this.cexName,k=this.baseFactor,w=this.quoteFactor,C=this.baseFeeFactor,S=this.quoteFeeFactor,F=this.host,D=this.mktID,T=a(Po(c.base),3),I=T[0],A=T[1],R=T[2],E=a(Po(c.quote),3),B=E[0],P=E[1],L=E[2],O=this.alloc={dex:(e={},h(e,f,I*k),h(e,v,B*w),e),cex:(t={},h(t,f,A*k),h(t,v,P*w),t)};O.dex[m]=Math.min((null!==(n=O.dex[m])&&void 0!==n?n:0)+c.base.fees.req*C,c.base.fees.avail*C),O.dex[g]=Math.min((null!==(o=O.dex[g])&&void 0!==o?o:0)+c.quote.fees.req*S,c.quote.fees.avail*S);var M=O.dex[f]/k*d+O.dex[v]/w*p;M+=O.cex[f]/k*d+O.cex[v]/w*p,m!==f&&(M+=O.dex[m]/C*y),g!==v&&g!==m&&(M+=O.dex[g]/S*b),l.allocUSD.textContent=qe.formatFourSigFigs(M),qe.setVis.apply(qe,[x].concat(r(qe.applySelector(l.allocationDialog,"[data-cex-only]")))),qe.setVis(c.fundedAndBalanced,l.fundedAndBalancedBox),qe.setVis(c.base.transferable+c.quote.transferable>0,l.hasTransferable),qe.setVis(c.fundedAndNotBalanced,l.fundedAndNotBalancedBox),qe.setVis(c.starved,l.starvedBox),l.startBttn.classList.toggle("go",c.fundedAndBalanced),l.startBttn.classList.toggle("warning",!c.fundedAndBalanced),l.proposedDexBaseAlloc.classList.toggle("text-warning",!(c.base.fundedAndBalanced||c.base.fundedAndNotBalanced)),l.proposedDexQuoteAlloc.classList.toggle("text-warning",!(c.quote.fundedAndBalanced||c.quote.fundedAndNotBalanced));var q=function(e,t){l.proposedDexBaseAlloc.textContent=qe.formatFourSigFigs(e),l.proposedDexBaseAllocUSD.textContent=qe.formatFourSigFigs(e*d),l.proposedCexBaseAlloc.textContent=qe.formatFourSigFigs(t),l.proposedCexBaseAllocUSD.textContent=qe.formatFourSigFigs(t*d)};if(q(I,A),qe.setVis(R,l.baseAllocSlider),R){var N=R.right.dex-R.left.dex,W=R.right.cex-R.left.cex;this.baseAllocSlider.setValue(.5),this.baseAllocSlider.changed=function(e){var t=R.left.dex+e*N,n=R.left.cex+e*W;O.dex[f]=t*k,O.cex[f]=n*k,q(t,n)}}var V=function(e,t){l.proposedDexQuoteAlloc.textContent=qe.formatFourSigFigs(e),l.proposedDexQuoteAllocUSD.textContent=qe.formatFourSigFigs(e*p),l.proposedCexQuoteAlloc.textContent=qe.formatFourSigFigs(t),l.proposedCexQuoteAllocUSD.textContent=qe.formatFourSigFigs(t*p)};if(V(B,P),qe.setVis(L,l.quoteAllocSlider),L){var U=L.right.dex-L.left.dex,_=L.right.cex-L.left.cex;this.quoteAllocSlider.setValue(.5),this.quoteAllocSlider.changed=function(e){var t=L.left.dex+e*U,n=L.left.cex+e*_;O.dex[v]=t*w,O.cex[v]=n*w,V(t,n)}}if(qe.setVis.apply(qe,[m!==f].concat(r(qe.applySelector(l.allocationDialog,"[data-base-token-fees]")))),m!==f){var j=c.base.fees.req+(m===g?c.quote.fees.req:0),H=Math.min(j,c.base.fees.avail);l.proposedDexBaseFeeAlloc.textContent=qe.formatFourSigFigs(H),l.proposedDexBaseFeeAllocUSD.textContent=qe.formatFourSigFigs(H*y),l.proposedDexBaseFeeAlloc.classList.toggle("text-warning",!c.base.fees.funded)}var z=g!==v&&g!==m;if(qe.setVis.apply(qe,[z].concat(r(qe.applySelector(l.allocationDialog,"[data-quote-token-fees]")))),z){var G=Math.min(c.quote.fees.req,c.quote.fees.avail);l.proposedDexQuoteFeeAlloc.textContent=qe.formatFourSigFigs(G),l.proposedDexQuoteFeeAllocUSD.textContent=qe.formatFourSigFigs(G*b),l.proposedDexQuoteFeeAlloc.classList.toggle("text-warning",!c.quote.fees.funded)}var X=null===(s=pt().exchanges[F])||void 0===s?void 0:s.markets[D],K=!1;if(X&&X.orders)for(var Q=0;Q<X.orders.length;Q++)if(X.orders[Q].status<=At){K=!0;break}qe.setVis(K,l.existingOrdersBox),qe.show(l.allocationDialog),qe.bind(document,"click",(function e(t){qe.mouseInElement(t,l.allocationDialog)||(i.hideAllocationDialog(),qe.unbind(document,"click",e))}))}},{key:"hideAllocationDialog",value:function(){qe.hide(this.page.allocationDialog)}},{key:"start",value:(t=s(f().mark((function e(){var t,n,r,o,s,i,c,l,u,d,h,p,v,m,g,y,b,x;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.page,r=this.alloc,o=this.baseID,s=this.quoteID,i=this.host,c=this.cexName,l=this.cfg.uiConfig.cexRebalance,qe.hide(n.errMsg),!c||null!==(t=pt().mmStatus.cexes[c])&&void 0!==t&&t.connected){e.next=6;break}return n.errMsg.textContent="".concat(c," not connected"),qe.show(n.errMsg),e.abrupt("return");case 6:for(u=0,d=[r.dex,r.cex];u<d.length;u++)for(h=d[u],p=0,v=Object.entries(h);p<v.length;p++)m=a(v[p],2),g=m[0],y=m[1],h[parseInt(g)]=Math.round(y);return b={baseID:o,quoteID:s,host:i,alloc:r},c&&l&&(b.autoRebalance=this.autoRebalanceSettings()),e.prev=9,pt().log("mm","starting mm bot",b),e.next=13,sr.startBot(b);case 13:if(x=e.sent,pt().checkResponse(x)){e.next=16;break}throw x;case 16:e.next=23;break;case 18:return e.prev=18,e.t0=e.catch(9),n.errMsg.textContent=xe(H,e.t0),qe.show(n.errMsg),e.abrupt("return");case 23:this.hideAllocationDialog();case 24:case"end":return e.stop()}}),e,this,[[9,18]])}))),function(){return t.apply(this,arguments)})},{key:"autoRebalanceSettings",value:function(){var e=this.proj,t=e.bProj,n=e.qProj,r=e.alloc,a=this.baseFeeID,o=this.quoteFeeID,s=this.cfg.uiConfig,i=s.baseConfig,c=s.quoteConfig,l=this.baseID,u=this.quoteID,d=this.cexName,h=this.mktID,p=r[l],f=t.book;l===a&&(f+=t.bookingFees),l===o&&(f+=n.bookingFees);var v=n.book;u===o&&(v+=n.bookingFees),u===a&&(v+=t.bookingFees);var m=Math.max(p-f,p-t.cex),g=r[u],y=Math.max(g-v,g-n.cex);if(m<0||y<0)throw Error("rebalance math doesn't work: ".concat(JSON.stringify({bProj:t,qProj:n,maxBase:m,maxQuote:y})));var b=pt().mmStatus.cexes[d].markets[h],x=[b.baseMinWithdraw,Math.max(2*b.baseMinWithdraw,m)],k=x[0],w=x[1],C=Math.round(k+i.transferFactor*(w-k)),S=[b.quoteMinWithdraw,Math.max(2*b.quoteMinWithdraw,y)],F=S[0],D=S[1];return{minBaseTransfer:C,minQuoteTransfer:Math.round(F+c.transferFactor*(D-F))}}},{key:"reconfigure",value:function(){var e=this.host,t=this.baseID,n=this.quoteID,r=this.cexName,a=this.botType;pt().loadPage("mmsettings",{host:e,baseID:t,quoteID:n,cexName:r,botType:a})}},{key:"handleEpochReportNote",value:function(e){this.runDisplay.handleEpochReportNote(e)}},{key:"handleCexProblemsNote",value:function(e){this.runDisplay.handleCexProblemsNote(e)}},{key:"handleRunStats",value:function(){this.updateDisplay(),this.updateTableRow(),this.runDisplay.readBook()}}]),c}(mr);function Mo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mo(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function No(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Wo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wo(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function Wo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Vo="lastMMSpecs",Uo="lastBots",_o="lastArbExchange",jo="arbmm",Ho=.001,zo=.099,Go=.001,Xo=.0199,Ko={gapStrategy:tr,sellPlacements:[],buyPlacements:[],driftTolerance:.002,profit:.02,orderPersistence:20,cexRebalance:!0,simpleArbLots:1},Qo={swapFeeN:50,orderReservesFactor:1,slippageBufferFactor:.05,transferFactor:.1},Yo=function(e){g(T,e);var t,n,o,l,u,p,m,x,w,C,S,F,D=(S=T,F=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(S);if(F){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return y(this,e)});function T(e,t){var n;i(this,T),h(v(n=D.call(this)),"page",void 0),h(v(n),"forms",void 0),h(v(n),"opts",void 0),h(v(n),"newWalletForm",void 0),h(v(n),"approveTokenForm",void 0),h(v(n),"walletAddrForm",void 0),h(v(n),"cexConfigForm",void 0),h(v(n),"currentMarket",void 0),h(v(n),"originalConfig",void 0),h(v(n),"updatedConfig",void 0),h(v(n),"creatingNewBot",void 0),h(v(n),"marketReport",void 0),h(v(n),"qcProfit",void 0),h(v(n),"qcProfitSlider",void 0),h(v(n),"qcLevelSpacing",void 0),h(v(n),"qcLevelSpacingSlider",void 0),h(v(n),"qcMatchBuffer",void 0),h(v(n),"qcMatchBufferSlider",void 0),h(v(n),"qcLevelsPerSide",void 0),h(v(n),"qcLotsPerLevel",void 0),h(v(n),"qcUSDPerSide",void 0),h(v(n),"cexBaseBalance",void 0),h(v(n),"cexQuoteBalance",void 0),h(v(n),"specs",void 0),h(v(n),"mktID",void 0),h(v(n),"formSpecs",void 0),h(v(n),"formCexes",void 0),h(v(n),"placementsCache",void 0),h(v(n),"botTypeSelectors",void 0),h(v(n),"marketRows",void 0),h(v(n),"lotsPerLevelIncrement",void 0),h(v(n),"placementsChart",void 0),h(v(n),"basePane",void 0),h(v(n),"quotePane",void 0),h(v(n),"driftTolerance",void 0),h(v(n),"driftToleranceSlider",void 0),h(v(n),"orderPersistence",void 0),h(v(n),"orderPersistenceSlider",void 0),n.placementsCache={},n.opts={};var r=n.page=qe.idDescendants(e);n.forms=new Fr(r.forms,{closed:function(){var e,t;null!==(e=n.specs)&&void 0!==e&&e.host&&null!==(t=n.specs)&&void 0!==t&&t.botType||pt().loadPage("mm")}}),n.placementsChart=new dr(r.placementsChart),n.approveTokenForm=new Wr(r.approveTokenForm,(function(){n.submitBotType()})),n.walletAddrForm=new Mr(r.walletAddrForm),n.cexConfigForm=new Vr(r.cexConfigForm,(function(e){return n.cexConfigured(e)})),r.quotePane=r.basePane.cloneNode(!0),r.assetPaneBox.appendChild(r.quotePane),n.basePane=new es(v(n),r.basePane),n.quotePane=new es(v(n),r.quotePane),pt().headerSpace.appendChild(r.mmTitle),vt(r),qe.cleanTemplates(r.orderOptTmpl,r.booleanOptTmpl,r.rangeOptTmpl,r.placementRowTmpl,r.oracleTmpl,r.cexOptTmpl,r.arbBttnTmpl,r.marketRowTmpl,r.needRegTmpl),r.basePane.removeAttribute("id"),qe.bind(r.resetButton,"click",(function(){n.setOriginalValues()})),qe.bind(r.updateButton,"click",(function(){n.saveSettings()})),qe.bind(r.createButton,"click",s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.saveSettings();case 1:case"end":return e.stop()}}),e)})))),qe.bind(r.deleteBttn,"click",(function(){n.delete()})),zr(r.botTypeForm,r.botTypeSubmit,(function(){n.submitBotType()})),qe.bind(r.noMarketBttn,"click",(function(){n.showMarketSelectForm()})),qe.bind(r.botTypeHeader,"click",(function(){n.reshowBotTypeForm()})),qe.bind(r.botTypeChangeMarket,"click",(function(){n.showMarketSelectForm()})),qe.bind(r.marketHeader,"click",(function(){n.showMarketSelectForm()})),qe.bind(r.marketFilterInput,"input",(function(){n.sortMarketRows()})),qe.bind(r.cexRebalanceCheckbox,"change",(function(){n.autoRebalanceChanged()})),qe.bind(r.switchToAdvanced,"click",(function(){n.showAdvancedConfig()})),qe.bind(r.switchToQuickConfig,"click",(function(){n.switchToQuickConfig()})),qe.bind(r.qcMatchBuffer,"change",(function(){n.matchBufferChanged()})),qe.bind(r.switchToUSDPerSide,"click",(function(){n.changeSideCommitmentDialog()})),qe.bind(r.switchToLotsPerLevel,"click",(function(){n.changeSideCommitmentDialog()})),qe.bind(r.gapStrategySelect,"change",(function(){if(r.gapStrategySelect.value){var e=r.gapStrategySelect.value;n.clearPlacements(n.updatedConfig.gapStrategy),n.loadCachedPlacements(e),n.updatedConfig.gapStrategy=e,n.setGapFactorLabels(e),n.updateModifiedMarkers()}})),qe.bind(r.addBuyPlacementBtn,"click",(function(){n.addPlacement(!0,null),r.addBuyPlacementLots.value="",r.addBuyPlacementGapFactor.value="",n.updateModifiedMarkers(),n.placementsChart.render(),n.updateAllocations()})),qe.bind(r.addSellPlacementBtn,"click",(function(){n.addPlacement(!1,null),r.addSellPlacementLots.value="",r.addSellPlacementGapFactor.value="",n.updateModifiedMarkers(),n.placementsChart.render(),n.updateAllocations()})),n.driftTolerance=new Qe(r.driftToleranceInput,{prec:3,sigFigs:!0,min:0,changed:function(e){var t=a($e(e/100,5),1)[0];n.driftToleranceSlider.setValue((t-0)/.02),n.updatedConfig.driftTolerance=t}}),n.driftToleranceSlider=new Je(r.driftToleranceSlider,(function(e){var t=a($e(0+.02*e,5),1)[0];n.updatedConfig.driftTolerance=t,n.driftTolerance.setValue(100*t)})),n.orderPersistence=new Qe(r.orderPersistence,{changed:function(e){n.updatedConfig.orderPersistence=e,n.orderPersistenceSlider.setValue((e-0)/40)}}),n.orderPersistenceSlider=new Je(r.orderPersistenceSlider,(function(e){var t=a(Ze(0+40*e,0),1)[0];n.updatedConfig.orderPersistence=t,n.orderPersistence.setValue(t)})),n.qcProfit=new Qe(r.qcProfit,{prec:1,sigFigs:!0,min:.1,changed:function(e){var t=e/100;n.updatedConfig.profit=t,r.profitInput.value=n.qcProfit.input.value,n.qcProfitSlider.setValue((t-.001)/.099),n.quickConfigUpdated()}}),n.qcProfitSlider=new Je(r.qcProfitSlider,(function(e){var t=a($e(100*(Ho+e*zo),3),1)[0];n.updatedConfig.profit=t/100,n.qcProfit.setValue(t),r.profitInput.value=n.qcProfit.input.value,n.quickConfigUpdated()})),n.qcLevelSpacing=new Qe(r.qcLevelSpacing,{prec:1,sigFigs:!0,min:.1,changed:function(e){n.qcLevelSpacingSlider.setValue((e/100-.001)/.0199),n.quickConfigUpdated()}}),n.qcLevelSpacingSlider=new Je(r.qcLevelSpacingSlider,(function(e){n.qcLevelSpacing.setValue(.001+.0199*e*100),n.quickConfigUpdated()})),n.qcMatchBuffer=new Qe(r.qcMatchBuffer,{prec:1,sigFigs:!0,min:0,changed:function(e){n.qcMatchBufferSlider.setValue((e/100-0)/1),n.quickConfigUpdated()}}),n.qcMatchBufferSlider=new Je(r.qcMatchBufferSlider,(function(e){n.qcMatchBuffer.setValue(0+1*e*100),n.quickConfigUpdated()})),n.qcLevelsPerSide=new Ye(r.qcLevelsPerSide,{prec:0,min:1,inc:1,changed:function(e){n.qcUSDPerSide.setValue(n.lotSizeUSD()*e*n.qcLotsPerLevel.value()),n.quickConfigUpdated()}}),n.qcLotsPerLevel=new Ye(r.qcLotsPerLevel,{prec:0,min:1,inc:1,changed:function(e){n.qcUSDPerSide.setValue(n.lotSizeUSD()*e*n.qcLevelsPerSide.value()),r.qcUSDPerSideEcho.textContent=n.qcUSDPerSide.input.value,n.quickConfigUpdated()},set:function(e){var t=a($e(e*n.qcLevelsPerSide.value()*n.lotSizeUSD(),2),2)[1];r.qcUSDPerSideEcho.textContent=t,r.qcLotsPerLevelEcho.textContent=t}}),n.qcUSDPerSide=new Ye(r.qcUSDPerSide,{prec:2,min:1,inc:1,changed:function(e){n.qcLotsPerLevel.setValue(e/n.qcLevelsPerSide.value()/n.lotSizeUSD()),r.qcLotsPerLevelEcho.textContent=n.qcLotsPerLevel.input.value,n.quickConfigUpdated()},set:function(e,t){r.qcUSDPerSideEcho.textContent=t,r.qcLotsPerLevelEcho.textContent=String(Math.round(e/n.lotSizeUSD()))}});var o=function(e){"Enter"===e.key&&(isNaN(parseFloat(r.addBuyPlacementGapFactor.value||""))||isNaN(parseFloat(r.addBuyPlacementLots.value||""))||r.addBuyPlacementBtn.click())};qe.bind(r.addBuyPlacementGapFactor,"keyup",(function(e){o(e)})),qe.bind(r.addBuyPlacementLots,"keyup",(function(e){o(e)}));var c=function(e){"Enter"===e.key&&(isNaN(parseFloat(r.addSellPlacementGapFactor.value||""))||isNaN(parseFloat(r.addSellPlacementLots.value||""))||r.addSellPlacementBtn.click())};qe.bind(r.addSellPlacementGapFactor,"keyup",(function(e){c(e)})),qe.bind(r.addSellPlacementLots,"keyup",(function(e){c(e)})),qe.bind(r.profitInput,"change",(function(){qe.hide(r.profitInputErr);var e=function(e){qe.show(r.profitInputErr),r.profitInputErr.textContent=xe(e)},t=parseFloat(r.profitInput.value||"")/100;return isNaN(t)?e(ue):0===t?e(de):(n.updatedConfig.profit=t,void n.updateModifiedMarkers())})),n.botTypeSelectors=qe.applySelector(r.botTypeForm,"[data-bot-type]");var l,u=No(n.botTypeSelectors);try{var d=function(){var e=l.value;qe.bind(e,"click",(function(){e.classList.contains("disabled")||(qe.hide(r.botTypeErr),r.cexSelection.classList.toggle("disabled",e.dataset.botType===nr),n.setBotTypeSelected(e.dataset.botType))}))};for(u.s();!(l=u.n()).done;)d()}catch(e){u.e(e)}finally{u.f()}return n.newWalletForm=new Dr(r.newWalletForm,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pt().fetchUser();case 2:n.submitBotType();case 3:case"end":return e.stop()}}),e)})))),pt().registerNoteFeeder({balance:function(e){n.handleBalanceNote(e)}}),n.initialize(t),n}return d(T,[{key:"unload",value:function(){this.forms.exit()}},{key:"initialize",value:(C=s(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setupCEXes(),this.initializeMarketRows(),t&&0===Object.keys(t).length&&(t=k.fetchLocal(Vo)),t&&pt().walletMap[t.baseID]&&pt().walletMap[t.quoteID]){e.next=7;break}return this.showMarketSelectForm(),e.abrupt("return");case 7:return t&&!t.botType&&(r=pr(t.host,t.baseID,t.quoteID),t.cexName=null!==(n=null==r?void 0:r.cexName)&&void 0!==n?n:"",t.botType=nr,null!=r&&r.arbMarketMakingConfig?t.botType=rr:null!=r&&r.simpleArbConfig&&(t.botType=ar)),this.specs=t,e.next=11,this.fetchCEXBalances(t);case 11:this.configureUI();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"configureUI",value:(w=s(f().mark((function e(){var t,n,o,s,i,c,l,u,d,h,p,v,m,g,y,b,x,w,C,S,F,D,T,I,A,R,E,B,P,L,O,M,q,N,W,V,U,_,j,H,z;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=this.page,l=this.specs,u=l.host,d=l.baseID,h=l.quoteID,p=l.cexName,v=l.botType,m=[pt().assets[d],pt().assets[h]],y=(g=m[0]).symbol,b=g.token,w=(x=m[1]).symbol,C=x.token,this.mktID="".concat(y,"_").concat(w),qe.hide(c.botSettingsContainer,c.marketBox,c.updateButton,c.resetButton,c.createButton,c.noMarket,c.missingFiatRates),![d,h,null!==(t=null==b?void 0:b.parentID)&&void 0!==t?t:d,null!==(n=null==C?void 0:C.parentID)&&void 0!==n?n:h].some((function(e){return!pt().fiatRatesMap[e]}))){e.next=8;break}return qe.show(c.missingFiatRates),e.abrupt("return");case 8:if(qe.show(c.marketLoading),k.storeLocal(Vo,l),S=pt().mmStatus,F=Jo(l,S),(D=pr(u,d,h))&&(D.arbMarketMakingConfig?rr:D.basicMarketMakingConfig?nr:ar)!==v&&(D=void 0),qe.setVis(D,c.deleteBttnBox),T=this.originalConfig=Object.assign({},Ko,{disabled:F,baseOptions:this.defaultWalletOptions(d),quoteOptions:this.defaultWalletOptions(h),buyPlacements:[],sellPlacements:[],baseConfig:Object.assign({},Qo),quoteConfig:Object.assign({},Qo)}),D){for(A=(I=D).basicMarketMakingConfig,R=I.arbMarketMakingConfig,E=I.simpleArbConfig,B=I.uiConfig.cexRebalance,this.creatingNewBot=!1,P=T,L=0,O=Object.entries(D);L<O.length;L++)M=a(O[L],2),q=M[0],N=M[1],void 0!==P[q]&&(P[q]=N);T.baseConfig=Object.assign({},Qo,D.uiConfig.baseConfig),T.quoteConfig=Object.assign({},Qo,D.uiConfig.quoteConfig),T.baseOptions=D.baseWalletOptions||{},T.quoteOptions=D.quoteWalletOptions||{},T.cexRebalance=B,A?(T.buyPlacements=A.buyPlacements,T.sellPlacements=A.sellPlacements,T.driftTolerance=A.driftTolerance,T.gapStrategy=A.gapStrategy):R?(W=R.buyPlacements,V=R.sellPlacements,T.buyPlacements=Array.from(W,(function(e){return{lots:e.lots,gapFactor:e.multiplier}})),T.sellPlacements=Array.from(V,(function(e){return{lots:e.lots,gapFactor:e.multiplier}})),T.profit=R.profit,T.driftTolerance=R.driftTolerance,T.orderPersistence=R.orderPersistence):E&&(T.profit=E.profitTrigger,T.orderPersistence=E.numEpochsLeaveOpen,T.simpleArbLots=null!==(U=D.uiConfig.simpleArbLots)&&void 0!==U?U:1),qe.setVis(!F,c.updateButton,c.resetButton)}else this.creatingNewBot=!0,qe.setVis(!F,c.createButton);this.updatedConfig=JSON.parse(JSON.stringify(T)),e.t0=v,e.next=e.t0===nr?21:e.t0===rr?23:e.t0===ar?25:26;break;case 21:return c.botTypeDisplay.textContent=xe(he),e.abrupt("break",26);case 23:return c.botTypeDisplay.textContent=xe(pe),e.abrupt("break",26);case 25:c.botTypeDisplay.textContent=xe(fe);case 26:return cr(document.body,d,h,u),qe.setVis(v!==ar,c.driftToleranceBox,c.switchToAdvanced),qe.setVis.apply(qe,[Boolean(p)].concat(r(qe.applySelector(document.body,"[data-cex-show]")))),qe.setVis(F,c.viewOnlyRunning),qe.setVis(p,c.cexRebalanceSettings),p&&lr(document.body,p),e.next=34,this.fetchMarketReport();case 34:_=this.lotSizeUSD(),this.lotsPerLevelIncrement=Math.round(Math.max(1,100/_)),this.qcLotsPerLevel.inc=this.lotsPerLevelIncrement,this.qcUSDPerSide.inc=this.lotsPerLevelIncrement*_,this.qcUSDPerSide.min=_,this.basePane.setAsset(d,!1),this.quotePane.setAsset(h,!0),j=this.marketReport.baseFiatRate,this.placementsChart.setMarket({cexName:p,botType:v,baseFiatRate:j,dict:this.updatedConfig}),H=!D||this.isQuickPlacements(this.updatedConfig.buyPlacements,this.updatedConfig.sellPlacements),z=null!==(o=null===(s=D)||void 0===s||null===(i=s.basicMarketMakingConfig)||void 0===i?void 0:i.gapStrategy)&&void 0!==o?o:tr,c.gapStrategySelect.value=z,v===ar||H&&z===tr?this.showQuickConfig():this.showAdvancedConfig(),this.setOriginalValues(),qe.hide(c.marketLoading),qe.show(c.botSettingsContainer,c.marketBox);case 50:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"initializeMarketRows",value:function(){var e=this;this.marketRows=[],qe.empty(this.page.marketSelect);for(var t=function(){var t=r[n],o=t.host,s=t.markets,i=t.assets,c=t.auth;if(c.effectiveTier+c.pendingStrength===0){var l=e.page,u=l.needRegTmpl,d=l.needRegBox,h=u.cloneNode(!0),p=qe.parseTemplate(h);return qe.bind(h,"click",(function(){pt().loadPage("register",{host:o,backTo:"mmsettings"})})),p.host.textContent=o,d.appendChild(h),qe.show(d),"continue"}for(var f=function(){var t=m[v],n=t.name,r=t.baseid,s=t.quoteid,c=t.spot,l=t.basesymbol,u=t.quotesymbol;if(!pt().assets[r]||!pt().assets[s])return"continue";var d=e.page.marketRowTmpl.cloneNode(!0),h=qe.parseTemplate(d),p={tr:d,tmpl:h,host:o,name:n,baseID:r,quoteID:s,spot:c,arbs:[]};e.marketRows.push(p),e.page.marketSelect.appendChild(d),h.baseIcon.src=qe.logoPath(l),h.quoteIcon.src=qe.logoPath(u),h.baseSymbol.appendChild(qe.symbolize(i[r],!0)),h.quoteSymbol.appendChild(qe.symbolize(i[s],!0)),h.host.textContent=o;for(var f=e.cexMarketSupportFilter(r,s),g=0,y=Object.entries(or);g<y.length;g++){var b=a(y[g],2),x=b[0],k=b[1];if(f(x)){var w=e.page.arbBttnTmpl.cloneNode(!0);w.src=k.logo,h.arbs.appendChild(w),p.arbs.push(x)}}qe.bind(d,"click",(function(){e.showBotTypeForm(o,r,s)}))},v=0,m=Object.values(s);v<m.length;v++)f()},n=0,r=Object.values(pt().exchanges);n<r.length;n++)t();if(0===this.marketRows.length){var o=this.page,s=o.marketSelectionTable,i=o.marketFilterBox,c=o.noMarkets;qe.hide(s,i),qe.show(c)}else qe.hide(this.page.noMarkets);var l=pt().fiatRatesMap;this.marketRows.sort((function(e,t){var n,r,a,o,s=null!==(n=null===(r=e.spot)||void 0===r?void 0:r.vol24)&&void 0!==n?n:0,i=null!==(a=null===(o=t.spot)||void 0===o?void 0:o.vol24)&&void 0!==a?a:0;return l[e.baseID]&&l[t.baseID]&&(s*=l[e.baseID],i*=l[t.baseID]),i-s}))}},{key:"runningBotInventory",value:function(e){return ir(e)}},{key:"adjustedBalances",value:function(e,t){var n=this.cexBaseBalance,r=this.cexQuoteBalance,a=[this.runningBotInventory(e.assetID),this.runningBotInventory(t.assetID)],o=a[0],s=a[1],i=((null==n?void 0:n.available)||0)-o.cex.total,c=((null==r?void 0:r.available)||0)-s.cex.total,l=e.balance.available-o.dex.total,u=t.balance.available-s.dex.total;return{baseAvail:l+i,quoteAvail:u+c,dexBaseAvail:l,dexQuoteAvail:u,cexBaseAvail:i,cexQuoteAvail:c}}},{key:"lotSizeUSD",value:function(){var e=this.specs,t=e.host,n=e.baseID,r=this.mktID,a=this.marketReport.baseFiatRate;return pt().exchanges[t].markets[r].lotsize/pt().assets[n].unitInfo.conventional.conversionFactor*a}},{key:"marketStuff",value:function(){var e=this.page,t=this.specs,n=t.host,r=t.baseID,a=t.quoteID,o=t.cexName,s=t.botType,i=this.basePane,c=this.quotePane,l=this.marketReport,u=l.baseFiatRate,d=l.quoteFiatRate,h=l.baseFees,p=l.quoteFees,f=this.lotsPerLevelIncrement,v=this.updatedConfig,m=this.originalConfig,g=this.mktID,y=pt().assets[r],b=y.symbol,x=y.unitInfo,k=pt().assets[a],w=k.symbol,C=k.unitInfo,S=pt().exchanges[n],F=S.markets[g],D=F.lotsize,T=F.spot,I=D/x.conventional.conversionFactor*u,A=1/x.conventional.conversionFactor*u/d*C.conventional.conversionFactor,R={conv:d/u,atomic:A,msg:Math.round(A*qt),spot:T},E=[v.simpleArbLots,v.simpleArbLots],B=E[0],P=E[1];s!==ar&&(B=this.updatedConfig.sellPlacements.reduce((function(e,t){return e+t.lots}),0),P=this.updatedConfig.buyPlacements.reduce((function(e,t){return e+t.lots}),0));var L=ur(D,r,a,T),O=this.walletStuff(),M=xr(r,a,h,p,D,B,P,O.baseFeeAssetID,O.quoteFeeAssetID,O.baseIsAccountLocker,O.quoteIsAccountLocker,v.baseConfig.orderReservesFactor,v.quoteConfig.orderReservesFactor);return qo({page:e,cfg:v,oldCfg:m,host:n,xc:S,baseID:r,quoteID:a,botType:s,cexName:o,baseFiatRate:u,quoteFiatRate:d,xcRate:R,baseSymbol:b,quoteSymbol:w,mktID:g,lotSize:D,lotSizeUSD:I,lotsPerLevelIncrement:f,quoteLot:L,commit:M.commit,basePane:i,quotePane:c,fees:M.fees},O)}},{key:"walletStuff",value:function(){var e=this.specs,t=e.baseID,n=e.quoteID,r=[pt().walletMap[t],pt().walletMap[n]],a=r[0],o=r[1],s=[pt().assets[t],pt().assets[n]],i=s[0],c=i.token,l=i.unitInfo,u=s[1],d=u.token,h=u.unitInfo,p=c?c.parentID:t,f=d?d.parentID:n,v=[pt().assets[p].unitInfo,pt().assets[f].unitInfo];return qo({baseWallet:a,quoteWallet:o,baseFeeUI:v[0],quoteFeeUI:v[1],baseToken:c,quoteToken:d,bui:l,qui:h,baseFeeAssetID:p,quoteFeeAssetID:f,baseIsAccountLocker:(16384&a.traits)>0,quoteIsAccountLocker:(16384&o.traits)>0},this.adjustedBalances(a,o))}},{key:"showAdvancedConfig",value:function(){var e=this.page;qe.show(e.advancedConfig),qe.hide(e.quickConfig),this.placementsChart.render()}},{key:"isQuickPlacements",value:function(e,t){if(0===e.length||e.length!==t.length)return!1;for(var n=0;n<e.length;n++){if(e[n].gapFactor!==t[n].gapFactor)return!1;if(e[n].lots!==t[n].lots)return!1}return!0}},{key:"switchToQuickConfig",value:function(){var e=this.marketStuff(),t=e.cfg,n=e.botType,r=e.lotSizeUSD,a=t.buyPlacements,o=t.sellPlacements;if(a.length>0&&o.length>0){var s=a.reduce((function(e,t){return t.gapFactor<e.gapFactor?t:e})),i=o.reduce((function(e,t){return t.gapFactor<e.gapFactor?t:e})),c=a.length+o.length,l=Math.max(1,Math.floor(c/2));if(n===nr){t.profit=(s.gapFactor+i.gapFactor)/2;var u=a.reduce((function(e,t){return t.gapFactor>e.gapFactor?t:e})),d=o.reduce((function(e,t){return t.gapFactor>e.gapFactor?t:e})),h=(u.gapFactor-s.gapFactor+(d.gapFactor-i.gapFactor))/2/(l-1);this.qcProfit.setValue(100*t.profit),this.qcProfitSlider.setValue((t.profit-Ho)/zo),this.qcLevelSpacing.setValue(100*h),this.qcLevelSpacingSlider.setValue((h-Go)/Xo)}else if(n===rr){var p=(a.reduce((function(e,t){return e+t.gapFactor}),0)+o.reduce((function(e,t){return e+t.gapFactor}),0))/c-1||0;this.qcMatchBuffer.setValue(100*p),this.qcMatchBufferSlider.setValue((p-0)/1)}var f=a.reduce((function(e,t){return e+t.lots}),0)+o.reduce((function(e,t){return e+t.lots}),0),v=Math.max(1,Math.round(f/2/l));this.qcLotsPerLevel.setValue(v),this.qcUSDPerSide.setValue(v*l*r),this.qcLevelsPerSide.setValue(l)}else n===ar&&this.qcLotsPerLevel.setValue(t.simpleArbLots);this.showQuickConfig(),this.quickConfigUpdated()}},{key:"showQuickConfig",value:function(){var e=this.marketStuff(),t=e.page,n=e.lotSizeUSD,r=e.botType,a=e.lotsPerLevelIncrement;this.qcLevelsPerSide.input.value||(this.qcLevelsPerSide.setValue(1),this.qcUSDPerSide.setValue(1*(this.qcLotsPerLevel.value()||a)*n)),this.qcLotsPerLevel.input.value||(this.qcLotsPerLevel.setValue(a),this.qcUSDPerSide.setValue(n*a*this.qcLevelsPerSide.value())),t.qcLevelSpacing.value||(this.qcLevelSpacing.setValue(.5),this.qcLevelSpacingSlider.setValue(.20100502512562812)),t.qcMatchBuffer.value||(t.qcMatchBuffer.value=String(0)),qe.hide(t.advancedConfig),qe.show(t.quickConfig),this.showInputsForBot(r)}},{key:"showInputsForBot",value:function(e){var t=this.page,n=this.opts.usingUSDPerSide;switch(qe.hide(t.matchMultiplierBox,t.placementsChartBox,t.placementChartLegend,t.lotsPerLevelLabel,t.levelSpacingBox,t.arbLotsLabel,t.qcLevelPerSideBox),qe.setVis(n,t.qcUSDPerSideBox),qe.setVis(!n,t.qcLotsBox),e){case rr:qe.show(t.qcLevelPerSideBox,t.matchMultiplierBox,t.placementsChartBox,t.placementChartLegend,t.lotsPerLevelLabel);break;case nr:qe.show(t.qcLevelPerSideBox,t.levelSpacingBox,t.placementsChartBox,t.lotsPerLevelLabel);break;case ar:qe.show(t.arbLotsLabel)}}},{key:"quickConfigUpdated",value:function(){var e,t,n,r=this.marketStuff(),a=r.page,o=r.cfg,s=r.botType,i=r.cexName;qe.hide(a.qcError);var c=function(e){a.qcError.textContent=e,qe.show(a.qcError)},l=s===ar?1:this.qcLevelsPerSide.value();isNaN(l)&&c("invalid value for levels per side");var u=this.qcLotsPerLevel.value();isNaN(u)&&c("invalid value for lots per level");var d=parseFloat(null!==(e=a.qcProfit.value)&&void 0!==e?e:"")/100;isNaN(d)&&c("invalid value for profit");var h=s===nr?parseFloat(null!==(t=a.qcLevelSpacing.value)&&void 0!==t?t:"")/100:0;isNaN(h)&&c("invalid value for level spacing");var p=s===rr?parseFloat(null!==(n=a.qcMatchBuffer.value)&&void 0!==n?n:"")/100:0;isNaN(p)&&c("invalid value for match buffer");var f=p+1,v=1===l;if(a.levelSpacingBox.classList.toggle("disabled",v),a.qcLevelSpacing.disabled=v,o.simpleArbLots=u,s!==ar){this.clearPlacements(i?jo:o.gapStrategy);for(var m=0;m<l;m++){var g={lots:u};g.gapFactor=s===nr?d+h*m:f,o.buyPlacements.push(g),o.sellPlacements.push(g),this.addPlacement(!0,g),this.addPlacement(!1,g)}this.placementsChart.render()}this.updateAllocations()}},{key:"updateAllocations",value:function(){this.updateBaseAllocations(),this.updateQuoteAllocations()}},{key:"updateBaseAllocations",value:function(){var e=this.marketStuff(),t=e.commit,n=e.lotSize,r=e.basePane,a=e.fees;r.updateInventory(t.dex.base.lots,t.dex.quote.lots,n,t.dex.base.val,t.cex.base.val,a.base),r.updateCommitTotal()}},{key:"updateQuoteAllocations",value:function(){var e=this.marketStuff(),t=e.commit,n=e.quoteLot,r=e.quotePane,a=e.fees;r.updateInventory(t.dex.quote.lots,t.dex.base.lots,n,t.dex.quote.val,t.cex.quote.val,a.quote),r.updateCommitTotal()}},{key:"matchBufferChanged",value:function(){var e,t=this.page;t.qcMatchBuffer.value=Math.max(0,parseFloat(null!==(e=t.qcMatchBuffer.value)&&void 0!==e?e:"")||0).toFixed(2),this.quickConfigUpdated()}},{key:"showAddress",value:function(e){this.walletAddrForm.setAsset(e),this.forms.show(this.page.walletAddrForm)}},{key:"changeSideCommitmentDialog",value:function(){var e=this.page,t=this.opts;t.usingUSDPerSide=!t.usingUSDPerSide,qe.setVis(t.usingUSDPerSide,e.qcUSDPerSideBox),qe.setVis(!t.usingUSDPerSide,e.qcLotsBox)}},{key:"showBotTypeForm",value:(x=s(f().mark((function e(t,n,r,a,o){var s,i,c,l,u,d,h,p,v,m,g,y,b,x,w,C,S,F,D,T,I,A,R,E,B,P,L,O;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.page,this.formSpecs={host:t,baseID:n,quoteID:r,botType:""},!Jo(this.formSpecs,pt().mmStatus)){e.next=21;break}i=pr(t,n,r),c=this.specs=this.formSpecs,e.t0=!0,e.next=e.t0===Boolean(null==i?void 0:i.simpleArbConfig)?9:e.t0===Boolean(null==i?void 0:i.arbMarketMakingConfig)?11:13;break;case 9:return c.botType=ar,e.abrupt("break",14);case 11:return c.botType=rr,e.abrupt("break",14);case 13:c.botType=nr;case 14:return c.cexName=null==i?void 0:i.cexName,e.next=17,this.fetchCEXBalances(this.formSpecs);case 17:return e.next=19,this.configureUI();case 19:return this.forms.close(),e.abrupt("return");case 21:cr(s.botTypeForm,n,r,t),qe.empty(s.botTypeBaseSymbol,s.botTypeQuoteSymbol),l=[pt().assets[n],pt().assets[r]],u=l[0],d=l[1],s.botTypeBaseSymbol.appendChild(qe.symbolize(u,!0)),s.botTypeQuoteSymbol.appendChild(qe.symbolize(d,!0)),h=No(this.botTypeSelectors);try{for(h.s();!(p=h.n()).done;)p.value.classList.remove("selected")}catch(e){h.e(e)}finally{h.f()}for(v=0,m=Object.values(this.formCexes);v<m.length;v++)m[v].div.classList.remove("selected");for(this.setCEXAvailability(n,r),qe.hide(s.noCexesConfigured,s.noCexMarket,s.noCexMarketConfigureMore,s.botTypeErr),g=this.cexMarketSupportFilter(n,r),y={},b=0,x=Object.values(pt().mmStatus.cexes);b<x.length;b++)w=x[b],g(w.config.name)&&(y[w.config.name]=w.config);C=Object.keys(y).length,S=C>0,F=No(this.botTypeSelectors);try{for(F.s();!(D=F.n()).done;)(T=D.value).classList.toggle("disabled",T.dataset.botType!==nr&&!S)}catch(e){F.e(e)}finally{F.f()}0===Object.keys(pt().mmStatus.cexes).length?(qe.show(s.noCexesConfigured),this.setBotTypeSelected(nr)):(A=k.fetchLocal(Uo)||{},R=A["".concat(n,"_").concat(r,"_").concat(t)],(a=null!==(I=a)&&void 0!==I?I:R?R.botType:rr)!==nr&&(o&&(E=y[o]),!E&&R&&(E=y[null!==(B=R.cexName)&&void 0!==B?B:""]),E||(P=k.fetchLocal(_o))&&(E=y[P]),!E&&C>0&&(E=Object.values(y)[0])),E?(s.cexSelection.classList.remove("disabled"),this.setBotTypeSelected(null!==(L=a)&&void 0!==L?L:R?R.botType:rr),this.selectFormCEX(E.name)):(s.cexSelection.classList.add("disabled"),qe.show(s.noCexMarket),this.setBotTypeSelected(nr),0===(O=Object.keys(or).filter((function(e){return!pt().mmStatus.cexes[e]}))).length||1===O.length&&("Binance"===O[0]||"BinanceUS"===O[0])||qe.show(s.noCexMarketConfigureMore))),qe.show(s.cexSelection),this.forms.show(s.botTypeForm);case 41:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,a){return x.apply(this,arguments)})},{key:"reshowBotTypeForm",value:function(){Jo(this.specs,pt().mmStatus)&&this.showMarketSelectForm();var e=this.specs,t=e.baseID,n=e.quoteID,r=e.host,a=e.cexName,o=e.botType;this.showBotTypeForm(r,t,n,o,a)}},{key:"setBotTypeSelected",value:function(e){var t,n=this.formSpecs,r=n.baseID,a=n.quoteID,o=n.host,s=this.botTypeSelectors,i=this.formCexes,c=No(s);try{for(c.s();!(t=c.n()).done;){var l=t.value,u=l.classList,d=l.dataset.botType;u.toggle("selected",d===e)}}catch(e){c.e(e)}finally{c.f()}if(e!==nr){var h=pt().mmStatus;if(0!==Object.keys(h.cexes).length){var p=this.cexMarketSupportFilter(r,a),f=Object.values(i).filter((function(e){return e.div.classList.contains("selected")}));if(!f.length||!p(f[0].name)){var v=(k.fetchLocal(Uo)||{})["".concat(r,"_").concat(a,"_").concat(o)];if(v){var m,g=h.cexes[null!==(m=v.cexName)&&void 0!==m?m:""];if(g&&p(g.config.name))return void this.selectFormCEX(g.config.name)}var y=k.fetchLocal(_o);if(y){var b=h.cexes[y];if(b&&p(b.config.name))return void this.selectFormCEX(b.config.name)}var x=Object.values(h.cexes).filter((function(e){return p(e.config.name)}));x.length&&this.selectFormCEX(x[0].config.name)}}}}},{key:"showMarketSelectForm",value:function(){this.page.marketFilterInput.value="",this.sortMarketRows(),this.forms.show(this.page.marketSelectForm)}},{key:"sortMarketRows",value:function(){var e,t=this.page,n=null===(e=t.marketFilterInput.value)||void 0===e?void 0:e.toLowerCase();qe.empty(t.marketSelect);var r,a=No(this.marketRows);try{for(a.s();!(r=a.n()).done;){var o=r.value;o.tr.classList.remove("selected"),n&&!o.name.includes(n)||t.marketSelect.appendChild(o.tr)}}catch(e){a.e(e)}finally{a.f()}}},{key:"handleBalanceNote",value:function(e){if(this.approveTokenForm.handleBalanceNote(e),this.marketReport){var t=this.marketStuff(),n=t.baseID,r=t.quoteID,a=t.quoteToken,o=t.baseToken;e.assetID===n||e.assetID===(null==o?void 0:o.parentID)?this.basePane.updateBalances():e.assetID!==r&&e.assetID!==(null==a?void 0:a.parentID)||this.quotePane.updateBalances()}}},{key:"autoRebalanceChanged",value:function(){var e,t,n=this.page;this.updatedConfig.cexRebalance=null!==(e=null===(t=n.cexRebalanceCheckbox)||void 0===t?void 0:t.checked)&&void 0!==e&&e,this.updateAllocations()}},{key:"submitBotType",value:(m=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=pt().loading(this.page.botTypeForm),e.prev=1,e.next=4,this.submitBotWithValidation();case 4:return e.prev=4,t(),e.finish(4);case 7:case"end":return e.stop()}}),e,this,[[1,,4,7]])}))),function(){return m.apply(this,arguments)})},{key:"submitBotWithValidation",value:(p=s(f().mark((function e(){var t,n,r,o,s,i,c,l,u,d,h,p,v,m,g;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.page,r=this.forms,o=this.formSpecs,s=o.baseID,i=o.quoteID,c=o.host,pt().walletMap[s]){e.next=5;break}return this.newWalletForm.setAsset(s),r.show(this.page.newWalletForm),e.abrupt("return");case 5:if(pt().walletMap[i]){e.next=9;break}return this.newWalletForm.setAsset(i),r.show(this.page.newWalletForm),e.abrupt("return");case 9:if(l=$o(c,pt().assets[s],pt().assets[i]),u=a(l,2),d=u[0],h=u[1],d!==ut.NotApproved){e.next=14;break}return this.approveTokenForm.setAsset(s,c),r.show(n.approveTokenForm),e.abrupt("return");case 14:if(h!==ut.NotApproved){e.next=18;break}return this.approveTokenForm.setAsset(i,c),r.show(n.approveTokenForm),e.abrupt("return");case 18:if(p=this.botTypeSelectors,!((v=p.filter((function(e){return e.classList.contains("selected")}))).length<1)){e.next=24;break}return n.botTypeErr.textContent=xe("NO_BOTTYPE"),qe.show(n.botTypeErr),e.abrupt("return");case 24:if((this.formSpecs.botType=null!==(t=v[0].dataset.botType)&&void 0!==t?t:"")===nr){e.next=35;break}if(!((m=Object.values(this.formCexes).filter((function(e){return e.div.classList.contains("selected")}))).length<1)){e.next=31;break}return n.botTypeErr.textContent=xe("NO_CEX"),qe.show(n.botTypeErr),e.abrupt("return");case 31:return g=m[0].name,this.formSpecs.cexName=g,e.next=35,this.fetchCEXBalances(this.formSpecs);case 35:this.specs=this.formSpecs,this.configureUI(),this.forms.close();case 38:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"fetchCEXBalances",value:(u=s(f().mark((function e(t){var n,r,a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.page,r=t.baseID,a=t.quoteID,o=t.cexName,t.botType!==nr&&o){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,sr.cexBalance(o,r);case 7:this.cexBaseBalance=e.sent,e.next=15;break;case 10:throw e.prev=10,e.t0=e.catch(4),n.botTypeErr.textContent=xe(ve,{cexName:o,assetID:String(r),err:String(e.t0)}),qe.show(n.botTypeErr),e.t0;case 15:return e.prev=15,e.next=18,sr.cexBalance(o,a);case 18:this.cexQuoteBalance=e.sent,e.next=26;break;case 21:throw e.prev=21,e.t1=e.catch(15),n.botTypeErr.textContent=xe(ve,{cexName:o,assetID:String(a),err:String(e.t1)}),qe.show(n.botTypeErr),e.t1;case 26:case"end":return e.stop()}}),e,this,[[4,10],[15,21]])}))),function(e){return u.apply(this,arguments)})},{key:"defaultWalletOptions",value:function(e){var t=pt().currentWalletDefinition(e);if(!t.multifundingopts)return{};var n,r={},a=No(t.multifundingopts);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.quoteAssetOnly&&e!==this.specs.quoteID||(r[o.key]="".concat(o.default))}}catch(e){a.e(e)}finally{a.f()}return r}},{key:"updateModifiedMarkers",value:function(){if(!this.creatingNewBot){var e=this.page,t=this.originalConfig,n=this.updatedConfig,r=t.gapStrategy!==n.gapStrategy;e.gapStrategySelect.classList.toggle("modified",r);var a=t.profit!==n.profit;e.profitInput.classList.toggle("modified",a);var o=!1;if(t.buyPlacements.length!==n.buyPlacements.length)o=!0;else for(var s=0;s<t.buyPlacements.length;s++)if(t.buyPlacements[s].lots!==n.buyPlacements[s].lots||t.buyPlacements[s].gapFactor!==n.buyPlacements[s].gapFactor){o=!0;break}e.buyPlacementsTableWrapper.classList.toggle("modified",o);var i=!1;if(t.sellPlacements.length!==n.sellPlacements.length)i=!0;else for(var c=0;c<t.sellPlacements.length;c++)if(t.sellPlacements[c].lots!==n.sellPlacements[c].lots||t.sellPlacements[c].gapFactor!==n.sellPlacements[c].gapFactor){i=!0;break}e.sellPlacementsTableWrapper.classList.toggle("modified",i)}}},{key:"gapFactorHeaderUnit",value:function(e){switch(e){case Jn:return["Multiplier","x"];case Zn:case $n:return["Rate","".concat(pt().assets[this.specs.quoteID].symbol,"/").concat(pt().assets[this.specs.baseID].symbol)];case er:case tr:return["Percent","%"];default:throw new Error("Unknown gap strategy ".concat(e))}}},{key:"checkGapFactorRange",value:function(e,t){switch(e){case Jn:return t<1||t>100?"Multiplier must be between 1 and 100":null;case Zn:case $n:return t<=0?"Rate must be greater than 0":null;case er:case tr:return t<=0||t>10?"Percent must be between 0 and 10":null;default:throw new Error("Unknown gap factor ".concat(e))}}},{key:"convertGapFactor",value:function(e,t,n){switch(t){case Jn:case Zn:case $n:return e;case er:case tr:return n?100*e:e/100;default:throw new Error("Unknown gap factor ".concat(t))}}},{key:"addPlacement",value:function(e,t,n){var r=this,a=this.page,o=this.updatedConfig,s=a.sellPlacementsTableBody,i=a.addSellPlacementRow,c=a.addSellPlacementLots,l=a.addSellPlacementGapFactor,u=a.sellPlacementsErr;e&&(s=a.buyPlacementsTableBody,i=a.addBuyPlacementRow,c=a.addBuyPlacementLots,l=a.addBuyPlacementGapFactor,u=a.buyPlacementsErr),qe.hide(u);var d=function(){for(var e=0;e<s.children.length-1;e++){var t=qe.parseTemplate(s.children[e]);qe.setVis(0!==e,t.upBtn),qe.setVis(e!==s.children.length-2,t.downBtn)}};qe.hide(u);var h,p,f,v=function(e){u.textContent=e,qe.show(u)};n||(n=this.specs.cexName?Jn:o.gapStrategy);var m=e?o.buyPlacements:o.sellPlacements,g=this.gapFactorHeaderUnit(n)[1];if(t)h=t.lots,p=t.gapFactor,f=this.convertGapFactor(p,n,!0);else{if(h=parseInt(c.value||"0"),f=parseFloat(l.value||"0"),p=this.convertGapFactor(f,n,!1),0===h)return void v("Lots must be greater than 0");var y=this.checkGapFactorRange(n,f);if(y)return void v(y);if(m.find((function(e){return e.gapFactor===p})))return void v("Duplicate placement");m.push({lots:h,gapFactor:p})}var b=a.placementRowTmpl.cloneNode(!0),x=qe.parseTemplate(b);x.priority.textContent="".concat(s.children.length),x.lots.textContent="".concat(h),x.gapFactor.textContent="".concat(f," ").concat(g),qe.bind(x.removeBtn,"click",(function(){var e=m.findIndex((function(e){return e.lots===h&&e.gapFactor===p}));-1!==e&&(m.splice(e,1),b.remove(),d(),r.updateModifiedMarkers(),r.placementsChart.render(),r.updateAllocations())})),qe.bind(x.upBtn,"click",(function(){var e=m.findIndex((function(e){return e.lots===h&&e.gapFactor===p}));if(0!==e){var t=m[e-1];m[e-1]=m[e],m[e]=t,x.priority.textContent="".concat(e),b.remove(),s.insertBefore(b,s.children[e-1]),qe.parseTemplate(s.children[e]).priority.textContent="".concat(e+1),d(),r.updateModifiedMarkers()}})),qe.bind(x.downBtn,"click",(function(){var e=m.findIndex((function(e){return e.lots===h&&e.gapFactor===p}));if(e!==m.length-1){var t=m[e+1];m[e+1]=m[e],m[e]=t,x.priority.textContent="".concat(e+2),b.remove(),s.insertBefore(b,s.children[e+1]),qe.parseTemplate(s.children[e]).priority.textContent="".concat(e+1),d(),r.updateModifiedMarkers()}})),s.insertBefore(b,i),d()}},{key:"setArbMMLabels",value:function(){this.page.buyGapFactorHdr.textContent=xe(ce),this.page.sellGapFactorHdr.textContent=xe(ce)}},{key:"setGapFactorLabels",value:function(e){var t=this.page,n=this.gapFactorHeaderUnit(e)[0];switch(t.buyGapFactorHdr.textContent=n,t.sellGapFactorHdr.textContent=n,qe.hide(t.percentPlusInfo,t.percentInfo,t.absolutePlusInfo,t.absoluteInfo,t.multiplierInfo),e){case"percent-plus":return qe.show(t.percentPlusInfo);case"percent":return qe.show(t.percentInfo);case"absolute-plus":return qe.show(t.absolutePlusInfo);case"absolute":return qe.show(t.absoluteInfo);case"multiplier":return qe.show(t.multiplierInfo)}}},{key:"clearPlacements",value:function(e){for(var t=this.page,n=this.updatedConfig;t.buyPlacementsTableBody.children.length>1;)t.buyPlacementsTableBody.children[0].remove();for(;t.sellPlacementsTableBody.children.length>1;)t.sellPlacementsTableBody.children[0].remove();this.placementsCache[e]=[n.buyPlacements,n.sellPlacements],n.buyPlacements.splice(0,n.buyPlacements.length),n.sellPlacements.splice(0,n.sellPlacements.length)}},{key:"loadCachedPlacements",value:function(e){var t,n,a=this.placementsCache[e];if(a){var o=this.updatedConfig;o.buyPlacements.splice(0,o.buyPlacements.length),o.sellPlacements.splice(0,o.sellPlacements.length),(t=o.buyPlacements).push.apply(t,r(a[0])),(n=o.sellPlacements).push.apply(n,r(a[1]));var s,i=e===jo?Jn:e,c=No(o.buyPlacements);try{for(c.s();!(s=c.n()).done;){var l=s.value;this.addPlacement(!0,l,i)}}catch(e){c.e(e)}finally{c.f()}var u,d=No(o.sellPlacements);try{for(d.s();!(u=d.n()).done;){var h=u.value;this.addPlacement(!1,h,i)}}catch(e){d.e(e)}finally{d.f()}}}},{key:"setOriginalValues",value:function(){var e,t,n,r=this,o=this.page,s=this.originalConfig,i=this.updatedConfig,l=this.specs,u=l.cexName,d=l.botType;this.clearPlacements(u?jo:i.gapStrategy),function(e,t){for(var n=0,r=Object.entries(t);n<r.length;n++){var o=a(r[n],2),s=o[0],i=o[1];if(Array.isArray(i)){e[s].splice(0,e[s].length);var l,u=No(i);try{for(u.s();!(l=u.n()).done;){var d=l.value;e[s].push(d)}}catch(e){u.e(e)}finally{u.f()}}else"object"===c(i)?Object.assign(e[s],i):e[s]=t[s]}}(i,JSON.parse(JSON.stringify(s)));var h=null!==(e=i.driftTolerance)&&void 0!==e?e:.002;this.driftTolerance.setValue(100*h),this.driftToleranceSlider.setValue(h/.02);var p=null!==(t=i.orderPersistence)&&void 0!==t?t:20;this.orderPersistence.setValue(p),this.orderPersistenceSlider.setValue(p/40);var f=null!==(n=i.profit)&&void 0!==n?n:.01;o.profitInput.value=String(100*f),this.qcProfit.setValue(100*f),this.qcProfitSlider.setValue((f-Ho)/zo),u&&(o.cexRebalanceCheckbox.checked=i.cexRebalance,this.autoRebalanceChanged()),o.gapStrategySelect.options&&(Array.from(o.gapStrategySelect.options).forEach((function(e){e.selected=e.value===i.gapStrategy})),this.setGapFactorLabels(i.gapStrategy),d===nr?(qe.show(o.gapStrategyBox),qe.hide(o.profitSelectorBox,o.orderPersistenceBox),this.setGapFactorLabels(o.gapStrategySelect.value||"")):u&&pt().mmStatus.cexes[u]&&(qe.hide(o.gapStrategyBox),qe.show(o.profitSelectorBox,o.orderPersistenceBox),this.setArbMMLabels()),s.buyPlacements.forEach((function(e){r.addPlacement(!0,e)})),s.sellPlacements.forEach((function(e){r.addPlacement(!1,e)})),this.basePane.setupWalletSettings(),this.quotePane.setupWalletSettings(),this.updateModifiedMarkers(),qe.isDisplayed(o.quickConfig)&&this.switchToQuickConfig())}},{key:"validateFields",value:function(e){var t=!0,n=this.page,r=this.specs.botType,a=this.updatedConfig,o=a.sellPlacements,s=a.buyPlacements,i=a.profit,c=function(n,r){t=!1,e&&(n.textContent=xe(r),qe.show(n))};return e&&qe.hide(n.buyPlacementsErr,n.sellPlacementsErr,n.profitInputErr),r!==ar&&s.length+o.length===0&&(c(n.buyPlacementsErr,le),c(n.sellPlacementsErr,le)),r!==nr&&(isNaN(i)?c(n.profitInputErr,ue):0===i&&c(n.profitInputErr,de)),t}},{key:"saveSettings",value:(l=s(f().mark((function e(){var t,n,r,a,o,s,i,c,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.validateFields(!0)){e.next=2;break}return e.abrupt("return");case 2:t=this.marketStuff(),n=t.cfg,r=t.baseID,a=t.quoteID,o=t.host,s=t.botType,i=t.cexName,c={host:o,baseID:r,quoteID:a,cexName:null!=i?i:"",uiConfig:{simpleArbLots:n.simpleArbLots,baseConfig:n.baseConfig,quoteConfig:n.quoteConfig,cexRebalance:n.cexRebalance},baseWalletOptions:n.baseOptions,quoteWalletOptions:n.quoteOptions},e.t0=s,e.next=e.t0===nr?7:e.t0===rr?9:e.t0===ar?11:12;break;case 7:return c.basicMarketMakingConfig=this.basicMMConfig(),e.abrupt("break",12);case 9:return c.arbMarketMakingConfig=this.arbMMConfig(),e.abrupt("break",12);case 11:c.simpleArbConfig=this.basicArbConfig();case 12:return pt().log("mm","saving bot config",c),e.next=15,sr.updateBotConfig(c);case 15:return e.next=17,pt().fetchMMStatus();case 17:this.originalConfig=JSON.parse(JSON.stringify(n)),this.updateModifiedMarkers(),(l=k.fetchLocal(Uo)||{})["".concat(r,"_").concat(a,"_").concat(o)]=this.specs,k.storeLocal(Uo,l),i&&k.storeLocal(_o,i),pt().loadPage("mm");case 24:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"delete",value:(o=s(f().mark((function e(){var t,n,r,a,o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=this.specs,r=n.host,a=n.baseID,o=n.quoteID,qe.hide(t.deleteErr),s=pt().loading(t.botSettingsContainer),e.next=5,sr.removeBotConfig(r,a,o);case 5:if(i=e.sent,s(),pt().checkResponse(i)){e.next=11;break}return t.deleteErr.textContent=xe(H,{msg:i.msg}),qe.show(t.deleteErr),e.abrupt("return");case 11:return e.next=13,pt().fetchMMStatus();case 13:pt().loadPage("mm");case 14:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"arbMMConfig",value:function(){var e,t=this.updatedConfig,n={buyPlacements:[],sellPlacements:[],profit:t.profit,driftTolerance:t.driftTolerance,orderPersistence:t.orderPersistence},r=No(t.buyPlacements);try{for(r.s();!(e=r.n()).done;){var a=e.value;n.buyPlacements.push({lots:a.lots,multiplier:a.gapFactor})}}catch(e){r.e(e)}finally{r.f()}var o,s=No(t.sellPlacements);try{for(s.s();!(o=s.n()).done;){var i=o.value;n.sellPlacements.push({lots:i.lots,multiplier:i.gapFactor})}}catch(e){s.e(e)}finally{s.f()}return n}},{key:"basicArbConfig",value:function(){var e=this.updatedConfig;return{profitTrigger:e.profit,maxActiveArbs:100,numEpochsLeaveOpen:e.orderPersistence}}},{key:"basicMMConfig",value:function(){var e=this.updatedConfig;return{gapStrategy:e.gapStrategy,sellPlacements:e.sellPlacements,buyPlacements:e.buyPlacements,driftTolerance:e.driftTolerance}}},{key:"fetchMarketReport",value:(n=s(f().mark((function e(){var t,n,r,a,o,s,i,c,l,u,d,h,p;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=this.specs,r=n.host,a=n.baseID,o=n.quoteID,e.next=3,sr.report(r,a,o);case 3:if(s=e.sent,qe.hide(t.oraclesLoading,t.oraclesTable,t.noOracles),pt().checkResponse(s)){e.next=9;break}return t.oraclesErrMsg.textContent=s.msg,qe.show(t.oraclesErr),e.abrupt("return");case 9:if((i=this.marketReport=s.report).oracles&&0!==i.oracles.length){qe.hide(t.noOracles),qe.empty(t.oracles),l=No(null!==(c=i.oracles)&&void 0!==c?c:[]);try{for(l.s();!(u=l.n()).done;)d=u.value,h=t.oracleTmpl.cloneNode(!0),t.oracles.appendChild(h),(p=qe.parseTemplate(h)).logo.src="img/"+d.host+".png",p.host.textContent=Zo[d.host],p.volume.textContent=qe.formatFourSigFigs(d.usdVol),p.price.textContent=qe.formatFourSigFigs((d.bestBuy+d.bestSell)/2)}catch(e){l.e(e)}finally{l.f()}t.avgPrice.textContent=i.price?qe.formatFourSigFigs(i.price):"0",qe.show(t.oraclesTable)}else qe.show(t.noOracles);i.baseFiatRate>0?t.baseFiatRate.textContent=qe.formatFourSigFigs(i.baseFiatRate):t.baseFiatRate.textContent="N/A",i.quoteFiatRate>0?t.quoteFiatRate.textContent=qe.formatFourSigFigs(i.quoteFiatRate):t.quoteFiatRate.textContent="N/A",qe.show(t.fiatRates);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"cexConfigured",value:(t=s(f().mark((function e(t){var n,r,a,o,s,i,c,l,u,d,h,p,v,m;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.page,r=this.formSpecs,a=r.host,o=r.baseID,s=r.quoteID,i=or[t],c=No(this.marketRows),e.prev=3,c.s();case 5:if((l=c.n()).done){e.next=13;break}if(u=l.value,d=u.baseID,h=u.quoteID,p=u.tmpl,-1===(v=u.arbs).indexOf(t)){e.next=9;break}return e.abrupt("continue",11);case 9:this.cexMarketSupportFilter(d,h)(t)&&((m=n.arbBttnTmpl.cloneNode(!0)).src=i.logo,p.arbs.appendChild(m),v.push(t));case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),c.e(e.t0);case 18:return e.prev=18,c.f(),e.finish(18);case 21:this.setCEXAvailability(o,s,t),this.showBotTypeForm(a,o,s,rr,t);case 23:case"end":return e.stop()}}),e,this,[[3,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"setupCEXes",value:function(){this.formCexes={};for(var e=0,t=Object.keys(or);e<t.length;e++){var n=t[e];this.addCEX(n)}}},{key:"setCEXAvailability",value:function(e,t,n){for(var r=this.cexMarketSupportFilter(e,t),a=0,o=Object.values(this.formCexes);a<o.length;a++){var s=o[a],i=s.name,c=s.div,l=s.tmpl,u=r(i),d=pt().mmStatus.cexes[i];qe.hide(l.unavailable,l.needsconfig,l.disconnected),qe.setVis(Boolean(d),l.reconfig),l.logo.classList.remove("greyscal"),c.classList.toggle("configured",Boolean(d)&&!d.connectErr),d?d.connectErr?qe.show(l.disconnected):u?i===n&&this.selectFormCEX(i):(qe.show(l.unavailable),l.logo.classList.add("greyscal")):qe.show(l.needsconfig)}}},{key:"selectFormCEX",value:function(e){for(var t=0,n=Object.values(this.formCexes);t<n.length;t++){var r=n[t],a=r.name;r.div.classList.toggle("selected",a===e)}}},{key:"addCEX",value:function(e){var t=this,n=or[e],r=this.page.cexOptTmpl.cloneNode(!0),a=qe.parseTemplate(r);a.name.textContent=n.name,a.logo.src=n.logo,this.page.cexSelection.appendChild(r),this.formCexes[e]={name:e,div:r,tmpl:a},qe.bind(r,"click",(function(){var n=pt().mmStatus.cexes[e];if(n&&!n.connectErr)if(t.formCexes[e].div.classList.contains("selected")){for(var r=0,a=Object.values(t.formCexes);r<a.length;r++)a[r].div.classList.remove("selected");var o=t.formSpecs,s=o.baseID,i=o.quoteID;t.setCEXAvailability(s,i)}else for(var c=0,l=Object.values(t.formCexes);c<l.length;c++){var u=l[c];u.div.classList.toggle("selected",u.name===e)}else t.showCEXConfigForm(e)})),qe.bind(a.reconfig,"click",(function(n){n.stopPropagation(),t.showCEXConfigForm(e)}))}},{key:"showCEXConfigForm",value:function(e){var t=this.page;this.cexConfigForm.setCEX(e),this.forms.show(t.cexConfigForm)}},{key:"cexMarketSupportFilter",value:function(e,t){for(var n={},r=0,o=Object.entries(pt().mmStatus.cexes);r<o.length;r++)for(var s=a(o[r],2),i=s[0],c=s[1],l=0,u=Object.values(null!==(d=c.markets)&&void 0!==d?d:[]);l<u.length;l++){var d,h=u[l],p=h.baseID,f=h.quoteID;if(p===e&&f===t){n[i]=!0;break}}return function(e){return Boolean(n[e])}}}]),T}(ct);function Jo(e,t){var n=t.bots.find((function(t){var n=t.config;return n.host===e.host&&n.baseID===e.baseID&&n.quoteID===e.quoteID}));return Boolean(null==n?void 0:n.running)}var Zo={"binance.com":"Binance","coinbase.com":"Coinbase","bittrex.com":"Bittrex","hitbtc.com":"HitBTC","exmo.com":"EXMO"};function $o(e,t,n){var r=ut.Approved,a=ut.Approved;if(null!=t&&t.token){var o,s=pt().assets[t.id],i=pt().exchanges[e].assets[t.id].version;null!=s&&null!==(o=s.wallet)&&void 0!==o&&o.approved&&void 0!==s.wallet.approved[i]&&(r=s.wallet.approved[i])}if(null!=n&&n.token){var c,l=pt().assets[n.id],u=pt().exchanges[e].assets[n.id].version;null!=l&&null!==(c=l.wallet)&&void 0!==c&&c.approved&&void 0!==l.wallet.approved[u]&&(a=l.wallet.approved[u])}return[r,a]}var es=function(){function e(t,n){var r=this;i(this,e),h(this,"pg",void 0),h(this,"div",void 0),h(this,"page",void 0),h(this,"assetID",void 0),h(this,"ui",void 0),h(this,"walletConfig",void 0),h(this,"feeAssetID",void 0),h(this,"feeUI",void 0),h(this,"isQuote",void 0),h(this,"isToken",void 0),h(this,"lotSize",void 0),h(this,"lotSizeConv",void 0),h(this,"cfg",void 0),h(this,"inv",void 0),h(this,"nSwapFees",void 0),h(this,"nSwapFeesSlider",void 0),h(this,"orderReserves",void 0),h(this,"orderReservesSlider",void 0),h(this,"slippageBuffer",void 0),h(this,"slippageBufferSlider",void 0),h(this,"minTransfer",void 0),h(this,"minTransferSlider",void 0),this.pg=t,this.div=n;var o=this.page=qe.parseTemplate(n);this.nSwapFees=new Ye(o.nSwapFees,{prec:0,inc:10,changed:function(e){r.cfg.swapFeeN=e,r.nSwapFeesSlider.setValue((e-0)/1e3),r.pg.updateAllocations()}}),this.nSwapFeesSlider=new Je(o.nSwapFeesSlider,(function(e){var t=a(Ze(0+1e3*e,0),1)[0];r.cfg.swapFeeN=t,r.nSwapFees.setValue(t),r.pg.updateAllocations()})),this.orderReserves=new Qe(o.orderReservesFactor,{prec:3,min:0,changed:function(e){r.cfg.orderReservesFactor=e,r.orderReservesSlider.setValue((e-0)/3),r.pg.updateAllocations()}}),this.orderReservesSlider=new Je(o.orderReservesSlider,(function(e){var t=a(Ze(0+3*e,3),1)[0];r.orderReserves.setValue(t),r.cfg.orderReservesFactor=t,r.pg.updateAllocations()})),this.slippageBuffer=new Qe(o.slippageBufferFactor,{prec:3,min:0,changed:function(e){r.cfg.slippageBufferFactor=e,r.slippageBufferSlider.setValue((e-0)/.3),r.pg.updateAllocations()}}),this.slippageBufferSlider=new Je(o.slippageBufferSlider,(function(e){var t=a(Ze(0+.3*e,3),1)[0];r.slippageBuffer.setValue(0+.3*e),r.cfg.slippageBufferFactor=t,r.pg.updateAllocations()})),this.minTransfer=new Qe(o.minTransfer,{sigFigs:!0,min:0,changed:function(e){var t=r.cfg,n=r.commit(),a=[r.minTransfer.min,Math.max(2*r.minTransfer.min,n)],o=a[0],s=a[1];t.transferFactor=(e-o)/(s-o),r.minTransferSlider.setValue(t.transferFactor)}}),this.minTransferSlider=new Je(o.minTransferSlider,(function(e){var t=r.cfg,n=r.commit(),a=[r.minTransfer.min,Math.max(r.minTransfer.min,n)],o=a[0],s=a[1];t.transferFactor=e,r.minTransfer.setValue(o+e*(s-o))})),qe.bind(o.showBalance,"click",(function(){t.showAddress(r.assetID)}))}return d(e,[{key:"setLotSize",value:function(e){var t=this.ui;this.lotSize=e,this.lotSizeConv=e/t.conventional.conversionFactor}},{key:"setAsset",value:function(e,t){var n;this.assetID=e,this.isQuote=t;var r=this.cfg=t?this.pg.updatedConfig.quoteConfig:this.pg.updatedConfig.baseConfig,o=this.page,s=this.div,i=this.pg,c=i.specs,l=c.botType,u=c.baseID,d=c.cexName,h=i.mktID,p=i.updatedConfig,f=p.baseOptions,v=p.quoteOptions,m=pt().assets[e],g=m.symbol,y=m.name,b=m.token,x=m.unitInfo;this.ui=x,this.walletConfig=e===u?f:v;var k=x.conventional.unit;this.feeAssetID=b?b.parentID:e;var w=pt().assets[this.feeAssetID],C=w.unitInfo,S=w.name,F=w.symbol;this.feeUI=C,this.inv={book:0,bookingFees:0,swapFeeReserves:0,cex:0,orderReserves:0,slippageBuffer:0},this.isToken=Boolean(b),qe.setVis(this.isToken,o.feeTotalBox,o.feeReservesBox,o.feeBalances),qe.setVis(t,o.slippageBufferBox),qe.setSrc(s,"[data-logo]",qe.logoPath(g)),qe.setText(s,"[data-name]",y),qe.setText(s,"[data-ticker]",k);var D=C.conventional.unit;if(qe.setText(s,"[data-fee-ticker]",D),qe.setText(s,"[data-fee-name]",S),qe.setSrc(s,"[data-fee-logo]",qe.logoPath(F)),qe.setVis(l!==nr,o.cexMinInvBox),qe.setVis(l!==ar,o.orderReservesBox),this.nSwapFees.setValue(null!==(n=r.swapFeeN)&&void 0!==n?n:50),this.nSwapFeesSlider.setValue(r.swapFeeN/1e3),l!==ar){var T,I=a(Ze(null!==(T=r.orderReservesFactor)&&void 0!==T?T:1,3),1)[0];this.orderReserves.setValue(I),this.orderReservesSlider.setValue((I-0)/3)}if(l!==nr){this.minTransfer.prec=Math.log10(x.conventional.conversionFactor);var A=pt().mmStatus.cexes[d].markets[h];this.minTransfer.min=(t?A.quoteMinWithdraw:A.baseMinWithdraw)/x.conventional.conversionFactor}this.slippageBuffer.setValue(r.slippageBufferFactor);this.slippageBufferSlider.setValue((r.slippageBufferFactor-0)/.3),this.setupWalletSettings(),this.updateBalances()}},{key:"commit",value:function(){var e=this.inv,t=this.isToken,n=e.book+e.cex+e.orderReserves+e.slippageBuffer;return t||(n+=e.bookingFees+e.swapFeeReserves),n}},{key:"updateInventory",value:function(e,t,n,r,a,o){this.setLotSize(n);var s=this.page,i=this.cfg,c=this.lotSizeConv,l=this.inv,u=this.ui,d=this.feeUI,h=this.isToken,p=this.isQuote,f=this.pg.specs,v=f.cexName,m=f.botType;s.bookLots.textContent=String(e),s.bookLotSize.textContent=qe.formatFourSigFigs(c),l.book=e*c,s.bookCommitment.textContent=qe.formatFourSigFigs(l.book);var g=o.bookingFeesPerLot/d.conventional.conversionFactor;if(s.bookingFeesPerLot.textContent=qe.formatFourSigFigs(g),s.swapReservesFactor.textContent=o.swapReservesFactor.toFixed(2),s.bookingFeesLots.textContent=String(e),l.bookingFees=o.bookingFees/d.conventional.conversionFactor,s.bookingFees.textContent=qe.formatFourSigFigs(l.bookingFees),v&&(l.cex=a/u.conventional.conversionFactor,s.cexMinInv.textContent=qe.formatFourSigFigs(l.cex)),m!==ar){var y=Math.max(a,r)/u.conventional.conversionFactor;s.orderReservesBasis.textContent=qe.formatFourSigFigs(y);var b=y*i.orderReservesFactor;l.orderReserves=b,s.orderReserves.textContent=qe.formatFourSigFigs(b)}if(h){var x=o.tokenFeesPerSwap/d.conventional.conversionFactor;s.feeReservesPerSwap.textContent=qe.formatFourSigFigs(x),l.swapFeeReserves=x*i.swapFeeN,s.feeReserves.textContent=qe.formatFourSigFigs(l.swapFeeReserves)}if(p){var k=l.book+l.cex+l.orderReserves;s.slippageBufferBasis.textContent=qe.formatCoinValue(k*u.conventional.conversionFactor,u),l.slippageBuffer=k*i.slippageBufferFactor,s.slippageBuffer.textContent=qe.formatCoinValue(l.slippageBuffer*u.conventional.conversionFactor,u)}if(qe.setVis(o.bookingFeesPerCounterLot>0,s.redemptionFeesBox),o.bookingFeesPerCounterLot>0){var w=o.bookingFeesPerCounterLot/d.conventional.conversionFactor;s.redemptionFeesPerLot.textContent=qe.formatFourSigFigs(w),s.redemptionFeesLots.textContent=String(t),s.redeemReservesFactor.textContent=o.redeemReservesFactor.toFixed(2)}this.updateCommitTotal(),this.updateTokenFees(),this.updateRebalance()}},{key:"updateCommitTotal",value:function(){var e=this.page,t=this.assetID,n=this.ui,r=this.commit();e.commitTotal.textContent=qe.formatCoinValue(Math.round(r*n.conventional.conversionFactor),n),e.commitTotalFiat.textContent=qe.formatFourSigFigs(r*pt().fiatRatesMap[t])}},{key:"updateTokenFees",value:function(){var e=this.page,t=this.inv,n=this.feeAssetID,r=this.feeUI;if(this.isToken){var a=t.bookingFees+t.swapFeeReserves;e.feeTotal.textContent=qe.formatCoinValue(a*r.conventional.conversionFactor,r),e.feeTotalFiat.textContent=qe.formatFourSigFigs(a*pt().fiatRatesMap[n])}}},{key:"updateRebalance",value:function(){var e=this.page,t=this.cfg,n=this.pg,r=n.updatedConfig.cexRebalance,a=n.specs.cexName&&r;if(qe.setVis(a,e.rebalanceOpts),a){var o=this.commit(),s=[this.minTransfer.min,Math.max(2*this.minTransfer.min,o)],i=s[0],c=s[1]-i;this.minTransfer.setValue(i+t.transferFactor*c),this.minTransferSlider.setValue((t.transferFactor-0)/1)}}},{key:"setupWalletSettings",value:function(){var e=this,t=this.page,n=this.assetID,r=this.walletConfig,o=pt().currentWalletDefinition(n);if(qe.empty(t.walletSettings),qe.setVis(!o.multifundingopts,t.walletSettingsNone),o.multifundingopts){var s={},i={},c=function(n){if(!n.quoteAssetOnly||e.isQuote){var o,c,l,u,d=r[n.key];if(n.isboolean){o=t.boolSettingTmpl.cloneNode(!0);var h=qe.parseTemplate(o);h.name.textContent=n.displayname,h.input.checked="true"===d,qe.bind(h.input,"change",(function(){r[n.key]=h.input.checked?"true":"false",function(e,t){var n=i[e];if(n){var r,a=No(n);try{for(a.s();!(r=a.n()).done;){var o=r.value;qe.setVis(t,s[o])}}catch(e){a.e(e)}finally{a.f()}}}(n.key,Boolean(h.input.checked))})),n.description&&(h.tooltip.dataset.tooltip=n.description)}else if(n.xyRange){var p=n.xyRange,f=p.start,v=p.end,m=p.xUnit,g=v.x-f.x;o=t.rangeSettingTmpl.cloneNode(!0);var y=qe.parseTemplate(o);y.name.textContent=n.displayname,n.description&&(y.tooltip.dataset.tooltip=n.description),m?y.unit.textContent=m:qe.hide(y.unit);var b=new Qe(y.value,{prec:1,changed:function(e){var t=a($e(e,1),2),o=t[0],s=t[1];r[n.key]=s,x.setValue((o-f.x)/g)}}),x=new Je(y.slider,(function(e){var t=a($e(f.x+e*g,1),2),o=t[0],s=t[1];r[n.key]=s,b.setValue(o)})),k=a($e(et(d,f.x),3),2),w=k[0],C=k[1];r[n.key]=C,x.setValue((w-f.x)/g),b.setValue(w),y.value.textContent=C}if(!o)return console.error("don't know how to handle opt",n);if(t.walletSettings.appendChild(o),n.dependsOn){c=n.key,l=o,u=n.dependsOn,i[u]||(i[u]=[]),i[u].push(c),s[c]=l;var S=r[n.dependsOn];qe.setVis("true"===S,o)}}};if(o.multifundingopts&&o.multifundingopts.length>0){var l,u=No(o.multifundingopts);try{for(u.s();!(l=u.n()).done;)c(l.value)}catch(e){u.e(e)}finally{u.f()}}pt().bindTooltips(t.walletSettings)}}},{key:"updateBalances",value:function(){var e=this.page,t=this.assetID,n=this.ui,r=this.feeAssetID,a=this.feeUI,o=this.pg,s=o.specs,i=s.cexName,c=s.baseID,l=o.cexBaseBalance,u=o.cexQuoteBalance,d=pt().walletMap[t].balance.available,h=this.pg.runningBotInventory(t),p=d-h.dex.total,f=0;if(qe.setVis(i,e.balanceBreakdown),i&&(e.dexAvail.textContent=qe.formatFourSigFigs(p/n.conventional.conversionFactor),f=(t===c?l:u).available-h.cex.total,e.cexAvail.textContent=qe.formatFourSigFigs(f/n.conventional.conversionFactor)),e.avail.textContent=qe.formatFourSigFigs((p+f)/n.conventional.conversionFactor),t!==r){var v=pt().walletMap[r].balance.available;e.feeAvail.textContent=qe.formatFourSigFigs(v/a.conventional.conversionFactor)}}}]),e}();var ts=function(e){g(I,e);var t,n,r,a,o,c,l,u,p,m,x,k,w,C,F,D,T=(F=I,D=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(F);if(D){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return y(this,e)});function I(e){var t;i(this,I),h(v(t=T.call(this)),"body",void 0),h(v(t),"forms",void 0),h(v(t),"currentForm",void 0),h(v(t),"page",void 0),h(v(t),"host",void 0),h(v(t),"accountDisabled",void 0),h(v(t),"keyup",void 0),h(v(t),"dexAddrForm",void 0),h(v(t),"bondFeeBufferCache",void 0),h(v(t),"newWalletForm",void 0),h(v(t),"regAssetForm",void 0),h(v(t),"walletWaitForm",void 0),h(v(t),"confirmRegisterForm",void 0),h(v(t),"reputationMeter",void 0),h(v(t),"animation",void 0),h(v(t),"renewToggle",void 0),t.body=e;var n=t.host=e.dataset.host?e.dataset.host:"",r=pt().exchanges[n],a=t.page=qe.idDescendants(e);t.forms=qe.applySelector(a.forms,":scope > form"),t.confirmRegisterForm=new Ar(a.confirmRegForm,s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.showSuccess(xe(se)),t.renewToggle.setState(t.confirmRegisterForm.tier>0),e.next=4,pt().fetchUser();case 4:pt().updateMenuItemsDisplay();case 5:case"end":return e.stop()}}),e)}))),(function(){t.runAnimation(t.regAssetForm,a.regAssetForm)})),t.confirmRegisterForm.setExchange(r,""),t.walletWaitForm=new Er(a.walletWait,(function(){t.runAnimation(t.confirmRegisterForm,a.confirmRegForm)}),(function(){t.runAnimation(t.regAssetForm,a.regAssetForm)})),t.walletWaitForm.setExchange(r),t.newWalletForm=new Dr(a.newWalletForm,(function(e){return t.newWalletCreated(e,t.confirmRegisterForm.tier)}),(function(){return t.runAnimation(t.regAssetForm,a.regAssetForm)})),t.regAssetForm=new Rr(a.regAssetForm,function(){var e=s(f().mark((function e(n,r){var o,s,i,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!==ht){e.next=6;break}return e.next=3,pt().fetchUser();case 3:return t.updateReputation(),t.showSuccess(xe(se)),e.abrupt("return");case 6:if(o=pt().assets[n],!(s=o.wallet)){e.next=17;break}return i=pt().loading(a.regAssetForm),e.next=12,t.getBondsFeeBuffer(n,a.regAssetForm);case 12:return c=e.sent,t.confirmRegisterForm.setAsset(n,r,c),i(),t.progressTierFormsWithWallet(n,s),e.abrupt("return");case 17:t.confirmRegisterForm.setAsset(n,r,0),t.newWalletForm.setAsset(n),t.showForm(a.newWalletForm);case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),t.regAssetForm.setExchange(r,""),t.reputationMeter=new Cn(a.repMeter),t.reputationMeter.setHost(n),qe.bind(a.exportDexBtn,"click",(function(){return t.exportAccount()})),t.accountDisabled="true"===e.dataset.disabled,qe.bind(a.toggleAccountStatusBtn,"click",(function(){t.accountDisabled?t.toggleAccountStatus(!1):t.prepareAccountDisable(a.disableAccountForm)})),qe.bind(a.updateCertBtn,"click",(function(){return a.certFileInput.click()})),qe.bind(a.updateHostBtn,"click",(function(){return t.prepareUpdateHost()})),qe.bind(a.certFileInput,"change",(function(){return t.onCertFileChange()})),qe.bind(a.goBackToSettings,"click",(function(){return pt().loadPage("settings")}));var o=function(){t.regAssetForm.setExchange(pt().exchanges[n],""),t.showForm(a.regAssetForm)};qe.bind(a.changeTier,"click",(function(){o()}));var c=r.auth.targetTier>0;t.renewToggle=new Ue(a.toggleAutoRenew,a.renewErr,c,function(){var e=s(f().mark((function e(n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.accountDisabled){e.next=2;break}return e.abrupt("return");case 2:if(!n){e.next=6;break}o(),e.next=7;break;case 6:return e.abrupt("return",t.disableAutoRenew());case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),qe.bind(a.autoRenewBox,"click",(function(e){e.stopPropagation(),t.accountDisabled||a.toggleAutoRenew.click()})),a.penaltyComps.textContent=String(r.auth.penaltyComps);var l=function(){qe.hide(a.penaltyCompInput),qe.show(a.penaltyComps)};return qe.bind(a.penaltyCompBox,"click",(function(e){e.stopPropagation();var n=pt().exchanges[t.host];a.penaltyCompInput.value=String(n.auth.penaltyComps),qe.hide(a.penaltyComps),qe.show(a.penaltyCompInput),a.penaltyCompInput.focus(),qe.bind(document,"click",(function e(t){qe.mouseInElement(t,a.penaltyCompBox)||(l(),qe.unbind(document,"click",e))}))})),qe.bind(a.penaltyCompInput,"keyup",function(){var e=s(f().mark((function e(n){var r,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(qe.hide(a.penaltyCompsErr),"Escape"!==n.key){e.next=4;break}return l(),e.abrupt("return");case 4:if("Enter"===n.key){e.next=6;break}return e.abrupt("return");case 6:if(r=parseInt(a.penaltyCompInput.value||""),!isNaN(r)){e.next=11;break}return qe.show(a.penaltyCompsErr),a.penaltyCompsErr.textContent=xe("INVALID_COMPS_VALUE"),e.abrupt("return");case 11:return o=pt().loading(a.otherBondSettings),e.prev=12,e.next=15,t.updateBondOptions({penaltyComps:r});case 15:o(),a.penaltyComps.textContent=String(r),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(12),o(),qe.show(a.penaltyCompsErr),a.penaltyCompsErr.textContent=xe(H,{msg:e.t0.msg});case 24:l();case 25:case"end":return e.stop()}}),e,null,[[12,19]])})));return function(t){return e.apply(this,arguments)}}()),t.dexAddrForm=new Pr(a.dexAddrForm,function(){var e=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:pt().loadPage("/dexsettings/".concat(t.host));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.host),zr(a.disableAccountForm,a.disableAccountConfirm,(function(){return t.toggleAccountStatus(!0)})),qe.bind(a.forms,"mousedown",(function(e){qe.mouseInElement(e,t.currentForm)||t.closePopups()})),t.keyup=function(e){"Escape"===e.key&&t.closePopups()},qe.bind(document,"keyup",t.keyup),qe.applySelector(a.forms,".form-closer").forEach((function(e){qe.bind(e,"click",(function(){t.closePopups()}))})),pt().registerNoteFeeder({conn:function(){t.setConnectionStatus()},reputation:function(){t.updateReputation()},feepayment:function(){t.updateReputation()},bondpost:function(){t.updateReputation()}}),t.setConnectionStatus(),t.updateReputation(),t}return d(I,[{key:"unload",value:function(){qe.unbind(document,"keyup",this.keyup)}},{key:"progressTierFormsWithWallet",value:(C=s(f().mark((function e(t,n){var r,a,o,s,i,c,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.page,a=this.confirmRegisterForm.fees,o=pt().assets[t],s=this.regAssetForm.xc.bondAssets,i=s[o.symbol],n.open){e.next=12;break}return c=pt().loading(r.forms),e.next=8,S("/api/openwallet",{assetID:t});case 8:return l=e.sent,c(),pt().checkResponse(l)||(this.regAssetForm.setAssetError("error unlocking wallet: ".concat(l.msg)),this.runAnimation(this.regAssetForm,r.regAssetForm)),e.abrupt("return");case 12:if(!(n.synced&&n.balance.available>=2*i.amount+a)){e.next=15;break}return this.progressTierFormWithSyncedFundedWallet(t),e.abrupt("return");case 15:this.walletWaitForm.setWallet(t,a,this.confirmRegisterForm.tier),this.showForm(r.walletWait);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"progressTierFormWithSyncedFundedWallet",value:(w=s(f().mark((function e(t){var n,r,a,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=pt().exchanges[this.host],r=this.confirmRegisterForm.tier,a=this.page,o=n.auth.liveStrength+n.auth.pendingStrength-n.auth.weakStrength,!(r>n.auth.targetTier&&r>o)){e.next=7;break}return this.runAnimation(this.confirmRegisterForm,a.confirmRegForm),e.abrupt("return");case 7:return s=pt().loading(this.body),e.prev=8,e.next=11,this.updateBondOptions({bondAssetID:t,targetTier:r});case 11:s(),e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(8),s(),this.regAssetForm.setTierError(e.t0.msg),e.abrupt("return");case 19:this.showSuccess(xe(se));case 20:case"end":return e.stop()}}),e,this,[[8,14]])}))),function(e){return w.apply(this,arguments)})},{key:"updateReputation",value:function(){var e=this.page,t=pt().exchanges[this.host].auth,n=t.rep.penalties,r=t.targetTier,a=t.expiredBonds,o=Sn(t);e.targetTier.textContent=String(r),e.effectiveTier.textContent=String(o),e.penalties.textContent=String(n),e.bondsPendingRefund.textContent="".concat((null==a?void 0:a.length)||0),this.reputationMeter.update()}},{key:"showForm",value:(k=s(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.page,this.currentForm=t,this.forms.forEach((function(e){return qe.hide(e)})),t.style.right="10000px",qe.show(n.forms,t),r=(n.forms.offsetWidth+t.offsetWidth)/2,e.next=8,qe.animate(300,(function(e){t.style.right="".concat((1-e)*r,"px")}),"easeOutHard");case 8:t.style.right="0";case 9:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"runAnimation",value:(x=s(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return qe.hide(this.currentForm),e.next=3,t.animate();case 3:this.currentForm=n,qe.show(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return x.apply(this,arguments)})},{key:"closePopups",value:function(){qe.hide(this.page.forms),this.animation&&this.animation.stop()}},{key:"showSuccess",value:(m=s(f().mark((function e(t){var n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.forms.forEach((function(e){return qe.hide(e)})),this.currentForm=this.page.checkmarkForm,this.animation=Hr(this.page,t),e.next=5,this.animation.wait();case 5:this.animation=new Ne(1500,(function(){}),"",(function(){n.currentForm===n.page.checkmarkForm&&n.closePopups()}));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"exportAccount",value:(p=s(f().mark((function e(){var t,n,r,a,o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,n=this.host,r={host:n},a=pt().loading(this.body),e.next=5,S("/api/exportaccount",r);case 5:if(o=e.sent,a(),pt().checkResponse(o)){e.next=11;break}return t.exportAccountErr.textContent=o.msg,qe.show(t.exportAccountErr),e.abrupt("return");case 11:o.account.bonds=o.bonds,s=JSON.parse(JSON.stringify(o.account)),(i=document.createElement("a")).setAttribute("download","dcrAccount-"+n+".json"),i.setAttribute("href","data:text/json,"+JSON.stringify(s,null,2)),i.click(),qe.hide(t.forms);case 18:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"toggleAccountStatus",value:(u=s(f().mark((function e(t){var n,r,a,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.page,qe.hide(n.errMsg),r=this.host,t&&(r=n.disableAccountHost.textContent),a={host:r,disable:t},o=pt().loading(this.body),e.next=8,S("/api/toggleaccountstatus",a);case 8:if(s=e.sent,o(),pt().checkResponse(s)){e.next=13;break}return t?(n.disableAccountErr.textContent=s.msg,qe.show(n.disableAccountErr)):(n.errMsg.textContent=s.msg,qe.show(n.errMsg)),e.abrupt("return");case 13:return t?(this.page.toggleAccountStatusBtn.textContent=xe("ENABLE_ACCOUNT"),qe.hide(n.forms)):this.page.toggleAccountStatusBtn.textContent=xe("DISABLE_ACCOUNT"),this.accountDisabled=t,e.next=17,pt().fetchUser();case 17:pt().loadPage("dexsettings/".concat(r));case 18:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"prepareAccountDisable",value:(l=s(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=this.page).disableAccountHost.textContent=this.host,n.disableAccountErr.textContent="",this.showForm(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"getBondsFeeBuffer",value:(c=s(f().mark((function e(t,n){var r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=pt().loading(n),e.next=3,S("/api/bondsfeebuffer",{assetID:t});case 3:if(a=e.sent,r(),pt().checkResponse(a)){e.next=7;break}return e.abrupt("return",0);case 7:return e.abrupt("return",a.feeBuffer);case 8:case"end":return e.stop()}}),e)}))),function(e,t){return c.apply(this,arguments)})},{key:"prepareUpdateHost",value:(o=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.page,this.dexAddrForm.refresh(),this.showForm(t.dexAddrForm);case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"onCertFileChange",value:(a=s(f().mark((function e(){var t,n,r,a,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.page,qe.hide(t.errMsg),!(n=t.certFileInput.files)||!n.length){e.next=7;break}return e.next=6,n[0].text();case 6:r=e.sent;case 7:if(r){e.next=9;break}return e.abrupt("return");case 9:return a={host:this.host,cert:r},o=pt().loading(this.body),e.next=13,S("/api/updatecert",a);case 13:s=e.sent,o(),pt().checkResponse(s)?(qe.show(t.updateCertMsg),setTimeout((function(){qe.hide(t.updateCertMsg)}),5e3)):(t.errMsg.textContent=s.msg,qe.show(t.errMsg));case 16:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"setConnectionStatus",value:function(){var e=this.page,t=pt().user.exchanges[this.host],n=function(t){t?(qe.hide(e.disconnectedIcon),qe.show(e.connectedIcon)):(qe.show(e.disconnectedIcon),qe.hide(e.connectedIcon))};if(t)switch(t.connectionStatus){case lt.Connected:n(!0),e.connectionStatus.textContent=xe("CONNECTED");break;case lt.Disconnected:n(!1),this.accountDisabled?e.connectionStatus.textContent=xe("ACCOUNT_DISABLED_MSG"):e.connectionStatus.textContent=xe($);break;case lt.InvalidCert:n(!1),e.connectionStatus.textContent="".concat(xe($)," - ").concat(xe("INVALID_CERTIFICATE"))}}},{key:"disableAutoRenew",value:(r=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=pt().loading(this.page.otherBondSettings),e.prev=1,this.updateBondOptions({targetTier:0}),t(),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),t(),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return r.apply(this,arguments)})},{key:"updateBondOptions",value:(n=s(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.host=this.host,e.next=3,S("/api/updatebondoptions",t);case 3:r=null!==(n=t.targetTier)&&void 0!==n?n:pt().exchanges[this.host].auth.targetTier,this.renewToggle.setState(r>0);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"newWalletCreated",value:(t=s(f().mark((function e(t,n){var r,a,o,s,i,c,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.regAssetForm.refresh(),e.next=3,pt().fetchUser();case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return");case 6:return a=this.page,o=r.assets[t],s=o.wallet,i=pt().exchanges[this.host],c=i.bondAssets[o.symbol].amount,e.next=13,this.getBondsFeeBuffer(t,a.newWalletForm);case 13:if(l=e.sent,this.confirmRegisterForm.setFees(t,l),!(s.synced&&s.balance.available>=2*c+l)){e.next=18;break}return this.progressTierFormWithSyncedFundedWallet(t),e.abrupt("return");case 18:return this.walletWaitForm.setWallet(t,l,n),e.next=21,this.showForm(a.walletWait);case 21:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),I}(ct);var ns=function(e){g(o,e);var t,n,r,a=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(n);if(r){var a=b(this).constructor;e=Reflect.construct(t,arguments,a)}else e=t.apply(this,arguments);return y(this,e)});function o(e){var t;i(this,o),h(v(t=a.call(this)),"page",void 0),h(v(t),"base",void 0),h(v(t),"quote",void 0),h(v(t),"host",void 0);var n=t.page=qe.idDescendants(e);return qe.cleanTemplates(n.runTableRowTmpl),qe.bind(n.backButton,"click",(function(){pt().loadPage("mm")})),t.setup(),t}return d(o,[{key:"setup",value:(t=s(f().mark((function e(){var t,n,r,a,o=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D("/api/archivedmmruns");case 2:if(t=e.sent,pt().checkResponse(t)){e.next=6;break}return console.error("failed to get archived mm runs",t),e.abrupt("return");case 6:n=t.runs,r=f().mark((function e(){var t,r,s,i,c,l,u,d;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n[a],r=t.startTime,s=t.market,i=s.baseID,c=s.quoteID,l=s.host,u=o.page.runTableRowTmpl.cloneNode(!0),(d=qe.parseTemplate(u)).startTime.textContent=new Date(1e3*r).toLocaleString(),cr(u,i,c,l),qe.bind(d.logs,"click",(function(){pt().loadPage("mmlogs",{baseID:i,quoteID:c,host:l,startTime:r,returnPage:"mmarchives"})})),qe.bind(d.settings,"click",(function(){pt().loadPage("mmsettings",{host:l,baseID:i,quoteID:c})})),o.page.runTableBody.appendChild(u);case 8:case"end":return e.stop()}}),e)})),a=0;case 9:if(!(a<n.length)){e.next=14;break}return e.delegateYield(r(),"t0",11);case 11:a++,e.next=9;break;case 14:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),o}(ct);function rs(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return as(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?as(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function as(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function os(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var ss=0,is=function(e){g(p,e);var t,n,r,o,c,l,u=(c=p,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(c);if(l){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return y(this,e)});function p(e,t){var n,r;i(this,p),h(v(r=u.call(this)),"page",void 0),h(v(r),"mkt",void 0),h(v(r),"startTime",void 0),h(v(r),"fiatRates",void 0),h(v(r),"liveBot",void 0),h(v(r),"overview",void 0),h(v(r),"events",void 0),h(v(r),"forms",void 0),h(v(r),"dexOrderIDCopyListener",void 0),h(v(r),"cexOrderIDCopyListener",void 0),h(v(r),"depositIDCopyListener",void 0),h(v(r),"withdrawalIDCopyListener",void 0),h(v(r),"filters",void 0),h(v(r),"loading",void 0),h(v(r),"refID",void 0),h(v(r),"doneScrolling",void 0),h(v(r),"statsRows",void 0);var a=r.page=qe.idDescendants(e);if(ss=pt().user.net,qe.cleanTemplates(a.eventTableRowTmpl,a.dexOrderTxRowTmpl,a.performanceTableRowTmpl),qe.bind(r.page.backButton,"click",(function(){var e;pt().loadPage(null!==(e=t.returnPage)&&void 0!==e?e:"mm")})),qe.bind(r.page.filterButton,"click",(function(){r.applyFilters()})),null!==(n=t)&&void 0!==n&&n.host){var o=new URL(window.location.href);o.searchParams.set("host",t.host),o.searchParams.set("baseID",String(t.baseID)),o.searchParams.set("quoteID",String(t.quoteID)),o.searchParams.set("startTime",String(t.startTime)),window.history.replaceState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?os(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):os(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({page:"mmsettings"},t),"",o)}else{var s=new URLSearchParams(window.location.search);t||(t={}),t.host=s.get("host")||"",t.baseID=parseInt(s.get("baseID")||"0"),t.quoteID=parseInt(s.get("quoteID")||"0"),t.startTime=parseInt(s.get("startTime")||"0")}var c=t,l=c.baseID,d=c.quoteID,f=c.host,m=c.startTime;return r.startTime=m,r.forms=new Fr(a.forms),r.events={},r.statsRows={},r.mkt={baseID:l,quoteID:d,host:f},cr(e,l,d,f),qe.bind(e,"scroll",(function(){r.loading||r.doneScrolling||a.eventsTable.offsetHeight-e.offsetHeight-e.scrollTop<0&&r.nextPage()})),r.setup(f,l,d),r}return d(p,[{key:"nextPage",value:(o=s(f().mark((function e(){var t,n,r,o,s,i,c,l,u,d;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.next=3,this.getRunLogs();case 3:t=e.sent,n=a(t,3),r=n[0],o=n[1],s=n[2],i=this.mktAssets(),c=rs(r),e.prev=10,c.s();case 12:if((l=c.n()).done){e.next=20;break}if(u=l.value,!this.events[u.id]){e.next=16;break}return e.abrupt("continue",18);case 16:d=this.newEventRow(u,!1,i),this.events[u.id]=[u,d];case 18:e.next=12;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(10),c.e(e.t0);case 25:return e.prev=25,c.f(),e.finish(25);case 28:this.populateStats(s.profitLoss,s.endTime),this.updateExistingRows(o),this.loading=!1;case 31:case"end":return e.stop()}}),e,this,[[10,22,25,28]])}))),function(){return o.apply(this,arguments)})},{key:"getRunLogs",value:(r=s(f().mark((function e(){var t,n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.mkt,n=this.startTime,r={market:t,startTime:n,n:50,filters:this.filters,refID:this.refID},e.next=4,S("/api/mmrunlogs",r);case 4:return a=e.sent,pt().checkResponse(a)||console.error("failed to get bot logs",a),a.logs.length<=1&&(this.doneScrolling=!0),a.logs.length>0&&(this.refID=a.logs[a.logs.length-1].id),e.abrupt("return",[a.logs,a.updatedLogs||[],a.overview]);case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"applyFilters",value:(n=s(f().mark((function e(){var t,n,r,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.page,this.filters={dexSells:!!t.dexSellsCheckbox.checked,dexBuys:!!t.dexBuysCheckbox.checked,cexSells:!!t.cexSellsCheckbox.checked,cexBuys:!!t.cexBuysCheckbox.checked,deposits:!!t.depositsCheckbox.checked,withdrawals:!!t.withdrawalsCheckbox.checked},this.refID=void 0,e.next=5,this.getRunLogs();case 5:n=e.sent,r=a(n,3),o=r[0],s=r[2],this.populateTable(o),this.populateStats(s.profitLoss,s.endTime);case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setFilters",value:function(){var e=this.page;e.dexSellsCheckbox.checked=!0,e.dexBuysCheckbox.checked=!0,e.cexSellsCheckbox.checked=!0,e.cexBuysCheckbox.checked=!0,e.depositsCheckbox.checked=!0,e.withdrawalsCheckbox.checked=!0,this.filters={dexSells:!0,dexBuys:!0,cexSells:!0,cexBuys:!0,deposits:!0,withdrawals:!0}}},{key:"setup",value:(t=s(f().mark((function e(t,n,r){var o,s,i,c,l,u,d,h,p,v,m,g,y,b,x,k,w=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.page,this.setFilters(),i=this.startTime,l=0,u=fr(t,n,r),e.next=7,this.getRunLogs();case 7:d=e.sent,h=a(d,3),p=h[0],v=h[2],(null==u||null===(o=u.runStats)||void 0===o?void 0:o.startTime)===i?(this.liveBot=!0,this.fiatRates=pt().fiatRatesMap,c=u.runStats.profitLoss):(this.fiatRates=v.finalState.fiatRates,c=v.profitLoss,l=v.endTime),this.populateStats(c,l),m=this.mktAssets(),g=s.sumUSDHeader.parentElement,y=rs(m);try{for(y.s();!(b=y.n()).done;)x=b.value,(k=document.createElement("th")).textContent="".concat(x.symbol.toUpperCase()," Delta"),g&&g.insertBefore(k,s.sumUSDHeader)}catch(e){y.e(e)}finally{y.f()}this.populateTable(p),pt().registerNoteFeeder({runevent:function(e){w.handleRunEventNote(e)},runstats:function(e){w.handleRunStatsNote(e)}});case 19:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"handleRunEventNote",value:function(e){var t=this.mkt,n=t.baseID,r=t.quoteID,a=t.host;if(e.host===a&&e.baseID===n&&e.quoteID===r&&(o=e.event,s=this.filters,o.dexOrderEvent?o.dexOrderEvent.sell?s.dexSells:s.dexBuys:o.cexOrderEvent?o.cexOrderEvent.sell?s.cexSells:s.cexBuys:o.depositEvent?s.deposits:o.withdrawalEvent&&s.withdrawals)){var o,s,i=e.event,c=this.events[i.id];if(c)return this.setRowContents(c[1],i,this.mktAssets()),void(c[0]=i);var l=this.newEventRow(i,!0,this.mktAssets());this.events[i.id]=[i,l]}}},{key:"handleRunStatsNote",value:function(e){var t=this.mkt,n=t.baseID,r=t.quoteID,a=t.host,o=this.startTime;e.host===a&&e.baseID===n&&e.quoteID===r&&e.stats&&e.stats.startTime===o&&this.populateStats(e.stats.profitLoss,0)}},{key:"populateStats",value:function(e,t){var n=this.page;for(var r in n.startTime.textContent=new Date(1e3*this.startTime).toLocaleString(),0===t?qe.hide(n.endTimeRow):n.endTime.textContent=new Date(1e3*t).toLocaleString(),e.diffs){var a=pt().assets[parseInt(r)],o=this.statsRows[r];if(!o){o=n.performanceTableRowTmpl.cloneNode(!0);var s=qe.parseTemplate(o);s.logo.src=qe.logoPath(a.symbol),s.ticker.textContent=a.symbol.toUpperCase(),this.statsRows[r]=o,n.performanceTableBody.appendChild(o)}var i=e.diffs[r],c=qe.parseTemplate(o);c.diff.textContent=i.fmt,c.usdDiff.textContent=i.fmtUSD,c.fiatRate.textContent="".concat(qe.formatFiatValue(this.fiatRates[a.id])," USD")}n.profitLoss.textContent="".concat(qe.formatFiatValue(e.profit)," USD")}},{key:"mktAssets",value:function(){var e,t=pt().assets[this.mkt.baseID],n=pt().assets[this.mkt.quoteID],r=[t,n],a=(h(e={},t.id,!0),h(e,n.id,!0),e);if(t.token&&!a[t.token.parentID]){var o=pt().assets[t.token.parentID];a[o.id]=!0,r.push(o)}if(n.token&&!a[n.token.parentID]){var s=pt().assets[n.token.parentID];r.push(s)}return r}},{key:"updateExistingRows",value:function(e){var t,n=rs(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=this.events[r.id];a&&(this.setRowContents(a[1],r,this.mktAssets()),a[0]=r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"populateTable",value:function(e){var t=this.page;qe.empty(t.eventsTableBody),this.events={},this.doneScrolling=!1;var n,r=this.mktAssets(),a=rs(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=this.newEventRow(o,!1,r);this.events[o.id]=[o,s]}}catch(e){a.e(e)}finally{a.f()}}},{key:"setRowContents",value:function(e,t,n){var r,a=this,o=qe.parseTemplate(e);o.time.textContent=new Date(1e3*t.timestamp).toLocaleString(),o.eventType.textContent=this.eventType(t),t.depositEvent?r=t.depositEvent.transaction.id:t.withdrawalEvent?r=t.withdrawalEvent.id:t.dexOrderEvent?r=t.dexOrderEvent.id:t.cexOrderEvent&&(r=t.cexOrderEvent.id),r&&(o.eventID.textContent=cs(r,30),o.eventID.setAttribute("title",r));var s,i=0,c=rs(n);try{for(c.s();!(s=c.n()).done;){var l,u=s.value,d=t.balanceEffects,h=ls(u.id,d),p="sum".concat(u.symbol.toUpperCase()),f=void 0;if(o[p])f=o[p];else{(f=document.createElement("td")).dataset.tmpl=p;var v=o.sumUSD.parentElement;v&&v.insertBefore(f,o.sumUSD)}f.textContent=qe.formatCoinValue(h,u.unitInfo),i+=null!==(l=h/u.unitInfo.conventional.conversionFactor*this.fiatRates[u.id])&&void 0!==l?l:0}}catch(e){c.e(e)}finally{c.f()}o.sumUSD.textContent=qe.formatFourSigFigs(i),qe.bind(o.details,"click",(function(){a.showEventDetails(t.id)}))}},{key:"newEventRow",value:function(e,t,n){var r=this.page,a=r.eventTableRowTmpl.cloneNode(!0);return a.id=e.id.toString(),this.setRowContents(a,e,n),t?r.eventsTableBody.insertBefore(a,r.eventsTableBody.firstChild):r.eventsTableBody.appendChild(a),a}},{key:"eventType",value:function(e){return e.depositEvent?"Deposit":e.withdrawalEvent?"Withdrawal":e.dexOrderEvent?e.dexOrderEvent.sell?"DEX Sell":"DEX Buy":e.cexOrderEvent?e.cexOrderEvent.sell?"CEX Sell":"CEX Buy":""}},{key:"showDexOrderEventDetails",value:function(e){var t=this.page,n=this.mkt,r=n.baseID,a=n.quoteID,o=pt().assets[r],s=pt().assets[a],i=[o.unitInfo,s.unitInfo],c=i[0],l=i[1],u=[c.conventional.unit,l.conventional.unit],d=u[0],h=u[1];void 0!==this.dexOrderIDCopyListener&&t.copyDexOrderID.removeEventListener("click",this.dexOrderIDCopyListener),this.dexOrderIDCopyListener=function(){nt(e.id,t.dexOrderID,t.copyDexOrderID,"#1e7d11")},t.copyDexOrderID.addEventListener("click",this.dexOrderIDCopyListener),t.dexOrderID.textContent=cs(e.id,20),t.dexOrderID.setAttribute("title",e.id);var p=pt().conventionalRate(r,a,e.rate);t.dexOrderRate.textContent="".concat(p," ").concat(d,"/").concat(h),t.dexOrderQty.textContent="".concat(e.qty/c.conventional.conversionFactor," ").concat(d),e.sell?t.dexOrderSide.textContent=xe(B):t.dexOrderSide.textContent=xe(E),qe.empty(t.dexOrderTxsTableBody),qe.setVis(e.transactions&&e.transactions.length>0,t.dexOrderTxsTable);for(var f=function(e,t){switch(e){case 3:case 5:case 6:return t?o:s;case 4:return t?s:o}},v=0;e.transactions&&v<e.transactions.length;v++){var m=e.transactions[v],g=t.dexOrderTxRowTmpl.cloneNode(!0),y=qe.parseTemplate(g);y.id.textContent=cs(m.id,20),y.id.setAttribute("title",m.id),y.type.textContent=sa(m.type);var b=f(m.type,e.sell);if(b){var x=Hn[b.id];x&&x[ss]&&(y.explorerLink.href=x[ss](m.id)),y.amt.textContent="".concat(qe.formatCoinValue(m.amount,b.unitInfo)," ").concat(b.unitInfo.conventional.unit.toLowerCase()),y.fees.textContent="".concat(qe.formatCoinValue(m.fees,b.unitInfo)," ").concat(b.unitInfo.conventional.unit.toLowerCase()),t.dexOrderTxsTableBody.appendChild(g)}else console.error("unexpected tx type in dex order event",m.type)}this.forms.show(t.dexOrderDetailsForm)}},{key:"showCexOrderEventDetails",value:function(e){var t=this.page,n=this.mkt,r=n.baseID,a=n.quoteID,o=pt().assets[r],s=pt().assets[a],i=[o.unitInfo,s.unitInfo],c=i[0],l=i[1],u=[c.conventional.unit,l.conventional.unit],d=u[0],h=u[1];t.cexOrderID.textContent=cs(e.id,20),void 0!==this.cexOrderIDCopyListener&&t.copyCexOrderID.removeEventListener("click",this.cexOrderIDCopyListener),this.cexOrderIDCopyListener=function(){nt(e.id,t.cexOrderID,t.copyCexOrderID,"#1e7d11")},t.copyCexOrderID.addEventListener("click",this.cexOrderIDCopyListener),t.cexOrderID.setAttribute("title",e.id);var p=pt().conventionalRate(r,a,e.rate);t.cexOrderRate.textContent="".concat(p," ").concat(d,"/").concat(h),t.cexOrderQty.textContent="".concat(e.qty/c.conventional.conversionFactor," ").concat(d),e.sell?t.cexOrderSide.textContent=xe(B):t.cexOrderSide.textContent=xe(E),t.cexOrderBaseFilled.textContent="".concat(e.baseFilled/c.conventional.conversionFactor," ").concat(d),t.cexOrderQuoteFilled.textContent="".concat(e.quoteFilled/l.conventional.conversionFactor," ").concat(h),this.forms.show(t.cexOrderDetailsForm)}},{key:"showDepositEventDetails",value:function(e,t){var n=this.page;n.depositID.textContent=cs(e.transaction.id,20),void 0!==this.depositIDCopyListener&&n.copyDepositID.removeEventListener("click",this.depositIDCopyListener),this.depositIDCopyListener=function(){nt(e.transaction.id,n.depositID,n.copyDepositID,"#1e7d11")},n.copyDepositID.addEventListener("click",this.depositIDCopyListener),n.depositID.setAttribute("title",e.transaction.id);var r=pt().assets[e.assetID].unitInfo,a=r.conventional.unit;n.depositAmt.textContent="".concat(qe.formatCoinValue(e.transaction.amount,r)," ").concat(a),n.depositFees.textContent="".concat(qe.formatCoinValue(e.transaction.fees,r)," ").concat(a),n.depositStatus.textContent=xe(t?me:ge),qe.setVis(!t,n.depositCreditSection),t||(n.depositCredit.textContent="".concat(qe.formatCoinValue(e.cexCredit,r)," ").concat(a)),this.forms.show(n.depositDetailsForm)}},{key:"showWithdrawalEventDetails",value:function(e,t){var n=this.page;n.withdrawalID.textContent=cs(e.id,20),void 0!==this.withdrawalIDCopyListener&&n.copyWithdrawalID.removeEventListener("click",this.withdrawalIDCopyListener),this.withdrawalIDCopyListener=function(){nt(e.id,n.withdrawalID,n.copyWithdrawalID,"#1e7d11")},n.copyWithdrawalID.addEventListener("click",this.withdrawalIDCopyListener),n.withdrawalID.setAttribute("title",e.id);var r=pt().assets[e.assetID].unitInfo,a=r.conventional.unit;n.withdrawalAmt.textContent="".concat(qe.formatCoinValue(e.cexDebit,r)," ").concat(a),n.withdrawalStatus.textContent=xe(t?me:ge),e.transaction&&(n.withdrawalTxID.textContent=cs(e.transaction.id,20),n.withdrawalTxID.setAttribute("title",e.transaction.id),n.withdrawalReceived.textContent="".concat(qe.formatCoinValue(e.transaction.amount,r)," ").concat(a)),this.forms.show(n.withdrawalDetailsForm)}},{key:"showEventDetails",value:function(e){var t=a(this.events[e],1)[0];t.dexOrderEvent&&this.showDexOrderEventDetails(t.dexOrderEvent),t.cexOrderEvent&&this.showCexOrderEventDetails(t.cexOrderEvent),t.depositEvent&&this.showDepositEventDetails(t.depositEvent,t.pending),t.withdrawalEvent&&this.showWithdrawalEventDetails(t.withdrawalEvent,t.pending)}}]),p}(ct);function cs(e,t){return e.length<=t?e:"".concat(e.substring(0,t/2),"...").concat(e.substring(e.length-t/2))}function ls(e,t){var n=0;return t.settled[e]&&(n+=t.settled[e]),t.pending[e]&&(n+=t.pending[e]),t.locked[e]&&(n+=t.locked[e]),t.reserved[e]&&(n+=t.reserved[e]),n}function us(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ds(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ds(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function ds(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var hs,ps=function(e){g(o,e);var t,n,r,a=(n=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(n);if(r){var a=b(this).constructor;e=Reflect.construct(t,arguments,a)}else e=t.apply(this,arguments);return y(this,e)});function o(e){var t;i(this,o),h(v(t=a.call(this)),"body",void 0),h(v(t),"page",void 0),h(v(t),"initForm",void 0),h(v(t),"quickConfigForm",void 0),h(v(t),"seedBackupForm",void 0),h(v(t),"mnemonic",void 0),t.body=e;var n=t.page=qe.idDescendants(e);return t.initForm=new fs(n.appPWForm,(function(e,n,r){t.appInited(e,n,r)})),t.quickConfigForm=new ms(n.quickConfigForm,(function(){return t.quickConfigDone()})),t.seedBackupForm=new gs(n.seedBackupForm,(function(){return t.seedBackedUp()})),t}return d(o,[{key:"appInited",value:(t=s(f().mark((function e(t,n,r){var a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.mnemonic=r,a=this.page,e.next=4,this.quickConfigForm.update(t,n);case 4:r&&this.seedBackupForm.update(r),_r(a.appPWForm,a.quickConfigForm);case 6:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"quickConfigDone",value:function(){this.mnemonic?_r(this.page.quickConfigForm,this.page.seedBackupForm):pt().loadPage("wallets")}},{key:"seedBackedUp",value:function(){pt().loadPage("wallets")}}]),o}(ct),fs=function(){function e(t,n){var r=this;i(this,e),h(this,"form",void 0),h(this,"page",void 0),h(this,"success",void 0),this.form=t,this.success=n;var a=this.page=qe.idDescendants(t);zr(t,a.appPWSubmit,(function(){return r.setAppPass()})),zr(t,a.toggleSeedInput,(function(){qe.isHidden(a.seedInputBox)?(a.toggleSeedInputIcon.classList.remove("ico-plus"),a.toggleSeedInputIcon.classList.add("ico-minus"),qe.show(a.seedInputBox)):(a.toggleSeedInputIcon.classList.remove("ico-minus"),a.toggleSeedInputIcon.classList.add("ico-plus"),qe.hide(a.seedInputBox))}))}var t;return d(e,[{key:"setAppPass",value:(t=s(f().mark((function e(){var t,n,r,a,o,s,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.page,qe.hide(n.appPWErrMsg),r=n.appPW.value||"",a=n.appPWAgain.value,""!==r){e.next=8;break}return n.appPWErrMsg.textContent=xe(R),qe.show(n.appPWErrMsg),e.abrupt("return");case 8:if(r===a){e.next=12;break}return n.appPWErrMsg.textContent=xe(N),qe.show(n.appPWErrMsg),e.abrupt("return");case 12:return n.appPW.value="",n.appPWAgain.value="",o=pt().loading(this.form),s=null!==(t=n.seedInput.value)&&void 0!==t?t:"",e.next=18,S("/api/init",{pass:r,seed:s});case 18:if(i=e.sent,o(),pt().checkResponse(i)){e.next=24;break}return n.appPWErrMsg.textContent=i.msg,qe.show(n.appPWErrMsg),e.abrupt("return");case 24:this.success(r,i.hosts,i.mnemonic);case 25:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),vs=0,ms=function(){function e(t,n){var r=this;i(this,e),h(this,"page",void 0),h(this,"form",void 0),h(this,"servers",void 0),h(this,"wallets",void 0),h(this,"pw",void 0),h(this,"success",void 0),this.form=t,this.success=n;var a=this.page=qe.idDescendants(t);qe.cleanTemplates(a.qcServerTmpl,a.qcWalletTmpl),zr(t,a.quickConfigSubmit,(function(){r.submit()})),zr(t,a.qcErrAck,(function(){r.success()}))}var t,n;return d(e,[{key:"update",value:(n=s(f().mark((function e(t,n){var r,a,o,s,i,c,l,u,d,h,p,v,m,g,y,b,x,k,w;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.pw=t,r=this.page,this.servers=[],a=us(n);try{for(a.s();!(o=a.n()).done;)s=o.value,i=r.qcServerTmpl.cloneNode(!0),r.qcServersBox.appendChild(i),c=qe.parseTemplate(i),vs++,l="qcsrow".concat(vs),i.htmlFor=l,c.checkbox.id=l,c.host.textContent=s,this.servers.push({host:s,checkbox:c.checkbox})}catch(e){a.e(e)}finally{a.f()}return e.next=7,pt().fetchUser();case 7:u=e.sent,this.wallets=[],d=0,h=Object.values(u.assets);case 10:if(!(d<h.length)){e.next=52;break}if(!(p=h[d]).token){e.next=14;break}return e.abrupt("continue",49);case 14:v=p.info,m=null,g=us(v.availablewallets),e.prev=17,g.s();case 19:if((y=g.n()).done){e.next=29;break}if((b=y.value).seeded){e.next=23;break}return e.abrupt("continue",27);case 23:if(!b.configopts||!b.configopts.some((function(e){return e.required}))){e.next=25;break}return e.abrupt("continue",27);case 25:return m=b,e.abrupt("break",29);case 27:e.next=19;break;case 29:e.next=34;break;case 31:e.prev=31,e.t0=e.catch(17),g.e(e.t0);case 34:return e.prev=34,g.f(),e.finish(34);case 37:if(m){e.next=39;break}return e.abrupt("continue",49);case 39:x=r.qcWalletTmpl.cloneNode(!0),r.qcWalletsBox.appendChild(x),k=qe.parseTemplate(x),vs++,w="qcwrow".concat(vs),x.htmlFor=w,k.checkbox.id=w,k.icon.src=qe.logoPath(p.symbol),k.name.textContent=p.name,this.wallets.push({asset:p,type:m.type,checkbox:k.checkbox});case 49:d++,e.next=10;break;case 52:case"end":return e.stop()}}),e,this,[[17,31,34,37]])}))),function(e,t){return n.apply(this,arguments)})},{key:"submit",value:(t=s(f().mark((function e(){var t,n,r,a,o,i,c,l,u,d,h,p,v=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],(r=new ln(this.form,{backgroundColor:!0,message:"..."})).opts.message=xe("ADDING_SERVER"),a=function(){var e=s(f().mark((function e(n){var r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.checkbox.checked){e.next=2;break}return e.abrupt("return");case 2:return r={addr:n.host,appPW:v.pw},e.next=5,S("/api/adddex",r);case 5:a=e.sent,pt().checkResponse(a)||t.push(n.host);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=6,Promise.all(this.servers.map(a));case 6:return r.opts.message=xe("CREATING_WALLETS"),o=function(){var e=s(f().mark((function e(t){var r,a,o,s,i,c,l,u,d,h;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.asset,o=t.type,t.checkbox.checked){e.next=3;break}return e.abrupt("return");case 3:s={},i=pt().walletDefinition(a.id,o),c=us(null!==(r=i.configopts)&&void 0!==r?r:[]),e.prev=6,c.s();case 8:if((l=c.n()).done){e.next=18;break}if((u=l.value).default){e.next=12;break}return e.abrupt("continue",16);case 12:if(!u.isboolean){e.next=15;break}return s[u.key]=u.default?"1":"0",e.abrupt("continue",16);case 15:u.repeatable&&s[u.key]?s[u.key]+=u.repeatable+u.default:s[u.key]=String(u.default);case 16:e.next=8;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(6),c.e(e.t0);case 23:return e.prev=23,c.f(),e.finish(23);case 26:return d={assetID:a.id,appPass:v.pw,config:s,walletType:o},e.next=29,S("/api/newwallet",d);case 29:h=e.sent,pt().checkResponse(h)||n.push(a.name);case 31:case"end":return e.stop()}}),e,null,[[6,20,23,26]])})));return function(t){return e.apply(this,arguments)}}(),e.next=10,Promise.all(this.wallets.map(o));case 10:return r.stop(),e.next=13,pt().fetchUser();case 13:if(n.length+t.length!==0){e.next=15;break}return e.abrupt("return",this.success());case 15:if(i=this.page,qe.hide(i.qcChoices),qe.show(i.qcErrors),t.length){c=us(t);try{for(c.s();!(l=c.n()).done;)u=l.value,i.qcServerErrorList.appendChild(document.createTextNode(u)),i.qcServerErrorList.appendChild(document.createElement("br"))}catch(e){c.e(e)}finally{c.f()}}else qe.hide(i.qcServerErrors);if(n.length){d=us(n);try{for(d.s();!(h=d.n()).done;)p=h.value,i.qcWalletErrorList.appendChild(document.createTextNode(p)),i.qcWalletErrorList.appendChild(document.createElement("br"))}catch(e){d.e(e)}finally{d.f()}}else qe.hide(i.qcWalletErrors);case 20:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),gs=function(){function e(t,n){var r=this;i(this,e),h(this,"form",void 0),h(this,"page",void 0),h(this,"mnemonic",void 0),this.form=t;var a=this.page=qe.idDescendants(t);zr(t,a.seedAck,(function(){return n()})),zr(t,a.showSeed,(function(){return r.showSeed()}))}return d(e,[{key:"update",value:function(e){this.mnemonic=e}},{key:"showSeed",value:function(){var e=this.page;e.mnemonic.textContent=this.mnemonic,qe.hide(e.sbWanna),qe.show(e.sbSeed)}}]),e}();function ys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ys(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xs(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ks(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ks(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function ks(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ws=qe.idel,Cs=qe.bind,Ss=qe.unbind,Fs={login:Yr,register:Qr,markets:ro,wallets:da,settings:Pa,orders:yo,order:Co,dexsettings:ts,init:ps,mm:Lo,mmsettings:Yo,mmarchives:ns,mmlogs:is},Ds={"en-US":{name:"English",flag:"🇺🇸"},"pt-BR":{name:"Portugese",flag:"🇧🇷"},"zh-CN":{name:"Chinese",flag:"🇨🇳"},"pl-PL":{name:"Polish",flag:"🇵🇱"},"de-DE":{name:"German",flag:"🇩🇪"},ar:{name:"Arabic",flag:"🇪🇬"}},Ts=function(){function e(){var t=this;i(this,e),h(this,"notes",void 0),h(this,"pokes",void 0),h(this,"langs",void 0),h(this,"lang",void 0),h(this,"mmStatus",void 0),h(this,"inited",void 0),h(this,"authed",void 0),h(this,"user",void 0),h(this,"seedGenTime",void 0),h(this,"commitHash",void 0),h(this,"showPopups",void 0),h(this,"loggers",void 0),h(this,"recorders",void 0),h(this,"main",void 0),h(this,"header",void 0),h(this,"headerSpace",void 0),h(this,"assets",void 0),h(this,"exchanges",void 0),h(this,"walletMap",void 0),h(this,"fiatRatesMap",void 0),h(this,"tooltip",void 0),h(this,"page",void 0),h(this,"loadedPage",void 0),h(this,"popupNotes",void 0),h(this,"popupTmpl",void 0),h(this,"noteReceivers",void 0),h(this,"txHistoryMap",void 0),h(this,"requiredActions",void 0),this.notes=[],this.pokes=[],this.seedGenTime=0,this.commitHash="d1f27b744a5d77e949996c380a8a50e8c064a05b",this.noteReceivers=[],this.fiatRatesMap={},this.showPopups="1"===k.fetchLocal(k.popupsLK),this.txHistoryMap={},this.requiredActions={},console.log("Bison Wallet, Build",this.commitHash.substring(0,7)),k.isDark()&&document.body.classList.add("dark"),this.loggers=k.fetchLocal(k.loggersLK)||{},window.enableLogger=function(e,n){return n?t.loggers[e]=!0:delete t.loggers[e],k.storeLocal(k.loggersLK,t.loggers),"".concat(e," logger ").concat(n?"enabled":"disabled")},window.log=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];t.log.apply(t,[e].concat(r))},window.mmStatus=function(){return t.mmStatus};var n=k.fetchLocal(k.recordersLK)||[];this.recorders={};var r,a=xs(n);try{for(a.s();!(r=a.n()).done;){var o=r.value;console.log("recording",o),this.recorders[o]=[]}}catch(e){a.e(e)}finally{a.f()}window.recordLogger=function(e,n){return n?t.recorders[e]=[]:delete t.recorders[e],k.storeLocal(k.recordersLK,Object.keys(t.recorders)),"".concat(e," recorder ").concat(n?"enabled":"disabled")},window.dumpLogger=function(e){var n=t.recorders[e];if(!n)return"no recorder for logger ".concat(e);var r=document.createElement("a");r.href="data:application/octet-stream;base64,".concat(window.btoa(JSON.stringify(n,null,4))),r.download="".concat(e,".json"),document.body.appendChild(r),r.click(),setTimeout((function(){document.body.removeChild(r)}),0)},window.user=function(){return t.user}}var t,n,o,c,l,u,p,v,m,g,y;return d(e,[{key:"start",value:(y=s(f().mark((function e(){var t,n,r=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Cs(window,"popstate",(function(e){var t,n=null===(t=e.state)||void 0===t?void 0:t.page;(n||""===n)&&r.loadPage(n,e.state.data,!0)})),this.main=ws(document,"main"),t=this.main.dataset.handler,e.next=5,this.fetchUser();case 5:return e.next=8,ye(this.lang,this.commitHash,!1);case 8:if(As((n=new URL(window.location.href)).pathname)!==t&&(n.pathname="/".concat(t),n.search="",window.history.replaceState({page:t},"",n)),this.attachHeader(),this.attachActions(),this.attachCommon(this.header),this.attach({}),!this.authed){e.next=17;break}return e.next=17,this.fetchNotes();case 17:this.updateMenuItemsDisplay(),Ta(),Wa.connect((void 0,a="https:"===window.location.protocol?"wss":"ws","".concat(a,"://").concat(window.location.host,"/ws")),(function(){return r.reconnected()})),Wa.registerRoute("notify",(function(e){r.notify(e)}));case 21:case"end":return e.stop()}var a}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"reconnected",value:function(){var e;"settings"===(null===(e=this.main)||void 0===e?void 0:e.dataset.handler)?window.location.assign("/"):window.location.reload()}},{key:"fetchUser",value:(g=s(f().mark((function e(){var t,n,r,o,s,i,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D("/api/user");case 2:if(t=e.sent,this.checkResponse(t)){e.next=5;break}return e.abrupt("return");case 5:if(this.inited=t.inited,this.authed=Boolean(t.user),this.lang=t.lang,this.langs=t.langs,this.mmStatus=t.mmStatus,t.user){e.next=12;break}return e.abrupt("return");case 12:for(n=t.user,this.seedGenTime=n.seedgentime,this.user=n,this.assets=n.assets,this.exchanges=n.exchanges,this.walletMap={},this.fiatRatesMap=n.fiatRates,r=0,o=Object.entries(n.assets);r<o.length;r++)s=a(o[r],2),i=s[0],(c=s[1]).wallet&&(this.walletMap[i]=c.wallet);return this.updateMenuItemsDisplay(),e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"fetchMMStatus",value:(m=s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,sr.status();case 2:this.mmStatus=e.sent;case 3:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"loadPage",value:(v=s(f().mark((function e(t,n,r){var a,o,s,i,c,l,u,d;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.tooltip.style.left="-10000px",qe.hide(this.page.noteBox,this.page.profileBox),a=new URL("/".concat(t),window.location.origin),o=As(t),e.next=6,window.fetch(a.toString());case 6:if((s=e.sent).ok){e.next=9;break}return e.abrupt("return",!1);case 9:return e.next=11,s.text();case 11:return i=e.sent,c=qe.noderize(i),l=ws(c,"main"),u=l.dataset.handler,r||(d=u===o?a.toString():"/".concat(u),window.history.pushState({page:t,data:n},"",d)),document.title=c.title,this.main.replaceWith(l),this.main=l,this.noteReceivers=[],qe.empty(this.headerSpace),this.attach(n),e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return v.apply(this,arguments)})},{key:"attach",value:function(e){var t=this.main.dataset.handler;if(t){this.attachCommon(this.main),this.loadedPage&&this.loadedPage.unload();var n=Fs[t];this.loadedPage=n?new n(this.main,e):null,this.bindTooltips(this.main),window.isWebview&&this.bindUrlHandlers(this.main),this.bindUnits(this.main)}else console.error("cannot attach to content with no specified handler")}},{key:"bindTooltips",value:function(e){var t=this;e.querySelectorAll("[data-tooltip]").forEach((function(e){Cs(e,"mouseenter",(function(){t.tooltip.textContent=e.dataset.tooltip||"";var n=qe.layoutMetrics(e),r=n.centerX-t.tooltip.offsetWidth/2;r<0&&(r=5),r+t.tooltip.offsetWidth>document.body.offsetWidth&&(r=document.body.offsetWidth-t.tooltip.offsetWidth-5),t.tooltip.style.left="".concat(r,"px"),t.tooltip.style.top="".concat(n.bodyTop-t.tooltip.offsetHeight-5,"px")})),Cs(e,"mouseleave",(function(){t.tooltip.style.left="-10000px"}))}))}},{key:"bindUnits",value:function(e){var t=this,n=document.createElement("div");n.classList.add("position-absolute","p-3");var r=document.createElement("div");n.appendChild(r),r.classList.add("body-bg","border");var a,o=function(e,t,n){var a=qe.safeSelector(e,"[data-unit-box]"),o=parseInt(a.dataset.atoms),s=document.createElement("div");s.textContent=t,r.appendChild(s),s.classList.add("p-2","hoverbg","pointer"),qe.bind(s,"click",(function(){qe.setText(e,"[data-value]",qe.formatFourSigFigs(o/n,Math.round(Math.log10(n)))),qe.setText(e,"[data-unit]",t)}))},s=xs(qe.applySelector(e,"[data-conversion-value]"));try{var i=function(){var e=a.value,s=qe.safeSelector(e,"[data-unit-box]");qe.bind(s,"mouseenter",(function(){qe.empty(r),s.appendChild(n);var a=qe.layoutMetrics(s),i=parseInt(s.dataset.assetID),c=t.assets[i].unitInfo;o(e,c.conventional.unit,c.conventional.conversionFactor);var l,u=xs(c.denominations);try{for(u.s();!(l=u.n()).done;){var d=l.value,h=d.unit,p=d.conversionFactor;o(e,h,p)}}catch(e){u.e(e)}finally{u.f()}o(e,c.atomicUnit,1),a.bodyTop>n.offsetHeight+t.header.offsetHeight?(n.style.bottom="calc(100% - 1rem)",n.style.top="auto"):(n.style.top="calc(100% - 1rem)",n.style.bottom="auto")})),qe.bind(s,"mouseleave",(function(){return n.remove()}))};for(s.s();!(a=s.n()).done;)i()}catch(e){s.e(e)}finally{s.f()}}},{key:"bindUrlHandlers",value:function(e){if(window.openUrl){var t,n=xs(qe.applySelector(e,"a[target=_blank]"));try{var r=function(){var e=t.value;qe.bind(e,"click",(function(t){var n;t.preventDefault(),window.openUrl(null!==(n=e.href)&&void 0!==n?n:"")}))};for(n.s();!(t=n.n()).done;)r()}catch(e){n.e(e)}finally{n.f()}}}},{key:"attachHeader",value:function(){var e=this;this.header=ws(document.body,"header");var t=this.page=qe.idDescendants(this.header);this.headerSpace=t.headerSpace,this.popupNotes=ws(document.body,"popupNotes"),this.popupTmpl=qe.tmplElement(this.popupNotes,"note"),this.popupTmpl?this.popupTmpl.remove():console.error("popupTmpl element not found"),this.tooltip=ws(document.body,"tooltip"),t.noteTmpl.removeAttribute("id"),t.noteTmpl.remove(),t.pokeTmpl.removeAttribute("id"),t.pokeTmpl.remove(),t.loader.remove(),qe.show(t.loader),Cs(t.noteBell,"click",s(f().mark((function n(){var r,a,o;return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:qe.hide(t.pokeList),qe.show(t.noteList),e.ackNotes(),t.noteCat.classList.add("active"),t.pokeCat.classList.remove("active"),e.showDropdown(t.noteBell,t.noteBox),qe.hide(t.noteIndicator),r=xs(e.notes);try{for(r.s();!(a=r.n()).done;)(o=a.value).acked&&o.el.classList.remove("firstview")}catch(e){r.e(e)}finally{r.f()}e.setNoteTimes(t.noteList),e.setNoteTimes(t.pokeList);case 11:case"end":return n.stop()}}),n)})))),Cs(t.burgerIcon,"click",(function(){qe.hide(t.logoutErr),e.showDropdown(t.burgerIcon,t.profileBox)})),Cs(t.innerNoteIcon,"click",(function(){qe.hide(t.noteBox)})),Cs(t.innerBurgerIcon,"click",(function(){qe.hide(t.profileBox)})),Cs(t.profileSignout,"click",s(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.signOut();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))),Cs(t.pokeCat,"click",(function(){e.setNoteTimes(t.pokeList),t.pokeCat.classList.add("active"),t.noteCat.classList.remove("active"),qe.hide(t.noteList),qe.show(t.pokeList),e.ackNotes()})),Cs(t.noteCat,"click",(function(){e.setNoteTimes(t.noteList),t.noteCat.classList.add("active"),t.pokeCat.classList.remove("active"),qe.hide(t.pokeList),qe.show(t.noteList),e.ackNotes()})),qe.cleanTemplates(t.langBttnTmpl);var n=Ds[this.lang],r=n.name,a=n.flag;t.langFlag.textContent=a,t.langName.textContent=r;var o,i=xs(this.langs);try{var c=function(){var n=o.value;if(n===e.lang)return"continue";var r=t.langBttnTmpl.cloneNode(!0),a=Ds[n],s=a.name,i=a.flag;r.textContent=i,r.title=s,qe.bind(r,"click",(function(){return e.setLanguage(n)})),t.langBttns.appendChild(r)};for(i.s();!(o=i.n()).done;)c()}catch(e){i.e(e)}finally{i.f()}}},{key:"attachActions",value:function(){var e=this,t=this.page;Object.assign(t,qe.idDescendants(qe.idel(document.body,"requiredActions"))),qe.cleanTemplates(t.missingNoncesTmpl,t.actionTxTableTmpl,t.tooCheapTmpl,t.lostNonceTmpl),qe.bind(t.actionsCollapse,"click",(function(){qe.hide(t.actionDialog),qe.show(t.actionDialogCollapsed)})),qe.bind(t.actionDialogCollapsed,"click",(function(){qe.hide(t.actionDialogCollapsed),qe.show(t.actionDialog),0===t.actionDialogContent.children.length&&e.showOldestAction()}));var n=function(t){var n=Object.values(e.requiredActions).filter((function(e){return e.selected}))[0],r=e.sortedActions(),a=r.indexOf(n);e.showRequestedAction(r[a+t].uniqueID)};qe.bind(t.prevAction,"click",(function(){return n(-1)})),qe.bind(t.nextAction,"click",(function(){return n(1)}))}},{key:"setRequiredActions",value:function(){var e=this.user.actions,t=this.requiredActions;if(e){var n,r=xs(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;this.addAction(a)}}catch(e){r.e(e)}finally{r.f()}Object.keys(t).length&&(this.showOldestAction(),this.blinkAction())}}},{key:"sortedActions",value:function(){var e=Object.values(this.requiredActions);return e.sort((function(e,t){return e.stamp-t.stamp})),e}},{key:"showOldestAction",value:function(){this.showRequestedAction(this.sortedActions()[0].uniqueID)}},{key:"addAction",value:function(e){var t=this.page,n=this.requiredActions,r=n[e.uniqueID];if(!r||r.actionID!==e.actionID){var a=this.actionForm(e);if(r)r.selected&&r.div.replaceWith(a),r.div=a;else{n[e.uniqueID]={div:a,stamp:(new Date).getTime(),uniqueID:e.uniqueID,actionID:e.actionID,selected:!1};var o=Object.keys(n).length;t.actionDialogCount.textContent=String(o),t.actionCount.textContent=String(o),qe.isHidden(t.actionDialog)&&this.showRequestedAction(e.uniqueID)}}}},{key:"blinkAction",value:function(){qe.blink(this.page.actionDialog),qe.blink(this.page.actionDialogCollapsed)}},{key:"resolveAction",value:function(e){this.resolveActionWithID(e.uniqueID)}},{key:"resolveActionWithID",value:function(e){var t=this.page,n=this.requiredActions,r=n[e];if(r){delete n[e];var a=Object.keys(n).length;r.div.remove(),0!==a?(t.actionDialogCount.textContent=String(a),t.actionCount.textContent=String(a),r.selected&&this.showOldestAction()):qe.hide(t.actionDialog,t.actionDialogCollapsed)}}},{key:"actionForm",value:function(e){switch(e.actionID){case"tooCheap":return this.tooCheapAction(e);case"missingNonces":return this.missingNoncesAction(e);case"lostNonce":return this.lostNonceAction(e);case"redeemRejected":return this.redeemRejectedAction(e)}throw Error("unknown required action ID "+e.actionID)}},{key:"actionTxTable",value:function(e){var t=e.assetID,n=e.payload,r=this.assets[t],a=r.unitInfo,o=r.token,s=this.page.actionTxTableTmpl.cloneNode(!0),i=qe.parseTemplate(s);i.lostTxID.textContent=n.tx.id,i.lostTxID.dataset.explorerCoin=n.tx.id,Gn(o?o.parentID:t,i.lostTxID),i.txAmt.textContent=qe.formatCoinValue(n.tx.amount,a),i.amtUnit.textContent=a.conventional.unit;var c=o?this.unitInfo(o.parentID):a;return i.type.textContent=sa(n.tx.type),i.feeAmount.textContent=qe.formatCoinValue(n.tx.fees,c),i.feeUnit.textContent=c.conventional.unit,"tooCheap"===e.actionID&&(qe.show(i.newFeesRow),i.newFees.textContent=qe.formatCoinValue(n.tx.fees,c),i.newFeesUnit.textContent=c.conventional.unit),s}},{key:"submitAction",value:(p=s(f().mark((function e(t,n,r){var a,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return qe.hide(r),a=this.loading(this.page.actionDialog),e.next=4,S("/api/takeaction",{assetID:t.assetID,actionID:t.actionID,action:n});case 4:if(o=e.sent,a(),this.checkResponse(o)){e.next=10;break}return r.textContent=o.msg,qe.show(r),e.abrupt("return");case 10:this.resolveActionWithID(t.uniqueID);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return p.apply(this,arguments)})},{key:"missingNoncesAction",value:function(e){var t=this,n=e.assetID,r=this.page.missingNoncesTmpl.cloneNode(!0),a=qe.parseTemplate(r),o=this.assets[n].name;return a.assetName.textContent=o,qe.bind(a.doNothingBttn,"click",(function(){t.submitAction(e,{recover:!1},a.errMsg)})),qe.bind(a.recoverBttn,"click",(function(){t.submitAction(e,{recover:!0},a.errMsg)})),r}},{key:"tooCheapAction",value:function(e){var t=this,n=e.assetID,r=e.payload,a=this.page.tooCheapTmpl.cloneNode(!0),o=qe.parseTemplate(a),s=this.assets[n].name;o.assetName.textContent=s,o.txTable.appendChild(this.actionTxTable(e));var i=function(n){t.submitAction(e,{txID:r.tx.id,bump:n},o.errMsg)};return qe.bind(o.keepWaitingBttn,"click",(function(){return i(!1)})),qe.bind(o.addFeesBttn,"click",(function(){return i(!0)})),a}},{key:"lostNonceAction",value:function(e){var t=this,n=e.assetID,r=e.payload,a=this.page.lostNonceTmpl.cloneNode(!0),o=qe.parseTemplate(a),s=this.assets[n].name;return o.assetName.textContent=s,o.nonce.textContent=String(r.nonce),o.txTable.appendChild(this.actionTxTable(e)),qe.bind(o.abandonBttn,"click",(function(){t.submitAction(e,{txID:r.tx.id,abandon:!0},o.errMsg)})),qe.bind(o.keepWaitingBttn,"click",(function(){t.submitAction(e,{txID:r.tx.id,abandon:!1},o.errMsg)})),qe.bind(o.replaceBttn,"click",(function(){var n=o.idInput.value;if(!n)return o.idInput.focus(),void qe.blink(o.idInput);t.submitAction(e,{txID:r.tx.id,abandon:!1,replacementID:n},o.errMsg)})),a}},{key:"redeemRejectedAction",value:function(e){var t=this,n=e.payload,r=n.orderID,a=n.coinID,o=n.coinFmt,s=n.assetID,i=this.page.rejectedRedemptionTmpl.cloneNode(!0),c=qe.parseTemplate(i),l=this.assets[s],u=l.name,d=l.token;return c.assetName.textContent=u,c.txid.textContent=o,c.txid.dataset.explorerCoin=a,Gn(d?d.parentID:s,c.txid),qe.bind(c.doNothingBttn,"click",(function(){t.submitAction(e,{orderID:r,coinID:a,retry:!1},c.errMsg)})),qe.bind(c.tryAgainBttn,"click",(function(){t.submitAction(e,{orderID:r,coinID:a,retry:!0},c.errMsg)})),i}},{key:"showRequestedAction",value:function(e){var t=this.page,n=this.requiredActions;qe.hide(t.actionDialogCollapsed);for(var r=0,a=Object.values(n);r<a.length;r++){var o=a[r];o.selected=o.uniqueID===e}qe.empty(t.actionDialogContent);var s=n[e];t.actionDialogContent.appendChild(s.div),qe.show(t.actionDialog);var i=this.sortedActions();if(1!==i.length){qe.show(t.actionsNavigator);var c=i.indexOf(s);t.currentAction.textContent=String(c+1),t.prevAction.classList.toggle("invisible",0===c),t.nextAction.classList.toggle("invisible",c===i.length-1)}else qe.hide(t.actionsNavigator)}},{key:"updateMarketElements",value:function(e,t,n,r){var a,o=this,s=function(e){var t=o.assets[e];if(t)return t;if(!r)throw Error("no asset found for asset ID ".concat(e));var n=r.assets[e];return{unitInfo:n.unitInfo,name:n.symbol,symbol:n.symbol}},i=s(t),c=i.unitInfo,l=i.name,u=i.symbol,d=xs(qe.applySelector(e,"[data-base-name"));try{for(d.s();!(a=d.n()).done;)a.value.textContent=l}catch(e){d.e(e)}finally{d.f()}var h,p=xs(qe.applySelector(e,"[data-base-logo]"));try{for(p.s();!(h=p.n()).done;)h.value.src=qe.logoPath(u)}catch(e){p.e(e)}finally{p.f()}var f,v=xs(qe.applySelector(e,"[data-base-ticker]"));try{for(v.s();!(f=v.n()).done;)f.value.textContent=c.conventional.unit}catch(e){v.e(e)}finally{v.f()}var m,g=s(n),y=g.unitInfo,b=g.name,x=g.symbol,k=xs(qe.applySelector(e,"[data-quote-name"));try{for(k.s();!(m=k.n()).done;)m.value.textContent=b}catch(e){k.e(e)}finally{k.f()}var w,C=xs(qe.applySelector(e,"[data-quote-logo]"));try{for(C.s();!(w=C.n()).done;)w.value.src=qe.logoPath(x)}catch(e){C.e(e)}finally{C.f()}var S,F=xs(qe.applySelector(e,"[data-quote-ticker]"));try{for(F.s();!(S=F.n()).done;)S.value.textContent=y.conventional.unit}catch(e){F.e(e)}finally{F.f()}}},{key:"setLanguage",value:(u=s(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("/api/setlocale",t);case 2:window.location.reload();case 3:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"showDropdown",value:function(e,t){var n=this;if(qe.hide(this.page.noteBox,this.page.profileBox),qe.show(t),window.innerWidth<500)Object.assign(t.style,{left:"0",right:"0",top:"0"});else{var r=e.getBoundingClientRect(),a="".concat(window.innerWidth-r.left-r.width+5,"px");Object.assign(t.style,{left:"auto",right:a,top:"".concat(r.top-4,"px")})}Cs(document,"click",(function e(r){qe.mouseInElement(r,t)||(qe.hide(t),Ss(document,"click",e),t===n.page.noteBox&&qe.isDisplayed(n.page.noteList)&&n.ackNotes())}))}},{key:"ackNotes",value:function(){var e,t=[],n=xs(this.notes);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.acked?r.el.classList.remove("firstview"):(r.acked=!0,r.id&&r.severity>2&&t.push(r.id))}}catch(e){n.e(e)}finally{n.f()}t.length&&Wa.request("acknotes",t),qe.hide(this.page.noteIndicator)}},{key:"setNoteTimes",value:function(e){for(var t=0,n=Array.from(e.children);t<n.length;t++){var r=n[t];qe.safeSelector(r,"span.note-time").textContent=qe.timeSince(r.note.stamp)}}},{key:"bindInternalNavigation",value:function(e){var t=this,n=new URL(window.location.href);e.querySelectorAll("a").forEach((function(e){if(e.href){var r=new URL(e.href);if(r.origin===n.origin){var a=r.pathname.substring(1),o={};r.search&&r.searchParams.forEach((function(e,t){o[t]=e})),qe.bind(e,"click",(function(e){e.preventDefault(),t.loadPage(a,o)}))}}}))}},{key:"updateMenuItemsDisplay",value:function(){var e=this.page,t=this.authed,n=this.mmStatus;if(e){if(!t)return e.profileBox.classList.remove("authed"),void qe.hide(e.noteBell,e.walletsMenuEntry,e.marketsMenuEntry);qe.setVis(Object.keys(this.exchanges).length>0,e.marketsMenuEntry,e.mmLink),e.profileBox.classList.add("authed"),qe.show(e.noteBell,e.walletsMenuEntry,e.marketsMenuEntry),qe.setVis(n,e.mmLink)}}},{key:"fetchNotes",value:(l=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D("/api/notes");case 2:if(t=e.sent,this.checkResponse(t)){e.next=5;break}return e.abrupt("return",console.error("failed to fetch notes:",(null==t?void 0:t.msg)||String(t)));case 5:t.notes.reverse(),this.setNotes(t.notes),this.setPokes(t.pokes),this.setRequiredActions();case 9:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"attachCommon",value:function(e){this.bindInternalNavigation(e)}},{key:"updateBondConfs",value:function(e,t,n){var r,a=xs(this.exchanges[e].auth.pendingBonds);try{for(a.s();!(r=a.n()).done;){var o=r.value;o.coinID===t&&(o.confs=n)}}catch(e){a.e(e)}finally{a.f()}}},{key:"updateTier",value:function(e,t){this.exchanges[e].auth.rep.bondedTier=t}},{key:"handleBondNote",value:function(e){switch(e.auth&&(this.exchanges[e.dex].auth=e.auth),e.topic){case"RegUpdate":null!==e.coinID&&this.updateBondConfs(e.dex,e.coinID,e.confirmations);break;case"BondConfirmed":null!==e.tier&&this.updateTier(e.dex,e.tier)}}},{key:"handleTransactionNote",value:function(e,t){var n=this.txHistoryMap[e];if(n)if(t.new)n.txs.unshift(t.transaction);else for(var r=0;r<n.txs.length;r++)if(n.txs[r].id===t.transaction.id){n.txs[r]=t.transaction;break}}},{key:"handleTxHistorySyncedNote",value:function(e){delete this.txHistoryMap[e]}},{key:"loggedIn",value:function(e,t){this.setNotes(e),this.setPokes(t),this.setRequiredActions()}},{key:"setNotes",value:function(e){this.log("notes","setNotes",e),this.notes=[],qe.empty(this.page.noteList);for(var t=0;t<e.length;t++)this.prependNoteElement(e[t])}},{key:"setPokes",value:function(e){this.log("pokes","setPokes",e),this.pokes=[],qe.empty(this.page.pokeList);for(var t=0;t<e.length;t++)this.prependPokeElement(e[t])}},{key:"botStatus",value:function(e,t,n){var r,a,o,s=xs(null!==(r=null===(a=this.mmStatus)||void 0===a?void 0:a.bots)&&void 0!==r?r:[]);try{for(s.s();!(o=s.n()).done;){var i=o.value,c=i.config;if(e===c.host&&t===c.baseID&&n===c.quoteID)return i}}catch(e){s.e(e)}finally{s.f()}}},{key:"updateUser",value:function(e){var t=this.user,n=this.assets,r=this.walletMap;if("fiatrateupdate"!==e.type){if(t)switch(e.type){case"order":var o=e,s=o.order,i=t.exchanges[s.host].markets[s.market],c=o.tempID;if("AsyncOrderSubmitted"===e.topic){var l=s;l.tempID=c,i.inflight?i.inflight.push(l):i.inflight=[l];break}if("AsyncOrderFailure"===e.topic){i.inflight=i.inflight.filter((function(e){return e.tempID!==c}));break}for(var u in i.inflight||[])if(i.inflight[u].tempID===c){i.inflight=i.inflight.filter((function(e){return e.tempID!==c}));break}i.orders=i.orders||[],function(t,n){var r=t.orders.findIndex((function(e){return e.id===n.id}));return-1!==r&&("OrderRetired"===e.topic?t.orders.splice(r,1):t.orders[r]=n,!0)}(i,s)||i.orders.push(s);break;case"balance":var d=e,h=t.assets[d.assetID];if(!h)break;var p=h.wallet;p&&(p.balance=d.balance);break;case"bondpost":this.handleBondNote(e);break;case"reputation":var f=e;this.exchanges[f.host].auth.rep=f.rep;break;case"walletstate":case"walletconfig":if(!n)return;var v=null==e?void 0:e.wallet;if(!v)return;n[v.assetID].wallet=v,r[v.assetID]=v;break;case"walletsync":var m=e,g=this.walletMap[m.assetID];g&&(g.syncStatus=m.syncStatus,g.synced=g.syncStatus.synced,g.syncProgress=m.syncProgress);break;case"match":var y=e,b=this.order(y.orderID);b&&function(e,t){for(var n in e.matches)if(e.matches[n].matchID===t.matchID)return void(e.matches[n]=t);e.matches=e.matches||[],e.matches.push(t)}(b,y.match);break;case"conn":var x=e,k=t.exchanges[x.host];k&&(k.connectionStatus=x.connectionStatus);break;case"spots":var w=e,C=t.exchanges[w.host];if(!C||!C.markets)break;for(var S=0,F=Object.entries(w.spots);S<F.length;S++){var D=a(F[S],2),T=D[0],I=D[1];C.markets[T].spot=I}break;case"fiatrateupdate":this.fiatRatesMap=e.fiatRates;break;case"actionrequired":var A=e;this.addAction(A.payload);break;case"walletnote":var R=e;switch(R.payload.route){case"transaction":var E=R.payload;this.handleTransactionNote(R.payload.assetID,E);break;case"actionRequired":var B=R.payload;this.addAction(B),this.blinkAction();break;case"actionResolved":this.resolveAction(R.payload)}"transactionHistorySynced"===R.payload.route&&this.handleTxHistorySyncedNote(R.payload.assetID);break;case"runstats":this.log("mm",{runstats:e});var P=e,L=this.botStatus(P.host,P.baseID,P.quoteID);L&&(L.runStats=P.stats,L.running=Boolean(P.stats),P.stats||(L.latestEpoch=void 0,L.cexProblems=void 0));break;case"cexnote":var O=e;if("BalanceUpdate"===O.topic){var M=O.note;this.mmStatus.cexes[O.cexName].balances[M.assetID]=M.balance}break;case"epochreport":var q=e,N=this.botStatus(q.host,q.baseID,q.quoteID);N&&(N.latestEpoch=q.report);break;case"cexproblems":var W=e,V=this.botStatus(W.host,W.baseID,W.quoteID);V&&(V.cexProblems=W.problems)}}else this.fiatRatesMap=e.fiatRates}},{key:"notify",value:function(e){this.log("notes","notify",e),this.updateUser(e);var t,n=xs(this.noteReceivers);try{for(n.s();!(t=n.n()).done;){var r=t.value[e.type];if(r)try{r(e)}catch(t){console.error("note feeder error:",t.message?t.message:t),console.log(e),console.log(t.stack)}}}catch(e){n.e(e)}finally{n.f()}if(!(e.severity<2)){var a=this.popupTmpl,o=this.popupNotes;if(this.showPopups){var i=a.cloneNode(!0);qe.tmplElement(i,"text").textContent="".concat(e.subject,": ").concat(Ea(e.details));var c=qe.tmplElement(i,"indicator");for(2===e.severity?qe.hide(c):Es(c,e.severity),o.appendChild(i),qe.show(o);o.children.length>5;)o.removeChild(o.firstChild);setTimeout(s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qe.animate(500,(function(e){i.style.opacity=String(1-e)}));case 2:i.remove(),0===o.children.length&&qe.hide(o);case 4:case"end":return e.stop()}}),e)}))),6e3)}2===e.severity?this.prependPokeElement(e):this.prependNoteElement(e),function(e){Da.apply(this,arguments)}(e)}}},{key:"registerNoteFeeder",value:function(e){this.noteReceivers.push(e)}},{key:"log",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];this.loggers[e]&&(t=console).log.apply(t,["".concat(Rs(),"[").concat(e,"]:")].concat(r)),this.recorders[e]&&this.recorders[e].push({time:Rs(),msg:r})}},{key:"prependPokeElement",value:function(e){var t=a(this.makePoke(e),2),n=t[0],r=t[1];for(this.pokes.push(r);this.pokes.length>100;)this.pokes.shift();this.prependListElement(this.page.pokeList,r,n)}},{key:"prependNoteElement",value:function(e){var t=a(this.makeNote(e),2),n=t[0],r=t[1];for(this.notes.push(r);this.notes.length>100;)this.notes.shift();var o=this.page.noteList;if(this.prependListElement(o,r,n),this.bindUrlHandlers(n),!(0===this.notes.length||qe.isDisplayed(this.page.noteBox)&&qe.isDisplayed(o))){var s=0,i=this.notes.reduce((function(e,t){return t.acked||s++,!t.acked&&t.severity>e?t.severity:e}),0),c=this.page.noteIndicator;Es(c,i),s?(c.textContent=String(s>99?"".concat(99,"+"):s),qe.show(c)):qe.hide(c)}}},{key:"prependListElement",value:function(e,t,n){for(n.note=t,e.prepend(n);e.children.length>100;)e.removeChild(e.lastChild);this.setNoteTimes(e)}},{key:"makeNote",value:function(e){var t=this.page.noteTmpl.cloneNode(!0);if(e.severity>2){var n=3===e.severity?"good":4===e.severity?"warn":"bad";qe.safeSelector(t,"div.note-indicator").classList.add(n)}return qe.safeSelector(t,"div.note-subject").textContent=e.subject,Ra(qe.safeSelector(t,"div.note-details"),e.details),[t,bs({el:t},e)]}},{key:"makePoke",value:function(e){var t=this.page.pokeTmpl.cloneNode(!0);return qe.tmplElement(t,"subject").textContent="".concat(e.subject,":"),Ra(qe.tmplElement(t,"details"),e.details),[t,bs({el:t},e)]}},{key:"loading",value:function(e){var t=this.page.loader.cloneNode(!0);return e.appendChild(t),function(){t.remove()}}},{key:"orders",value:function(e,t){var n=[],r=this.user.exchanges[e].markets[t];return r.orders&&(n=n.concat(r.orders)),r.inflight&&(n=n.concat(r.inflight)),n}},{key:"haveActiveOrders",value:function(e){for(var t=0,n=Object.values(this.user.exchanges);t<n.length;t++){var r=n[t];if(r.markets)for(var a=0,o=Object.values(r.markets);a<o.length;a++){var s=o[a];if(s.orders){var i,c=xs(s.orders);try{for(c.s();!(i=c.n()).done;){var l=i.value;if((l.baseID===e||l.quoteID===e)&&(l.status<Rt||Ut(l)))return!0}}catch(e){c.e(e)}finally{c.f()}}}}return!1}},{key:"order",value:function(e){for(var t=0,n=Object.values(this.user.exchanges);t<n.length;t++){var r=n[t];if(r&&r.markets)for(var a=0,o=Object.values(r.markets);a<o.length;a++){var s=o[a];if(s.orders){var i,c=xs(s.orders);try{for(c.s();!(i=c.n()).done;){var l=i.value;if(l.id===e)return l}}catch(e){c.e(e)}finally{c.f()}}}}return null}},{key:"canAccelerateOrder",value:function(e){var t;t=e.sell?e.baseID:e.quoteID;var n=this.walletMap[t];if(!(n&&16&n.traits))return!1;if(e.matches)for(var r=0;r<(null===(a=e.matches)||void 0===a?void 0:a.length);r++){var a,o=e.matches[r];if(o.swap&&o.swap.confs&&0===o.swap.confs.count&&!o.revoked)return!0}return!1}},{key:"unitInfo",value:function(e,t){var n=this.assets[e];if(n)return n.unitInfo;if(!t||!t.assets)throw Error(xe("UNSUPPORTED_ASSET_INFO_ERR_MSG",{assetID:"".concat(e)}));return t.assets[e].unitInfo}},{key:"parentAsset",value:function(e){var t=this.assets[e];return t.token?this.assets[t.token.parentID]:t}},{key:"baseChainSymbol",value:function(e){var t=this.user.assets[e];return t.token?this.user.assets[t.token.parentID].symbol:t.symbol}},{key:"extensionWallet",value:function(e){var t;return null===(t=this.user.extensionModeConfig)||void 0===t?void 0:t.restrictedWallets[this.baseChainSymbol(e)]}},{key:"conventionalRate",value:function(e,t,n,r){var a=[this.unitInfo(e,r),this.unitInfo(t,r)],o=a[1];return n*(a[0].conventional.conversionFactor/o.conventional.conversionFactor)/qt}},{key:"walletDefinition",value:function(e,t){var n=this.assets[e];if(n.token)return n.token.definition;if(!n.info)throw Error("where's the wallet info?");return""===t?n.info.availablewallets[n.info.emptyidx]:n.info.availablewallets.filter((function(e){return e.type===t}))[0]}},{key:"currentWalletDefinition",value:function(e){var t=this.assets[e];return t.token?t.token.definition:this.walletDefinition(e,this.assets[e].wallet.type)}},{key:"fetchBalance",value:(c=s(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("/api/balance",{assetID:t});case 2:if(n=e.sent,this.checkResponse(n)){e.next=5;break}throw new Error("failed to fetch balance for asset ID ".concat(t));case 5:return e.abrupt("return",n.balance);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"checkResponse",value:function(e){return e.requestSuccessful&&e.ok}},{key:"signOut",value:(o=s(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("/api/logout");case 2:if(t=e.sent,this.checkResponse(t)){e.next=7;break}return t.code===A.activeOrdersErr?this.page.logoutErr.textContent=xe("ACTIVE_ORDERS_LOGOUT_ERR_MSG"):this.page.logoutErr.textContent=t.msg,qe.show(this.page.logoutErr),e.abrupt("return");case 7:k.removeCookie(k.authCK),k.removeCookie(k.pwKeyCK),k.removeLocal(k.notificationsLK),window.location.href="/login";case 11:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"txHistory",value:(n=s(f().mark((function e(t,n,a){var o,s,i,c,l,u,d,h,p,v,m,g;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="/api/txhistory",s=this.txHistoryMap[t]){e.next=12;break}return e.next=5,S(o,{n,assetID:t});case 5:if(i=e.sent,this.checkResponse(i)){e.next=8;break}throw new Error(i.msg);case 8:return(c=i.txs)||(c=[]),this.txHistoryMap[t]={txs:c,lastTx:c.length<n},e.abrupt("return",this.txHistoryMap[t]);case 12:if(l=[],u=!1,d=a?s.txs.findIndex((function(e){return e.id===a}))+1:0,!a||-1!==d){e.next=17;break}throw new Error("invalid after tx "+a);case 17:for(h=d,p=d;p<s.txs.length&&l.length<n;p++)l.push(s.txs[p]),h=p,a=s.txs[p].id;if(s.lastTx&&h===s.txs.length-1&&(u=!0),!(l.length<n)||s.lastTx){e.next=33;break}return e.next=23,S(o,{n:n-l.length+1,assetID:t,refID:a,past:!0});case 23:if(m=e.sent,this.checkResponse(m)){e.next=26;break}throw new Error(m.msg);case 26:(g=m.txs)||(g=[]),g.length>0&&a&&(g[0].id===a?g.shift():console.error("First tx history element != refID")),s.lastTx=g.length<n-l.length,u=s.lastTx,l.push.apply(l,r(g)),(v=s.txs).push.apply(v,r(g));case 33:return e.abrupt("return",{txs:l,lastTx:u});case 34:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"getWalletTx",value:function(e,t){var n=this.txHistoryMap[e];if(n)return n.txs.find((function(e){return e.id===t}))}},{key:"clearTxHistory",value:function(e){delete this.txHistoryMap[e]}},{key:"needsCustomProvider",value:(t=s(f().mark((function e(t){var n,r,a,o,s,i,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=null!==(n=null===(r=this.assets[t])||void 0===r||null===(a=r.token)||void 0===a?void 0:a.parentID)&&void 0!==n?n:t){e.next=3;break}return e.abrupt("return",!1);case 3:if(s=this.walletMap[o]){e.next=6;break}return e.abrupt("return",!1);case 6:if(0!=(16384&s.traits)){e.next=9;break}return e.abrupt("return",!1);case 9:return e.next=11,S("/api/walletsettings",{assetID:o});case 11:if(i=e.sent,this.checkResponse(i)){e.next=15;break}return console.error(i.msg),e.abrupt("return",!1);case 15:return c=i.map,e.abrupt("return",!c.providers);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Is=(h(hs={},3,"good"),h(hs,5,"bad"),h(hs,4,"warn"),hs);function As(e){return e.replace(/^\//,"").split("/")[0].split("?")[0].split("#")[0]}function Rs(){var e=new Date,t=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0"),r=e.getSeconds().toString().padStart(2,"0"),a=e.getMilliseconds().toString().padStart(3,"0");return"".concat(t,":").concat(n,":").concat(r,".").concat(a)}function Es(e,t){e.classList.remove("bad","warn","good"),e.classList.add(Is[t])}var Bs=new Ts;at=Bs,Bs.start()})()})();
//# sourceMappingURL=entry.js.map